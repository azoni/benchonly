import{b as pt,u as ht,ai as gt,d as ft,r as x,D as X,G as Z,H as V,I as ee,J as z,M as te,j as e,w as bt,A as yt,B as se,k as jt,m as ae,f as $,h as Le,v as B,aj as Nt,ak as re,S as de,al as ne,am as Oe,X as vt,n as Me,Y as wt,N as Fe,O as He,Q as kt,an as Ge}from"./index-BH1MXG3y.js";import{o as St}from"./ouraService-D_y77Xx6.js";import{P as Dt}from"./pencil-B3kL8D_P.js";import{T as $t}from"./trash-2-DIsgLbDI.js";import{M as Et}from"./message-square-C07fH1sq.js";const me=[{text:"Reviewing your recent training sessions...",icon:"brain"},{text:"Analyzing strength progression trends...",icon:"calc"},{text:"Checking for pain history and injury risks...",icon:"alert"},{text:"Calculating working weights from your e1RM data...",icon:"calc"},{text:"Evaluating RPE patterns and recovery state...",icon:"brain"},{text:"Selecting exercises based on your focus area...",icon:"dumbbell"},{text:"Applying progressive overload to target weights...",icon:"calc"},{text:"Balancing volume with recovery capacity...",icon:"brain"},{text:"Building optimal set and rep schemes...",icon:"dumbbell"},{text:"Writing personalized coaching notes...",icon:"msg"}];function Pt(){var Ce;const le=pt();ht("Generate Workout");const[xe]=gt(),{user:k,userProfile:R,updateProfile:ue,isAppAdmin:ze}=ft(),[a]=x.useState(()=>{try{const t=xe.get("programContext");return t?JSON.parse(t):null}catch{return null}}),[S,pe]=x.useState(!1),[U,he]=x.useState(!0),[y,v]=x.useState(null),[_,Be]=x.useState(null),[ge,q]=x.useState(null),[fe,be]=x.useState(!1),[j,ye]=x.useState(!1),[je,Ne]=x.useState(null),[ie,Ue]=x.useState(!1),[W,oe]=x.useState([]),[Ct,ve]=x.useState(null),[P,E]=x.useState([]),L=x.useRef(null),T=x.useRef(null),[g,_e]=x.useState({recentWorkouts:[],goals:[],maxLifts:{},painHistory:{},rpeAverages:{},cardioHistory:[],ouraData:null}),[O,qe]=x.useState(()=>{var s;if(!a)return"";const t=[`Program: ${a.programName} — Week ${a.weekNumber} (${a.phase})`];return t.push(`Day: ${a.dayLabel} (${a.dayType})`),t.push(`Primary: ${a.primaryLift} ${a.primaryScheme} @ ${a.intensity}`),((s=a.accessories)==null?void 0:s.length)>0&&t.push(`Accessories: ${a.accessories.join(", ")}`),a.notes&&t.push(`Notes: ${a.notes}`),t.push(`
Generate this workout following the program prescription above. Use my actual performance data to calculate working weights.`),t.join(`
`)}),[N,Je]=x.useState(a?"bench":"auto"),[ce,Ke]=x.useState((a==null?void 0:a.dayType)==="deload"?"recovery":(a==null?void 0:a.dayType)==="test"?"max":(a==null?void 0:a.dayType)==="speed"?"light":"moderate"),[A,we]=x.useState("standard"),[M,Ye]=x.useState("auto"),[F,Qe]=x.useState("auto"),[D,ke]=x.useState(""),[Se,Xe]=x.useState(()=>{const t=xe.get("date");return t&&/^\d{4}-\d{2}-\d{2}$/.test(t)?t:new Date().toISOString().split("T")[0]}),J=ze;x.useEffect(()=>{k&&Ve()},[k]),x.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[P]),x.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]);const b=(t,s,n=null)=>{oe(l=>{const i=l.findIndex(r=>r.label===t);if(i>=0){const r=[...l];return r[i]={label:t,status:s,detail:n},r}return[...l,{label:t,status:s,detail:n}]}),ve(t)},Ze=()=>{E([]);let t=0;E([{...me[0],id:0}]),t=1,T.current=setInterval(()=>{t<me.length?(E(s=>[...s,{...me[t],id:t}]),t++):E(s=>[...s,{text:"Finalizing your workout...",icon:"brain",id:s.length}])},2e3)},De=()=>{T.current&&(clearInterval(T.current),T.current=null)},$e=t=>{switch(t){case"brain":return e.jsx(se,{className:"w-3 h-3 text-flame-400"});case"alert":return e.jsx(B,{className:"w-3 h-3 text-amber-400"});case"calc":return e.jsx(de,{className:"w-3 h-3 text-purple-400"});case"dumbbell":return e.jsx(wt,{className:"w-3 h-3 text-cyan-400"});case"msg":return e.jsx(Et,{className:"w-3 h-3 text-blue-400"});case"check":return e.jsx(Le,{className:"w-3 h-3 text-green-400"});case"error":return e.jsx(B,{className:"w-3 h-3 text-red-400"});default:return e.jsx($,{className:"w-3 h-3 text-flame-400 animate-spin"})}},Ve=async()=>{var t,s,n,l;try{he(!0),oe([]);const i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let r=[];b("Loading workout history","loading");try{(await X(Z(V(ee,"workouts"),z("userId","==",k.uid),te(50)))).docs.forEach(u=>{var f,m;const p=u.data();if(p.status==="completed"){const h=((m=(f=p.date)==null?void 0:f.toDate)==null?void 0:m.call(f))||new Date(p.date);r.push({...p,date:h.toISOString().split("T")[0],dayOfWeek:i[h.getDay()]})}})}catch(d){console.error(d)}try{(await X(Z(V(ee,"groupWorkouts"),z("assignedTo","==",k.uid),te(50)))).docs.forEach(u=>{var f,m;const p=u.data();if(p.status==="completed"){const h=((m=(f=p.date)==null?void 0:f.toDate)==null?void 0:m.call(f))||new Date(p.date);r.push({...p,date:h.toISOString().split("T")[0],dayOfWeek:i[h.getDay()]})}})}catch(d){console.error(d)}r.sort((d,u)=>new Date(u.date||0)-new Date(d.date||0)),r=r.slice(0,20),b("Loading workout history","complete",`${r.length} workouts found`),b("Analyzing max lifts","loading");const o={},c={},w={},mt=new Date;r.forEach(d=>{var f;const u=(f=d.date)!=null&&f.toDate?d.date.toDate():d.date?new Date(d.date):null,p=u&&!isNaN(u.getTime())?Math.floor((mt-u)/(1e3*60*60*24)):null;(d.exercises||[]).forEach(m=>{m.name&&(m.sets||[]).forEach(h=>{const I=parseFloat(h.actualWeight)||parseFloat(h.prescribedWeight)||0,Q=parseInt(h.actualReps)||parseInt(h.prescribedReps)||0,Ie=parseInt(h.rpe)||0,We=parseInt(h.painLevel)||0;if(!(!h.actualWeight&&!h.actualReps&&h.prescribedWeight)){if(I>0&&Q>0&&Q<=12){const Pe=Math.round(I*(1+Q/30));(!o[m.name]||Pe>o[m.name].e1rm)&&(o[m.name]={weight:I,reps:Q,e1rm:Pe})}We>0&&(c[m.name]||(c[m.name]={count:0,maxPain:0,lastDaysAgo:null,recentCount:0}),c[m.name].count++,c[m.name].maxPain=Math.max(c[m.name].maxPain,We),p!==null&&((c[m.name].lastDaysAgo===null||p<c[m.name].lastDaysAgo)&&(c[m.name].lastDaysAgo=p),p<=30&&c[m.name].recentCount++)),Ie>0&&(w[m.name]||(w[m.name]={total:0,count:0}),w[m.name].total+=Ie,w[m.name].count++)}})})});const Re=Object.keys(o).length,xt=Object.entries(o).sort((d,u)=>u[1].e1rm-d[1].e1rm).slice(0,3).map(([d,u])=>`${d}: ${u.e1rm}lb`);b("Analyzing max lifts","complete",Re>0?`${Re} lifts tracked. Top: ${xt.join(", ")}`:"No lift data found"),b("Checking pain history","loading");const Te=Object.keys(c).length,ut=Object.keys(c).slice(0,3).join(", ");b("Checking pain history",Te>0?"warning":"complete",Te>0?`Pain flagged on: ${ut}`:"No pain history"),b("Analyzing RPE patterns","loading");const H={};Object.entries(w).forEach(([d,u])=>{H[d]=Math.round(u.total/u.count*10)/10});const Ae=Object.values(H).length>0?(Object.values(H).reduce((d,u)=>d+u,0)/Object.values(H).length).toFixed(1):null;b("Analyzing RPE patterns","complete",Ae?`Average RPE: ${Ae}`:"No RPE data"),b("Loading goals","loading");let Y=[];try{Y=(await X(Z(V(ee,"goals"),z("userId","==",k.uid),te(10)))).docs.map(u=>u.data()).filter(u=>u.status==="active")}catch(d){console.error(d)}b("Loading goals","complete",Y.length>0?`${Y.length} active goals`:"No active goals"),b("Loading cardio history","loading");let C=[];try{C=(await X(Z(V(ee,"workouts"),z("userId","==",k.uid),z("workoutType","==","cardio"),te(20)))).docs.map(u=>{var f,m,h,I;const p=u.data();return{...p,date:((I=(h=(m=(f=p.date)==null?void 0:f.toDate)==null?void 0:m.call(f))==null?void 0:h.toISOString)==null?void 0:I.call(h).split("T")[0])||p.date}}),C.sort((u,p)=>new Date(p.date||0)-new Date(u.date||0)),C=C.slice(0,10)}catch(d){console.error(d)}b("Loading cardio history","complete",C.length>0?`${C.length} recent cardio sessions`:"No cardio data");let G=null;try{G=await St.getLatestScores(k.uid),G&&b("Loading Oura data","complete",`Readiness: ${((s=(t=G.latest)==null?void 0:t.readiness)==null?void 0:s.score)||"—"}, Sleep: ${((l=(n=G.latest)==null?void 0:n.sleep)==null?void 0:l.score)||"—"}`)}catch{}_e({recentWorkouts:r,goals:Y,maxLifts:o,painHistory:c,rpeAverages:H,cardioHistory:C,ouraData:G}),ve(null)}catch(i){console.error("Error loading context:",i)}finally{he(!1)}},et=async()=>{var n;const t=(R==null?void 0:R.credits)??0,s=A==="premium"?ne:re["generate-workout"];if(!J&&t<s){q(`Not enough credits. You need ${s} credits but have ${t}. Check Settings for your usage.`);return}pe(!0),q(null),b("Generating workout","loading"),Ze();try{J||ue({credits:t-s});const l=await Fe(),i=await fetch(He("generate-workout"),{method:"POST",headers:l,body:JSON.stringify({prompt:O,workoutFocus:N,intensity:ce,model:A,duration:M!=="auto"?parseInt(M):null,exerciseCount:F!=="auto"?parseInt(F):null,maxExercise:N==="1rm-test"?D:null,draftMode:!0,context:{recentWorkouts:g.recentWorkouts.slice(0,5),goals:g.goals,maxLifts:g.maxLifts,painHistory:g.painHistory,rpeAverages:g.rpeAverages,cardioHistory:g.cardioHistory,ouraData:g.ouraData}})});if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.error||"Failed to generate workout")}const r=await i.json();v(r.workout),Be(r.usage),De(),E(o=>[...o,{text:"Workout ready!",icon:"check",id:o.length}]),b("Generating workout","complete",`Created in ${(n=r.usage)==null?void 0:n.responseMs}ms`)}catch(l){console.error("Generation error:",l),q(l.message),J||ue({credits:t}),De(),E(i=>[...i,{text:`Error: ${l.message}`,icon:"error",id:i.length}]),b("Generating workout","error",l.message)}finally{pe(!1)}},tt=async()=>{if(y){be(!0);try{const t={...y,date:new Date(Se+"T12:00:00"),status:"scheduled"};a&&(t.programId=a.programId,t.programWeek=a.weekNumber,t.programDayLabel=a.dayLabel);const s=await kt.create(k.uid,t);if(a!=null&&a.programId&&(a!=null&&a.dayKey))try{const n=await Ge.get(a.programId);if(n){const l=[...n.completedDays||[],a.dayKey];await Ge.update(a.programId,{completedDays:l})}}catch(n){console.error("Failed to mark program day complete:",n)}le(`/workouts/${s.id}`)}catch(t){console.error("Save error:",t),q("Failed to save workout")}finally{be(!1)}}},st=(t,s)=>{v(n=>({...n,exercises:n.exercises.map((l,i)=>i===t?{...l,name:s}:l)}))},K=(t,s,n,l)=>{v(i=>({...i,exercises:i.exercises.map((r,o)=>o===t?{...r,sets:r.sets.map((c,w)=>w===s?{...c,[n]:l}:c)}:r)}))},at=t=>{v(s=>({...s,exercises:s.exercises.filter((n,l)=>l!==t)}))},rt=t=>{v(s=>({...s,exercises:s.exercises.map((n,l)=>{if(l!==t)return n;const i=n.sets[n.sets.length-1]||{};return{...n,sets:[...n.sets,{...i,id:Date.now(),completed:!1}]}})}))},nt=(t,s)=>{v(n=>({...n,exercises:n.exercises.map((l,i)=>i===t?{...l,sets:l.sets.filter((r,o)=>o!==s)}:l)}))},lt=async t=>{const s=y.exercises[t];if(s){Ne(t);try{const n=y.exercises.filter((o,c)=>c!==t).map(o=>o.name),l=await Fe(),i=await fetch(He("swap-exercise"),{method:"POST",headers:l,body:JSON.stringify({exerciseName:s.name,exerciseType:s.type||"weight",sets:s.sets,workoutContext:{otherExercises:n}})});if(!i.ok)throw new Error("Swap failed");const r=await i.json();r.exercise&&v(o=>({...o,exercises:o.exercises.map((c,w)=>w===t?{...r.exercise,type:r.exercise.type||c.type||"weight"}:c)}))}catch(n){console.error("Swap error:",n)}finally{Ne(null)}}},Ee=()=>{v(null),ye(!1),E([]),oe(t=>t.filter(s=>s.label!=="Generating workout"))},it=t=>{const s=t.type||"weight";return s==="time"?{label:"Time",color:"bg-blue-500/20 text-blue-400"}:s==="bodyweight"?{label:"BW",color:"bg-emerald-500/20 text-emerald-400"}:null},ot=(t,s)=>s==="time"?`${t.prescribedTime||"?"}s`:s==="bodyweight"?`${t.prescribedReps||"?"} reps`:`${t.prescribedWeight?`${t.prescribedWeight} lbs × `:""}${t.prescribedReps||"?"} reps`,ct=[{value:"auto",label:"Auto"},{value:"push",label:"Push"},{value:"pull",label:"Pull"},{value:"legs",label:"Legs"},{value:"upper",label:"Upper"},{value:"full",label:"Full Body"},{value:"bench",label:"Bench Focus"},{value:"no-equipment",label:"Bodyweight"},{value:"vacation",label:"Hotel / Travel"},{value:"1rm-test",label:"Test 1RM"}],dt=[{value:"light",label:"Light",desc:"RPE 5-6"},{value:"moderate",label:"Moderate",desc:"RPE 7-8"},{value:"heavy",label:"Heavy",desc:"RPE 8-9"},{value:"max",label:"Max",desc:"RPE 9-10"}];return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[a&&e.jsxs("div",{className:"mb-4 p-3 bg-flame-500/10 border border-flame-500/20 rounded-xl flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-flame-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(bt,{className:"w-4 h-4 text-flame-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-flame-300",children:a.programName}),e.jsxs("p",{className:"text-xs text-iron-400",children:["Week ",a.weekNumber," · ",a.phase," · ",a.dayLabel]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium border ${{primary:"bg-flame-500/20 text-flame-400 border-flame-500/30",volume:"bg-blue-500/20 text-blue-400 border-blue-500/30",speed:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",deload:"bg-green-500/20 text-green-400 border-green-500/30",test:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"}[a.dayType]||"bg-iron-800 text-iron-400 border-iron-700"}`,children:a.dayType})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>le(a?`/programs/${a.programId}`:"/workouts"),className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-xl transition-colors",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl text-iron-50",children:a?"Generate Program Workout":"AI Generate Workout"}),e.jsx("p",{className:"text-iron-400 mt-1",children:a?`${a.primaryLift} ${a.primaryScheme} @ ${a.intensity}`:"Personalized based on your training history"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 order-2 lg:order-1",children:e.jsxs("div",{className:"card-steel rounded-xl p-4",children:[e.jsxs("button",{onClick:()=>Ue(!ie),className:"flex items-center gap-2 w-full lg:cursor-default",children:[e.jsx(se,{className:"w-5 h-5 text-flame-400"}),e.jsx("h3",{className:"font-medium text-iron-200 flex-1 text-left",children:"Analysis"}),!U&&W.length>0&&e.jsxs("span",{className:"text-xs text-iron-500 lg:hidden",children:[W.filter(t=>t.status==="complete").length,"/",W.length]}),e.jsx(jt,{className:`w-4 h-4 text-iron-500 lg:hidden transition-transform ${ie?"rotate-180":""}`})]}),e.jsxs("div",{className:`${ie?"":"hidden"} lg:block mt-4`,children:[e.jsxs("div",{className:"space-y-3",children:[W.map((t,s)=>e.jsxs(ae.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:t.status==="loading"?e.jsx($,{className:"w-4 h-4 text-flame-400 animate-spin"}):t.status==="complete"?e.jsx(Le,{className:"w-4 h-4 text-green-400"}):t.status==="warning"?e.jsx(B,{className:"w-4 h-4 text-amber-400"}):e.jsx(B,{className:"w-4 h-4 text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-iron-200",children:t.label}),t.detail&&e.jsx("p",{className:"text-xs text-iron-500 mt-0.5 truncate",children:t.detail})]})]},t.label)),W.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-iron-500",children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Starting analysis..."})]})]}),(S||P.length>0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[S&&e.jsx($,{className:"w-3 h-3 text-flame-400 animate-spin"}),e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wider",children:S?"AI Thinking...":"AI Process"})]}),e.jsxs("div",{ref:L,className:"max-h-44 overflow-y-auto space-y-1.5",children:[P.map(t=>e.jsxs(ae.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:$e(t.icon)}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t.text})]},t.id)),S&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),!U&&!S&&P.length===0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-iron-800",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-3",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:g.recentWorkouts.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Workouts"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.keys(g.maxLifts).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Lifts Tracked"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:g.goals.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Goals"})]}),e.jsxs("div",{className:`bg-iron-800/50 rounded-lg p-2 ${Object.keys(g.painHistory).length>0?"border border-amber-500/30":""}`,children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.keys(g.painHistory).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Pain Flags"})]})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2 order-1 lg:order-2",children:S?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-iron-800/30 rounded-xl border border-flame-500/20 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-iron-700/50 bg-flame-500/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-flame-500/20 flex items-center justify-center",children:e.jsx(se,{className:"w-4 h-4 text-flame-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI is generating your workout..."}),e.jsxs("p",{className:"text-xs text-iron-500",children:[N!=="auto"?N:"Auto"," · ",ce," intensity",M!=="auto"?` · ${M}min`:"",F!=="auto"?` · ${F} exercises`:"",O?` · "${O.slice(0,40)}${O.length>40?"...":""}"`:""]})]}),e.jsx($,{className:"w-5 h-5 text-flame-400 animate-spin ml-auto"})]}),e.jsxs("div",{ref:L,className:"p-4 max-h-[400px] overflow-y-auto space-y-2.5 scrollbar-thin",children:[P.map(t=>e.jsxs(ae.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},className:"flex items-start gap-3 py-1",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0 w-5 h-5 rounded bg-iron-800 flex items-center justify-center",children:$e(t.icon)}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:t.text})]},t.id)),e.jsxs("div",{className:"flex items-center gap-1.5 pt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]})}):y?e.jsxs(ae.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-400 font-medium",children:"Draft"})}),j?e.jsx("input",{type:"text",value:y.name,onChange:t=>v(s=>({...s,name:t.target.value})),className:"input-field w-full text-xl font-semibold"}):e.jsx("h2",{className:"text-xl font-semibold text-iron-100",children:y.name}),y.description&&!j&&e.jsx("p",{className:"text-iron-400 mt-1",children:y.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ye(!j),className:`p-2 rounded-xl transition-colors ${j?"text-flame-400 bg-flame-500/10":"text-iron-400 hover:text-iron-200 hover:bg-iron-800"}`,title:j?"Done editing":"Edit workout",children:e.jsx(Dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Ee,className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-xl",title:"Start over",children:e.jsx(Oe,{className:"w-5 h-5"})})]})]}),_&&e.jsxs("p",{className:"text-xs text-iron-600 mt-2",children:[_.tokens," tokens · ",_.responseMs,"ms · ",_.cost]})]}),y.notes&&!j&&e.jsxs("div",{className:"border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2 px-6 pt-3",children:[e.jsx(se,{className:"w-4 h-4 text-flame-400"}),e.jsx("span",{className:"text-xs text-iron-500 uppercase tracking-wider",children:"Coaching Notes"})]}),e.jsx("div",{className:"px-6 py-3 max-h-32 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:y.notes})})]}),e.jsx("div",{className:"divide-y divide-iron-800",children:(Ce=y.exercises)==null?void 0:Ce.map((t,s)=>{var i;const n=it(t),l=t.type||"weight";return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-iron-800 flex items-center justify-center text-iron-400 text-sm font-medium",children:s+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[j?e.jsx("input",{type:"text",value:t.name,onChange:r=>st(s,r.target.value),className:"input-field w-full text-sm font-medium"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-iron-100",children:t.name}),n&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${n.color}`,children:n.label})]}),t.notes&&!j&&e.jsx("p",{className:"text-xs text-iron-500 mt-0.5",children:t.notes})]}),!j&&e.jsx("button",{onClick:()=>lt(s),disabled:je!==null,title:"Swap for similar exercise",className:"p-1.5 text-iron-500 hover:text-flame-400 hover:bg-flame-500/10 rounded-lg transition-colors disabled:opacity-30",children:je===s?e.jsx($,{className:"w-4 h-4 animate-spin text-flame-400"}):e.jsx(Oe,{className:"w-4 h-4"})}),j&&e.jsx("button",{onClick:()=>at(s),className:"p-1.5 text-red-400 hover:bg-red-500/10 rounded-lg",children:e.jsx($t,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"ml-11 space-y-1",children:[(i=t.sets)==null?void 0:i.map((r,o)=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-iron-500 w-12",children:["Set ",o+1]}),j?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[l==="time"?e.jsx("input",{type:"text",value:r.prescribedTime||"",onChange:c=>K(s,o,"prescribedTime",c.target.value),className:"input-field w-20 text-sm py-1",placeholder:"sec"}):l==="bodyweight"?e.jsx("input",{type:"text",value:r.prescribedReps||"",onChange:c=>K(s,o,"prescribedReps",c.target.value),className:"input-field w-20 text-sm py-1",placeholder:"reps"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:r.prescribedWeight||"",onChange:c=>K(s,o,"prescribedWeight",c.target.value),className:"input-field w-20 text-sm py-1",placeholder:"lbs"}),e.jsx("span",{className:"text-iron-500",children:"×"}),e.jsx("input",{type:"text",value:r.prescribedReps||"",onChange:c=>K(s,o,"prescribedReps",c.target.value),className:"input-field w-20 text-sm py-1",placeholder:"reps"})]}),e.jsx("button",{onClick:()=>nt(s,o),className:"p-1 text-iron-600 hover:text-red-400",children:e.jsx(vt,{className:"w-3 h-3"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-iron-300",children:ot(r,l)}),r.targetRpe&&e.jsxs("span",{className:"text-iron-500 cursor-help",title:`RPE ${r.targetRpe}/10 effort — ${r.targetRpe>=10?"all-out, nothing left":r.targetRpe>=9?"could maybe do 1 more rep":r.targetRpe>=8?"could do ~2 more reps":r.targetRpe>=7?"could do ~3 more reps":"comfortable, 4+ reps in reserve"}`,children:["@ RPE ",r.targetRpe]})]})]},o)),j&&e.jsxs("button",{onClick:()=>rt(s),className:"text-xs text-flame-400 hover:text-flame-300 mt-1 flex items-center gap-1",children:[e.jsx(Me,{className:"w-3 h-3"})," Add set"]})]})]},s)})}),e.jsxs("div",{className:"p-4 border-t border-iron-800 flex gap-3",children:[e.jsx("button",{onClick:Ee,className:"btn-secondary flex-1",children:"Regenerate"}),e.jsx("button",{onClick:tt,disabled:fe,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:fe?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-5 h-5"}),"Add to Workouts"]})})]})]}):e.jsxs("div",{className:"card-steel rounded-xl p-6",children:[e.jsx("h3",{className:"font-medium text-iron-200 mb-4",children:"Workout Options"}),!U&&Object.keys(g.maxLifts).length===0&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg flex items-start gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-300",children:"No training data yet"}),e.jsx("p",{className:"text-xs text-iron-500",children:"Weights will be set conservatively. Log a workout first for personalized loads."})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Describe your workout (optional)"}),e.jsx("textarea",{value:O,onChange:t=>qe(t.target.value),placeholder:"e.g., 'Heavy bench day with tricep accessories' or 'Similar to last week but more volume'",className:"input-field w-full min-h-[80px] resize-none"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Style"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ct.map(t=>e.jsxs("button",{onClick:()=>{Je(t.value),t.value!=="1rm-test"&&ke("")},className:`px-3 py-1.5 text-sm rounded-lg border transition-colors
                        ${N===t.value?t.value==="1rm-test"?"border-yellow-500 bg-yellow-500/10 text-yellow-400":"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[t.label,t.value==="1rm-test"&&e.jsx("span",{className:"ml-1 text-[9px] px-1 py-0.5 rounded-full bg-green-500/20 text-green-400 font-medium leading-none",children:"New"})]},t.value))}),N==="auto"&&e.jsx("p",{className:"text-[11px] text-iron-600 mt-2",children:"Auto selects exercises from your logged workouts and adjusts weights based on recent performance. The more you log, the more variety you'll get."})]}),N==="1rm-test"&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-500/5 border border-yellow-500/20 rounded-xl",children:[e.jsx("label",{className:"block text-sm text-yellow-400 mb-2",children:"Which lift are you testing?"}),e.jsx("input",{type:"text",value:D,onChange:t=>ke(t.target.value),placeholder:"e.g. Bench Press, Squat, Deadlift...",className:"input-field w-full",list:"known-exercises"}),e.jsx("datalist",{id:"known-exercises",children:Object.keys(g.maxLifts).map(t=>e.jsx("option",{value:t},t))}),D&&g.maxLifts[D]&&e.jsxs("p",{className:"text-xs text-iron-500 mt-2",children:["Current e1RM: ",e.jsxs("span",{className:"text-iron-300",children:[g.maxLifts[D].e1rm," lbs"]}),e.jsxs("span",{className:"text-iron-600",children:[" (best: ",g.maxLifts[D].weight,"×",g.maxLifts[D].reps,")"]})]}),e.jsx("p",{className:"text-xs text-iron-600 mt-1.5",children:"AI will generate warm-up ramps, attempt protocols, and accessory cooldown."})]}),N!=="1rm-test"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("label",{className:"text-sm text-iron-400",children:"Intensity"}),e.jsx("span",{className:"text-[10px] text-iron-600 bg-iron-800/80 px-1.5 py-0.5 rounded",title:"Rate of Perceived Exertion — 10 is max effort, 8 means you had ~2 more reps in you",children:"RPE = effort out of 10"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:dt.map(t=>e.jsxs("button",{onClick:()=>Ke(t.value),className:`px-3 py-2 text-sm rounded-lg border transition-colors text-center
                        ${ce===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsx("div",{className:"font-medium",children:t.label}),e.jsx("div",{className:"text-xs text-iron-500",children:t.desc})]},t.value))})]}),N!=="1rm-test"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Duration"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"15",label:"15m"},{value:"20",label:"20m"},{value:"30",label:"30m"},{value:"45",label:"45m"},{value:"60",label:"60m"},{value:"90",label:"90m"}].map(t=>e.jsx("button",{onClick:()=>Ye(t.value),className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                          ${M===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"8",label:"8"}].map(t=>e.jsx("button",{onClick:()=>Qe(t.value),className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                          ${F===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Workout Date"}),e.jsx("input",{type:"date",value:Se,onChange:t=>Xe(t.target.value),className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>we("standard"),className:`px-3 py-2 text-xs rounded-lg border transition-colors text-center
                        ${A==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(Nt,{className:"w-3 h-3"}),"Standard"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[re["generate-workout"]," cr"]})]}),e.jsxs("button",{onClick:()=>we("premium"),className:`px-3 py-2 text-xs rounded-lg border transition-colors text-center
                        ${A==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"Premium"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[ne," cr"]})]})]})]})]}),e.jsx("button",{onClick:et,disabled:S||U||N==="1rm-test"&&!D.trim()||!J&&((R==null?void 0:R.credits)??0)<(A==="premium"?ne:re["generate-workout"]),className:"btn-primary w-full flex items-center justify-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-5 h-5"}),"Generate Workout",e.jsxs("span",{className:"text-xs opacity-70 ml-1",children:["(",A==="premium"?ne:re["generate-workout"]," credits)"]})]})}),ge&&e.jsx("p",{className:"text-red-400 text-sm mt-3 text-center",children:ge})]})})]})]})}export{Pt as default};
