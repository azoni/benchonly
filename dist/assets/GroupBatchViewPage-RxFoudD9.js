import{a as ce,b as oe,d as xe,u as de,r as m,e as me,j as e,A as K,I as V,L as pe,l as he,n as ue,p as fe,Z as ge,H as be,f as Z,g as je,y as Ne,z as ve}from"./index-BtJ8VAyI.js";import{W as we}from"./WorkoutSummaryCard-C11D6V2s.js";import{E as ye}from"./ExerciseInfoModal-C6Ull8h4.js";import{M as k}from"./message-square-CISnFriZ.js";import"./external-link-Bu7AxTuG.js";const Re=a=>{if(a.type)return a.type;const i=a.sets||[];return i.some(d=>d.prescribedTime||d.actualTime)?"time":!i.some(d=>d.prescribedWeight||d.actualWeight)&&i.some(d=>d.prescribedReps||d.actualReps)?"bodyweight":"weight"},ke=a=>{switch(a){case"time":return{label:"Time",color:"bg-blue-500/20 text-blue-400"};case"bodyweight":return{label:"BW",color:"bg-emerald-500/20 text-emerald-400"};default:return null}},Te=(a,i)=>!a||!i||i<1?null:i===1?a:i>30?null:Math.round(a*(1+i/30)),E=(a,i="MMM d, yyyy")=>{if(!a)return"";try{const N=Ne(a);return isNaN(N.getTime())?"":ve(N,i)}catch{return""}},Ee=a=>a>=9?"text-red-400":a>=7?"text-yellow-400":"text-green-400",Se=a=>a>=7?"bg-red-500/20 text-red-400":a>=4?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400";function Ae(){var I,D,F,U;const{groupId:a,batchKey:i}=ce(),N=oe(),{user:d}=xe();de("Group Workout Batch");const[We,J]=m.useState(null),[S,Q]=m.useState([]),[h,X]=m.useState([]),[W,Y]=m.useState(0),[_,ee]=m.useState(!0),[C,L]=m.useState(null),[M,se]=m.useState(!1),{sidebarOpen:B}=me(),[te,$]=m.useState(0),[ae,re]=m.useState({top:0,left:0,right:0});m.useEffect(()=>{function r(){const t=window.matchMedia("(min-width: 1024px)").matches;re({top:t?0:"calc(env(safe-area-inset-top, 0px) + 3.5rem)",left:t?B?"16rem":"5rem":0,right:0})}r();const c=window.matchMedia("(min-width: 1024px)");return c.addEventListener("change",r),()=>c.removeEventListener("change",r)},[B]);const ne=m.useCallback(r=>{if(!r)return;$(r.offsetHeight),new ResizeObserver(()=>$(r.offsetHeight)).observe(r)},[]),A=decodeURIComponent(i);if(m.useEffect(()=>{async function r(){if(!(!a||!d))try{const[c,t]=await Promise.all([Z.getById(a),je.getByGroup(a,d.uid)]);if(J(c),c!=null&&c.members){const x=await Z.getMemberDetails(c.members);Q(x)}const g=t.filter(x=>{const f=E(x.date,"yyyy-MM-dd");return`${x.name}-${f}`===A});X(g)}catch(c){console.error("Error loading batch view:",c)}finally{ee(!1)}}r()},[a,i,d,A]),_)return e.jsx("div",{className:"min-h-[50vh] flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})});if(h.length===0)return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>N(`/groups/${a}`),className:"flex items-center gap-2 text-iron-400 hover:text-iron-200 mb-6",children:[e.jsx(K,{className:"w-5 h-5"}),"Back to Group"]}),e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-iron-700 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-500",children:"No workouts found for this batch"})]})]});const le=((I=h[0])==null?void 0:I.name)||"Workout",ie=E((D=h[0])==null?void 0:D.date,"EEE, MMM d"),P=h.filter(r=>r.status==="completed").length,n=h[W]||h[0],p=S.find(r=>r.uid===(n==null?void 0:n.assignedTo)),u=(n==null?void 0:n.status)==="completed";return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:ne,className:"fixed z-20 bg-iron-950 border-b border-iron-800",style:ae,children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center gap-3 pt-3 pb-2",children:[e.jsx("button",{onClick:()=>N(`/groups/${a}`,{state:{activeTab:"workouts"}}),className:"p-2 -ml-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl font-bold text-iron-50 truncate",children:le}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500",children:[e.jsx("span",{children:ie}),e.jsx("span",{children:"·"}),e.jsxs("span",{className:P===h.length?"text-green-400":"",children:[P,"/",h.length," done"]})]})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-3 scrollbar-hide",children:h.map((r,c)=>{var f,v;const t=S.find(R=>R.uid===r.assignedTo),g=c===W,x=r.status==="completed";return e.jsxs("button",{onClick:()=>Y(c),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl whitespace-nowrap transition-all flex-shrink-0 ${g?"bg-flame-500 text-white shadow-lg shadow-flame-500/20":"bg-iron-800/50 text-iron-400 hover:bg-iron-800 hover:text-iron-200"}`,children:[t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${g?"bg-white/20":"bg-iron-700"}`,children:((f=t==null?void 0:t.displayName)==null?void 0:f[0])||"?"}),e.jsx("span",{className:"text-sm font-medium",children:((v=t==null?void 0:t.displayName)==null?void 0:v.split(" ")[0])||"Unknown"}),x&&e.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${g?"bg-green-300":"bg-green-500"}`})]},r.id)})})]})}),e.jsx("div",{style:{height:te}}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 pt-4 pb-32",children:[n&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p!=null&&p.photoURL?e.jsx("img",{src:p.photoURL,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-iron-400",children:((F=p==null?void 0:p.displayName)==null?void 0:F[0])||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-iron-100",children:(p==null?void 0:p.displayName)||"Unknown"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[u?"Completed":"Pending",n.completedAt&&` · ${E(n.completedAt,"MMM d, h:mm a")}`]})]})]}),e.jsx(pe,{to:`/workouts/group/${n.id}`,state:{from:`/groups/${a}/batch/${i}`,fromLabel:"Back to Batch"},className:"text-sm text-flame-400 hover:text-flame-300 font-medium",children:"View Full →"})]}),((U=n.exercises)==null?void 0:U.length)>0&&e.jsx(we,{exercises:n.exercises,isCompleted:u,detailed:!0,workoutNotes:n.notes}),n.coachingNotes&&e.jsxs("div",{className:"card-steel mb-4 bg-flame-500/5 border-flame-500/10 overflow-hidden",children:[e.jsxs("button",{onClick:()=>se(r=>!r),className:"w-full flex items-center justify-between px-4 py-3 text-left",children:[e.jsx("p",{className:"text-xs font-semibold text-flame-400",children:"AI Coaching Notes"}),M?e.jsx(he,{className:"w-4 h-4 text-flame-400 flex-shrink-0"}):e.jsx(ue,{className:"w-4 h-4 text-flame-400 flex-shrink-0"})]}),M?e.jsx("div",{className:"px-4 pb-4",children:e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:n.coachingNotes})}):e.jsx("div",{className:"px-4 pb-3",children:e.jsx("p",{className:"text-sm text-iron-500 leading-relaxed line-clamp-2",children:n.coachingNotes})})]}),n.notes&&e.jsx("div",{className:"card-steel p-4 mb-4",children:e.jsx("p",{className:"text-iron-300 text-sm",children:n.notes})}),e.jsx("div",{className:"space-y-4",children:fe(n.exercises||[]).map((r,c)=>{var v,R,G,H,O,z,q;if(r.type==="superset"){const{exerciseA:s,exerciseB:o}=r,b=(j,l)=>{const w=j.type==="time",y=j.type==="bodyweight",T=w?!!l.actualTime:y?!!l.actualReps:!!(l.actualWeight||l.actualReps);return w?u&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualTime,"s ",e.jsxs("span",{className:"text-xs text-iron-500 font-normal",children:["target ",l.prescribedTime||"—","s"]})]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedTime||"—","s"]}):y?u&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualReps||"—"," reps"]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedReps||"—"," reps"]}):u&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualWeight||"—"," × ",l.actualReps||"—"," ",e.jsxs("span",{className:"text-xs text-iron-500 font-normal",children:["target ",l.prescribedWeight||"—"," × ",l.prescribedReps||"—"]})]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedWeight||"—"," lbs × ",l.prescribedReps||"—"]})};return e.jsxs("div",{className:"card-steel overflow-hidden border border-purple-500/20",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-purple-500/10 text-purple-400 text-xs font-semibold",children:[e.jsx(ge,{className:"w-3 h-3"})," Superset"]}),e.jsxs("h3",{className:"text-lg font-semibold text-iron-50 flex-1",children:[s.name," ",e.jsx("span",{className:"text-iron-600",children:"/"})," ",o.name]})]}),e.jsxs("p",{className:"text-sm text-iron-500 mt-1",children:[((v=s.sets)==null?void 0:v.length)||0," sets"]})]}),e.jsx("div",{className:"divide-y divide-iron-800/50",children:(R=s.sets)==null?void 0:R.map((j,l)=>{var y;const w=(y=o.sets)==null?void 0:y[l];return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:l+1})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-purple-400 font-medium mb-0.5",children:["A — ",s.name]}),b(s,j)]}),w&&e.jsxs("div",{className:"pt-1.5 border-t border-iron-700/30",children:[e.jsxs("p",{className:"text-xs text-purple-400 font-medium mb-0.5",children:["B — ",o.name]}),b(o,w)]})]})]})},l)})}),(s.notes||o.notes)&&e.jsxs("div",{className:"px-4 pb-2 space-y-1",children:[s.notes&&e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-iron-400",children:[e.jsx("span",{className:"text-purple-400",children:"A:"})," ",s.notes]})]}),o.notes&&e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-iron-400",children:[e.jsx("span",{className:"text-purple-400",children:"B:"})," ",o.notes]})]})]})]},`ss-${r.supersetGroup}`)}const t=r.exercise,g=r.index,x=Re(t),f=ke(x);return e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>L(t),className:"text-lg font-semibold text-iron-50 hover:text-flame-400 transition-colors text-left flex items-center gap-1.5",children:[t.name,e.jsx(be,{className:"w-3.5 h-3.5 text-iron-600 flex-shrink-0"})]}),f&&e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${f.color}`,children:f.label})]}),e.jsxs("p",{className:"text-sm text-iron-500 mt-1",children:[((G=t.sets)==null?void 0:G.length)||0," sets"]})]}),e.jsx("div",{className:"divide-y divide-iron-800/50",children:(H=t.sets)==null?void 0:H.map((s,o)=>{const b=x==="time"?s.actualTime:x==="bodyweight"?s.actualReps:s.actualWeight||s.actualReps,j=x==="weight"&&b&&s.actualWeight&&s.actualReps&&parseInt(s.actualReps)>1?Te(parseFloat(s.actualWeight),parseInt(s.actualReps)):null;return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:o+1})}),e.jsx("div",{className:"flex-1",children:x==="time"?u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedTime||"—","s"]}),b?e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualTime||"—"," seconds"]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("div",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedTime||"—"," seconds"]}):x==="bodyweight"?u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedReps||"—"," reps"]}),b?e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualReps||"—"," reps"]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("div",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedReps||"—"," reps"]}):u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedWeight||"—"," lbs × ",s.prescribedReps||"—"," reps"]}),b?e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualWeight||"—"," lbs × ",s.actualReps||"—"]}),j&&e.jsxs("span",{className:"text-sm text-iron-500 bg-iron-800 px-2 py-1 rounded-lg",children:["e1RM: ",j," lbs"]})]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("span",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedWeight||"—"," lbs × ",s.prescribedReps||"—",s.targetRpe&&e.jsxs("span",{className:"text-sm text-iron-500 font-normal ml-2",children:["@ RPE ",s.targetRpe]})]})})]})},o)})}),u&&(t.rpe||t.painLevel>0||((O=t.sets)==null?void 0:O.some(s=>s.rpe||s.painLevel>0)))&&e.jsxs("div",{className:"px-4 pb-2 flex items-center gap-3",children:[(t.rpe||((z=t.sets)==null?void 0:z.some(s=>s.rpe)))&&(()=>{const s=t.rpe||Math.max(0,...(t.sets||[]).map(o=>parseFloat(o.rpe)||0));return e.jsxs("span",{className:`text-sm font-semibold ${Ee(s)}`,children:["RPE ",s]})})(),(t.painLevel>0||((q=t.sets)==null?void 0:q.some(s=>s.painLevel>0)))&&(()=>{const s=t.painLevel||Math.max(0,...(t.sets||[]).map(o=>o.painLevel||0));return e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Se(s)}`,children:["Pain ",s]})})()]}),t.notes&&e.jsx("div",{className:"px-4 pb-2",children:e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-iron-400",children:t.notes})]})}),t.userNotes&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex items-start gap-2 bg-flame-500/5 border border-flame-500/10 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-flame-400/60 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-iron-500 mb-0.5",children:"Their Notes"}),e.jsx("p",{className:"text-sm text-iron-400",children:t.userNotes})]})]})})]},g)})}),(!n.exercises||n.exercises.length===0)&&e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-iron-700 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-500",children:"No exercises in this workout"})]})]}),e.jsx(ye,{exercise:C,isOpen:!!C,onClose:()=>L(null)})]})]})}export{Ae as default};
