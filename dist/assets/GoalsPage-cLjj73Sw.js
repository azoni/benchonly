const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Lqbj01pB.js","assets/index-CGE7ifKR.css"])))=>i.map(i=>d[i]);
import{u as se,d as ae,r as d,j as e,i as re,S as q,P as le,J as ne,X as M,K as ie,M as ce,k as oe,z as U,C as z,N as de,O as me,_ as xe,Q as g,V as ue,W as he,Y as pe,$ as fe,a0 as H,a1 as ge,a2 as je,w as be,x as Ne}from"./index-Lqbj01pB.js";import{i as ye}from"./index-o74L4mYE.js";import{P as ve}from"./pen-D5MYK4Bj.js";import{T as J}from"./trash-2-CVhQkg2S.js";import{d as we}from"./index-BPxqPur_.js";const W=["Bench Press","Squat","Deadlift","Overhead Press","Barbell Row","Pull-ups","Incline Bench","Romanian Deadlift","Front Squat","Close Grip Bench"];function Ce(){se("Goals");const{user:u,isGuest:h}=ae(),[p,o]=d.useState([]),[Y,P]=d.useState(!0),[K,f]=d.useState(!1),[c,A]=d.useState(null),[r,m]=d.useState({lift:"",metricType:"weight",currentValue:"",targetValue:"",targetDate:"",notes:""}),[L,V]=d.useState(!1),[O,b]=d.useState([]),[_,I]=d.useState(!1),[S,N]=d.useState(null),[F,T]=d.useState(!1),x={weight:{label:"Weight",unit:"lbs",placeholder:"225"},reps:{label:"Reps",unit:"reps",placeholder:"10"},time:{label:"Time",unit:"seconds",placeholder:"60"}};d.useEffect(()=>{async function t(){if(u)try{if(h){const{SAMPLE_GOALS:a}=await xe(async()=>{const{SAMPLE_GOALS:l}=await import("./index-Lqbj01pB.js").then(n=>n.be);return{SAMPLE_GOALS:l}},__vite__mapDeps([0,1]));o(a),P(!1);return}const s=await g.getByUser(u.uid);o(s)}catch(s){console.error("Error fetching goals:",s)}finally{P(!1)}}t()},[u,h]);const D=(t=null)=>{t?(A(t),m({lift:t.lift,metricType:t.metricType||"weight",currentValue:(t.currentWeight||t.currentValue||"").toString(),targetValue:(t.targetWeight||t.targetValue||"").toString(),targetDate:t.targetDate,notes:t.notes||""})):(A(null),m({lift:"",metricType:"weight",currentValue:"",targetValue:"",targetDate:"",notes:""})),f(!0)},Q=async t=>{if(t.preventDefault(),!(!r.lift||!r.targetValue||!r.targetDate)){V(!0);try{const s=parseInt(r.currentValue)||0,a=parseInt(r.targetValue),l={lift:r.lift,metricType:r.metricType,currentValue:s,startValue:(c==null?void 0:c.startValue)||s,targetValue:a,targetDate:r.targetDate,notes:r.notes||"",status:"active"};if(r.metricType==="weight"&&(l.currentWeight=s,l.startWeight=(c==null?void 0:c.startWeight)||s,l.targetWeight=a),h){o(c?n=>n.map(i=>i.id===c.id?{...i,...l}:i):n=>[...n,{id:`guest-${Date.now()}`,...l}]),f(!1),V(!1);return}if(c)await g.update(c.id,l),o(n=>n.map(i=>i.id===c.id?{...i,...l}:i));else{const n=await g.create(u.uid,l);o(i=>[...i,{...n,status:"active",progress:0}])}f(!1)}catch(s){console.error("Error saving goal:",s),alert("Failed to save goal. Please try again.")}finally{V(!1)}}},$=async t=>{if(confirm("Delete this goal?")){if(h){o(s=>s.filter(a=>a.id!==t));return}try{await g.delete(t),o(s=>s.filter(a=>a.id!==t))}catch(s){console.error("Error deleting goal:",s)}}},X=async t=>{if(h){o(s=>s.map(a=>a.id===t.id?{...a,status:"completed"}:a));return}try{await g.update(t.id,{status:"completed",completedAt:new Date().toISOString()}),o(s=>s.map(a=>a.id===t.id?{...a,status:"completed"}:a))}catch(s){console.error("Error completing goal:",s)}},y=t=>{var G;const s=t.metricType||"weight",a=t.startValue??t.startWeight??t.currentValue??t.currentWeight??0,l=t.currentValue??t.currentWeight??a,n=t.targetValue??t.targetWeight??0,i=((G=x[s])==null?void 0:G.unit)||"lbs";return{metricType:s,startVal:a,currentVal:l,targetVal:n,unit:i}},R=t=>{const{startVal:s,currentVal:a,targetVal:l}=y(t);if(a>=l)return 100;if(a<=s)return 0;const n=l-s,i=a-s;return n<=0?0:Math.min(100,Math.round(i/n*100))},Z=t=>{const s=we(new Date(t),new Date);return s<0?"Overdue":s===0?"Today":s===1?"1 day left":`${s} days left`},ee=async()=>{I(!0),N(null),T(!1),b([]);try{const t={},s=await ue(he(pe(fe,"workouts"),H("userId","==",u.uid),H("status","==","completed"),ge("completedAt","desc"),je(20)));s.docs.forEach(i=>{(i.data().exercises||[]).forEach(j=>{j.name&&(j.sets||[]).forEach(v=>{const E=parseFloat(v.actualWeight)||parseFloat(v.prescribedWeight)||0,w=parseInt(v.actualReps)||parseInt(v.prescribedReps)||0;if(E>0&&w>0&&w<=12){const B=Math.round(E*(1+w/30));(!t[j.name]||B>t[j.name].e1rm)&&(t[j.name]={weight:E,reps:w,e1rm:B})}})})});const a=await be(),l=await fetch(Ne("suggest-goals"),{method:"POST",headers:a,body:JSON.stringify({maxLifts:t,currentGoals:p.filter(i=>i.status==="active"),recentWorkouts:s.docs.map(()=>({}))})});if(!l.ok){const i=await l.json().catch(()=>({}));throw new Error(i.error||"Failed to get suggestions")}const n=await l.json();n.noData?(T(!0),N(n.message)):b(n.suggestions||[])}catch(t){console.error("Suggest error:",t),N(t.message)}finally{I(!1)}},te=async t=>{const s=U(new Date(Date.now()+48384e5),"yyyy-MM-dd"),a={lift:t.lift,metricType:t.metricType||"weight",currentValue:String(t.currentValue),targetValue:String(t.targetValue),startValue:String(t.currentValue),targetDate:s,notes:t.reason||"",status:"active"};if((t.metricType==="weight"||!t.metricType)&&(a.currentWeight=a.currentValue,a.targetWeight=a.targetValue,a.startWeight=a.startValue),h)o(l=>[...l,{id:`guest-${Date.now()}`,...a}]);else{const l=await g.create(u.uid,a);o(n=>[...n,{...l,status:"active",progress:0}])}b(l=>l.filter(n=>n.lift!==t.lift))},k=p.filter(t=>t.status==="active"),C=p.filter(t=>t.status==="completed");return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display text-iron-100",children:"Goals"}),e.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"Track your strength milestones"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:ee,disabled:_,className:"btn-secondary flex items-center gap-2",children:[_?e.jsx(re,{className:"w-4 h-4 animate-spin"}):e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Suggest"})]}),e.jsxs("button",{onClick:()=>D(),className:"btn-primary flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"New Goal"]})]})]}),(O.length>0||F||S)&&e.jsx("div",{className:"mb-6",children:F||S?e.jsxs("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-300",children:"Can't suggest goals yet"}),e.jsx("p",{className:"text-xs text-iron-500 mt-1",children:S||"Log a few workouts first so we can analyze your lifts."})]}),e.jsx("button",{onClick:()=>{N(null),T(!1)},className:"ml-auto text-iron-500 hover:text-iron-300",children:e.jsx(M,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"Suggested Goals"})]}),e.jsx("button",{onClick:()=>b([]),className:"text-iron-500 hover:text-iron-300",children:e.jsx(M,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"divide-y divide-iron-800",children:O.map((t,s)=>e.jsxs("div",{className:"p-4 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:t.lift}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-iron-800 text-iron-500",children:[t.currentValue," â†’ ",t.targetValue," ",t.metricType==="weight"?"lbs":t.metricType==="reps"?"reps":"s"]})]}),e.jsx("p",{className:"text-xs text-iron-500 mt-1",children:t.reason})]}),e.jsx("button",{onClick:()=>te(t),className:"px-3 py-1.5 text-xs rounded-lg bg-flame-500/10 text-flame-400 border border-flame-500/30 hover:bg-flame-500/20 transition-colors flex-shrink-0",children:"Add"})]},s))})]})}),p.length>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-flame-400",children:k.length}),e.jsx("p",{className:"text-sm text-iron-500",children:"Active"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-green-400",children:C.length}),e.jsx("p",{className:"text-sm text-iron-500",children:"Completed"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-iron-200",children:p.length}),e.jsx("p",{className:"text-sm text-iron-500",children:"Total"})]})]}),Y?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})}):p.length===0?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-iron-800 flex items-center justify-center mx-auto mb-4",children:e.jsx(ie,{className:"w-8 h-8 text-iron-500"})}),e.jsx("h3",{className:"text-lg font-display text-iron-300 mb-2",children:"No goals yet"}),e.jsx("p",{className:"text-iron-500 text-sm mb-6 max-w-sm mx-auto",children:"Set strength goals to track your progress and stay motivated"}),e.jsx("button",{onClick:()=>D(),className:"btn-primary",children:"Set Your First Goal"})]}):e.jsxs("div",{className:"space-y-8",children:[k.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-display text-iron-300 mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-flame-500"}),"Active Goals"]}),e.jsx("div",{className:"space-y-4",children:k.map(t=>e.jsxs("div",{className:"card-steel p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-iron-100",children:t.lift}),e.jsxs("p",{className:"text-sm text-iron-500 flex items-center gap-2 mt-1",children:[e.jsx(oe,{className:"w-4 h-4"}),U(new Date(t.targetDate),"MMM d, yyyy"),e.jsxs("span",{className:`ml-2 ${ye(new Date(t.targetDate))?"text-red-400":"text-iron-400"}`,children:["(",Z(t.targetDate),")"]})]}),t.notes&&e.jsx("p",{className:"text-xs text-iron-500 mt-1 italic",children:t.notes})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>X(t),className:"p-2 text-green-400 hover:bg-green-500/10 rounded-lg transition-colors",title:"Mark as complete",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>D(t),className:"p-2 text-iron-400 hover:bg-iron-700 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$(t.id),className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(J,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mb-4",children:(()=>{const{currentVal:s,targetVal:a,unit:l}=y(t);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-iron-400",children:["Current: ",e.jsxs("span",{className:"text-iron-200 font-medium",children:[s," ",l]})]}),e.jsxs("span",{className:"text-iron-400",children:["Target: ",e.jsxs("span",{className:"text-flame-400 font-medium",children:[a," ",l]})]})]}),e.jsx("div",{className:"h-3 bg-iron-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-flame-600 to-flame-500 rounded-full transition-all duration-500",style:{width:`${R(t)}%`}})})]})})()}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[(()=>{const{currentVal:s,targetVal:a,unit:l}=y(t);return e.jsxs("span",{className:"text-iron-500",children:[a-s," ",l," to go"]})})(),e.jsxs("span",{className:"flex items-center gap-1 text-iron-400",children:[e.jsx(de,{className:"w-4 h-4"}),R(t),"% there"]})]})]},t.id))})]}),C.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-display text-iron-300 mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-green-500"}),"Completed"]}),e.jsx("div",{className:"space-y-3",children:C.map(t=>{const{targetVal:s,unit:a}=y(t);return e.jsxs("div",{className:"card-steel p-4 flex items-center gap-4 opacity-75",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-iron-200",children:t.lift}),e.jsxs("p",{className:"text-sm text-iron-500",children:[s," ",a," achieved"]})]}),e.jsx("button",{onClick:()=>$(t.id),className:"p-2 text-iron-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(J,{className:"w-4 h-4"})})]},t.id)})})]})]}),K&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>f(!1)}),e.jsxs("div",{className:"relative bg-iron-900 border border-iron-700 rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto animate-scale-in",children:[e.jsx("button",{onClick:()=>f(!1),className:"absolute top-4 right-4 text-iron-500 hover:text-iron-300",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-display text-iron-100 mb-6",children:c?"Edit Goal":"New Goal"}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Exercise *"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[W.map(t=>e.jsx("button",{type:"button",onClick:()=>m(s=>({...s,lift:t})),className:`px-3 py-1.5 rounded-lg text-sm transition-colors ${r.lift===t?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:t},t)),r.lift&&!W.includes(r.lift)&&e.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg text-sm bg-cyan-500 text-white",children:r.lift})]}),e.jsx("input",{type:"text",value:r.lift&&!W.includes(r.lift)?r.lift:"",onChange:t=>m(s=>({...s,lift:t.target.value})),placeholder:"Or type any exercise...",className:"input-field w-full text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Goal Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(x).map(([t,{label:s}])=>e.jsx("button",{type:"button",onClick:()=>m(a=>({...a,metricType:t})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${r.metricType===t?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:s},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:["Current ",x[r.metricType].label," (",x[r.metricType].unit,")"]}),e.jsx("input",{type:"number",value:r.currentValue,onChange:t=>m(s=>({...s,currentValue:t.target.value})),placeholder:`e.g., ${x[r.metricType].placeholder}`,className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:["Target ",x[r.metricType].label," (",x[r.metricType].unit,") *"]}),e.jsx("input",{type:"number",value:r.targetValue,onChange:t=>m(s=>({...s,targetValue:t.target.value})),placeholder:`e.g., ${parseInt(x[r.metricType].placeholder)+20}`,className:"input-field w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Target Date *"}),e.jsx("input",{type:"date",value:r.targetDate,onChange:t=>m(s=>({...s,targetDate:t.target.value})),className:"input-field w-full",min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:r.notes,onChange:t=>m(s=>({...s,notes:t.target.value})),placeholder:"e.g., with pause, 20lb vest, strict form",className:"input-field w-full"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:L||!r.lift||!r.targetValue||!r.targetDate,className:"btn-primary flex-1",children:L?"Saving...":c?"Update Goal":"Create Goal"})]})]})]})]})]})}export{Ce as default};
