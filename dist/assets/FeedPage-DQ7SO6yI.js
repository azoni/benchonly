import{u as We,d as Re,b as Te,r as c,aa as _e,V as Ge,Y as Ee,$ as Ue,h as Me,f as Pe,ab as I,j as s,t as f,L as G,U as E,ac as U,i as M,ad as Be,I as P,n as de,F as He,ae as Ve,X as Oe,s as Ke,a3 as Qe,af as Ze,M as xe,K as qe,N as ze,Z as Xe}from"./index-hGcD7LDI.js";import{S as Ye}from"./search-LiGHrYO_.js";import{G as Je}from"./globe-BBUpmCAS.js";import{f as ue}from"./index-50qTnGKN.js";import{C as es}from"./clock-vhxzyO3D.js";import{C as ss}from"./copy-BaqFPxnp.js";import{T as ts}from"./trash-2-DpP4Lca1.js";import{T as as}from"./trophy-Dx3FoU9N.js";import{T as rs}from"./timer-BpDvcNOw.js";import"./index-BIcaetXa.js";function ys(){We("Feed");const{user:a,isGuest:h,isAppAdmin:$,isRealAdmin:os,impersonating:ns,realUser:ls}=Re(),me=Te(),[pe,y]=c.useState([]),[p,he]=c.useState({}),[ge,F]=c.useState(!0),[B,H]=c.useState(!1),[fe,V]=c.useState(null),[ye,O]=c.useState(!0),[L,je]=c.useState(""),[g,A]=c.useState(null),[K,Q]=c.useState([]),[j,Z]=c.useState(""),[q,z]=c.useState(!1),[X,we]=c.useState(new Set),[Ne,be]=c.useState(new Set),[W,ve]=c.useState("all"),[w,ke]=c.useState("all"),[R,Se]=c.useState(new Set),[T,Y]=c.useState(null),Ce=async e=>{var t,r,o;if(!(!a||h||T)){Y(e.id);try{const l=((t=e.data)==null?void 0:t.exerciseSummary)||[];if(!l.length){alert("No exercise data to copy");return}const i=l.map(d=>({name:d.name,type:d.topWeight?"weight":"bodyweight",sets:Array.from({length:d.sets||3},()=>({prescribedWeight:d.topWeight?String(d.topWeight):"",prescribedReps:d.topReps?String(d.topReps):"",actualWeight:"",actualReps:"",rpe:"",painLevel:0})),restSeconds:90,notes:""})),u=((r=p[e.userId])==null?void 0:r.displayName)||"someone",m=await Qe.create(a.uid,{name:`${((o=e.data)==null?void 0:o.name)||"Workout"} (from ${u})`,exercises:i,date:new Date,workoutType:"strength"});me(`/workouts/${m.id}`)}catch(l){console.error("Copy failed:",l),alert("Failed to copy workout")}finally{Y(null)}}},Ie=e=>{if(!a)return e.visibility==="public"||!e.visibility;if(e.userId===a.uid||$)return!0;switch(e.visibility||"public"){case"public":return!0;case"friends":return X.has(e.userId);case"group":return e.groupId&&Ne.has(e.groupId);case"private":return!1;default:return!0}};c.useEffect(()=>{Fe()},[a==null?void 0:a.uid]);const Fe=async()=>{F(!0);try{a&&!h&&_e.markAllAsRead(a.uid).catch(()=>{});const[e,t,r]=await Promise.all([Ge(Ee(Ue,"users")),a&&!h?Me.getFriendSet(a.uid):Promise.resolve(new Set),a&&!h?Pe.getByUser(a.uid):Promise.resolve([])]),o={};e.docs.forEach(i=>{o[i.id]={id:i.id,...i.data()}}),he(o),we(t),be(new Set(r.map(i=>i.id)));const l=await I.getFeed(30);y(l.items),V(l.lastDoc),O(l.hasMore)}catch(e){console.error("Error loading feed:",e)}finally{F(!1)}},De=async(e=!1)=>{e?H(!0):F(!0);try{const t=await I.getFeed(30,e?fe:null);y(e?r=>[...r,...t.items]:t.items),V(t.lastDoc),O(t.hasMore&&t.items.length>0)}catch(t){console.error("Error loading feed:",t)}finally{F(!1),H(!1)}},$e=async e=>{A(e);const t=await I.getComments(e.id);Q(t)},J=async()=>{if(!(!j.trim()||!g||h)){z(!0);try{const e=await I.addComment(g.id,a.uid,j.trim(),a.displayName||"");e&&(Q(t=>[...t,{id:e.id,userId:a.uid,text:j.trim(),createdAt:{toDate:()=>new Date}}]),Z(""),y(t=>t.map(r=>r.id===g.id?{...r,commentCount:(r.commentCount||0)+1}:r)))}catch(e){console.error("Error adding comment:",e)}finally{z(!1)}}},Le=async e=>{if(confirm("Delete this post from the feed?"))try{await I.deleteFeedItem(e,a.uid,$),y(t=>t.filter(r=>r.id!==e))}catch(t){console.error("Error deleting feed item:",t)}},Ae=e=>{switch(e){case"hiit":return s.jsx(rs,{className:"w-5 h-5 text-red-400"});case"wod":return s.jsx(Xe,{className:"w-5 h-5 text-yellow-400"});case"mobility":return s.jsx(f,{className:"w-5 h-5 text-green-400"});case"calisthenics":return s.jsx(ze,{className:"w-5 h-5 text-cyan-400"});case"dynamic":return s.jsx(xe,{className:"w-5 h-5 text-purple-400"});default:return null}},ee=(e,t)=>{var o,l,i;if((o=t==null?void 0:t.data)!=null&&o.eventId)return s.jsx(Ze,{className:"w-5 h-5 text-pink-400 fill-pink-400"});if(e==="group_workout"||(t==null?void 0:t.groupId)||((l=t==null?void 0:t.data)==null?void 0:l.groupId))return s.jsx(E,{className:"w-5 h-5 text-cyan-400"});if(e==="workout"&&((i=t==null?void 0:t.data)!=null&&i.workoutCategory)&&t.data.workoutCategory!=="strength")return Ae(t.data.workoutCategory)||s.jsx(P,{className:"w-5 h-5 text-green-400"});switch(e){case"workout":return s.jsx(P,{className:"w-5 h-5 text-green-400"});case"cardio":return s.jsx(f,{className:"w-5 h-5 text-orange-400"});case"goal_completed":return s.jsx(as,{className:"w-5 h-5 text-yellow-400"});case"goal_created":return s.jsx(qe,{className:"w-5 h-5 text-purple-400"});case"personal_record":return s.jsx(xe,{className:"w-5 h-5 text-flame-400"});default:return s.jsx(f,{className:"w-5 h-5 text-iron-400"})}},se=e=>{var i,u,m,d,N,b,n,x,v,k,S,C,re,oe,ne,le;const t=((i=p[e.userId])==null?void 0:i.displayName)||"Someone";if(e.type==="group_workout"||e.groupId||((u=e.data)==null?void 0:u.groupId))return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," completed their workout in ",s.jsx("span",{className:"text-cyan-400",children:((m=e.data)==null?void 0:m.groupName)||"a group"})]});const o={hiit:"HIIT",wod:"WOD",mobility:"Mobility",calisthenics:"Calisthenics",dynamic:"Dynamic"},l={hiit:"text-red-400",wod:"text-yellow-400",mobility:"text-green-400",calisthenics:"text-cyan-400",dynamic:"text-purple-400"};switch(e.type){case"workout":{const ie=(d=e.data)==null?void 0:d.workoutCategory,ce=o[ie];return ce?s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," completed a ",s.jsx("span",{className:l[ie],children:ce})," workout: ",s.jsx("span",{className:"text-flame-400",children:((N=e.data)==null?void 0:N.name)||"Workout"})]}):s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," completed ",s.jsx("span",{className:"text-flame-400",children:((b=e.data)==null?void 0:b.name)||"a workout"})]})}case"cardio":return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," logged ",s.jsxs("span",{className:"text-orange-400",children:[(n=e.data)==null?void 0:n.duration,"min of ",((x=e.data)==null?void 0:x.name)||"cardio"]})]});case"goal_completed":return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," achieved their goal: ",s.jsxs("span",{className:"text-yellow-400",children:[(v=e.data)==null?void 0:v.lift," - ",(k=e.data)==null?void 0:k.targetValue," ",(S=e.data)==null?void 0:S.unit]})]});case"goal_created":return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," set a new goal: ",s.jsxs("span",{className:"text-purple-400",children:[(C=e.data)==null?void 0:C.lift," - ",(re=e.data)==null?void 0:re.targetValue," ",(oe=e.data)==null?void 0:oe.unit]})]});case"personal_record":return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," hit a new PR: ",s.jsxs("span",{className:"text-flame-400",children:[(ne=e.data)==null?void 0:ne.exercise," - ",(le=e.data)==null?void 0:le.weight,"lbs"]})]});default:return s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:t})," was active"]})}},_=pe.filter(Ie),D=W==="all"?_:W==="friends"?_.filter(e=>X.has(e.userId)||e.userId===(a==null?void 0:a.uid)):_.filter(e=>e.userId===(a==null?void 0:a.uid)),te=w==="all"?D:w==="workout"?D.filter(e=>{var t;return e.type==="workout"||e.type==="group_workout"||e.groupId||((t=e.data)==null?void 0:t.groupId)}):w==="goal_completed"?D.filter(e=>e.type==="goal_completed"||e.type==="goal_created"):D.filter(e=>e.type===w),ae=L?te.filter(e=>{var l,i,u,m;const t=((i=(l=p[e.userId])==null?void 0:l.displayName)==null?void 0:i.toLowerCase())||"",r=((m=(u=e.data)==null?void 0:u.name)==null?void 0:m.toLowerCase())||"",o=L.toLowerCase();return t.includes(o)||r.includes(o)}):te;return h?s.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-12 text-center",children:[s.jsx(f,{className:"w-16 h-16 text-iron-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-display text-iron-200 mb-2",children:"Community Feed"}),s.jsx("p",{className:"text-iron-500 mb-6",children:"Sign in to see what others are up to and share your progress!"}),s.jsx(G,{to:"/login",className:"btn-primary",children:"Sign In"})]}):s.jsxs("div",{className:"max-w-2xl mx-auto pb-24",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-3",children:[s.jsx(f,{className:"w-7 h-7 text-flame-500"}),"Community Feed"]}),s.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"See what the community is up to"})]}),Object.keys(p).length>0&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-iron-800/50 rounded-full border border-iron-700/50",children:[s.jsx(E,{className:"w-4 h-4 text-flame-400"}),s.jsx("span",{className:"text-sm font-medium text-iron-300",children:Object.keys(p).length}),s.jsx("span",{className:"text-xs text-iron-500",children:"Active"})]})]}),s.jsx("div",{className:"card-steel p-4 mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(Ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500"}),s.jsx("input",{type:"text",placeholder:"Search by name or activity...",value:L,onChange:e=>je(e.target.value),className:"input-field w-full pl-10"})]})}),s.jsx("div",{className:"flex items-center gap-2 mb-3",children:[{key:"all",label:"All",icon:Je},{key:"friends",label:"Friends",icon:E},{key:"mine",label:"Mine",icon:U}].map(e=>s.jsxs("button",{onClick:()=>ve(e.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${W===e.key?"bg-flame-500/20 text-flame-400 border border-flame-500/30":"bg-iron-800/50 text-iron-400 border border-iron-700/50 hover:text-iron-200"}`,children:[s.jsx(e.icon,{className:"w-3.5 h-3.5"}),e.label]},e.key))}),s.jsx("div",{className:"flex items-center gap-1.5 mb-6 overflow-x-auto pb-1",children:[{key:"all",label:"All"},{key:"workout",label:"Workouts"},{key:"cardio",label:"Cardio"},{key:"personal_record",label:"PRs"},{key:"goal_completed",label:"Goals"}].map(e=>s.jsx("button",{onClick:()=>ke(e.key),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition-colors whitespace-nowrap ${w===e.key?"bg-iron-700 text-iron-100":"text-iron-500 hover:text-iron-300"}`,children:e.label},e.key))}),ge?s.jsxs("div",{className:"card-steel p-12 text-center",children:[s.jsx(M,{className:"w-8 h-8 text-flame-500 animate-spin mx-auto"}),s.jsx("p",{className:"text-iron-500 mt-4",children:"Loading feed..."})]}):ae.length===0?s.jsxs("div",{className:"card-steel p-12 text-center",children:[s.jsx(f,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),s.jsx("p",{className:"text-iron-500",children:"No activity yet. Be the first to log a workout!"})]}):s.jsxs("div",{className:"space-y-4",children:[ae.map(e=>{var l,i,u,m,d,N,b;const t=p[e.userId],r=`/profile/${(t==null?void 0:t.username)||e.userId}`,o=e.type==="group_workout"||!!e.groupId||!!((l=e.data)!=null&&l.groupId);return s.jsxs("div",{className:"card-steel p-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(G,{to:r,state:{from:"/feed",fromLabel:"Back to Feed"},className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center text-iron-400 hover:bg-iron-700 transition-colors",children:t!=null&&t.photoURL?s.jsx("img",{src:t.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx(U,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[ee(e.type,e),s.jsx("p",{className:"text-sm text-iron-200",children:se(e)})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("p",{className:"text-xs text-iron-600",children:((i=e.createdAt)==null?void 0:i.toDate)&&ue(e.createdAt.toDate(),{addSuffix:!0})}),e.visibility&&e.visibility!=="public"&&s.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${e.visibility==="friends"?"bg-blue-500/10 text-blue-400":e.visibility==="group"?"bg-green-500/10 text-green-400":"bg-iron-700 text-iron-500"}`,children:e.visibility==="friends"?"Friends":e.visibility==="group"?"Group":"Private"})]})]})]}),(e.type==="workout"||o)&&(()=>{var x,v,k,S,C;const n=Be((x=e.data)==null?void 0:x.totalSets,(v=e.data)==null?void 0:v.duration);return n?s.jsxs("div",{className:"mt-2 ml-[52px] flex items-center gap-1.5 text-xs text-iron-500",children:[s.jsx(es,{className:"w-3 h-3"}),n,(k=e.data)!=null&&k.exerciseCount?` · ${e.data.exerciseCount} exercises`:"",(S=e.data)!=null&&S.totalSets?` · ${e.data.totalSets} sets`:""]}):(C=e.data)!=null&&C.exerciseCount?s.jsxs("div",{className:"mt-2 ml-[52px] flex items-center gap-1.5 text-xs text-iron-500",children:[s.jsx(P,{className:"w-3 h-3"}),e.data.exerciseCount," exercises"]}):null})(),(e.type==="workout"||o)&&((m=(u=e.data)==null?void 0:u.exerciseSummary)==null?void 0:m.length)>0&&s.jsxs("div",{className:"mt-2 ml-[52px]",children:[s.jsxs("button",{onClick:()=>Se(n=>{const x=new Set(n);return x.has(e.id)?x.delete(e.id):x.add(e.id),x}),className:"text-xs text-iron-500 hover:text-iron-300 transition-colors flex items-center gap-1",children:[R.has(e.id)?s.jsx(de,{className:"w-3 h-3"}):s.jsx(He,{className:"w-3 h-3"}),R.has(e.id)?"Hide exercises":"Show exercises"]}),R.has(e.id)&&s.jsx("div",{className:"mt-2 space-y-1",children:e.data.exerciseSummary.map((n,x)=>s.jsxs("div",{className:"flex items-center justify-between py-1.5 px-3 bg-iron-800/40 rounded-lg",children:[s.jsx("span",{className:"text-xs text-iron-300",children:n.name}),s.jsx("span",{className:"text-xs text-iron-500",children:n.exerciseType==="time"||n.topTime?`${n.sets}×${n.topTime||"—"}s`:n.topWeight?`${n.sets}×${n.topReps}@${n.topWeight}lbs`:n.topReps?`${n.sets}×${n.topReps} reps`:`${n.sets} sets`})]},x))})]}),((d=e.data)==null?void 0:d.workoutId)&&e.userId===(a==null?void 0:a.uid)&&s.jsx(G,{to:o?`/workouts/group/${e.data.workoutId}`:`/workouts/${e.data.workoutId}`,className:"mt-2 ml-[52px] block p-2.5 bg-iron-800/50 rounded-lg text-xs text-iron-400 hover:text-iron-200 hover:bg-iron-800 transition-colors",children:"View full workout details →"}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>$e(e),className:"px-3 py-1.5 rounded-lg text-sm flex items-center gap-1.5 bg-iron-800 text-iron-400 hover:bg-iron-700 transition-colors",children:[s.jsx(Ve,{className:"w-4 h-4"}),e.commentCount>0?`${e.commentCount} comment${e.commentCount!==1?"s":""}`:"Comment"]}),(e.type==="workout"||o)&&((b=(N=e.data)==null?void 0:N.exerciseSummary)==null?void 0:b.length)>0&&e.userId!==(a==null?void 0:a.uid)&&!h&&s.jsxs("button",{onClick:()=>Ce(e),disabled:T===e.id,className:"px-3 py-1.5 rounded-lg text-sm flex items-center gap-1.5 bg-iron-800 text-iron-400 hover:bg-iron-700 hover:text-flame-400 transition-colors",children:[s.jsx(ss,{className:"w-4 h-4"}),T===e.id?"Copying...":"Copy Workout"]}),$&&s.jsx("button",{onClick:()=>Le(e.id),className:"ml-auto p-1.5 rounded-lg text-iron-600 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Delete post",children:s.jsx(ts,{className:"w-4 h-4"})})]})]},e.id)}),ye&&s.jsx("button",{onClick:()=>De(!0),disabled:B,className:"w-full py-3 text-center text-iron-400 hover:text-iron-200 transition-colors flex items-center justify-center gap-2",children:B?s.jsxs(s.Fragment,{children:[s.jsx(M,{className:"w-4 h-4 animate-spin"}),"Loading..."]}):s.jsxs(s.Fragment,{children:[s.jsx(de,{className:"w-4 h-4"}),"Load more"]})})]}),g&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>A(null)}),s.jsxs("div",{className:"relative bg-iron-900 border border-iron-700 rounded-t-2xl sm:rounded-2xl w-full sm:max-w-lg max-h-[80vh] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[s.jsx("h3",{className:"font-display text-lg text-iron-100",children:"Comments"}),s.jsx("button",{onClick:()=>A(null),className:"text-iron-500 hover:text-iron-300",children:s.jsx(Oe,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-4 bg-iron-800/50 border-b border-iron-800",children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-300",children:[ee(g.type,g),se(g)]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:K.length===0?s.jsx("p",{className:"text-center text-iron-500 py-8",children:"No comments yet. Be the first!"}):K.map(e=>{var t,r,o;return s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-800 flex items-center justify-center text-iron-400 flex-shrink-0 overflow-hidden",children:(t=p[e.userId])!=null&&t.photoURL?s.jsx("img",{src:p[e.userId].photoURL,alt:"",className:"w-8 h-8 rounded-full"}):s.jsx(U,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"bg-iron-800 rounded-lg p-3",children:[s.jsx("p",{className:"text-xs text-iron-500 mb-1",children:((r=p[e.userId])==null?void 0:r.displayName)||"User"}),s.jsx("p",{className:"text-sm text-iron-200",children:e.text})]}),s.jsx("p",{className:"text-xs text-iron-600 mt-1",children:((o=e.createdAt)==null?void 0:o.toDate)&&ue(e.createdAt.toDate(),{addSuffix:!0})})]})]},e.id)})}),s.jsx("div",{className:"p-4 border-t border-iron-800",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:j,onChange:e=>Z(e.target.value),onKeyDown:e=>e.key==="Enter"&&J(),placeholder:"Add a comment...",className:"input-field flex-1"}),s.jsx("button",{onClick:J,disabled:!j.trim()||q,className:"btn-primary px-4",children:q?s.jsx(M,{className:"w-4 h-4 animate-spin"}):s.jsx(Ke,{className:"w-4 h-4"})})]})})]})]})]})}export{ys as default};
