import{G as xt,u as ut,d as ht,r as n,W as We,a2 as Ve,a1 as pt,a0 as ae,Y as _e,V as ze,ay as ft,aE as gt,$ as be,aO as bt,x as jt,aF as yt,j as e,A as vt,a4 as Nt,o as X,m as x,J as wt,q as kt,Z as Ge,S as St,n as Qe,a5 as Je,i as Ct,F as Mt,K as At,l as Ft,aP as Dt}from"./index-BpGUo1il.js";import{P as Pt}from"./pause-4lrB2mG3.js";import{I as Xe}from"./info-mfLJ75Zg.js";import{C as Ye,S as Tt}from"./shield-C-QIWbnz.js";import{C as Rt}from"./clock-CnFzpjr1.js";import{C as Et,X as $t}from"./x-circle-Cir9tZDy.js";import{C as It}from"./chevron-left-D7ChpuGs.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=xt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),J={quick:{frames:5,label:"Quick",desc:"5 frames",credits:10},standard:{frames:10,label:"Standard",desc:"10 frames",credits:15},detailed:{frames:20,label:"Detailed",desc:"20 frames",credits:25}},Ot=480,Ut=.5,Ke=50,je=["Tip: Trim your video to start right before the first rep","Tip: Film from a 45Â° angle for the most useful analysis","Tip: Side angle works best for bench press form","Tip: Keep your phone at hip height for squats and deadlifts","Tip: Wear form-fitting clothes so joint positions are visible","Tip: Good lighting makes a huge difference in analysis quality","Tip: Shorter clips (5-15s) give the best frame coverage"];function ie(a){return a>=8?"text-green-400":a>=6?"text-yellow-400":a>=4?"text-orange-400":"text-red-400"}function Ze(a){return a>=8?"bg-green-500/20":a>=6?"bg-yellow-500/20":a>=4?"bg-orange-500/20":"bg-red-500/20"}function qt(a){return a>=8?"bg-green-500":a>=6?"bg-yellow-500":a>=4?"bg-orange-500":"bg-red-500"}function Bt(a){return a>=8?"bg-green-500/30":a>=6?"bg-yellow-500/30":a>=4?"bg-orange-500/30":"bg-red-500/30"}function Ht(a){return a>=9?"Excellent":a>=8?"Great":a>=7?"Good":a>=6?"Decent":a>=5?"Needs Work":a>=4?"Poor":a>=2?"Dangerous":"N/A"}function Wt(a){return a==="high"?"text-red-400 bg-red-500/15 border-red-500/30":a==="medium"?"text-orange-400 bg-orange-500/15 border-orange-500/30":"text-yellow-400 bg-yellow-500/15 border-yellow-500/30"}function Vt(a){return a==="high"?"ðŸ”´":a==="medium"?"ðŸŸ¡":"ðŸŸ¢"}function _t({score:a,size:u=100}){const P=(u-12)/2,$=2*Math.PI*P,H=$*(1-Math.min(a/10,1)),q=a>=8?"#4ade80":a>=6?"#facc15":a>=4?"#fb923c":"#f87171";return e.jsxs("div",{className:"relative flex-shrink-0",style:{width:u,height:u},children:[e.jsxs("svg",{width:u,height:u,className:"-rotate-90",children:[e.jsx("circle",{cx:u/2,cy:u/2,r:P,fill:"none",stroke:"rgba(255,255,255,0.06)",strokeWidth:"8"}),e.jsx(x.circle,{cx:u/2,cy:u/2,r:P,fill:"none",stroke:q,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:$,initial:{strokeDashoffset:$},animate:{strokeDashoffset:H},transition:{duration:1.2,ease:"easeOut",delay:.3}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(x.span,{className:`text-3xl font-bold font-display ${ie(a)}`,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.6,duration:.4},children:a}),e.jsx("span",{className:"text-[10px] text-iron-500 uppercase tracking-wider",children:Ht(a)})]})]})}function re({label:a,score:u,note:P}){const[$,H]=n.useState(!1),q=u>=8?"bg-green-500":u>=6?"bg-yellow-500":u>=4?"bg-orange-500":"bg-red-500";return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>P&&H(!$),className:"w-full flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-iron-400 w-16 text-right flex-shrink-0",children:a}),e.jsx("div",{className:"flex-1 h-2 bg-iron-800 rounded-full overflow-hidden",children:e.jsx(x.div,{className:`h-full rounded-full ${q}`,initial:{width:0},animate:{width:`${u/10*100}%`},transition:{duration:.8,ease:"easeOut",delay:.5}})}),e.jsx("span",{className:`text-xs font-semibold w-6 text-right ${ie(u)}`,children:u})]}),e.jsx(X,{children:$&&P&&e.jsx(x.p,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"text-[11px] text-iron-500 ml-[76px] mt-1 overflow-hidden",children:P})})]})}function zt({phase:a}){const u={setup:"bg-blue-500/20 text-blue-400",descent:"bg-purple-500/20 text-purple-400",bottom:"bg-red-500/20 text-red-400",ascent:"bg-amber-500/20 text-amber-400",lockout:"bg-green-500/20 text-green-400",transition:"bg-iron-700/50 text-iron-400",rest:"bg-iron-700/50 text-iron-500"};return e.jsx("span",{className:`text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wide ${u[a]||u.transition}`,children:a})}function ts(){var Te,Re,Ee,$e,Ie,Le,Oe,Ue;ut("Form Check");const{user:a,isAppAdmin:u}=ht(),P=u,$=n.useRef(null),H=n.useRef(null),q=n.useRef(null),ye=n.useRef(null),N=n.useRef(null),[D,S]=n.useState("upload"),[W,ve]=n.useState(null),[O,Ne]=n.useState(null),[g,ne]=n.useState([]),[z,we]=n.useState(""),[ke,et]=n.useState(""),[V,le]=n.useState("standard"),[E,Se]=n.useState("standard"),[Y,oe]=n.useState(0),[l,K]=n.useState(null),[Ce,C]=n.useState(null),[y,T]=n.useState(0),[Me,ce]=n.useState(!1),[tt,de]=n.useState(!1),[Ae,Fe]=n.useState(0),[Z,me]=n.useState(!1),[ee,De]=n.useState([]),[Gt,Pe]=n.useState(!1),[xe,st]=n.useState(!1);n.useEffect(()=>()=>{O&&URL.revokeObjectURL(O)},[O]),n.useEffect(()=>()=>{N.current&&N.current()},[]);const te=n.useCallback(()=>{if(!a||a.uid==="guest")return;Pe(!0);const t=We(_e(be,"formCheckJobs"),ae("userId","==",a.uid),ae("status","==","complete"),pt("createdAt","desc"),Ve(20));ze(t).then(s=>{const i=[];s.forEach(h=>{var f,r;const p=h.data();p.analysis&&p.analysis.overallScore>0&&i.push({id:h.id,exercise:p.analysis.exercise||"Unknown",score:p.analysis.overallScore||0,quality:p.quality||"standard",frameCount:p.frameCount||0,createdAt:((r=(f=p.createdAt)==null?void 0:f.toDate)==null?void 0:r.call(f))||new Date,analysis:p.analysis})}),De(i)}).catch(s=>{console.warn("Form check history needs composite index, trying fallback:",s.message);const i=We(_e(be,"formCheckJobs"),ae("userId","==",a.uid),ae("status","==","complete"),Ve(20));ze(i).then(h=>{const p=[];h.forEach(f=>{var w,v;const r=f.data();r.analysis&&r.analysis.overallScore>0&&p.push({id:f.id,exercise:r.analysis.exercise||"Unknown",score:r.analysis.overallScore||0,quality:r.quality||"standard",frameCount:r.frameCount||0,createdAt:((v=(w=r.createdAt)==null?void 0:w.toDate)==null?void 0:v.call(w))||new Date,analysis:r.analysis})}),p.sort((f,r)=>r.createdAt-f.createdAt),De(p)}).catch(h=>{console.error("Failed to load form check history:",h)})}).finally(()=>Pe(!1))},[a]);n.useEffect(()=>{te()},[te]),n.useEffect(()=>{if(D!=="results")return;const t=s=>{s.key==="ArrowLeft"&&y>0&&T(i=>i-1),s.key==="ArrowRight"&&y<g.length-1&&T(i=>i+1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[D,y,g.length]),n.useEffect(()=>{if(D!=="analyzing")return;const t=setInterval(()=>Fe(s=>(s+1)%je.length),4e3);return()=>clearInterval(t)},[D]);const se=n.useCallback(t=>{if(t){if(!t.type.startsWith("video/")){C("Please select a video file.");return}if(t.size>100*1024*1024){C("Video must be under 100MB.");return}C(null),ve(t),Ne(s=>(s&&URL.revokeObjectURL(s),URL.createObjectURL(t)))}},[]),at=n.useCallback(t=>{var s;return se((s=t.target.files)==null?void 0:s[0])},[se]),rt=n.useCallback(t=>{var s;t.preventDefault(),ce(!1),se((s=t.dataTransfer.files)==null?void 0:s[0])},[se]),it=n.useCallback(()=>{const t=ye.current;t&&(t.paused?(t.play(),de(!0)):(t.pause(),de(!1)))},[]),nt=n.useCallback(async()=>{if(!O)return;const t=J[E].frames;S("extracting"),oe(0),C(null);const s=$.current,i=H.current;if(!s||!i){C("Could not initialize video processor."),S("upload");return}const h=i.getContext("2d",{willReadFrequently:!0}),p=r=>new Promise((w,v)=>{const c=setTimeout(()=>v(new Error("Frame seek timed out")),1e4),M=()=>{clearTimeout(c),s.removeEventListener("seeked",M),s.removeEventListener("error",o),requestAnimationFrame(()=>setTimeout(w,150))},o=()=>{clearTimeout(c),s.removeEventListener("seeked",M),s.removeEventListener("error",o),v(new Error("Video error during seek"))};s.addEventListener("seeked",M),s.addEventListener("error",o),s.currentTime=r}),f=()=>{const r=h.getImageData(0,0,i.width,i.height).data,w=Math.max(4,Math.floor(r.length/500))*4;let v=0,c=0;for(let m=0;m<r.length;m+=w)v+=r[m]+r[m+1]+r[m+2],c++;const M=v/(c*3);let o=0;for(let m=0;m<r.length;m+=w){const _=(r[m]+r[m+1]+r[m+2])/3-M;o+=_*_}o/=c;const U=new Set;for(let m=0;m<r.length;m+=w)U.add((r[m]>>4)*256+(r[m+1]>>4)*16+(r[m+2]>>4));return o>200||U.size>20};try{s.src=O,await new Promise((j,I)=>{s.readyState>=1?j():(s.onloadedmetadata=j,s.onerror=()=>I(new Error("Could not load video")))});const r=s.duration;if(!r||r<=0||!isFinite(r)){C("Could not read video duration. Try a different file."),S("upload");return}const v=Math.min(1,160/s.videoWidth);i.width=Math.round(s.videoWidth*v),i.height=Math.round(s.videoHeight*v);const c=Math.max(2,Math.min(30,Math.floor(r*2))),M=r/c,o=[];let U=null;for(let j=0;j<c;j++){const I=j*M;await p(I),h.drawImage(s,0,0,i.width,i.height);const R=h.getImageData(0,0,i.width,i.height).data;if(U){let B=0;for(let k=0;k<R.length;k+=16)B+=Math.abs(R[k]-U[k])+Math.abs(R[k+1]-U[k+1])+Math.abs(R[k+2]-U[k+2]);o.push({time:I,score:B})}U=new Uint8Array(R),oe(Math.round((j+1)/c*30))}let m=0,_=r;if(o.length>t){const j=[...o].map(d=>d.score).sort((d,L)=>d-L),I=j[Math.floor(j.length/2)],R=j[Math.floor(j.length*.75)],B=(I+R)/2,k=[];let b=null;for(let d=0;d<o.length;d++)o[d].score>=B?(b||(b={start:d,end:d,totalScore:0}),b.end=d,b.totalScore+=o[d].score):b&&d-b.end<=2?(b.end=d,b.totalScore+=o[d].score):b&&(k.push(b),b=null);b&&k.push(b);let G=k.length>0?k.reduce((d,L)=>d.totalScore>L.totalScore?d:L):null;if(G){const d=Math.max(0,G.start-1),L=Math.min(o.length-1,G.end+1);m=o[d].time,_=o[L].time}else{const d=Math.min(t,o.length);let L=0,pe=0;for(let Q=0;Q<=o.length-d;Q++){let fe=0;for(let ge=Q;ge<Q+d;ge++)fe+=o[ge].score;fe>L&&(L=fe,pe=Q)}const dt=Math.max(0,pe-1),mt=Math.min(o.length-1,pe+d);m=o[dt].time,_=o[mt].time}}const qe=_-m,he=Math.max(1,Math.min(t,Math.floor(qe))),ct=qe/he,Be=Math.min(1,Ot/s.videoWidth);i.width=Math.round(s.videoWidth*Be),i.height=Math.round(s.videoHeight*Be);const He=[];for(let j=0;j<he;j++){const I=m+j*ct;let R,B,k=!1;for(let b=0;b<5;b++){if(await p(I+(b>0?.02*b:0)),h.drawImage(s,0,0,i.width,i.height),f()){k=!0;break}if(await new Promise(G=>setTimeout(G,100*(b+1))),h.drawImage(s,0,0,i.width,i.height),f()){k=!0;break}}R=i.toDataURL("image/jpeg",Ut),B=R.split(",")[1],He.push({dataUrl:R,base64:B,timestamp:I,index:j+1}),oe(30+Math.round((j+1)/he*70))}ne(He),S("preview")}catch(r){console.error("Frame extraction error:",r),C(r.message||"Could not extract frames. Try a different file."),S("upload")}},[O,E]),lt=n.useCallback(async()=>{if(!a||g.length===0)return;S("analyzing"),C(null),Fe(Math.floor(Math.random()*je.length));const t=V==="premium",s=t?Ke:J[E].credits;try{if(!P&&await ft.getBalance(a.uid)<s){C(`Not enough credits. You need ${s} credits.`),S("preview");return}const i=`fc_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,h=await a.getIdToken();N.current&&(N.current(),N.current=null);const p=gt(be,"formCheckJobs",i);await bt(p,{userId:a.uid,status:"pending",createdAt:new Date});let f=!1;const r=await fetch(jt("analyze-form"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({jobId:i,frames:g.map(c=>c.base64),timestamps:g.map(c=>Math.round(c.timestamp*10)/10),note:z.trim()||void 0,exercise:ke||void 0,model:t?"premium":"standard",quality:E})});if(!r.ok){const c=await r.json().catch(()=>({}));throw new Error(c.error||"Failed to start analysis. Please try again.")}const w=await r.json();if(w.analysis&&!w.background){f=!0,N.current&&(N.current(),N.current=null),K(w.analysis),T(0),S("results"),w.analysis.overallScore>0&&te();return}const v=yt(p,c=>{var o;if(f)return;const M=c.data();M&&(M.status==="complete"?(f=!0,v(),N.current=null,K(M.analysis),T(0),S("results"),((o=M.analysis)==null?void 0:o.overallScore)>0&&te()):M.status==="error"&&(f=!0,v(),N.current=null,C(M.error||"Analysis failed. Please try again."),S("preview")))},c=>{f||(f=!0,console.error("Firestore listener error:",c),v(),N.current=null,C("Lost connection to analysis. Please try again."),S("preview"))});N.current=v,setTimeout(()=>{f||(f=!0,v(),N.current=null,S(c=>c==="analyzing"?(C("Analysis is taking longer than expected. Please try again or use fewer frames."),"preview"):c))},18e4)}catch(i){console.error("Form analysis error:",i),C(i.message||"Something went wrong. Please try again."),S("preview")}},[a,g,z,V,E,P]),ue=()=>{N.current&&(N.current(),N.current=null),S("upload"),ve(null),Ne(t=>(t&&URL.revokeObjectURL(t),null)),ne([]),we(""),le("standard"),Se("standard"),K(null),C(null),T(0),me(!1)},A=(Te=l==null?void 0:l.frames)==null?void 0:Te[y],F=l==null?void 0:l.movementQuality,ot=n.useCallback(t=>{ne([]),K(t.analysis),T(0),me(!1),S("results")},[]);return e.jsxs("div",{className:"max-w-2xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[D==="results"&&e.jsx("button",{onClick:ue,className:"p-2 -ml-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-2",children:[e.jsx(Nt,{className:"w-6 h-6 text-flame-400"}),"Form Check",e.jsx("span",{className:"text-[10px] font-semibold px-1.5 py-0.5 rounded-full bg-purple-500/20 text-purple-400 uppercase",children:"Beta"})]}),D!=="results"&&e.jsx("p",{className:"text-sm text-iron-500 mt-1",children:"Upload a video for AI-powered frame-by-frame form analysis"})]})]}),e.jsx("video",{ref:$,className:"hidden",muted:!0,playsInline:!0,preload:"metadata"}),e.jsx("canvas",{ref:H,className:"hidden"}),e.jsx(X,{children:Ce&&e.jsxs(x.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-2",children:[e.jsx(wt,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-300",children:Ce})]})}),D==="upload"&&e.jsxs(x.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("div",{onClick:()=>{var t;return!W&&((t=q.current)==null?void 0:t.click())},onDragOver:t=>{t.preventDefault(),ce(!0)},onDragLeave:()=>ce(!1),onDrop:rt,className:`relative rounded-2xl overflow-hidden transition-all duration-200 ${Me?"ring-2 ring-flame-500 bg-flame-500/5":W?"bg-black":"card-steel border-2 border-dashed border-iron-700 hover:border-flame-500/40 cursor-pointer"}`,children:W&&O?e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:ye,src:O,className:"w-full aspect-video object-contain bg-black",playsInline:!0,loop:!0,muted:!0,onEnded:()=>de(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("button",{onClick:t=>{t.stopPropagation(),it()},className:"w-14 h-14 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center hover:bg-black/80 transition-colors",children:tt?e.jsx(Pt,{className:"w-6 h-6 text-white"}):e.jsx(kt,{className:"w-6 h-6 text-white ml-0.5"})})}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/80 to-transparent p-4 pt-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white font-medium truncate max-w-[200px]",children:W.name}),e.jsxs("p",{className:"text-xs text-iron-400",children:[(W.size/(1024*1024)).toFixed(1),"MB"]})]}),e.jsx("button",{onClick:t=>{var s;t.stopPropagation(),(s=q.current)==null||s.click()},className:"text-xs text-flame-400 hover:text-flame-300 font-medium",children:"Change"})]})})]}):e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-iron-800/80 flex items-center justify-center mx-auto mb-4",children:e.jsx(Lt,{className:`w-7 h-7 transition-colors ${Me?"text-flame-400":"text-iron-500"}`})}),e.jsx("p",{className:"text-iron-200 font-medium mb-1",children:"Drop a video here or tap to upload"}),e.jsx("p",{className:"text-xs text-iron-500",children:"MP4, MOV, WEBM up to 100MB"})]})}),e.jsx("input",{ref:q,type:"file",accept:"video/*",onChange:at,className:"hidden","aria-label":"Upload video"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-iron-400 mb-1.5 block",children:"Exercise (optional)"}),e.jsxs("select",{value:ke,onChange:t=>et(t.target.value),className:"input-field w-full","aria-label":"Exercise selection",children:[e.jsx("option",{value:"",children:"Auto-detect"}),e.jsx("option",{value:"Bench Press",children:"Bench Press"}),e.jsx("option",{value:"Squat",children:"Squat"}),e.jsx("option",{value:"Deadlift",children:"Deadlift"}),e.jsx("option",{value:"Overhead Press",children:"Overhead Press"}),e.jsx("option",{value:"Barbell Row",children:"Barbell Row"}),e.jsx("option",{value:"Pull-up",children:"Pull-up"}),e.jsx("option",{value:"Romanian Deadlift",children:"Romanian Deadlift"}),e.jsx("option",{value:"Front Squat",children:"Front Squat"}),e.jsx("option",{value:"Hip Thrust",children:"Hip Thrust"}),e.jsx("option",{value:"Lunges",children:"Lunges"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-iron-400 mb-1.5 block",children:"Note (optional)"}),e.jsx("input",{type:"text",value:z,onChange:t=>we(t.target.value),maxLength:200,placeholder:"e.g., checking squat depth, elbow pain on bench...",className:"input-field w-full","aria-label":"Analysis note"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Analysis Depth"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(J).map(([t,s])=>e.jsxs("button",{onClick:()=>Se(t),className:`relative px-3 py-3 rounded-xl border transition-all text-center ${E===t?"border-flame-500 bg-flame-500/10 shadow-glow":"border-iron-700 hover:border-iron-600 bg-iron-900/50"}`,children:[t==="standard"&&e.jsx("span",{className:"absolute -top-2 left-1/2 -translate-x-1/2 text-[9px] font-bold px-1.5 py-0.5 rounded-full bg-flame-500 text-white uppercase",children:"Popular"}),e.jsx("div",{className:`text-sm font-semibold ${E===t?"text-flame-400":"text-iron-300"}`,children:s.label}),e.jsx("div",{className:"text-[11px] text-iron-500 mt-0.5",children:s.desc}),e.jsxs("div",{className:`text-xs font-semibold mt-1 ${E===t?"text-flame-400":"text-iron-400"}`,children:[s.credits," credits"]})]},t))})]}),P&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>le("standard"),className:`px-3 py-2 text-xs rounded-xl border transition-colors text-center ${V==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),"Standard"]})}),e.jsx("button",{onClick:()=>le("premium"),className:`px-3 py-2 text-xs rounded-xl border transition-colors text-center ${V==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(St,{className:"w-3 h-3"}),"Premium"]})})]})]}),e.jsxs("div",{className:"flex items-start gap-2.5 p-3 bg-iron-800/40 rounded-xl",children:[e.jsx(Xe,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-iron-500 leading-relaxed",children:"Video is processed on your device â€” only extracted frames are sent. For best results, trim your video to start near your first rep. Side or 45Â° angle recommended."})]}),e.jsxs("button",{onClick:nt,disabled:!W,className:"btn-primary w-full py-3.5 disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-base",children:[e.jsx(Ye,{className:"w-5 h-5"})," Extract Frames"]})]}),D==="upload"&&ee.length>0&&e.jsxs(x.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.15},className:"mt-4",children:[e.jsxs("button",{onClick:()=>st(!xe),className:"card-steel p-3 w-full flex items-center gap-3 hover:border-iron-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Rt,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:"Past Form Checks"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[ee.length," analysis",ee.length!==1?"es":""]})]}),e.jsx(Qe,{className:`w-4 h-4 text-iron-500 transition-transform ${xe?"rotate-180":""}`})]}),e.jsx(X,{children:xe&&e.jsx(x.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx("div",{className:"card-steel mt-1 divide-y divide-iron-800/50 max-h-72 overflow-y-auto",children:ee.map(t=>e.jsxs("button",{onClick:()=>ot(t),className:"w-full p-3 flex items-center gap-3 hover:bg-iron-800/30 transition-colors text-left",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${Ze(t.score)}`,children:e.jsx("span",{className:`text-sm font-bold ${ie(t.score)}`,children:t.score})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-iron-200 truncate",children:t.exercise}),e.jsxs("p",{className:"text-[11px] text-iron-500",children:[t.createdAt.toLocaleDateString(void 0,{month:"short",day:"numeric"})," Â· ",t.frameCount," frames Â· ",t.quality]})]}),e.jsx(Je,{className:"w-4 h-4 text-iron-600 flex-shrink-0"})]},t.id))})})})]}),D==="extracting"&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"card-steel p-8 text-center",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-5",children:[e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-flame-500/20 animate-ping"}),e.jsx("div",{className:"relative w-16 h-16 rounded-2xl bg-flame-500/10 flex items-center justify-center",children:e.jsx(Ye,{className:"w-7 h-7 text-flame-400"})})]}),e.jsx("p",{className:"text-iron-200 font-semibold mb-1",children:Y<=30?"Scanning for the actual lift...":"Extracting key frames..."}),e.jsx("p",{className:"text-xs text-iron-500 mb-4",children:Y<=30?"Detecting when the lift starts":`Capturing ${J[E].frames} frames`}),e.jsx("div",{className:"w-56 h-2.5 bg-iron-800 rounded-full mx-auto overflow-hidden",children:e.jsx(x.div,{className:"h-full bg-gradient-to-r from-flame-500 to-flame-400 rounded-full",animate:{width:`${Y}%`},transition:{duration:.3}})}),e.jsxs("p",{className:"text-xs text-iron-600 mt-2",children:[Y,"%"]})]}),D==="preview"&&e.jsxs(x.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-iron-200",children:[g.length," frames captured"]}),e.jsx("span",{className:"text-[11px] text-iron-500",children:g.length>0&&`${g[0].timestamp.toFixed(1)}s â€“ ${g[g.length-1].timestamp.toFixed(1)}s`})]}),e.jsx("div",{className:"flex gap-1.5 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:g.map((t,s)=>e.jsxs("div",{className:"relative flex-shrink-0 w-20 aspect-video rounded-lg overflow-hidden bg-iron-800 ring-1 ring-iron-700/50",children:[e.jsx("img",{src:t.dataUrl,alt:`Frame ${s+1}`,className:"w-full h-full object-cover"}),e.jsxs("span",{className:"absolute bottom-0.5 right-1 text-[9px] text-white/80 bg-black/60 px-1 rounded",children:[t.timestamp.toFixed(1),"s"]}),e.jsx("span",{className:"absolute top-0.5 left-1 text-[9px] text-white/60 font-semibold",children:s+1})]},s))})]}),z&&e.jsxs("div",{className:"card-steel p-3 flex items-start gap-2",children:[e.jsx(Xe,{className:"w-3.5 h-3.5 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-iron-500 uppercase tracking-wider mb-0.5",children:"Note"}),e.jsx("p",{className:"text-sm text-iron-300",children:z})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:ue,className:"btn-secondary flex-1 py-3",children:"Start Over"}),e.jsxs("button",{onClick:lt,className:"btn-primary flex-1 py-3 flex items-center justify-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Analyze (",V==="premium"?Ke:J[E].credits," credits)"]})]})]}),D==="analyzing"&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx("div",{className:"card-steel p-6",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-[100px] h-[100px] rounded-full bg-iron-800 animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-5 w-40 bg-iron-800 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-full bg-iron-800/60 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-3/4 bg-iron-800/60 rounded animate-pulse"})]})]})}),e.jsxs("div",{className:"card-steel p-5 text-center",children:[e.jsx(Ct,{className:"w-8 h-8 text-flame-400 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-iron-200 font-semibold mb-1",children:"Analyzing your form..."}),e.jsxs("p",{className:"text-xs text-iron-500 mb-4",children:[V==="premium"?"GPT-4o":"GPT-4o mini"," is reviewing each frame"]}),e.jsx(X,{mode:"wait",children:e.jsx(x.p,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"text-xs text-iron-600 italic",children:je[Ae]},Ae)})]})]}),D==="results"&&l&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(x.div,{className:"card-steel p-5",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(_t,{score:l.overallScore}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h2",{className:"text-lg font-display text-iron-100",children:l.exercise||"Exercise"}),l.variation&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-iron-800 text-iron-400 border border-iron-700",children:l.variation})]}),l.repsDetected>0&&e.jsxs("p",{className:"text-xs text-iron-500 mt-0.5",children:[l.repsDetected," rep",l.repsDetected!==1?"s":""," detected"]}),e.jsx("p",{className:"text-sm text-iron-400 mt-2 leading-relaxed",children:l.overallSummary})]})]})}),F&&e.jsxs(x.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3",children:"Movement Quality"}),e.jsxs("div",{className:"space-y-2.5",children:[F.stability&&e.jsx(re,{label:"Stability",score:F.stability.score,note:F.stability.note}),F.rangeOfMotion&&e.jsx(re,{label:"ROM",score:F.rangeOfMotion.score,note:F.rangeOfMotion.note}),F.control&&e.jsx(re,{label:"Control",score:F.control.score,note:F.control.note}),F.alignment&&e.jsx(re,{label:"Alignment",score:F.alignment.score,note:F.alignment.note})]})]}),e.jsxs(x.div,{className:"grid grid-cols-2 gap-3",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.3},children:[((Re=l.keyStrengths)==null?void 0:Re.length)>0&&e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-green-400 uppercase tracking-wider mb-2.5 flex items-center gap-1.5",children:[e.jsx(Et,{className:"w-3.5 h-3.5"})," Strengths"]}),e.jsx("div",{className:"space-y-2",children:l.keyStrengths.map((t,s)=>e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t},s))})]}),((Ee=l.keyIssues)==null?void 0:Ee.length)>0&&e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-red-400 uppercase tracking-wider mb-2.5 flex items-center gap-1.5",children:[e.jsx($t,{className:"w-3.5 h-3.5"})," Issues"]}),e.jsx("div",{className:"space-y-2",children:l.keyIssues.map((t,s)=>e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t},s))})]})]}),(($e=l.injuryRisks)==null?void 0:$e.length)>0&&e.jsxs(x.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.35},children:[e.jsxs("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[e.jsx(Tt,{className:"w-3.5 h-3.5"})," Injury Risk Areas"]}),e.jsx("div",{className:"space-y-2.5",children:l.injuryRisks.map((t,s)=>e.jsxs("div",{className:`p-3 rounded-xl border ${Wt(t.severity)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:Vt(t.severity)}),e.jsx("span",{className:"text-xs font-semibold",children:t.area}),e.jsx("span",{className:"text-[9px] uppercase tracking-wider opacity-70 ml-auto",children:t.severity})]}),e.jsx("p",{className:"text-[11px] opacity-80 leading-relaxed",children:t.description}),t.fix&&e.jsxs("p",{className:"text-[11px] mt-1.5 opacity-90",children:[e.jsx("span",{className:"font-semibold",children:"Fix:"})," ",t.fix]})]},s))})]}),g.length>0&&((Ie=l.frames)==null?void 0:Ie.length)>0&&e.jsxs(x.div,{className:"card-steel overflow-hidden",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider px-4 pt-4 pb-2",children:"Frame-by-Frame"}),e.jsxs("div",{className:"relative bg-black",onTouchStart:t=>{t.currentTarget.dataset.touchX=t.touches[0].clientX},onTouchEnd:t=>{const s=t.changedTouches[0].clientX-Number(t.currentTarget.dataset.touchX||0);s>50&&y>0&&T(y-1),s<-50&&y<g.length-1&&T(y+1)},children:[e.jsx(X,{mode:"wait",children:e.jsx(x.img,{src:(Le=g[y])==null?void 0:Le.dataUrl,alt:`Frame ${y+1}`,className:"w-full aspect-video object-contain",initial:{opacity:.6},animate:{opacity:1},transition:{duration:.15}},y)}),e.jsx("div",{className:"absolute top-3 left-3 flex items-center gap-2",children:A&&(Number(A.formScore)>0?e.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded-lg backdrop-blur-sm ${Ze(Number(A.formScore))} ${ie(Number(A.formScore))}`,children:[A.formScore,"/10"]}):e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-lg backdrop-blur-sm bg-iron-700/80 text-iron-400",children:"Not scored"}))}),(A==null?void 0:A.phase)&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(zt,{phase:A.phase})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 bg-iron-900/80 border-t border-iron-800/50",children:[e.jsx("button",{onClick:()=>T(Math.max(0,y-1)),disabled:y===0,"aria-label":"Previous frame",className:"w-10 h-10 rounded-xl bg-iron-800 border border-iron-700 flex items-center justify-center transition-colors hover:bg-iron-700 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(It,{className:"w-5 h-5 text-iron-200"})}),e.jsx("div",{className:"flex-1 flex items-center gap-1 overflow-x-auto px-1",children:g.map((t,s)=>{var p;const i=(p=l.frames)==null?void 0:p[s],h=Number(i==null?void 0:i.formScore)||0;return e.jsx("button",{onClick:()=>T(s),"aria-label":`Frame ${s+1}`,className:`flex-1 min-w-[12px] rounded-full transition-all ${s===y?`h-3 ${h>0?qt(h):"bg-iron-400"} shadow-sm ring-1 ring-white/20`:`h-2 ${h>0?Bt(h):"bg-iron-700/50"} hover:h-2.5`}`,title:`Frame ${s+1}: ${(i==null?void 0:i.phase)||""} ${h>0?`(${h}/10)`:"(not scored)"}`},s)})}),e.jsx("button",{onClick:()=>T(Math.min(g.length-1,y+1)),disabled:y===g.length-1,"aria-label":"Next frame",className:"w-10 h-10 rounded-xl bg-iron-800 border border-iron-700 flex items-center justify-center transition-colors hover:bg-iron-700 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(Mt,{className:"w-5 h-5 text-iron-200"})}),e.jsxs("span",{className:"text-xs text-iron-500 font-mono w-10 text-center flex-shrink-0",children:[y+1,"/",g.length]})]}),A&&e.jsxs("div",{className:"p-4 border-t border-iron-800/50",children:[e.jsx("p",{className:"text-sm text-iron-200 leading-relaxed",children:A.assessment}),((Oe=A.cues)==null?void 0:Oe.length)>0&&e.jsx("div",{className:"mt-2.5 space-y-1.5",children:A.cues.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Je,{className:"w-3 h-3 text-flame-400 mt-1 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t})]},s))})]})]}),l.focusDrill&&e.jsxs(x.div,{className:"relative overflow-hidden rounded-2xl border border-flame-500/20",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-flame-500/10 via-transparent to-transparent"}),e.jsxs("div",{className:"relative p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(At,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-semibold text-flame-400",children:"Focus Next Session"})]}),e.jsx("p",{className:"text-sm font-semibold text-iron-100 mb-1",children:l.focusDrill.title}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed mb-3",children:l.focusDrill.description}),l.focusDrill.cue&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-flame-500/15 rounded-lg border border-flame-500/20",children:[e.jsx("span",{className:"text-xs text-iron-500",children:"Cue:"}),e.jsxs("span",{className:"text-sm font-semibold text-flame-300",children:['"',l.focusDrill.cue,'"']})]})]})]}),((Ue=l.recommendations)==null?void 0:Ue.length)>0&&e.jsxs(x.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.55},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3",children:"Recommendations"}),e.jsx("div",{className:"space-y-2.5",children:(Z?l.recommendations:l.recommendations.slice(0,3)).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 text-[10px] font-bold ${s===0?"bg-flame-500/20 text-flame-400":"bg-iron-800 text-iron-500"}`,children:s+1}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:t})]},s))}),l.recommendations.length>3&&e.jsxs("button",{onClick:()=>me(!Z),className:"mt-3 text-xs text-iron-500 hover:text-iron-300 flex items-center gap-1 transition-colors",children:[Z?e.jsx(Ft,{className:"w-3.5 h-3.5"}):e.jsx(Qe,{className:"w-3.5 h-3.5"}),Z?"Show less":`Show ${l.recommendations.length-3} more`]})]}),e.jsxs("button",{onClick:ue,className:"btn-secondary w-full py-3 flex items-center justify-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"})," Analyze Another Video"]})]})]})}export{ts as default};
