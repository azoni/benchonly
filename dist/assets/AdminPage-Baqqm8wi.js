const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-OFuFeI6c.js","assets/index-DEb0eXj3.css"])))=>i.map(i=>d[i]);
import{G as as,w as Ft,aR as It,aS as ve,aT as Wt,aA as H,$ as E,aU as As,W as ce,a2 as ye,a1 as $e,a0 as Ee,Y as oe,V as we,aP as rs,aV as bt,r as x,a3 as ft,Q as Ke,ar as Ls,j as e,i as ie,B as Ut,C as Qe,af as Ds,I as Gt,a5 as qt,X as jt,J as Es,K as _t,a4 as $s,L as Rs,l as is,n as vt,o as ns,m as ls,b as Ms,u as Ps,d as Os,aw as Ht,U as pt,t as ht,N as Fs,aj as Vt,ay as Is,ae as Bt,E as zt,Z as it,A as Ws,P as ut,aW as Us,z as De,aX as Gs,_ as Jt,R as Kt,q as Qt,az as qs,aY as _s}from"./index-OFuFeI6c.js";import{F as Hs}from"./file-text-CE0d_IyD.js";import{S as Nt}from"./save-B6W5CPL0.js";import{P as Vs}from"./pencil-CsQsBtEd.js";import{M as Bs}from"./moon-CvtCLmnz.js";import{T as zs}from"./timer-xHOXjdBS.js";import{C as Js}from"./copy-Br6F_JQL.js";import{S as Xt}from"./share-2-B4McxfBW.js";import{S as Ks}from"./search-BEmM8Tc3.js";import{P as Yt}from"./pen-BK8yZLeF.js";import{T as gt}from"./trash-2-B5s2_dp9.js";import{f as Zt}from"./index-D6ot5syO.js";import{C as Qs}from"./clock-Bf0ZY6q-.js";import{E as Xs}from"./external-link-BKjQ-ECn.js";import"./index-BCrUgKXx.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=as("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=as("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),ae={async getSettings(){const n=await bt(H(E,"settings","social"));return n.exists()?n.data():null},async saveSettings(n){await rs(H(E,"settings","social"),{...n,updatedAt:Wt()})},async getThreads(n=null,b=50){let A;return n?A=ce(oe(E,"socialThreads"),Ee("status","==",n),$e("createdAt","desc"),ye(b)):A=ce(oe(E,"socialThreads"),$e("createdAt","desc"),ye(b)),(await we(A)).docs.map(i=>({id:i.id,...i.data()}))},async deleteThread(n){await As(H(E,"socialThreads",n))},async retryThread(n){await ve(H(E,"socialThreads",n),{status:"queued",error:null,updatedAt:Wt()})},async generateThread(n={}){const b=await Ft(),A=await fetch(`${It}/generate-social-thread`,{method:"POST",headers:b,body:JSON.stringify(n)});if(!A.ok){const O=await A.json().catch(()=>({}));throw new Error(O.error||"Generation failed")}return A.json()},async postThread(n){const b=await Ft(),A=await fetch(`${It}/post-social-thread`,{method:"POST",headers:b,body:JSON.stringify({threadId:n})});if(!A.ok){const O=await A.json().catch(()=>({}));throw new Error(O.error||"Posting failed")}return A.json()},async getStats(){const n=await this.getThreads(null,200),b=n.filter(i=>i.status==="posted"),A=new Date;return A.setHours(0,0,0,0),{postsToday:b.filter(i=>{var c,h,m,N;const p=((h=(c=i.postedAt)==null?void 0:c.toDate)==null?void 0:h.call(c))||((N=(m=i.createdAt)==null?void 0:m.toDate)==null?void 0:N.call(m));return p&&p>=A}).length,totalPosted:b.length,queued:n.filter(i=>i.status==="queued").length,failed:n.filter(i=>i.status==="failed").length,totalImpressions:b.reduce((i,p)=>i+(p.impressions||0),0),totalLikes:b.reduce((i,p)=>i+(p.likes||0),0),totalRetweets:b.reduce((i,p)=>i+(p.retweets||0),0)}}};function ea(n){return n>=8?"text-green-400":n>=6?"text-yellow-400":n>=4?"text-orange-400":"text-red-400"}function ta(n){return n>=8?"bg-green-500/20":n>=6?"bg-yellow-500/20":n>=4?"bg-orange-500/20":"bg-red-500/20"}function es(n){return n>=9?"text-red-400":n>=7?"text-yellow-400":"text-green-400"}function ts(n){return n>=7?"text-red-400":n>=4?"text-orange-400":"text-yellow-400"}function sa(n){return n===0?"today":n===1?"yesterday":`${n}d ago`}function re({icon:n,iconColor:b,title:A,badge:O,defaultOpen:i=!0,children:p}){const[c,h]=x.useState(i);return e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>h(!c),className:"w-full p-4 flex items-center gap-3 hover:bg-iron-800/30 transition-colors",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${b}`,children:e.jsx(n,{className:"w-4 h-4"})}),e.jsx("span",{className:"flex-1 text-left text-sm font-medium text-iron-200",children:A}),O&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-iron-800 text-iron-400",children:O}),c?e.jsx(is,{className:"w-4 h-4 text-iron-500"}):e.jsx(vt,{className:"w-4 h-4 text-iron-500"})]}),e.jsx(ns,{children:c&&e.jsx(ls.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:e.jsx("div",{className:"px-4 pb-4",children:p})})})]})}function ss(n){var A,O,i;const b=[];if(n.profile){const p=n.profile,c=[];p.displayName&&c.push(`Name: ${p.displayName}`),p.weight&&c.push(`Weight: ${p.weight}lbs`),p.height&&c.push(`Height: ${p.height}`),p.age&&c.push(`Age: ${p.age}`),p.activityLevel&&c.push(`Activity level: ${p.activityLevel}`),c.length&&b.push(c.join(" | "))}if(Object.keys(n.maxLifts).length>0){const p=Object.entries(n.maxLifts).sort((c,h)=>h[1].e1rm-c[1].e1rm).slice(0,8).map(([c,h])=>`${c}: ${h.e1rm}lb e1RM (${h.weight}x${h.reps})`);b.push(`MAX LIFTS:
${p.join(`
`)}`)}if(Object.keys(n.painHistory).length>0){const p=Object.entries(n.painHistory).map(([c,h])=>{let m=`${c}: ${h.maxPain}/10 pain (${h.count}x`;return h.lastDaysAgo!=null&&(m+=`, last ${h.lastDaysAgo}d ago`),h.recentCount&&(m+=`, ${h.recentCount}x in 30d`),m+=")",m});b.push(`PAIN HISTORY:
${p.join(`
`)}`)}if(Object.keys(n.rpeAverages).length>0){const p=Object.entries(n.rpeAverages).sort((c,h)=>h[1]-c[1]).slice(0,8).map(([c,h])=>`${c}: avg RPE ${h}`);b.push(`RPE AVERAGES:
${p.join(`
`)}`)}if(n.recentWorkouts.length>0){const p=n.recentWorkouts.slice(0,3).map(c=>{let h=`--- ${c.name||"Workout"} (${c.date}) ---`;return(c.exercises||[]).forEach(m=>{h+=`
  ${m.name} [${m.type||"weight"}]:`,(m.sets||[]).forEach((N,F)=>{const P=[];N.prescribedWeight&&P.push(`target: ${N.prescribedWeight}lbs x ${N.prescribedReps||"?"}`),N.actualWeight?P.push(`actual: ${N.actualWeight}lbs x ${N.actualReps||"?"}`):N.actualReps&&P.push(`actual: ${N.actualReps} reps`),N.prescribedTime&&P.push(`target: ${N.prescribedTime}s`),N.actualTime&&P.push(`actual: ${N.actualTime}s`),N.rpe&&P.push(`RPE ${N.rpe}`),N.painLevel>0&&P.push(`pain ${N.painLevel}/10`),h+=`
    Set ${F+1}: ${P.join(" | ")}`})}),h}).join(`

`);b.push(`RECENT WORKOUTS (FULL DETAIL):
${p}`)}if(n.goals.length>0){const p=n.goals.map(c=>{const h=c.currentWeight||c.currentValue||"?",m=c.targetWeight||c.targetValue||"?";return`${c.lift||c.metricType}: ${h} -> ${m}${c.targetDate?` by ${c.targetDate}`:""}`});b.push(`ACTIVE GOALS:
${p.join(`
`)}`)}if(n.ouraData){const{latest:p,averages:c}=n.ouraData,h=[];(A=p==null?void 0:p.readiness)!=null&&A.score&&h.push(`Today readiness: ${p.readiness.score}/100`),(O=p==null?void 0:p.sleep)!=null&&O.score&&h.push(`Last sleep: ${p.sleep.score}/100`),(i=p==null?void 0:p.activity)!=null&&i.score&&h.push(`Activity score: ${p.activity.score}/100`),c!=null&&c.readinessScore&&h.push(`7-day avg readiness: ${c.readinessScore}`),h.length&&b.push(`OURA RING:
${h.join(`
`)}`)}if(n.formChecks.length>0){const p=n.formChecks.slice(0,5).map(c=>{var m,N,F,P;let h=`${c.exercise}: ${c.score}/10 (${c.date})`;if((N=(m=c.analysis)==null?void 0:m.focusDrill)!=null&&N.cue&&(h+=` — Focus: "${c.analysis.focusDrill.cue}"`),(P=(F=c.analysis)==null?void 0:F.injuryRisks)!=null&&P.length){const de=c.analysis.injuryRisks.filter(Z=>Z.severity!=="low");de.length&&(h+=` — Risks: ${de.map(Z=>`${Z.area} (${Z.severity})`).join(", ")}`)}return h});b.push(`FORM CHECK HISTORY:
${p.join(`
`)}`)}return b.join(`

`)}function aa({userId:n,userName:b}){var Ze,qe,k,J,ue,_e,_;const[A,O]=x.useState(!0),[i,p]=x.useState(null),[c,h]=x.useState(!1),[m,N]=x.useState(!1),[F,P]=x.useState(""),[de,Z]=x.useState(!1),[ke,Xe]=x.useState(!1),[$,xe]=x.useState({maxLifts:{},excludeExercises:[]}),[Re,ne]=x.useState(!1),[me,pe]=x.useState(!1),[Me,z]=x.useState(null),[he,Pe]=x.useState({e1rm:"",weight:"",reps:""}),[B,Ce]=x.useState(""),M=x.useCallback(async()=>{if(n){O(!0);try{const[a,d,f,g,j]=await Promise.all([ft.getByUser(n,50),Ke.getByUser(n),bt(H(E,"users",n)),we(ce(oe(E,"formCheckJobs"),Ee("userId","==",n),Ee("status","==","complete"),$e("createdAt","desc"),ye(10))).catch(()=>we(ce(oe(E,"formCheckJobs"),Ee("userId","==",n),Ee("status","==","complete"),ye(10))).catch(()=>({docs:[]}))),Ls.getLatestScores(n).catch(()=>null)]);let I=[];try{I=(await we(ce(oe(E,"groupWorkouts"),Ee("assignedTo","==",n),ye(50)))).docs.map(S=>({id:S.id,...S.data(),_isGroup:!0}))}catch{}const C=[...a,...I].filter(v=>v.status==="completed").map(v=>{var y;const S=(y=v.date)!=null&&y.toDate?v.date.toDate():new Date(v.date||0);return{...v,_date:S,date:S.toISOString().split("T")[0]}}).sort((v,S)=>S._date-v._date).slice(0,30),W={},L={},V={},K={},ge=new Date;let et=0,ee=0;C.forEach(v=>{const S=Math.floor((ge-v._date)/864e5);(v.exercises||[]).forEach(y=>{y.name&&(K[y.name]=(K[y.name]||0)+1,(y.sets||[]).forEach(U=>{const q=parseFloat(U.actualWeight)||parseFloat(U.prescribedWeight)||0,X=parseInt(U.actualReps)||parseInt(U.prescribedReps)||0,te=parseInt(U.rpe)||0,st=parseInt(U.painLevel)||0;if(!(!U.actualWeight&&!U.actualReps&&U.prescribedWeight)){if(et++,ee+=q*X,q>0&&X>0&&X<=12){const Be=Math.round(q*(1+X/30));(!W[y.name]||Be>W[y.name].e1rm)&&(W[y.name]={weight:q,reps:X,e1rm:Be,date:v.date})}st>0&&(L[y.name]||(L[y.name]={count:0,maxPain:0,lastDaysAgo:null,recentCount:0}),L[y.name].count++,L[y.name].maxPain=Math.max(L[y.name].maxPain,st),(L[y.name].lastDaysAgo===null||S<L[y.name].lastDaysAgo)&&(L[y.name].lastDaysAgo=S),S<=30&&L[y.name].recentCount++),te>0&&(V[y.name]||(V[y.name]={total:0,count:0,values:[]}),V[y.name].total+=te,V[y.name].count++,V[y.name].values.push(te))}}))})});const He={};Object.entries(V).forEach(([v,S])=>{He[v]=Math.round(S.total/S.count*10)/10});const T=C.filter(v=>v.workoutType==="cardio"),Q=g.docs.map(v=>{var y,U,q,X,te;const S=v.data();return{id:v.id,exercise:((y=S.analysis)==null?void 0:y.exercise)||"Unknown",score:((U=S.analysis)==null?void 0:U.overallScore)||0,quality:S.quality||"standard",frameCount:S.frameCount||0,date:((te=(X=(q=S.createdAt)==null?void 0:q.toDate)==null?void 0:X.call(q))==null?void 0:te.toLocaleDateString(void 0,{month:"short",day:"numeric"}))||"—",analysis:S.analysis}}),Te=f.exists()?f.data():{};P(Te.adminNotes||""),xe(Te.aiContextOverrides||{maxLifts:{},excludeExercises:[]});const tt=Object.entries(K).sort((v,S)=>S[1]-v[1]).slice(0,10),ct=C.map(v=>v.date),Ve=new Set(ct).size,fe=C.length>1?Math.max(1,Math.floor((C[0]._date-C[C.length-1]._date)/864e5)):1,Ae=Math.round(Ve/fe*7*10)/10;p({profile:Te,recentWorkouts:C,maxLifts:W,painHistory:L,rpeAverages:He,rpeData:V,goals:d.filter(v=>v.status==="active"),allGoals:d,cardioWorkouts:T,ouraData:j,formChecks:Q,topExercises:tt,totalSets:et,totalVolume:ee,workoutsPerWeek:Ae,exerciseFrequency:K})}catch(a){console.error("Failed to load user summary:",a)}finally{O(!1)}}},[n]);x.useEffect(()=>{M()},[M]);const nt=async()=>{Z(!0);try{const a=H(E,"users",n);await ve(a,{adminNotes:F}),Xe(!0),setTimeout(()=>Xe(!1),2e3)}catch(a){console.error("Failed to save notes:",a)}finally{Z(!1)}},G=async a=>{const d=$;xe(a),ne(!0);try{const f=H(E,"users",n);await ve(f,{aiContextOverrides:a}),pe(!0),setTimeout(()=>pe(!1),2e3)}catch(f){console.error("Failed to save overrides:",f),xe(d)}finally{ne(!1)}},lt=a=>{var f;const d=((f=$.maxLifts)==null?void 0:f[a])||i.maxLifts[a]||{};z(a),Pe({e1rm:String(d.e1rm||""),weight:String(d.weight||""),reps:String(d.reps||"")})},Oe=()=>{if(!Me)return;const a=parseInt(he.e1rm)||0,d=parseFloat(he.weight)||0,f=parseInt(he.reps)||0;if(!a)return;const g={...$,maxLifts:{...$.maxLifts,[Me]:{e1rm:a,weight:d,reps:f}}};z(null),G(g)},Ye=a=>{const{[a]:d,...f}=$.maxLifts||{};G({...$,maxLifts:f})},Fe=(a,d)=>{const f=a.toLowerCase().trim(),g=d.toLowerCase().trim();return f===g||f.includes(g)||g.includes(f)},Se=a=>{const d=$.excludeExercises||[];d.some(f=>Fe(f,a))||G({...$,excludeExercises:[...d,a]})},Ie=a=>{G({...$,excludeExercises:($.excludeExercises||[]).filter(d=>d!==a)})},We=()=>{if(!i)return i;const a={...i.maxLifts};return Object.entries($.maxLifts||{}).forEach(([d,f])=>{a[d]={...a[d]||{},...f}}),($.excludeExercises||[]).forEach(d=>{Object.keys(a).forEach(f=>{Fe(d,f)&&delete a[f]})}),{...i,maxLifts:a}},Ue=()=>{i&&(navigator.clipboard.writeText(ss(We())),N(!0),setTimeout(()=>N(!1),2e3))};if(A)return e.jsxs("div",{className:"card-steel p-8 rounded-xl text-center",children:[e.jsx(ie,{className:"w-6 h-6 text-flame-400 animate-spin mx-auto mb-3"}),e.jsxs("p",{className:"text-sm text-iron-500",children:["Loading AI summary for ",b||"user","..."]})]});if(!i)return e.jsx("div",{className:"card-steel p-8 rounded-xl text-center",children:e.jsx("p",{className:"text-sm text-iron-500",children:"Could not load user data."})});const Ge=Object.values(i.rpeAverages).length>0?(Object.values(i.rpeAverages).reduce((a,d)=>a+d,0)/Object.values(i.rpeAverages).length).toFixed(1):null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card-steel p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ut,{className:"w-5 h-5 text-purple-400"}),e.jsx("h3",{className:"font-medium text-iron-200",children:"AI Context Summary"}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-400 ml-auto",children:"What the AI sees"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-center",children:[e.jsxs("div",{className:"p-2.5 bg-iron-800/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.recentWorkouts.length}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Workouts"})]}),e.jsxs("div",{className:"p-2.5 bg-iron-800/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:Object.keys(i.maxLifts).length}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Tracked Lifts"})]}),e.jsxs("div",{className:"p-2.5 bg-iron-800/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.workoutsPerWeek}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Workouts/Week"})]}),e.jsxs("div",{className:"p-2.5 bg-iron-800/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.totalSets}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Total Sets"})]})]})]}),e.jsxs("div",{className:"card-steel p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Hs,{className:"w-4 h-4 text-amber-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"Admin Notes"})]}),e.jsx("textarea",{value:F,onChange:a=>P(a.target.value),placeholder:"Notes about this user (injuries, preferences, coaching cues, etc.)",rows:3,className:"input-field w-full text-sm resize-none mb-2"}),e.jsxs("button",{onClick:nt,disabled:de,className:"btn-secondary text-xs py-1.5 px-3 flex items-center gap-1.5",children:[ke?e.jsx(Qe,{className:"w-3 h-3 text-green-400"}):e.jsx(Nt,{className:"w-3 h-3"}),ke?"Saved":de?"Saving...":"Save Notes"]})]}),(i.profile.weight||i.profile.height||i.profile.age)&&e.jsx(re,{icon:Ds,iconColor:"bg-pink-500/20 text-pink-400",title:"Profile & Health",defaultOpen:!1,children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[i.profile.weight&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsxs("p",{className:"text-sm font-medium text-iron-200",children:[i.profile.weight," lbs"]}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Weight"})]}),i.profile.height&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:i.profile.height}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Height"})]}),i.profile.age&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:i.profile.age}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Age"})]}),i.profile.activityLevel&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200 capitalize",children:i.profile.activityLevel}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Activity"})]})]})}),(()=>{const a=$.excludeExercises||[],d={...i.maxLifts};Object.entries($.maxLifts||{}).forEach(([g,j])=>{d[g]={...d[g]||{},...j}}),a.forEach(g=>{Object.keys(d).forEach(j=>{Fe(g,j)&&delete d[j]})});const f=Object.entries(d).sort((g,j)=>j[1].e1rm-g[1].e1rm);return e.jsxs(re,{icon:Gt,iconColor:"bg-flame-500/20 text-flame-400",title:"Max Lifts (e1RM)",badge:e.jsxs(e.Fragment,{children:[`${f.length} lifts`,Re&&e.jsx("span",{className:"ml-2 text-iron-500",children:"saving..."}),me&&e.jsx("span",{className:"ml-2 text-green-400",children:"saved"})]}),children:[f.length>0?e.jsx("div",{className:"space-y-1.5",children:f.map(([g,j])=>{var C;const I=!!((C=$.maxLifts)!=null&&C[g]);return Me===g?e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:g}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-iron-500",children:"e1RM"}),e.jsx("input",{type:"number",value:he.e1rm,onChange:W=>Pe(L=>({...L,e1rm:W.target.value})),className:"w-full input-field text-sm py-1.5 px-2",autoFocus:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-iron-500",children:"Weight"}),e.jsx("input",{type:"number",value:he.weight,onChange:W=>Pe(L=>({...L,weight:W.target.value})),className:"w-full input-field text-sm py-1.5 px-2"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-iron-500",children:"Reps"}),e.jsx("input",{type:"number",value:he.reps,onChange:W=>Pe(L=>({...L,reps:W.target.value})),className:"w-full input-field text-sm py-1.5 px-2"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z(null),className:"flex-1 py-1.5 text-xs text-iron-400 hover:text-iron-200",children:"Cancel"}),e.jsx("button",{onClick:Oe,className:"flex-1 py-1.5 text-xs bg-flame-500/15 text-flame-400 rounded-lg hover:bg-flame-500/25",children:"Save Override"})]})]},g):e.jsxs("div",{className:"flex items-center justify-between p-2 bg-iron-800/40 rounded-lg group",children:[e.jsxs("span",{className:"text-sm text-iron-300 truncate flex-1",children:[g,I&&e.jsx("span",{className:"ml-1.5 text-[9px] px-1.5 py-0.5 rounded-full bg-flame-500/20 text-flame-400",children:"override"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-xs text-iron-500",children:[j.weight,"×",j.reps]}),e.jsxs("span",{className:"text-sm font-bold text-iron-100 w-16 text-right",children:[j.e1rm," lb"]}),e.jsx("button",{onClick:()=>lt(g),className:"p-1 text-iron-600 hover:text-flame-400 opacity-0 group-hover:opacity-100 transition-all",title:"Edit override",children:e.jsx(Vs,{className:"w-3 h-3"})}),I?e.jsx("button",{onClick:()=>Ye(g),className:"p-1 text-iron-600 hover:text-green-400 opacity-0 group-hover:opacity-100 transition-all",title:"Clear override",children:e.jsx(qt,{className:"w-3 h-3"})}):e.jsx("button",{onClick:()=>Se(g),className:"p-1 text-iron-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",title:"Exclude from context",children:e.jsx(jt,{className:"w-3 h-3"})})]})]},g)})}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No lift data recorded"}),a.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-iron-800/50",children:[e.jsx("p",{className:"text-[10px] text-iron-500 uppercase tracking-wider mb-2",children:"Excluded from AI context"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map(g=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-red-500/10 text-red-400 text-xs",children:[g,e.jsx("button",{onClick:()=>Ie(g),className:"hover:text-red-300",children:e.jsx(jt,{className:"w-3 h-3"})})]},g))})]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{type:"text",value:B,onChange:g=>Ce(g.target.value),onKeyDown:g=>{g.key==="Enter"&&B.trim()&&(Se(B.trim()),Ce(""))},placeholder:"Exclude exercise by name...",className:"flex-1 input-field text-xs py-1.5 px-2"}),B.trim()&&e.jsx("button",{onClick:()=>{Se(B.trim()),Ce("")},className:"px-2 py-1 text-xs bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20",children:"Exclude"})]})]})})(),e.jsx(re,{icon:Es,iconColor:"bg-red-500/20 text-red-400",title:"Pain History",badge:Object.keys(i.painHistory).length>0?`${Object.keys(i.painHistory).length} exercises`:"none",defaultOpen:Object.keys(i.painHistory).length>0,children:Object.keys(i.painHistory).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(i.painHistory).sort((a,d)=>d[1].maxPain-a[1].maxPain).map(([a,d])=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("span",{className:"text-sm text-iron-300 truncate flex-1",children:a}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0 text-xs",children:[e.jsxs("span",{className:ts(d.maxPain),children:["max ",d.maxPain,"/10"]}),e.jsxs("span",{className:"text-iron-500",children:[d.count,"× total"]}),d.recentCount>0&&e.jsxs("span",{className:"text-red-400",children:[d.recentCount,"× in 30d"]}),d.lastDaysAgo!=null&&e.jsx("span",{className:"text-iron-500",children:sa(d.lastDaysAgo)})]})]},a))}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No pain reported"})}),e.jsx(re,{icon:Ys,iconColor:"bg-yellow-500/20 text-yellow-400",title:"RPE Averages",badge:Ge?`avg ${Ge}`:"no data",defaultOpen:!1,children:Object.keys(i.rpeAverages).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(i.rpeAverages).sort((a,d)=>d[1]-a[1]).map(([a,d])=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("span",{className:"text-sm text-iron-300 truncate flex-1",children:a}),e.jsxs("span",{className:`text-sm font-medium ${es(d)}`,children:["RPE ",d]})]},a))}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No RPE data recorded"})}),e.jsx(re,{icon:_t,iconColor:"bg-purple-500/20 text-purple-400",title:"Active Goals",badge:`${i.goals.length} active`,defaultOpen:i.goals.length>0,children:i.goals.length>0?e.jsx("div",{className:"space-y-1.5",children:i.goals.map((a,d)=>{const f=a.currentWeight||a.currentValue||0,g=a.targetWeight||a.targetValue||0,j=g>0?Math.min(100,Math.round(f/g*100)):0;return e.jsxs("div",{className:"p-2.5 bg-iron-800/40 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-iron-200",children:a.lift||a.metricType}),e.jsxs("span",{className:"text-xs text-iron-400",children:[f," → ",g,a.targetDate?` by ${a.targetDate}`:""]})]}),e.jsx("div",{className:"h-1.5 bg-iron-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all",style:{width:`${j}%`}})})]},d)})}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No active goals"})}),e.jsx(re,{icon:Gt,iconColor:"bg-blue-500/20 text-blue-400",title:"Most Frequent Exercises",badge:`${i.topExercises.length} exercises`,defaultOpen:!1,children:i.topExercises.length>0?e.jsx("div",{className:"space-y-1.5",children:i.topExercises.map(([a,d])=>{const f=i.topExercises[0][1];return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("span",{className:"text-sm text-iron-300 truncate flex-1",children:a}),e.jsx("div",{className:"w-20 h-1.5 bg-iron-800 rounded-full overflow-hidden flex-shrink-0",children:e.jsx("div",{className:"h-full bg-blue-500/60 rounded-full",style:{width:`${d/f*100}%`}})}),e.jsxs("span",{className:"text-xs text-iron-400 w-6 text-right",children:[d,"×"]})]},a)})}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No workout data"})}),i.ouraData&&e.jsx(re,{icon:Bs,iconColor:"bg-indigo-500/20 text-indigo-400",title:"Oura Ring",defaultOpen:!1,children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[((qe=(Ze=i.ouraData.latest)==null?void 0:Ze.readiness)==null?void 0:qe.score)&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.ouraData.latest.readiness.score}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Readiness"})]}),((J=(k=i.ouraData.latest)==null?void 0:k.sleep)==null?void 0:J.score)&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.ouraData.latest.sleep.score}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Sleep"})]}),((_e=(ue=i.ouraData.latest)==null?void 0:ue.activity)==null?void 0:_e.score)&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.ouraData.latest.activity.score}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Activity"})]}),((_=i.ouraData.averages)==null?void 0:_.readinessScore)&&e.jsxs("div",{className:"p-2 bg-iron-800/40 rounded-lg text-center",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:i.ouraData.averages.readinessScore}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"7d Avg Readiness"})]})]})}),e.jsx(re,{icon:$s,iconColor:"bg-emerald-500/20 text-emerald-400",title:"Form Check History",badge:`${i.formChecks.length} checks`,defaultOpen:i.formChecks.length>0,children:i.formChecks.length>0?e.jsx("div",{className:"space-y-2",children:i.formChecks.map(a=>{var d,f,g,j;return e.jsxs("div",{className:"p-3 bg-iron-800/40 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1.5",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${ta(a.score)}`,children:e.jsx("span",{className:`text-sm font-bold ${ea(a.score)}`,children:a.score})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:a.exercise}),e.jsxs("p",{className:"text-[11px] text-iron-500",children:[a.date," · ",a.frameCount," frames · ",a.quality]})]})]}),((d=a.analysis)==null?void 0:d.overallSummary)&&e.jsx("p",{className:"text-xs text-iron-400 mb-1.5",children:a.analysis.overallSummary}),((f=a.analysis)==null?void 0:f.focusDrill)&&e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-iron-900/50 rounded-lg",children:[e.jsx(_t,{className:"w-3 h-3 text-flame-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-flame-300",children:a.analysis.focusDrill.title}),e.jsx("p",{className:"text-[11px] text-iron-400",children:a.analysis.focusDrill.cue})]})]}),((j=(g=a.analysis)==null?void 0:g.injuryRisks)==null?void 0:j.length)>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1.5",children:a.analysis.injuryRisks.map((I,C)=>e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${I.severity==="high"?"bg-red-500/20 text-red-400":I.severity==="medium"?"bg-orange-500/20 text-orange-400":"bg-yellow-500/20 text-yellow-400"}`,children:[I.area," (",I.severity,")"]},C))})]},a.id)})}):e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No form checks yet"})}),e.jsxs(re,{icon:zs,iconColor:"bg-cyan-500/20 text-cyan-400",title:"Recent Workouts (Set Detail)",badge:`${i.recentWorkouts.length} workouts`,defaultOpen:!1,children:[i.recentWorkouts.slice(0,5).map((a,d)=>e.jsxs("div",{className:`${d>0?"mt-3 pt-3 border-t border-iron-800/50":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(Rs,{to:a._isGroup?`/workouts/group/${a.id}`:`/workouts/${a.id}`,className:"text-sm font-medium text-iron-200 hover:text-flame-400 transition-colors flex items-center gap-1.5",children:[a.name||"Workout",a._isGroup&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400",children:"group"}),e.jsx(qt,{className:"w-3 h-3 text-iron-600"})]}),e.jsx("span",{className:"text-xs text-iron-500",children:a.date})]}),(a.exercises||[]).map((f,g)=>e.jsxs("div",{className:"ml-2 mb-2",children:[e.jsxs("p",{className:"text-xs font-medium text-iron-300 mb-1",children:[f.name," ",e.jsxs("span",{className:"text-iron-600",children:["[",f.type||"weight","]"]})]}),(f.sets||[]).map((j,I)=>{const C=[];return j.actualWeight?C.push(`${j.actualWeight}lb × ${j.actualReps||"?"}`):j.actualReps?C.push(`${j.actualReps} reps`):j.prescribedWeight&&C.push(`(prescribed ${j.prescribedWeight}lb × ${j.prescribedReps||"?"})`),j.actualTime?C.push(`${j.actualTime}s`):j.prescribedTime&&C.push(`(target ${j.prescribedTime}s)`),j.rpe&&C.push(e.jsxs("span",{className:es(parseInt(j.rpe)),children:["RPE ",j.rpe]},"rpe")),parseInt(j.painLevel)>0&&C.push(e.jsxs("span",{className:ts(parseInt(j.painLevel)),children:["pain ",j.painLevel,"/10"]},"pain")),e.jsxs("p",{className:"text-[11px] text-iron-500 ml-3",children:["Set ",I+1,": ",C.map((W,L)=>e.jsxs("span",{children:[L>0?" · ":"",W]},L))]},I)})]},g))]},d)),i.recentWorkouts.length===0&&e.jsx("p",{className:"text-sm text-iron-500 text-center py-2",children:"No workouts recorded"})]}),e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>h(!c),className:"w-full p-4 flex items-center gap-3 hover:bg-iron-800/30 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 bg-iron-700/50 text-iron-400",children:e.jsx(Ut,{className:"w-4 h-4"})}),e.jsx("span",{className:"flex-1 text-left text-sm font-medium text-iron-200",children:"Raw AI Context String"}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),Ue()},className:"text-xs px-2 py-1 rounded-md bg-iron-800 text-iron-400 hover:text-iron-200 flex items-center gap-1",children:[m?e.jsx(Qe,{className:"w-3 h-3 text-green-400"}):e.jsx(Js,{className:"w-3 h-3"}),m?"Copied":"Copy"]}),c?e.jsx(is,{className:"w-4 h-4 text-iron-500"}):e.jsx(vt,{className:"w-4 h-4 text-iron-500"})]}),e.jsx(ns,{children:c&&e.jsx(ls.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:e.jsx("pre",{className:"px-4 pb-4 text-[11px] text-iron-400 whitespace-pre-wrap font-mono leading-relaxed max-h-96 overflow-y-auto bg-iron-900/50 mx-4 mb-4 p-3 rounded-lg",children:ss(We())||"(empty — no data for this user)"})})})]})]})}function Na(){var Dt,Et,$t,Rt,Mt,Pt;const n=Ms();Ps("Admin");const{user:b,userProfile:A,isRealAdmin:O,startImpersonating:i,impersonating:p}=Os(),[c,h]=x.useState([]),[m,N]=x.useState(null),[F,P]=x.useState(null),[de,Z]=x.useState(!0),[ke,Xe]=x.useState(""),[$,xe]=x.useState([]),[Re,ne]=x.useState([]),[me,pe]=x.useState(null),[Me,z]=x.useState(!1),[he,Pe]=x.useState(!1),[B,Ce]=x.useState(null),[M,nt]=x.useState("users"),[G,lt]=x.useState(null),[Oe,Ye]=x.useState([]),[Fe,Se]=x.useState(!1),[Ie,We]=x.useState(null),[Ue,Ge]=x.useState([]),[Ze,qe]=x.useState(!1),[k,J]=x.useState(null),[ue,_e]=x.useState([]),[_,a]=x.useState(null),[d,f]=x.useState(!1),[g,j]=x.useState(!1),[I,C]=x.useState(!1),[W,L]=x.useState(!1),[V,K]=x.useState(null),[ge,et]=x.useState("dashboard"),[ee,He]=x.useState(null),[T,Q]=x.useState({painThresholdMin:3,painThresholdCount:2,defaultModel:"standard",rateLimitHourly:8,rateLimitDaily:25,overageCreditMultiplier:3}),[Te,tt]=x.useState(!1),[ct,Ve]=x.useState(!1),[fe,Ae]=x.useState(""),[v,S]=x.useState(!1),[y,U]=x.useState(!1),[q,X]=x.useState(!1),[te,st]=x.useState([]),[Be,yt]=x.useState(!1),[ot,cs]=x.useState(""),[os,ds]=x.useState(null),[D,le]=x.useState({lift:"",metricType:"weight",currentValue:"",targetValue:"",targetDate:"",notes:""}),xs=["Bench Press","Squat","Deadlift","Overhead Press","Barbell Row","Pull-ups","Incline Bench","Romanian Deadlift","Front Squat","Close Grip Bench","Dead Hang","Plank","Dips","Chin-ups"],Le={weight:{label:"Weight",unit:"lbs"},reps:{label:"Reps",unit:"reps"},time:{label:"Time",unit:"seconds"}},dt=O;x.useEffect(()=>{if(!dt){n("/dashboard");return}ms()},[dt,n]);const ms=async()=>{try{const t=ce(oe(E,"users"),$e("displayName")),r=(await we(t)).docs.map(o=>({id:o.id,...o.data()}));h(r)}catch(t){console.error("Error loading users:",t)}finally{Z(!1)}},ps=async t=>{N(t),P(t),Ae(""),pe(null);try{const[s,r]=await Promise.all([ft.getByUser(t.uid,20),Ke.getByUser(t.uid)]);xe(s),ne(r)}catch(s){console.error("Error loading user data:",s)}},hs=async()=>{if(!m||!fe)return;const t=parseInt(fe);if(!(isNaN(t)||t===0)){S(!0);try{await qs.add(m.uid,t);const s=(m.credits??0)+t;N(r=>({...r,credits:s})),h(r=>r.map(o=>o.uid===m.uid?{...o,credits:s}:o)),Ae("")}catch(s){console.error("Error adding credits:",s),alert("Failed to add credits")}finally{S(!1)}}},wt=async()=>{U(!0);try{const t=await _s.getActivitySummary(7);lt(t)}catch(t){console.error("Error loading activity:",t)}finally{U(!1)}},Y=x.useMemo(()=>{if(!(G!=null&&G.allEvents))return G;const t=q?G.allEvents.filter(w=>!w.adminUid):G.allEvents,s=new Set(t.map(w=>w.userId)),r={},o={},u={},l={};t.forEach(w=>{var ze,Ne,Je,be,at,rt,Ot;r[w.action]=(r[w.action]||0)+1,w.action==="page_view"&&((ze=w.metadata)!=null&&ze.page)&&(o[w.metadata.page]=(o[w.metadata.page]||0)+1);const se=(Je=(Ne=w.timestamp)==null?void 0:Ne.toDate)==null?void 0:Je.call(Ne);if(se){const mt=se.toISOString().split("T")[0];u[mt]||(u[mt]=new Set),u[mt].add(w.userId)}l[w.userId]||(l[w.userId]={actions:0,lastSeen:null}),l[w.userId].actions++,(!l[w.userId].lastSeen||((at=(be=w.timestamp)==null?void 0:be.toDate)==null?void 0:at.call(be))>l[w.userId].lastSeen)&&(l[w.userId].lastSeen=(Ot=(rt=w.timestamp)==null?void 0:rt.toDate)==null?void 0:Ot.call(rt))});const R=Object.entries(u).map(([w,se])=>({date:w,count:se.size})).sort((w,se)=>w.date.localeCompare(se.date));return{...G,totalEvents:t.length,uniqueUsers:s.size,actionCounts:r,pageCounts:o,dailyActiveCounts:R,userActivity:l,recentEvents:t.slice(0,50)}},[G,q]);x.useEffect(()=>{M==="activity"&&!G&&wt(),M==="usage"&&At(),M==="settings"&&ys(),M==="trainers"&&Oe.length===0&&vs(),M==="feedback"&&Ue.length===0&&kt(),M==="social"&&!_&&je()},[M]);const kt=async()=>{qe(!0);try{const t=ce(oe(E,"feedback"),$e("createdAt","desc"),ye(50)),s=await we(t);Ge(s.docs.map(r=>({id:r.id,...r.data()})))}catch(t){console.error("Failed to load feedback:",t)}finally{qe(!1)}},us=async(t,s)=>{try{await ve(H(E,"feedback",t),{status:s}),Ge(r=>r.map(o=>o.id===t?{...o,status:s}:o))}catch(r){console.error("Failed to update feedback:",r)}},gs={enabled:!1,frequencyHours:12,topicWeights:{bench_technique:20,programming:15,nutrition:10,recovery:10,myth_busting:15,motivation:5,app_promo:15,hot_takes:10},contentTypeMix:{education:50,promo:25,engagement:25},threadLength:{min:4,max:8},totalThreadsPosted:0},xt={bench_technique:"Bench Technique",programming:"Programming",nutrition:"Nutrition",recovery:"Recovery",myth_busting:"Myth Busting",motivation:"Motivation",app_promo:"App Promo",hot_takes:"Hot Takes"},je=async()=>{f(!0);try{const[t,s,r]=await Promise.all([ae.getSettings(),ae.getThreads(null,100),ae.getStats()]);J(t||{...gs}),_e(s),a(r)}catch(t){console.error("Failed to load social data:",t)}finally{f(!1)}},fs=async()=>{if(k){j(!0),C(!1);try{await ae.saveSettings(k),C(!0),setTimeout(()=>C(!1),2e3)}catch(t){console.error("Failed to save social settings:",t)}finally{j(!1)}}},Ct=async(t=!1)=>{L(!0);try{const s=await ae.generateThread();t&&s.threadId&&(K(s.threadId),await ae.postThread(s.threadId),K(null)),await je()}catch(s){console.error("Failed to generate thread:",s),alert("Failed: "+s.message)}finally{L(!1),K(null)}},js=async t=>{K(t);try{await ae.postThread(t),await je()}catch(s){console.error("Failed to post thread:",s),alert("Failed: "+s.message)}finally{K(null)}},Ns=async t=>{if(confirm("Delete this thread?"))try{await ae.deleteThread(t),_e(s=>s.filter(r=>r.id!==t)),a(s=>s&&{...s,queued:s.queued-1})}catch(s){console.error("Failed to delete thread:",s)}},bs=async t=>{try{await ae.retryThread(t),await je()}catch(s){console.error("Failed to retry thread:",s)}},vs=async()=>{Se(!0);try{const t=await Ht.getPendingApplications();Ye(t)}catch(t){console.error("Error loading trainer applications:",t)}finally{Se(!1)}},St=async(t,s)=>{We(t);try{await Ht.reviewApplication(t,s),Ye(r=>r.filter(o=>o.id!==t))}catch(r){console.error("Error reviewing application:",r),alert("Failed to process application")}finally{We(null)}},Tt=async(t,s)=>{try{const r=H(E,"users",t);await ve(r,{isTrainer:!s}),h(o=>o.map(u=>u.id===t?{...u,isTrainer:!s}:u))}catch(r){console.error("Error toggling trainer status:",r)}},ys=async()=>{try{const t=await bt(H(E,"settings","ai"));t.exists()&&Q({painThresholdMin:t.data().painThresholdMin??3,painThresholdCount:t.data().painThresholdCount??2,defaultModel:t.data().defaultModel??"standard",rateLimitHourly:t.data().rateLimitHourly??8,rateLimitDaily:t.data().rateLimitDaily??25,overageCreditMultiplier:t.data().overageCreditMultiplier??3})}catch(t){console.error("Error loading settings:",t)}},ws=async()=>{tt(!0),Ve(!1);try{await rs(H(E,"settings","ai"),{painThresholdMin:T.painThresholdMin,painThresholdCount:T.painThresholdCount,defaultModel:T.defaultModel,rateLimitHourly:T.rateLimitHourly,rateLimitDaily:T.rateLimitDaily,overageCreditMultiplier:T.overageCreditMultiplier,updatedAt:new Date,updatedBy:b.uid}),Ve(!0),setTimeout(()=>Ve(!1),2e3)}catch(t){console.error("Error saving settings:",t),alert("Failed to save settings")}finally{tt(!1)}},At=async()=>{yt(!0);try{const t=ce(oe(E,"tokenUsage"),$e("createdAt","desc"),ye(200)),r=(await we(t)).docs.map(o=>{const u={id:o.id,...o.data()};return!u.estimatedCost&&u.promptTokens&&u.completionTokens&&(u.model==="gpt-4o"?u.estimatedCost=u.promptTokens/1e6*2.5+u.completionTokens/1e6*10:u.estimatedCost=u.promptTokens/1e6*.15+u.completionTokens/1e6*.6),u});st(r)}catch(t){console.error("Error loading usage:",t)}finally{yt(!1)}},ks=async t=>{if(t.preventDefault(),!!F)try{const s=parseInt(D.currentValue)||0,r={lift:D.lift,metricType:D.metricType,currentValue:s,startValue:s,targetValue:parseInt(D.targetValue),targetDate:D.targetDate,notes:D.notes||"",status:"active"};if(D.metricType==="weight"&&(r.currentWeight=s,r.startWeight=s,r.targetWeight=parseInt(D.targetValue)),B)await Ke.update(B.id,r),ne(o=>o.map(u=>u.id===B.id?{...u,...r}:u));else{const o=await Ke.create(F.uid,r);ne(u=>[...u,{...o,...r}])}z(!1),Ce(null),le({lift:"",metricType:"weight",currentValue:"",targetValue:"",targetDate:"",notes:""})}catch(s){console.error("Error saving goal:",s),alert("Failed to save goal")}},Cs=async t=>{if(confirm("Delete this goal?"))try{await Ke.delete(t),ne(s=>s.filter(r=>r.id!==t))}catch(s){console.error("Error deleting goal:",s),alert("Failed to delete goal")}},Ss=async t=>{if(confirm("Delete this workout?"))try{await ft.delete(t),xe(s=>s.filter(r=>r.id!==t))}catch(s){console.error("Error deleting workout:",s),alert("Failed to delete workout")}},Ts=t=>{Ce(t),le({lift:t.lift,metricType:t.metricType||"weight",currentValue:(t.currentValue??t.currentWeight??"").toString(),targetValue:(t.targetValue??t.targetWeight??"").toString(),targetDate:t.targetDate||"",notes:t.notes||""}),z(!0)},Lt=c.filter(t=>{var s,r;return((s=t.displayName)==null?void 0:s.toLowerCase().includes(ke.toLowerCase()))||((r=t.email)==null?void 0:r.toLowerCase().includes(ke.toLowerCase()))});return dt?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 overflow-x-hidden",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-3",children:[e.jsx(Zs,{className:"w-7 h-7 text-flame-500"}),"Admin"]})}),e.jsx("div",{className:"flex gap-1 mb-6 overflow-x-auto pb-1 -mx-4 px-4 sm:mx-0 sm:px-0 scrollbar-hide",children:[{key:"users",icon:pt,label:"Users"},{key:"activity",icon:ht,label:"Activity"},{key:"usage",icon:Fs,label:"Usage"},{key:"settings",icon:Vt,label:"Settings"},{key:"trainers",icon:Is,label:"Trainers"},{key:"feedback",icon:Bt,label:"Feedback"},{key:"social",icon:Xt,label:"Social"}].map(t=>e.jsxs("button",{onClick:()=>nt(t.key),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 ${M===t.key?"bg-flame-500/15 text-flame-400 border border-flame-500/30":"text-iron-500 hover:text-iron-300 hover:bg-iron-800/50 border border-transparent"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t.label})]},t.key))}),F&&e.jsxs("div",{className:"mb-6 p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(zt,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"text-purple-200",children:["Viewing as: ",e.jsx("strong",{children:F.displayName||F.email})]})]}),e.jsx("button",{onClick:()=>{P(null),N(null),xe([]),ne([])},className:"text-purple-400 hover:text-purple-300 text-sm",children:"Clear Selection"})]}),M==="users"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid lg:grid-cols-[320px_1fr] gap-6",children:[e.jsxs("div",{className:`card-steel rounded-xl ${m?"hidden lg:block":""}`,children:[e.jsx("div",{className:"p-3 border-b border-iron-800",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:ke,onChange:t=>Xe(t.target.value),className:"input-field w-full pl-10 py-2 text-sm"})]})}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:de?e.jsx("div",{className:"p-8 text-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-flame-500 border-t-transparent rounded-full animate-spin mx-auto"})}):Lt.length>0?e.jsx("div",{children:Lt.map(t=>e.jsxs("button",{onClick:()=>ps(t),className:`w-full px-3 py-2.5 text-left transition-colors flex items-center gap-2.5 border-b border-iron-800/50
                      ${(m==null?void 0:m.id)===t.id?"bg-flame-500/10 border-l-2 border-l-flame-500":"hover:bg-iron-800/50 border-l-2 border-l-transparent"}`,children:[e.jsx("img",{src:t.photoURL||"/default-avatar.png",alt:t.displayName,className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-iron-100 truncate",children:t.displayName||"No Name"}),e.jsx("p",{className:"text-xs text-iron-500 truncate",children:t.email})]}),e.jsxs("span",{className:"flex items-center gap-0.5 text-xs text-flame-400/70 flex-shrink-0 tabular-nums",children:[e.jsx(it,{className:"w-3 h-3"}),t.credits??0]})]},t.id))}):e.jsx("div",{className:"p-8 text-center text-iron-500 text-sm",children:"No users found"})})]}),e.jsx("div",{className:"space-y-4 min-w-0",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N(null),className:"lg:hidden flex items-center gap-2 text-sm text-iron-400 hover:text-iron-200 mb-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Back to users"]}),e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-center gap-3 border-b border-iron-800/50",children:[e.jsx("img",{src:m.photoURL||"/default-avatar.png",alt:m.displayName,className:"w-12 h-12 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-display text-iron-100 truncate",children:m.displayName||"No Name"}),e.jsx("p",{className:"text-sm text-iron-500 truncate",children:m.email}),e.jsx("p",{className:"text-[10px] text-iron-600 truncate font-mono mt-0.5",children:m.uid})]}),e.jsxs("button",{onClick:async()=>{await i(m.uid),n("/today")},className:"px-3 py-2 bg-amber-500/15 hover:bg-amber-500/25 text-amber-400 text-xs font-medium rounded-lg transition-colors flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(zt,{className:"w-3.5 h-3.5"}),"View as User"]})]}),e.jsxs("div",{className:"grid grid-cols-4 divide-x divide-iron-800/50",children:[e.jsxs("div",{className:"text-center py-3",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:$.length}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Workouts"})]}),e.jsxs("div",{className:"text-center py-3",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:Re.filter(t=>t.status==="active").length}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Goals"})]}),e.jsxs("div",{className:"text-center py-3",children:[e.jsx("p",{className:"text-lg font-display text-iron-100",children:$.filter(t=>t.status==="scheduled").length}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Scheduled"})]}),e.jsxs("div",{className:"text-center py-3",children:[e.jsx("p",{className:"text-lg font-display text-flame-400",children:m.credits??0}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Credits"})]})]}),e.jsxs("div",{className:"p-3 border-t border-iron-800/50 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-iron-500 flex items-center gap-1",children:[e.jsx(it,{className:"w-3 h-3 text-flame-400"}),"Credits:"]}),e.jsx("div",{className:"flex gap-1",children:[10,25,50,100].map(t=>e.jsxs("button",{onClick:()=>Ae(String(t)),className:`px-2 py-0.5 text-xs rounded transition-colors ${fe===String(t)?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:["+",t]},t))}),e.jsx("input",{type:"number",value:fe,onChange:t=>Ae(t.target.value),placeholder:"Cust.",className:"input-field w-16 text-xs py-1 px-2"}),e.jsxs("button",{onClick:hs,disabled:v||!fe,className:"px-2.5 py-1 bg-flame-500 hover:bg-flame-600 disabled:bg-iron-700 disabled:text-iron-500 text-white text-xs rounded-lg transition-colors flex items-center gap-1",children:[v?e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ut,{className:"w-3 h-3"}),"Add"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-iron-500",children:"Personality:"}),e.jsxs("select",{value:m.chatPersonality||"coach",onChange:async t=>{try{const s=H(E,"users",m.uid);await ve(s,{chatPersonality:t.target.value}),N(r=>({...r,chatPersonality:t.target.value})),h(r=>r.map(o=>o.uid===m.uid?{...o,chatPersonality:t.target.value}:o))}catch(s){console.error(s)}},className:"text-xs bg-iron-800 border border-iron-700 rounded px-1.5 py-0.5 text-iron-300",children:[e.jsx("option",{value:"coach",children:"Coach"}),e.jsx("option",{value:"drill-sergeant",children:"Drill Sergeant"}),e.jsx("option",{value:"bro",children:"Gym Bro"}),e.jsx("option",{value:"scientist",children:"Scientist"}),e.jsx("option",{value:"comedian",children:"Trash Talk"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-iron-500",children:"Trainer:"}),e.jsx("button",{onClick:()=>Tt(m.uid||m.id,m.isTrainer),className:`text-xs px-2 py-0.5 rounded transition-colors ${m.isTrainer?"bg-green-500/20 text-green-400":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:m.isTrainer?"Active":"No"})]})]})]})]}),e.jsxs("div",{className:"card-steel p-3 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-iron-300 flex items-center gap-1.5",children:[e.jsx(ht,{className:"w-3.5 h-3.5 text-blue-400"}),"AI Chat Usage"]}),me&&e.jsx("button",{onClick:async()=>{try{const t=H(E,"users",m.uid);await ve(t,{rateLimitResetAt:new Date().toISOString()}),pe(null),alert("Rate limit reset signal sent.")}catch(t){console.error(t),alert("Failed to reset rate limit")}},className:"text-[10px] text-yellow-400 hover:text-yellow-300",children:"Reset Limits"})]}),me?e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("p",{className:"text-base font-display text-iron-100",children:me.hourCount}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Hour (8)"})]}),e.jsxs("div",{className:"text-center p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("p",{className:"text-base font-display text-iron-100",children:me.dayCount}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"Day (25)"})]}),e.jsxs("div",{className:"text-center p-2 bg-iron-800/40 rounded-lg",children:[e.jsx("p",{className:"text-base font-display text-iron-100",children:me.total}),e.jsx("p",{className:"text-[10px] text-iron-500",children:"All Time"})]})]}):e.jsx("button",{onClick:async()=>{try{const t=await Us.getRecentCounts(m.uid);pe(t)}catch{pe({hourCount:"?",dayCount:"?",total:"?"})}},className:"text-xs text-flame-400 hover:text-flame-300",children:"Load usage data"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card-steel rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-iron-800",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-200",children:"Goals"}),e.jsxs("button",{onClick:()=>z(!0),className:"text-xs text-flame-400 hover:text-flame-300 flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"}),"Add"]})]}),e.jsx("div",{className:"p-3",children:Re.length>0?e.jsx("div",{className:"space-y-2",children:Re.map(t=>{var l;const s=t.metricType||"weight",r=((l=Le[s])==null?void 0:l.unit)||"lbs",o=t.currentValue??t.currentWeight??0,u=t.targetValue??t.targetWeight??0;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-iron-800/40 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-iron-100 truncate",children:t.lift}),e.jsxs("p",{className:"text-xs text-iron-500",children:[o," → ",u," ",r]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${t.status==="active"?"bg-green-500/20 text-green-400":"bg-iron-700 text-iron-400"}`,children:t.status}),e.jsx("button",{onClick:()=>Ts(t),className:"p-1 text-iron-500 hover:text-iron-200 rounded",children:e.jsx(Yt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>Cs(t.id),className:"p-1 text-iron-500 hover:text-red-400 rounded",children:e.jsx(gt,{className:"w-3 h-3"})})]})]},t.id)})}):e.jsx("p",{className:"text-iron-600 text-center py-4 text-xs",children:"No goals set"})})]}),e.jsxs("div",{className:"card-steel rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-iron-800",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-200",children:"Recent Workouts"}),e.jsxs("button",{onClick:()=>n(`/workouts/new?userId=${m.uid}`),className:"text-xs text-iron-400 hover:text-iron-200 flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"}),"Create"]})]}),e.jsx("div",{className:"p-3",children:$.length>0?e.jsx("div",{className:"space-y-2",children:$.slice(0,5).map(t=>{var r,o,u;const s=(r=t.date)!=null&&r.toDate?t.date.toDate():new Date(t.date);return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-iron-800/40 rounded-lg",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-iron-100 truncate",children:t.name||"Workout"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[De(s,"MMM d")," · ",((o=t.exercises)==null?void 0:o.length)||0," ex"]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${t.status==="completed"?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:t.workoutType==="cardio"?"cardio":(u=t.status)==null?void 0:u.slice(0,4)}),e.jsx("button",{onClick:()=>n(`/workouts/${t.id}`),className:"p-1 text-iron-500 hover:text-iron-200 rounded",children:e.jsx(Yt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>Ss(t.id),className:"p-1 text-iron-500 hover:text-red-400 rounded",children:e.jsx(gt,{className:"w-3 h-3"})})]})]},t.id)})}):e.jsx("p",{className:"text-iron-600 text-center py-4 text-xs",children:"No workouts yet"})})]})]}),e.jsx(aa,{userId:m.uid,userName:m.displayName})]}):e.jsxs("div",{className:"card-steel p-12 rounded-xl text-center",children:[e.jsx(pt,{className:"w-12 h-12 text-iron-700 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-display text-iron-400 mb-1",children:"Select a User"}),e.jsx("p",{className:"text-iron-600 text-sm",children:"Choose a user from the list to manage"})]})})]})}):M==="activity"?e.jsx("div",{className:"space-y-6",children:y?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-flame-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-iron-500 mt-4",children:"Loading activity data..."})]}):Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("span",{className:"text-sm text-iron-400",children:"Hide admin activity"}),e.jsx("button",{onClick:()=>X(t=>!t),className:`relative w-10 h-5 rounded-full transition-colors ${q?"bg-flame-500":"bg-iron-700"}`,children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-4 h-4 rounded-full bg-white transition-transform ${q?"translate-x-5":""}`})})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-flame-400",children:Y.uniqueUsers}),e.jsx("p",{className:"text-sm text-iron-500",children:"Active Users (7d)"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-iron-100",children:Y.totalEvents}),e.jsx("p",{className:"text-sm text-iron-500",children:"Total Events"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-green-400",children:((Dt=Y.actionCounts)==null?void 0:Dt.workout_created)||0}),e.jsx("p",{className:"text-sm text-iron-500",children:"Workouts Created"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-orange-400",children:((Et=Y.actionCounts)==null?void 0:Et.cardio_logged)||0}),e.jsx("p",{className:"text-sm text-iron-500",children:"Cardio Logged"})]})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100 mb-4",children:"Daily Active Users"}),e.jsx("div",{className:"flex items-end gap-2 h-32",children:($t=Y.dailyActiveCounts)==null?void 0:$t.map((t,s)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-full bg-flame-500 rounded-t",style:{height:`${Math.max(8,t.count/Math.max(...Y.dailyActiveCounts.map(r=>r.count),1)*100)}%`}}),e.jsx("span",{className:"text-xs text-iron-500",children:De(new Date(t.date),"EEE")})]},t.date))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100 mb-4",children:"Top Pages"}),e.jsx("div",{className:"space-y-2",children:Object.entries(Y.pageCounts||{}).sort(([,t],[,s])=>s-t).slice(0,8).map(([t,s])=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-iron-800 last:border-0",children:[e.jsx("span",{className:"text-iron-300 text-sm",children:t}),e.jsx("span",{className:"text-flame-400 font-medium",children:s})]},t))})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100 mb-4",children:"Action Breakdown"}),e.jsx("div",{className:"space-y-2",children:Object.entries(Y.actionCounts||{}).sort(([,t],[,s])=>s-t).map(([t,s])=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-iron-800 last:border-0",children:[e.jsx("span",{className:"text-iron-300 text-sm",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-iron-400 font-medium",children:s})]},t))})]})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100",children:"Recent Activity"}),e.jsx("button",{onClick:wt,className:"text-sm text-flame-400 hover:text-flame-300",children:"Refresh"})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:(Rt=Y.recentEvents)==null?void 0:Rt.map(t=>{var r,o,u;const s=c.find(l=>l.uid===t.userId);return e.jsxs("div",{className:"flex items-center gap-3 py-2 border-b border-iron-800 last:border-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-800 flex items-center justify-center text-iron-400 text-xs",children:((r=s==null?void 0:s.displayName)==null?void 0:r[0])||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm text-iron-200 truncate",children:[e.jsx("span",{className:"text-iron-400",children:(s==null?void 0:s.displayName)||"Unknown"})," · ",e.jsx("span",{className:"text-flame-400",children:t.action.replace(/_/g," ")}),((o=t.metadata)==null?void 0:o.page)&&e.jsxs("span",{className:"text-iron-500",children:[" ",t.metadata.page]})]}),e.jsx("p",{className:"text-xs text-iron-600",children:((u=t.timestamp)==null?void 0:u.toDate)&&Zt(t.timestamp.toDate(),{addSuffix:!0})})]})]},t.id)})})]})]}):e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx(ht,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),e.jsx("p",{className:"text-iron-500",children:"No activity data yet"})]})}):M==="usage"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card-steel p-4 flex items-end gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-sm text-iron-400 mb-2 block",children:"Filter by User"}),e.jsxs("select",{value:ot,onChange:t=>cs(t.target.value),className:"input-field w-full max-w-xs",children:[e.jsx("option",{value:"",children:"All Users"}),c.map(t=>e.jsx("option",{value:t.uid,children:t.displayName||t.email},t.uid))]})]}),e.jsx("button",{onClick:At,disabled:Be,className:"text-sm text-flame-400 hover:text-flame-300 disabled:opacity-50",children:"Refresh"})]}),Be?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-flame-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-iron-500 mt-4",children:"Loading usage data..."})]}):e.jsx(e.Fragment,{children:(()=>{const t=ot?te.filter(l=>l.userId===ot):te,s=t.reduce((l,R)=>l+(R.totalTokens||0),0),r=t.reduce((l,R)=>l+(R.estimatedCost||0),0),o={},u={"generate-workout":"Workout Gen","generate-group-workout":"Group Gen","ask-assistant":"AI Chat","form-check":"Form Check"};return t.forEach(l=>{const R=u[l.feature]||l.feature||"other";o[R]||(o[R]={tokens:0,requests:0,cost:0}),o[R].tokens+=l.totalTokens||0,o[R].requests+=1,o[R].cost+=l.estimatedCost||0}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:"text-3xl font-display text-flame-400",children:t.length}),e.jsx("p",{className:"text-sm text-iron-500",children:"Total Requests"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsxs("p",{className:"text-3xl font-display text-iron-100",children:[(s/1e3).toFixed(1),"k"]}),e.jsx("p",{className:"text-sm text-iron-500",children:"Tokens Used"})]}),e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsxs("p",{className:"text-3xl font-display text-green-400",children:["$",r.toFixed(4)]}),e.jsx("p",{className:"text-sm text-iron-500",children:"Est. Cost"})]})]}),Object.keys(o).length>0&&e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("p",{className:"text-xs text-iron-500 font-medium uppercase tracking-wider mb-3",children:"Cost by Feature"}),e.jsx("div",{className:"space-y-2",children:Object.entries(o).sort((l,R)=>R[1].cost-l[1].cost).map(([l,R])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l==="AI Chat"?"bg-purple-400":l==="Workout Gen"?"bg-blue-400":l==="Group Gen"?"bg-cyan-400":"bg-iron-400"}`}),e.jsx("span",{className:"text-sm text-iron-300",children:l})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("span",{className:"text-green-400",children:["$",R.cost.toFixed(4)]}),e.jsxs("span",{className:"text-iron-500 ml-2",children:["(",R.requests,")"]})]})]},l))})]}),e.jsx("div",{className:"card-steel overflow-hidden",children:e.jsx("div",{className:"max-h-[600px] overflow-auto",children:e.jsxs("table",{className:"w-full text-sm min-w-[600px]",children:[e.jsx("thead",{className:"bg-iron-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-iron-400 w-8"}),e.jsx("th",{className:"text-left p-3 text-iron-400",children:"User"}),e.jsx("th",{className:"text-left p-3 text-iron-400",children:"Feature"}),e.jsx("th",{className:"text-left p-3 text-iron-400",children:"Date"}),e.jsx("th",{className:"text-right p-3 text-iron-400",children:"Tokens"}),e.jsx("th",{className:"text-right p-3 text-iron-400",children:"Cost"})]})}),e.jsx("tbody",{children:t.slice(0,100).map(l=>{var se,ze,Ne,Je,be;const R=c.find(at=>at.uid===l.userId),w=os===l.id;return e.jsxs(Gs.Fragment,{children:[e.jsxs("tr",{className:`border-t border-iron-800 cursor-pointer hover:bg-iron-800/50 transition-colors ${w?"bg-iron-800/30":""}`,onClick:()=>ds(w?null:l.id),children:[e.jsx("td",{className:"p-3 text-iron-500",children:e.jsx(vt,{className:`w-4 h-4 transition-transform ${w?"rotate-180":""}`})}),e.jsx("td",{className:"p-3 text-iron-300",children:(R==null?void 0:R.displayName)||((se=l.userId)==null?void 0:se.slice(0,8))}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${l.feature==="ask-assistant"?"bg-purple-500/20 text-purple-400":l.feature==="generate-group-workout"?"bg-cyan-500/20 text-cyan-400":l.feature==="form-check"?"bg-green-500/20 text-green-400":"bg-blue-500/20 text-blue-400"}`,children:l.feature==="generate-workout"?"Workout Gen":l.feature==="generate-group-workout"?"Group Gen":l.feature==="ask-assistant"?"AI Chat":l.feature==="form-check"?"Form Check":l.feature||"unknown"})}),e.jsx("td",{className:"p-3 text-iron-500",children:((ze=l.createdAt)==null?void 0:ze.toDate)&&De(l.createdAt.toDate(),"MMM d, h:mm a")}),e.jsx("td",{className:"p-3 text-right text-iron-300",children:(Ne=l.totalTokens)==null?void 0:Ne.toLocaleString()}),e.jsxs("td",{className:"p-3 text-right text-green-400",children:["$",(l.estimatedCost||0).toFixed(4)]})]}),w&&e.jsx("tr",{className:"border-t border-iron-800/50",children:e.jsx("td",{colSpan:6,className:"p-4 bg-iron-800/20",children:e.jsxs("div",{className:"space-y-4 max-w-3xl",children:[l.userMessage&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-iron-500 mb-1 font-medium",children:"USER MESSAGE"}),e.jsx("div",{className:"bg-iron-800 rounded-lg p-3 text-iron-300 text-sm",children:l.userMessage})]}),l.assistantResponse&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-iron-500 mb-1 font-medium",children:"ASSISTANT RESPONSE"}),e.jsx("div",{className:"bg-flame-500/10 border border-flame-500/20 rounded-lg p-3 text-iron-300 text-sm whitespace-pre-wrap",children:l.assistantResponse})]}),!l.userMessage&&!l.assistantResponse&&e.jsx("p",{className:"text-iron-500 text-sm italic",children:"No message data available (older request or different feature)"}),e.jsxs("div",{className:"flex gap-4 text-xs text-iron-500 pt-2 border-t border-iron-800",children:[e.jsxs("span",{children:["Model: ",l.model||"gpt-4o-mini"]}),e.jsxs("span",{children:["Prompt: ",(Je=l.promptTokens)==null?void 0:Je.toLocaleString()," tokens"]}),e.jsxs("span",{children:["Completion: ",(be=l.completionTokens)==null?void 0:be.toLocaleString()," tokens"]}),l.responseTimeMs&&e.jsxs("span",{children:["Response time: ",l.responseTimeMs,"ms"]})]})]})})})]},l.id)})})]})})})]})})()})]}):null,M==="settings"&&e.jsxs("div",{className:"max-w-2xl",children:[e.jsxs("div",{className:"card-steel p-6",children:[e.jsxs("h2",{className:"text-xl font-display text-iron-100 mb-6 flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-flame-500"}),"AI Workout Generation Settings"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-xl",children:[e.jsx("h3",{className:"font-medium text-iron-200 mb-4",children:"Pain Detection Thresholds"}),e.jsx("p",{className:"text-sm text-iron-500 mb-4",children:"Control when exercises are flagged for substitution based on pain history."}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Minimum Pain Level (1-10)"}),e.jsx("input",{type:"number",min:"1",max:"10",value:T.painThresholdMin,onChange:t=>Q(s=>({...s,painThresholdMin:parseInt(t.target.value)||3})),className:"input-field w-full"}),e.jsxs("p",{className:"text-xs text-iron-600 mt-1",children:["Pain level that triggers a flag (currently: ≥",T.painThresholdMin,")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Recurring Pain Count"}),e.jsx("input",{type:"number",min:"1",max:"10",value:T.painThresholdCount,onChange:t=>Q(s=>({...s,painThresholdCount:parseInt(t.target.value)||2})),className:"input-field w-full"}),e.jsxs("p",{className:"text-xs text-iron-600 mt-1",children:["Times pain reported to trigger flag (currently: ≥",T.painThresholdCount,")"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-iron-900/50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-iron-400",children:[e.jsx("strong",{className:"text-iron-300",children:"Current Logic:"})," Flag exercise if pain ≥",T.painThresholdMin,"/10 OR reported ≥",T.painThresholdCount," times"]})})]}),e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-xl",children:[e.jsx("h3",{className:"font-medium text-iron-200 mb-4",children:"Default AI Model"}),e.jsx("p",{className:"text-sm text-iron-500 mb-4",children:"Set the default model for AI workout generation."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>Q(t=>({...t,defaultModel:"standard"})),className:`flex-1 py-3 px-4 rounded-lg text-sm font-medium transition-colors ${T.defaultModel==="standard"?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:[e.jsx("div",{className:"font-semibold",children:"Standard"}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"GPT-4o-mini (~$0.001/workout)"})]}),e.jsxs("button",{type:"button",onClick:()=>Q(t=>({...t,defaultModel:"premium"})),className:`flex-1 py-3 px-4 rounded-lg text-sm font-medium transition-colors ${T.defaultModel==="premium"?"bg-purple-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:[e.jsx("div",{className:"font-semibold",children:"Premium"}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"GPT-4o (~$0.02/workout)"})]})]})]}),e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-xl",children:[e.jsx("h3",{className:"font-medium text-iron-200 mb-4",children:"Chat Rate Limits"}),e.jsxs("p",{className:"text-sm text-iron-500 mb-4",children:["Users can keep messaging after hitting the limit, but each message costs ",T.overageCreditMultiplier,"x credits."]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Hourly Limit"}),e.jsx("input",{type:"number",min:"1",max:"100",value:T.rateLimitHourly,onChange:t=>Q(s=>({...s,rateLimitHourly:parseInt(t.target.value)||8})),className:"input-field w-full"}),e.jsx("p",{className:"text-[10px] text-iron-600 mt-1",children:"msgs/hour"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Daily Limit"}),e.jsx("input",{type:"number",min:"1",max:"500",value:T.rateLimitDaily,onChange:t=>Q(s=>({...s,rateLimitDaily:parseInt(t.target.value)||25})),className:"input-field w-full"}),e.jsx("p",{className:"text-[10px] text-iron-600 mt-1",children:"msgs/day"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Overage Multiplier"}),e.jsx("input",{type:"number",min:"1",max:"10",value:T.overageCreditMultiplier,onChange:t=>Q(s=>({...s,overageCreditMultiplier:parseInt(t.target.value)||3})),className:"input-field w-full"}),e.jsx("p",{className:"text-[10px] text-iron-600 mt-1",children:"x credit cost"})]})]}),e.jsx("div",{className:"mt-3 p-2 bg-iron-900/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-iron-500",children:["After ",T.rateLimitHourly,"/hr or ",T.rateLimitDaily,"/day, each message costs ",T.overageCreditMultiplier," credits instead of 1"]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-iron-800",children:[e.jsx("div",{className:"text-sm text-iron-500",children:ct&&e.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[e.jsx(Qe,{className:"w-4 h-4"})," Settings saved!"]})}),e.jsx("button",{onClick:ws,disabled:Te,className:"btn-primary flex items-center gap-2",children:Te?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-4 h-4"}),"Save Settings"]})})]})]})]}),e.jsxs("div",{className:"card-steel p-6 mt-6",children:[e.jsxs("h2",{className:"text-xl font-display text-iron-100 mb-4 flex items-center gap-2",children:[e.jsx(it,{className:"w-5 h-5 text-purple-500"}),"Dev Tools"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-200",children:"Reset onboarding checklist"}),e.jsx("p",{className:"text-xs text-iron-500",children:"Clears claimed tasks so the checklist shows again on Today"})]}),e.jsx("button",{onClick:async()=>{try{const{updateDoc:t,doc:s}=await Jt(async()=>{const{updateDoc:o,doc:u}=await import("./index-OFuFeI6c.js").then(l=>l.bc);return{updateDoc:o,doc:u}},__vite__mapDeps([0,1])),{db:r}=await Jt(async()=>{const{db:o}=await import("./index-OFuFeI6c.js").then(u=>u.bd);return{db:o}},__vite__mapDeps([0,1]));await t(s(r,"users",b.uid),{onboardingChecklist:{}}),alert("Checklist reset! Go to Today to see it.")}catch(t){alert("Error: "+t.message)}},className:"px-3 py-1.5 text-xs rounded-lg bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30 transition-colors",children:"Reset"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-200",children:"Preview login page"}),e.jsx("p",{className:"text-xs text-iron-500",children:"View the landing page without logging out"})]}),e.jsx("a",{href:"/login?preview",className:"px-3 py-1.5 text-xs rounded-lg bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30 transition-colors",children:"Preview"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-200",children:"Preview onboarding flow"}),e.jsx("p",{className:"text-xs text-iron-500",children:"View the new-user onboarding without resetting your profile"})]}),e.jsx("a",{href:"/onboarding?preview",className:"px-3 py-1.5 text-xs rounded-lg bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30 transition-colors",children:"Preview"})]})]})]})]}),M==="trainers"&&e.jsxs("div",{className:"max-w-2xl space-y-6",children:[e.jsxs("div",{className:"card-steel p-6",children:[e.jsx("h2",{className:"font-display text-lg text-iron-100 mb-4",children:"Pending Applications"}),Fe?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500 py-4",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),"Loading applications..."]}):Oe.length===0?e.jsx("p",{className:"text-sm text-iron-500 py-4",children:"No pending applications."}):e.jsx("div",{className:"space-y-3",children:Oe.map(t=>{var s,r,o;return e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-xl border border-iron-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:t.displayName||t.email}),e.jsx("p",{className:"text-xs text-iron-500",children:t.email})]}),e.jsx("span",{className:"text-xs text-iron-600",children:(s=t.createdAt)!=null&&s.toDate?De((o=(r=t.createdAt)==null?void 0:r.toDate)==null?void 0:o.call(r),"MMM d"):""})]}),t.notes&&e.jsx("p",{className:"text-sm text-iron-400 mb-3 p-2 bg-iron-900/50 rounded",children:t.notes}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>St(t.id,"approved"),disabled:Ie===t.id,className:`flex-1 py-2 bg-green-500/20 text-green-400 rounded-lg text-sm font-medium
                          hover:bg-green-500/30 transition-colors disabled:opacity-50 flex items-center justify-center gap-1.5`,children:[Ie===t.id?e.jsx(ie,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Qe,{className:"w-3.5 h-3.5"}),"Approve"]}),e.jsx("button",{onClick:()=>St(t.id,"denied"),disabled:Ie===t.id,className:`flex-1 py-2 bg-red-500/10 text-red-400 rounded-lg text-sm font-medium
                          hover:bg-red-500/20 transition-colors disabled:opacity-50`,children:"Deny"})]})]},t.id)})})]}),e.jsxs("div",{className:"card-steel p-6",children:[e.jsx("h2",{className:"font-display text-lg text-iron-100 mb-4",children:"Active Trainers"}),e.jsxs("div",{className:"space-y-2",children:[c.filter(t=>t.isTrainer||t.email==="charltonuw@gmail.com").map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center overflow-hidden",children:t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx(pt,{className:"w-4 h-4 text-iron-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-200",children:t.displayName||t.email}),e.jsx("p",{className:"text-xs text-iron-500",children:t.email==="charltonuw@gmail.com"?"Admin (always trainer)":"Approved trainer"})]})]}),t.email!=="charltonuw@gmail.com"&&e.jsx("button",{onClick:()=>Tt(t.id,t.isTrainer),className:"text-xs px-3 py-1 bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 transition-colors",children:"Remove"})]},t.id)),c.filter(t=>t.isTrainer||t.email==="charltonuw@gmail.com").length===0&&e.jsx("p",{className:"text-sm text-iron-500",children:"No active trainers besides admin."})]})]})]}),M==="feedback"&&e.jsxs("div",{className:"max-w-2xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-lg text-iron-100",children:"User Feedback"}),e.jsx("button",{onClick:kt,className:"text-xs text-iron-500 hover:text-iron-300 transition-colors",children:"Refresh"})]}),Ze?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500 py-8",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),"Loading feedback..."]}):Ue.length===0?e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(Bt,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-iron-500",children:"No feedback yet."})]}):e.jsx("div",{className:"space-y-3",children:Ue.map(t=>{var s;return e.jsxs("div",{className:`card-steel p-4 border-l-2 ${t.category==="bug"?"border-l-red-500":t.category==="feature"?"border-l-blue-500":"border-l-flame-500"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase tracking-wider rounded font-semibold ${t.category==="bug"?"bg-red-500/15 text-red-400":t.category==="feature"?"bg-blue-500/15 text-blue-400":"bg-flame-500/15 text-flame-400"}`,children:t.category}),e.jsx("span",{className:"text-sm text-iron-300 font-medium",children:t.userName||"Unknown"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-iron-600",children:(s=t.createdAt)!=null&&s.toDate?De(t.createdAt.toDate(),"MMM d, h:mm a"):""}),e.jsxs("select",{value:t.status||"new",onChange:r=>us(t.id,r.target.value),className:"text-xs bg-iron-800 border border-iron-700 rounded px-1.5 py-0.5 text-iron-400",children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"read",children:"Read"}),e.jsx("option",{value:"done",children:"Done"})]})]})]}),e.jsx("p",{className:"text-sm text-iron-300 whitespace-pre-wrap",children:t.message}),e.jsx("p",{className:"text-[10px] text-iron-600 mt-1",children:t.userId})]},t.id)})})]}),M==="social"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-1 border-b border-iron-800 pb-2",children:["dashboard","queue","history","settings"].map(t=>e.jsx("button",{onClick:()=>et(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors capitalize ${ge===t?"bg-iron-800 text-iron-100":"text-iron-500 hover:text-iron-300"}`,children:t},t))}),d?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500 py-8",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),"Loading social data..."]}):e.jsxs(e.Fragment,{children:[ge==="dashboard"&&_&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{label:"Posts Today",value:_.postsToday,color:"text-flame-400"},{label:"Total Posted",value:_.totalPosted,color:"text-iron-100"},{label:"Queued",value:_.queued,color:"text-blue-400"},{label:"Failed",value:_.failed,color:_.failed>0?"text-red-400":"text-iron-500"}].map(t=>e.jsxs("div",{className:"card-steel p-4 text-center",children:[e.jsx("p",{className:`text-2xl font-bold ${t.color}`,children:t.value}),e.jsx("p",{className:"text-xs text-iron-500 mt-1",children:t.label})]},t.label))}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{label:"Impressions",value:_.totalImpressions.toLocaleString()},{label:"Likes",value:_.totalLikes.toLocaleString()},{label:"Retweets",value:_.totalRetweets.toLocaleString()}].map(t=>e.jsxs("div",{className:"card-steel p-3 text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-200",children:t.value}),e.jsx("p",{className:"text-[10px] text-iron-500 mt-0.5",children:t.label})]},t.label))}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${k!=null&&k.enabled?"bg-green-400 animate-pulse":"bg-iron-600"}`}),e.jsx("span",{className:"text-sm font-medium text-iron-200",children:k!=null&&k.enabled?"Auto-posting active":"Auto-posting disabled"})]}),(k==null?void 0:k.lastPostedAt)&&e.jsxs("p",{className:"text-xs text-iron-500 mt-1 ml-4",children:["Last posted: ",Zt(k.lastPostedAt.toDate(),{addSuffix:!0})]})]}),e.jsx("button",{onClick:je,className:"text-iron-500 hover:text-iron-300 transition-colors",children:e.jsx(Kt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Ct(!1),disabled:W,className:"btn-secondary text-sm flex items-center gap-1.5",children:[W?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(it,{className:"w-4 h-4"}),"Generate Thread"]}),e.jsxs("button",{onClick:()=>Ct(!0),disabled:W||V,className:"btn-primary text-sm flex items-center gap-1.5",children:[V?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(Qt,{className:"w-4 h-4"}),"Generate & Post Now"]})]})]})]}),ge==="queue"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-lg text-iron-100",children:"Queued Threads"}),e.jsx("button",{onClick:je,className:"text-xs text-iron-500 hover:text-iron-300 transition-colors",children:"Refresh"})]}),ue.filter(t=>t.status==="queued").length===0?e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(Qs,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-iron-500",children:"No threads in queue."})]}):ue.filter(t=>t.status==="queued").map(t=>{var s;return e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"px-2 py-0.5 text-[10px] uppercase tracking-wider rounded font-semibold bg-blue-500/15 text-blue-400",children:xt[t.topic]||t.topic}),e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase tracking-wider rounded font-semibold ${t.contentType==="education"?"bg-emerald-500/15 text-emerald-400":t.contentType==="promo"?"bg-flame-500/15 text-flame-400":"bg-purple-500/15 text-purple-400"}`,children:t.contentType}),e.jsxs("span",{className:"text-xs text-iron-500",children:[t.tweetCount," tweets"]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>js(t.id),disabled:V===t.id,className:"p-1.5 rounded-lg text-blue-400 hover:bg-blue-500/10 transition-colors",title:"Post now",children:V===t.id?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):e.jsx(Qt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Ns(t.id),className:"p-1.5 rounded-lg text-red-400 hover:bg-red-500/10 transition-colors",title:"Delete",children:e.jsx(gt,{className:"w-4 h-4"})})]})]}),e.jsx("button",{onClick:()=>He(ee===t.id?null:t.id),className:"text-xs text-iron-500 hover:text-iron-300 transition-colors mb-2",children:ee===t.id?"Hide preview":"Show preview"}),ee===t.id&&e.jsx("div",{className:"space-y-2 mt-2 border-t border-iron-800 pt-3",children:(s=t.tweets)==null?void 0:s.map((r,o)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-[10px] text-iron-600 font-mono w-4 flex-shrink-0 mt-0.5",children:o+1}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:r.text})]},o))})]},t.id)})]}),ge==="history"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-lg text-iron-100",children:"Post History"}),e.jsx("button",{onClick:je,className:"text-xs text-iron-500 hover:text-iron-300 transition-colors",children:"Refresh"})]}),ue.filter(t=>t.status==="posted"||t.status==="failed").length===0?e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(Xt,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-iron-500",children:"No posts yet."})]}):ue.filter(t=>t.status==="posted"||t.status==="failed").map(t=>{var s,r;return e.jsxs("div",{className:`card-steel p-4 ${t.status==="failed"?"border-l-2 border-l-red-500":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-2 py-0.5 text-[10px] uppercase tracking-wider rounded font-semibold ${t.status==="failed"?"bg-red-500/15 text-red-400":"bg-green-500/15 text-green-400"}`,children:t.status}),e.jsx("span",{className:"px-2 py-0.5 text-[10px] uppercase tracking-wider rounded font-semibold bg-blue-500/15 text-blue-400",children:xt[t.topic]||t.topic}),e.jsxs("span",{className:"text-xs text-iron-500",children:[t.tweetCount," tweets"]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.threadUrl&&e.jsx("a",{href:t.threadUrl,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-lg text-iron-400 hover:text-iron-200 hover:bg-iron-800 transition-colors",title:"View on X",children:e.jsx(Xs,{className:"w-4 h-4"})}),t.status==="failed"&&e.jsx("button",{onClick:()=>bs(t.id),className:"p-1.5 rounded-lg text-blue-400 hover:bg-blue-500/10 transition-colors",title:"Retry",children:e.jsx(Kt,{className:"w-4 h-4"})})]})]}),t.error&&e.jsx("p",{className:"text-xs text-red-400 mb-2",children:t.error}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-iron-500",children:[((s=t.postedAt)==null?void 0:s.toDate)&&e.jsx("span",{children:De(t.postedAt.toDate(),"MMM d, h:mm a")}),t.impressions>0&&e.jsxs("span",{children:[t.impressions.toLocaleString()," views"]}),t.likes>0&&e.jsxs("span",{children:[t.likes," likes"]}),t.retweets>0&&e.jsxs("span",{children:[t.retweets," RTs"]})]}),e.jsx("button",{onClick:()=>He(ee===t.id?null:t.id),className:"text-xs text-iron-500 hover:text-iron-300 transition-colors mt-2",children:ee===t.id?"Hide":"Show thread"}),ee===t.id&&e.jsx("div",{className:"space-y-2 mt-2 border-t border-iron-800 pt-3",children:(r=t.tweets)==null?void 0:r.map((o,u)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-[10px] text-iron-600 font-mono w-4 flex-shrink-0 mt-0.5",children:u+1}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:o.text})]},u))})]},t.id)})]}),ge==="settings"&&k&&e.jsxs("div",{className:"max-w-lg space-y-6",children:[e.jsx("div",{className:"card-steel p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-100",children:"Auto-posting"}),e.jsx("p",{className:"text-xs text-iron-500 mt-0.5",children:"Automatically generate and post threads on schedule"})]}),e.jsx("button",{onClick:()=>J(t=>({...t,enabled:!t.enabled})),className:`relative w-11 h-6 rounded-full transition-colors ${k.enabled?"bg-flame-500":"bg-iron-700"}`,children:e.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white transition-transform ${k.enabled?"translate-x-5":"translate-x-0"}`})})]})}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-100 mb-3",children:"Posting Frequency"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[6,8,12,24].map(t=>e.jsxs("button",{onClick:()=>J(s=>({...s,frequencyHours:t})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${k.frequencyHours===t?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:[t,"h"]},t))}),e.jsxs("p",{className:"text-xs text-iron-500 mt-2",children:["~",Math.round(24/(k.frequencyHours||12))," posts per day"]})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-100 mb-3",children:"Topic Weights"}),e.jsx("p",{className:"text-xs text-iron-500 mb-3",children:"Higher weight = more likely to be selected. Recent topics are auto-avoided."}),e.jsx("div",{className:"space-y-2",children:Object.entries(xt).map(([t,s])=>{var r,o;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-iron-300 w-32 flex-shrink-0",children:s}),e.jsx("input",{type:"range",min:"0",max:"30",value:((r=k.topicWeights)==null?void 0:r[t])||0,onChange:u=>J(l=>({...l,topicWeights:{...l.topicWeights,[t]:parseInt(u.target.value)}})),className:"flex-1 accent-flame-500"}),e.jsx("span",{className:"text-xs text-iron-500 w-6 text-right",children:((o=k.topicWeights)==null?void 0:o[t])||0})]},t)})})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-100 mb-3",children:"Content Type Mix (%)"}),e.jsxs("div",{className:"space-y-2",children:[[{key:"education",label:"Education",desc:"Pure fitness tips, no app mention"},{key:"promo",label:"Promo",desc:"Tips + subtle BenchOnly plug in last tweet"},{key:"engagement",label:"Engagement",desc:"Hot takes, debate starters, viral hooks"}].map(t=>{var s;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-28 flex-shrink-0",children:[e.jsx("span",{className:"text-sm text-iron-300",children:t.label}),e.jsx("p",{className:"text-[10px] text-iron-600 leading-tight",children:t.desc})]}),e.jsx("input",{type:"number",min:"0",max:"100",value:((s=k.contentTypeMix)==null?void 0:s[t.key])||0,onChange:r=>J(o=>({...o,contentTypeMix:{...o.contentTypeMix,[t.key]:parseInt(r.target.value)||0}})),className:"input-field w-20 text-center"}),e.jsx("span",{className:"text-xs text-iron-500",children:"%"})]},t.key)}),(()=>{const t=Object.values(k.contentTypeMix||{}).reduce((s,r)=>s+r,0);return t!==100&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1",children:["Total: ",t,"% (should be 100%)"]})})()]})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-iron-100 mb-3",children:"Thread Length"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-iron-400",children:"Min"}),e.jsx("input",{type:"number",min:"3",max:"10",value:((Mt=k.threadLength)==null?void 0:Mt.min)||4,onChange:t=>J(s=>({...s,threadLength:{...s.threadLength,min:parseInt(t.target.value)||4}})),className:"input-field w-16 text-center"}),e.jsx("span",{className:"text-sm text-iron-400",children:"Max"}),e.jsx("input",{type:"number",min:"3",max:"15",value:((Pt=k.threadLength)==null?void 0:Pt.max)||8,onChange:t=>J(s=>({...s,threadLength:{...s.threadLength,max:parseInt(t.target.value)||8}})),className:"input-field w-16 text-center"}),e.jsx("span",{className:"text-sm text-iron-500",children:"tweets"})]})]}),e.jsxs("button",{onClick:fs,disabled:g,className:"btn-primary w-full flex items-center justify-center gap-2",children:[g?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):I?e.jsx(Qe,{className:"w-4 h-4"}):e.jsx(Nt,{className:"w-4 h-4"}),I?"Saved!":"Save Settings"]})]})]})]}),Me&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>z(!1)}),e.jsxs("div",{className:"relative bg-iron-900 border border-iron-700 rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>z(!1),className:"absolute top-4 right-4 text-iron-500 hover:text-iron-300",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsxs("h2",{className:"text-xl font-display text-iron-100 mb-2",children:[B?"Edit":"Create"," Goal for ",F==null?void 0:F.displayName]}),e.jsx("p",{className:"text-sm text-iron-500 mb-6",children:B?"Update this goal":"This goal will be added to the user's account"}),e.jsxs("form",{onSubmit:ks,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Exercise *"}),e.jsxs("select",{value:D.lift,onChange:t=>le(s=>({...s,lift:t.target.value})),className:"input-field w-full",required:!0,children:[e.jsx("option",{value:"",children:"Select an exercise"}),xs.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Goal Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(Le).map(([t,{label:s}])=>e.jsx("button",{type:"button",onClick:()=>le(r=>({...r,metricType:t})),className:`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${D.metricType===t?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:s},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:["Current ",Le[D.metricType].label," (",Le[D.metricType].unit,")"]}),e.jsx("input",{type:"number",value:D.currentValue,onChange:t=>le(s=>({...s,currentValue:t.target.value})),className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:["Target ",Le[D.metricType].label," (",Le[D.metricType].unit,") *"]}),e.jsx("input",{type:"number",value:D.targetValue,onChange:t=>le(s=>({...s,targetValue:t.target.value})),className:"input-field w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Target Date *"}),e.jsx("input",{type:"date",value:D.targetDate,onChange:t=>le(s=>({...s,targetDate:t.target.value})),className:"input-field w-full",min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-400 mb-2",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:D.notes,onChange:t=>le(s=>({...s,notes:t.target.value})),placeholder:"e.g., with pause, 20lb vest",className:"input-field w-full"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!D.lift||!D.targetValue||!D.targetDate,className:"btn-primary flex-1",children:"Create Goal"})]})]})]})]})]}):null}export{Na as default};
