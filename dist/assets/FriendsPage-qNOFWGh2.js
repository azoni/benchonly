import{d as V,r as i,D as W,H as Y,I as Z,a1 as o,j as s,f as j,L as h,A as _,U as v,a4 as N,h as D,X as E,q as I}from"./index-DavVl6G1.js";import{C as w}from"./clock-CHsUorid.js";import{S as y}from"./search-CdPeamcd.js";import{U as ee}from"./user-minus-C9uceC_P.js";function ie(){const{user:l}=V(),[u,R]=i.useState("friends"),[x,S]=i.useState([]),[r,L]=i.useState([]),[p,g]=i.useState([]),[P,M]=i.useState([]),[f,T]=i.useState(""),[Q,k]=i.useState(!0),[c,n]=i.useState({}),[C,q]=i.useState({});i.useEffect(()=>{l&&F()},[l]);const F=async()=>{k(!0);try{const e=await W(Y(Z,"users")),t={},a=[];e.docs.forEach(m=>{const U={id:m.id,uid:m.id,...m.data()};t[m.id]=U,m.id!==l.uid&&a.push(U)}),q(t),M(a);const[d,b,O]=await Promise.all([o.getFriends(l.uid),o.getReceivedRequests(l.uid),o.getSentRequests(l.uid)]);S(d.map(m=>t[m]).filter(Boolean)),L(b),g(O)}catch(e){console.error("Error loading friends data:",e)}finally{k(!1)}},A=async e=>{n(t=>({...t,[e]:!0}));try{await o.acceptRequest(e),await F()}catch(t){console.error("Accept error:",t)}finally{n(t=>({...t,[e]:!1}))}},B=async e=>{n(t=>({...t,[e]:!0}));try{await o.declineRequest(e),L(t=>t.filter(a=>a.id!==e))}catch(t){console.error("Decline error:",t)}finally{n(t=>({...t,[e]:!1}))}},H=async e=>{n(t=>({...t,[e]:!0}));try{await o.cancelRequest(e),g(t=>t.filter(a=>a.id!==e))}catch(t){console.error("Cancel error:",t)}finally{n(t=>({...t,[e]:!1}))}},X=async e=>{if(confirm("Remove this friend?")){n(t=>({...t,[e]:!0}));try{await o.removeFriend(l.uid,e),S(t=>t.filter(a=>a.uid!==e&&a.id!==e))}catch(t){console.error("Remove error:",t)}finally{n(t=>({...t,[e]:!1}))}}},z=async e=>{n(t=>({...t,[e]:!0}));try{await o.sendRequest(l.uid,e);const t=await o.getSentRequests(l.uid);g(t)}catch(t){console.error("Send request error:",t),alert(t.message)}finally{n(t=>({...t,[e]:!1}))}},G=new Set(x.map(e=>e.uid||e.id)),J=new Set(p.map(e=>e.to)),K=new Set(r.map(e=>e.from)),$=f.trim()?P.filter(e=>{var a,d;const t=f.toLowerCase();return(((a=e.displayName)==null?void 0:a.toLowerCase().includes(t))||((d=e.username)==null?void 0:d.toLowerCase().includes(t)))&&!G.has(e.id)}):[];return Q?s.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-12 text-center",children:[s.jsx(j,{className:"w-8 h-8 text-flame-500 animate-spin mx-auto"}),s.jsx("p",{className:"text-iron-500 mt-4",children:"Loading friends..."})]}):s.jsxs("div",{className:"max-w-2xl mx-auto pb-24",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx(h,{to:"/feed",className:"text-iron-400 hover:text-iron-200",children:s.jsx(_,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-3",children:[s.jsx(v,{className:"w-7 h-7 text-flame-500"}),"Friends"]}),s.jsxs("p",{className:"text-iron-500 text-sm mt-1",children:[x.length," friend",x.length!==1?"s":"",r.length>0&&s.jsxs(s.Fragment,{children:[" Â· ",s.jsxs("span",{className:"text-flame-400",children:[r.length," pending request",r.length!==1?"s":""]})]})]})]})]}),s.jsx("div",{className:"flex gap-2 mb-6",children:[{key:"friends",label:"Friends",icon:v,count:x.length},{key:"requests",label:"Requests",icon:w,count:r.length+p.length},{key:"find",label:"Find People",icon:y}].map(e=>s.jsxs("button",{onClick:()=>R(e.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${u===e.key?"bg-flame-500/20 text-flame-400 border border-flame-500/30":"bg-iron-800/50 text-iron-400 border border-iron-700/50 hover:text-iron-200"}`,children:[s.jsx(e.icon,{className:"w-3.5 h-3.5"}),e.label,e.count>0&&s.jsx("span",{className:`text-xs px-1.5 rounded-full ${u===e.key?"bg-flame-500/30":"bg-iron-700"}`,children:e.count})]},e.key))}),u==="friends"&&s.jsx("div",{className:"space-y-2",children:x.length===0?s.jsxs("div",{className:"card-steel p-12 text-center",children:[s.jsx(v,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),s.jsx("p",{className:"text-iron-500 mb-2",children:"No friends yet"}),s.jsx("button",{onClick:()=>R("find"),className:"text-sm text-flame-400 hover:text-flame-300",children:"Find people to add"})]}):x.map(e=>s.jsxs("div",{className:"card-steel p-4 flex items-center gap-3",children:[s.jsx(h,{to:`/profile/${e.username||e.uid||e.id}`,className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center hover:bg-iron-700 transition-colors",children:e.photoURL?s.jsx("img",{src:e.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx(N,{className:"w-5 h-5 text-iron-400"})}),s.jsxs(h,{to:`/profile/${e.username||e.uid||e.id}`,className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-iron-200 truncate",children:e.displayName||"User"}),e.username&&s.jsxs("p",{className:"text-xs text-flame-400",children:["@",e.username]})]}),s.jsx("button",{onClick:()=>X(e.uid||e.id),disabled:c[e.uid||e.id],className:"p-2 text-iron-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Remove friend",children:c[e.uid||e.id]?s.jsx(j,{className:"w-4 h-4 animate-spin"}):s.jsx(ee,{className:"w-4 h-4"})})]},e.uid||e.id))}),u==="requests"&&s.jsxs("div",{className:"space-y-4",children:[r.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-iron-400 mb-2",children:"Received"}),s.jsx("div",{className:"space-y-2",children:r.map(e=>{const t=C[e.from];return s.jsxs("div",{className:"card-steel p-4 flex items-center gap-3",children:[s.jsx(h,{to:`/profile/${(t==null?void 0:t.username)||e.from}`,className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center hover:bg-iron-700 transition-colors",children:t!=null&&t.photoURL?s.jsx("img",{src:t.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx(N,{className:"w-5 h-5 text-iron-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-iron-200 truncate",children:(t==null?void 0:t.displayName)||"User"}),(t==null?void 0:t.username)&&s.jsxs("p",{className:"text-xs text-flame-400",children:["@",t.username]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>A(e.id),disabled:c[e.id],className:"flex items-center gap-1 px-3 py-1.5 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg text-sm font-medium transition-colors",children:[c[e.id]?s.jsx(j,{className:"w-3.5 h-3.5 animate-spin"}):s.jsx(D,{className:"w-3.5 h-3.5"}),"Accept"]}),s.jsx("button",{onClick:()=>B(e.id),disabled:c[e.id],className:"p-1.5 text-iron-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:s.jsx(E,{className:"w-4 h-4"})})]})]},e.id)})})]}),p.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-iron-400 mb-2",children:"Sent"}),s.jsx("div",{className:"space-y-2",children:p.map(e=>{const t=C[e.to];return s.jsxs("div",{className:"card-steel p-4 flex items-center gap-3",children:[s.jsx(h,{to:`/profile/${(t==null?void 0:t.username)||e.to}`,className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center hover:bg-iron-700 transition-colors",children:t!=null&&t.photoURL?s.jsx("img",{src:t.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx(N,{className:"w-5 h-5 text-iron-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-iron-200 truncate",children:(t==null?void 0:t.displayName)||"User"}),(t==null?void 0:t.username)&&s.jsxs("p",{className:"text-xs text-flame-400",children:["@",t.username]})]}),s.jsxs("button",{onClick:()=>H(e.id),disabled:c[e.id],className:"flex items-center gap-1 px-3 py-1.5 bg-iron-700 text-iron-300 hover:bg-iron-600 rounded-lg text-sm font-medium transition-colors",children:[c[e.id]?s.jsx(j,{className:"w-3.5 h-3.5 animate-spin"}):s.jsx(E,{className:"w-3.5 h-3.5"}),"Cancel"]})]},e.id)})})]}),r.length===0&&p.length===0&&s.jsxs("div",{className:"card-steel p-12 text-center",children:[s.jsx(w,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),s.jsx("p",{className:"text-iron-500",children:"No pending requests"})]})]}),u==="find"&&s.jsxs("div",{children:[s.jsx("div",{className:"card-steel p-4 mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500"}),s.jsx("input",{type:"text",placeholder:"Search by name or username...",value:f,onChange:e=>T(e.target.value),className:"input-field w-full pl-10",autoFocus:!0})]})}),f.trim()?s.jsx("div",{className:"space-y-2",children:$.length===0?s.jsx("div",{className:"card-steel p-8 text-center",children:s.jsxs("p",{className:"text-iron-500",children:['No users found matching "',f,'"']})}):$.map(e=>{const t=J.has(e.id),a=K.has(e.id);return s.jsxs("div",{className:"card-steel p-4 flex items-center gap-3",children:[s.jsx(h,{to:`/profile/${e.username||e.id}`,className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center hover:bg-iron-700 transition-colors",children:e.photoURL?s.jsx("img",{src:e.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):s.jsx(N,{className:"w-5 h-5 text-iron-400"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-iron-200 truncate",children:e.displayName||"User"}),e.username&&s.jsxs("p",{className:"text-xs text-flame-400",children:["@",e.username]})]}),t?s.jsxs("span",{className:"text-xs text-iron-500 flex items-center gap-1",children:[s.jsx(w,{className:"w-3.5 h-3.5"})," Pending"]}):a?s.jsxs("button",{onClick:()=>{const d=r.find(b=>b.from===e.id);d&&A(d.id)},className:"flex items-center gap-1 px-3 py-1.5 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg text-sm font-medium transition-colors",children:[s.jsx(D,{className:"w-3.5 h-3.5"})," Accept"]}):s.jsxs("button",{onClick:()=>z(e.id),disabled:c[e.id],className:"flex items-center gap-1 px-3 py-1.5 bg-flame-500/20 text-flame-400 hover:bg-flame-500/30 rounded-lg text-sm font-medium transition-colors",children:[c[e.id]?s.jsx(j,{className:"w-3.5 h-3.5 animate-spin"}):s.jsx(I,{className:"w-3.5 h-3.5"}),"Add"]})]},e.id)})}):s.jsxs("div",{className:"card-steel p-8 text-center",children:[s.jsx(y,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),s.jsx("p",{className:"text-iron-500",children:"Type a name or username to find people"})]})]})]})}export{ie as default};
