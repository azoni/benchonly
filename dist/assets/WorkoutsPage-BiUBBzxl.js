const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DavVl6G1.js","assets/index-B_knwA6G.css"])))=>i.map(i=>d[i]);
import{t as Se,d as Re,b as Te,r as n,_ as De,Q as se,g as S,aw as qe,ar as Pe,p as M,ag as Ae,o as y,j as e,au as L,L as v,S as Ee,n as ae,E as re,T as _e,s as ie,m as R,ax as $e,U as Ge,Y as I,C as Me,l as ne,X as Le,ak as oe,f as Ie,ab as le,av as ce,at as ze}from"./index-DavVl6G1.js";import{s as de}from"./index-TowzVWci.js";import{e as Oe}from"./index-UiQdz_qZ.js";import{S as Ue}from"./search-CdPeamcd.js";import{A as Be}from"./alert-circle-BQWEVami.js";import{C as Fe}from"./clock-CHsUorid.js";import{M as Qe}from"./more-vertical-D7X6ClrU.js";import{P as Ve}from"./pen-Blbe3mK0.js";import{T as Ye}from"./trash-2-DxpHMsj-.js";import{i as Ke}from"./index-Baaxu7Eq.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=Se("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function nt(){var te;const{user:d,userProfile:T,updateProfile:z,isGuest:O,isAppAdmin:D}=Re(),me=Te(),[q,w]=n.useState([]),[P,U]=n.useState([]),[xe,B]=n.useState(!0),[A,pe]=n.useState(""),[E,p]=n.useState(null),[k,j]=n.useState(null),[l,F]=n.useState("todo"),[he,C]=n.useState(!1),[m,ge]=n.useState("custom_workout"),[Q,V]=n.useState(""),[Y,K]=n.useState(""),[b,fe]=n.useState(null),[_,X]=n.useState(!1);n.useEffect(()=>{d&&ye()},[d]);const ye=async()=>{try{if(O){const{getSampleWorkouts:a}=await De(async()=>{const{getSampleWorkouts:o}=await import("./index-DavVl6G1.js").then(x=>x.b4);return{getSampleWorkouts:o}},__vite__mapDeps([0,1]));w(a()),B(!1);return}const[t,s,r,i]=await Promise.all([se.getByUser(d.uid,100),S.getByUser(d.uid).catch(()=>[]),S.getPendingReviews(d.uid).catch(()=>[]),qe.getByUser(d.uid).catch(()=>[])]);U(r);const u=s.map(a=>({...a,isGroupWorkout:!0})),h=i.filter(a=>{var o;return a.type==="recurring"&&((o=a.days)==null?void 0:o.length)>0}),g=[];if(h.length>0){const a=Pe(new Date),o=de(a,30),x=Oe({start:o,end:de(a,1)});for(const c of h){const W=c.skippedDates||[];for(const N of x){const We=M(N,"EEEE").toLowerCase(),G=Ae(N);c.days.includes(We)&&!W.includes(G)&&g.push({id:`recurring_${c.id}_${G}`,name:c.name||"Recurring Activity",date:G,status:"completed",isRecurring:!0,scheduleId:c.id,workoutType:c.workoutType||"cardio",duration:c.duration,exercises:[]})}}}const f=[...t,...u,...g].sort((a,o)=>{var W,N;const x=(W=a.date)!=null&&W.toDate?a.date.toDate():new Date(a.date);return((N=o.date)!=null&&N.toDate?o.date.toDate():new Date(o.date))-x});w(f)}catch(t){console.error("Error loading workouts:",t)}finally{B(!1)}},je=async t=>{if(k!==t.id){j(t.id);return}if(O){w(s=>s.filter(r=>r.id!==t.id)),p(null),j(null);return}try{t.isGroupWorkout?await S.delete(t.id):await se.delete(t.id),w(s=>s.filter(r=>r.id!==t.id)),p(null),j(null)}catch(s){console.error("Error deleting workout:",s),j(null)}},be=async t=>{try{await S.approveReview(t),U(s=>s.filter(r=>r.id!==t))}catch(s){console.error("Error approving:",s)}},H=q.filter(t=>{var u,h;if(!A)return!0;const s=A.toLowerCase(),r=(u=t.name)==null?void 0:u.toLowerCase().includes(s),i=(h=t.exercises)==null?void 0:h.some(g=>{var f;return(f=g.name)==null?void 0:f.toLowerCase().includes(s)});return r||i}),$=H.filter(t=>t.isGroupWorkout?t.status!=="completed":t.status==="scheduled"),J=H.filter(t=>t.isGroupWorkout?t.status==="completed":t.status!=="scheduled"),Ne=[...$].sort((t,s)=>{const r=y(t.date),i=y(s.date);return((r==null?void 0:r.getTime())||0)-((i==null?void 0:i.getTime())||0)}),ve=[...J].sort((t,s)=>{const r=y(t.date),i=y(s.date);return((i==null?void 0:i.getTime())||0)-((r==null?void 0:r.getTime())||0)}),we=t=>{try{const s=y(t);return isNaN(s.getTime())?"—":le(s)?"Today":M(s,"EEE, MMM d")}catch{return"—"}},ke=t=>{try{const s=y(t);return isNaN(s.getTime())?!1:Ke(s)&&!le(s)}catch{return!1}},Z=(t,s=null)=>{ge(t),fe(s),V(""),K(""),C(!0)},Ce=async()=>{var i;if(!d)return;const t=m==="custom_workout"?"trainer-custom-workout":"trainer-review",s=oe[t],r=(T==null?void 0:T.credits)??0;if(!D&&r<s){alert(`Not enough credits. This costs ${s} credits and you have ${r}.`);return}X(!0);try{D||(await ce.deduct(d.uid,t),z({credits:r-s})),await ze.create(d.uid,{type:m,notes:Q,targetDate:Y||null,workoutId:b||null,workoutName:b?((i=q.find(u=>u.id===b))==null?void 0:i.name)||"":null,creditCost:s}),C(!1),alert(m==="custom_workout"?"Workout request submitted! A trainer will build your workout.":"Review request submitted! A trainer will review your workout.")}catch(u){console.error("Error submitting request:",u),D||(await ce.add(d.uid,s).catch(()=>{}),z({credits:r})),alert("Failed to submit request. Please try again.")}finally{X(!1)}};if(xe)return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-10 bg-iron-800 rounded-lg w-1/3"}),e.jsx("div",{className:"h-12 bg-iron-800 rounded-lg"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-24 bg-iron-800 rounded-xl"},t))})]})});const ee=l==="todo"?Ne:ve;return e.jsxs("div",{className:"max-w-4xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-display text-iron-50",children:"Workouts"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Z("custom_workout"),className:"btn-secondary flex items-center gap-2 relative",title:"Request custom workout from a real trainer",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Trainer"}),e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded-full bg-amber-500/15 text-amber-400 font-medium leading-none",children:"Beta"})]}),e.jsxs(v,{to:"/workouts/generate",className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"AI"})]}),e.jsxs(v,{to:"/workouts/new",className:"btn-primary flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"New"]})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ue,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-iron-500"}),e.jsx("input",{type:"text",placeholder:"Search workouts or exercises...",value:A,onChange:t=>pe(t.target.value),className:"input-field pl-12"})]}),P.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-xs text-amber-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"Needs Your Review (",P.length,")"]}),e.jsx("div",{className:"space-y-2",children:P.map(t=>{let s="";try{const r=y(t.date);isNaN(r.getTime())||(s=M(r,"MMM d"))}catch{}return e.jsxs("div",{className:"card-steel p-3 border-amber-500/20 bg-amber-500/5 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-iron-100 truncate",children:t.name||"Group Workout"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[s," · Coach logged for you"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>be(t.id),className:"p-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg transition-colors",title:"Approve",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(v,{to:`/workouts/group/${t.id}`,className:"p-2 bg-iron-800 hover:bg-iron-700 text-iron-300 rounded-lg transition-colors",title:"Review details",children:e.jsx(ie,{className:"w-4 h-4"})})]})]},t.id)})})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>F("todo"),className:`flex-1 py-3 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2 ${l==="todo"?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:text-iron-200"}`,children:[e.jsx(Be,{className:"w-5 h-5"}),"To Do",$.length>0&&e.jsx("span",{className:`px-2 py-0.5 rounded-full text-sm ${l==="todo"?"bg-white/20":"bg-flame-500/20 text-flame-400"}`,children:$.length})]}),e.jsxs("button",{onClick:()=>F("completed"),className:`flex-1 py-3 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2 ${l==="completed"?"bg-green-500 text-white":"bg-iron-800 text-iron-400 hover:text-iron-200"}`,children:[e.jsx(ue,{className:"w-5 h-5"}),"Completed",e.jsx("span",{className:`px-2 py-0.5 rounded-full text-sm ${l==="completed"?"bg-white/20":"bg-iron-700"}`,children:J.length})]})]}),ee.length>0?e.jsx("div",{className:"space-y-3",children:ee.map((t,s)=>{var g,f;const r=l==="todo"&&ke(t.date),i=t.isRecurring,u=i?"div":v,h=i?{className:"flex items-center gap-4 p-4 pr-12"}:{to:t.isGroupWorkout?`/workouts/group/${t.id}`:`/workouts/${t.id}`,state:{from:"/workouts",fromLabel:"Back to Workouts"},className:"flex items-center gap-4 p-4 pr-12"};return e.jsxs(R.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.03},className:`card-steel rounded-xl group relative ${r?"border-red-500/50":""}`,children:[e.jsxs(u,{...h,children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 ${i?"bg-emerald-500/10":t.isGroupWorkout?"bg-cyan-500/10":r?"bg-red-500/10":l==="todo"?"bg-yellow-500/10":t.workoutType==="cardio"?"bg-orange-500/10":"bg-green-500/10"}`,children:i?e.jsx($e,{className:"w-7 h-7 text-emerald-400"}):t.isGroupWorkout?e.jsx(Ge,{className:"w-7 h-7 text-cyan-400"}):e.jsx(I,{className:`w-7 h-7 ${r?"text-red-400":l==="todo"?"text-yellow-400":t.workoutType==="cardio"?"text-orange-400":"text-green-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-iron-100 group-hover:text-flame-400 transition-colors",children:t.name||"Untitled Workout"}),i&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-emerald-500/20 text-emerald-400 rounded",children:"Recurring"}),t.isGroupWorkout&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-cyan-500/20 text-cyan-400 rounded",children:"Group"}),r&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-red-500/20 text-red-400 rounded",children:"Overdue"}),t.workoutType==="cardio"&&!i&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-orange-500/20 text-orange-400 rounded",children:"Cardio"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-iron-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"w-3.5 h-3.5"}),we(t.date)]}),t.duration&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),t.duration," min"]}),!i&&!t.duration&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),((g=t.exercises)==null?void 0:g.length)||0," exercises"]})]}),((f=t.exercises)==null?void 0:f.length)>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.exercises.slice(0,3).map((a,o)=>{var x,c;return e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-iron-800 text-iron-400 rounded",children:[a.name,l==="todo"&&((x=a.sets)==null?void 0:x.length)>0&&e.jsxs("span",{className:"text-iron-500 ml-1",children:["(",a.sets.length,"×",((c=a.sets[0])==null?void 0:c.prescribedReps)||"?",")"]})]},o)}),t.exercises.length>3&&e.jsxs("span",{className:"text-xs text-iron-500 px-1",children:["+",t.exercises.length-3]})]})]}),!i&&e.jsx(ie,{className:"w-5 h-5 text-iron-600 group-hover:text-iron-400 transition-colors flex-shrink-0"})]}),!i&&e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 z-10",onClick:a=>{a.preventDefault(),a.stopPropagation()},children:[e.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),p(E===t.id?null:t.id)},className:`p-2 text-iron-500
                        hover:text-iron-300 hover:bg-iron-800 rounded-lg transition-colors`,children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx(ne,{children:E===t.id&&e.jsxs(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`absolute right-0 top-full mt-1 bg-iron-800 border border-iron-700
                            rounded-lg shadow-xl z-50 py-1 min-w-[140px]`,onClick:a=>a.stopPropagation(),children:[!t.isGroupWorkout&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),p(null),me(`/workouts/${t.id}/edit`)},className:`flex items-center gap-2 px-4 py-2 text-sm text-iron-300
                                hover:bg-iron-700 transition-colors w-full`,children:[e.jsx(Ve,{className:"w-4 h-4"}),"Edit"]}),!t.isGroupWorkout&&t.status==="scheduled"&&e.jsxs("button",{onClick:a=>{a.stopPropagation(),p(null),Z("review",t.id)},className:`flex items-center gap-2 px-4 py-2 text-sm text-purple-300
                                hover:bg-iron-700 transition-colors w-full`,children:[e.jsx(L,{className:"w-4 h-4"}),"Send for Review"]}),e.jsxs("button",{onClick:a=>{a.stopPropagation(),je(t)},className:`flex items-center gap-2 px-4 py-2 text-sm w-full transition-colors ${k===t.id?"text-white bg-red-500 hover:bg-red-600":"text-red-400 hover:bg-iron-700"}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),k===t.id?"Tap to confirm":"Delete"]}),k===t.id&&e.jsx("button",{onClick:a=>{a.stopPropagation(),j(null),p(null)},className:"flex items-center gap-2 px-4 py-2 text-sm text-iron-400 hover:bg-iron-700 transition-colors w-full",children:"Cancel"})]})})]})]},t.id)})}):e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-iron-800 rounded-full flex items-center justify-center mx-auto mb-4",children:l==="todo"?e.jsx(ue,{className:"w-8 h-8 text-green-400"}):e.jsx(I,{className:"w-8 h-8 text-iron-600"})}),l==="todo"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-display text-iron-200 mb-2",children:"All Caught Up!"}),e.jsx("p",{className:"text-iron-500 mb-6",children:"No pending workouts. Create a new one or check your completed workouts."}),e.jsxs(v,{to:"/workouts/new",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Create Workout"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-display text-iron-200 mb-2",children:"No Completed Workouts"}),e.jsx("p",{className:"text-iron-500",children:"Complete your first workout to see it here."})]})]}),E&&e.jsx("div",{className:"fixed inset-0 z-[5]",onClick:()=>p(null)}),e.jsx(ne,{children:he&&e.jsxs(e.Fragment,{children:[e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>C(!1),className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50"}),e.jsxs(R.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-x-4 top-[15%] mx-auto max-w-md bg-iron-900 border border-iron-700 rounded-2xl z-50 overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100",children:m==="custom_workout"?"Request Custom Workout":"Request Workout Review"}),e.jsx("button",{onClick:()=>C(!1),className:"p-1.5 text-iron-400 hover:text-iron-200 rounded-lg",children:e.jsx(Le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("p",{className:"text-sm text-iron-400",children:m==="custom_workout"?"A real trainer will create a personalized workout based on your training data and goals.":"A trainer will review and optimize your existing workout plan."}),m==="review"&&b&&e.jsxs("div",{className:"p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg text-sm text-purple-300",children:["Reviewing: ",((te=q.find(t=>t.id===b))==null?void 0:te.name)||"Workout"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-iron-400 mb-1.5",children:"Notes for the trainer (optional)"}),e.jsx("textarea",{value:Q,onChange:t=>V(t.target.value),placeholder:m==="custom_workout"?"What are you looking for? Focus areas, time constraints, equipment available...":"Any specific concerns? Areas you want changed or improved...",rows:3,className:"input-field w-full resize-none text-sm"})]}),m==="custom_workout"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-iron-400 mb-1.5",children:"When do you need it by? (optional)"}),e.jsx("input",{type:"date",value:Y,onChange:t=>K(t.target.value),className:"input-field w-full text-sm"})]}),e.jsxs("div",{className:"p-3 bg-iron-800/50 rounded-lg flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-iron-400",children:"Cost"}),e.jsxs("span",{className:"text-sm font-medium text-flame-400",children:[oe[m==="custom_workout"?"trainer-custom-workout":"trainer-review"]," credits"]})]}),e.jsxs("button",{onClick:Ce,disabled:_,className:"btn-primary w-full py-3 text-sm flex items-center justify-center gap-2",children:[_?e.jsx(Ie,{className:"w-4 h-4 animate-spin"}):e.jsx(L,{className:"w-4 h-4"}),_?"Submitting...":"Submit Request"]})]})]})]})})]})}export{nt as default};
