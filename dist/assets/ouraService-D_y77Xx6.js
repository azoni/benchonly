import{ao as r,I as l,ap as y,N as u,O as i,aq as f}from"./index-BH1MXG3y.js";const v={async getStatus(n){const a=r(l,"users",n,"integrations","oura"),e=await f(a);if(!e.exists())return{connected:!1};const t=e.data();return{connected:t.status==="connected",status:t.status,connectedAt:t.connectedAt,lastSynced:t.lastSynced,data:t.data||null}},async connect(){const n=await u(),a=await fetch(i("oura-auth"),{method:"POST",headers:n});if(!a.ok){const t=await a.json().catch(()=>({}));throw new Error(t.error||"Failed to initiate Oura connection")}const{authUrl:e}=await a.json();return e},async sync(){const n=await u(),a=await fetch(i("oura-sync"),{method:"POST",headers:n});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||"Failed to sync Oura data")}return a.json()},async disconnect(n){const a=r(l,"users",n,"integrations","oura");await y(a)},async getLatestScores(n){const a=await this.getStatus(n);if(!a.connected||!a.data)return null;const{sleep:e,readiness:t,activity:s}=a.data,d=e!=null&&e.length?e[e.length-1]:null,h=t!=null&&t.length?t[t.length-1]:null,g=s!=null&&s.length?s[s.length-1]:null,w=e!=null&&e.length?Math.round(e.reduce((o,c)=>o+(c.score||0),0)/e.length):null,S=t!=null&&t.length?Math.round(t.reduce((o,c)=>o+(c.score||0),0)/t.length):null;return{latest:{sleep:d,readiness:h,activity:g},averages:{sleepScore:w,readinessScore:S}}}};export{v as o};
