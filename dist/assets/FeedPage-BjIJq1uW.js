import{d as fe,r as l,D as ge,a1 as je,e as Ne,H as we,I as be,a2 as w,j as e,a3 as b,L as D,U as L,a4 as A,f as $,a5 as ye,Y,k as J,s as ve,a6 as Se,X as ke,a7 as Ce,a8 as Ie,F as Fe,w as De}from"./index-DavVl6G1.js";import{S as Le}from"./search-CdPeamcd.js";import{G as Ae}from"./globe-Dt9Dj0E8.js";import{f as Z}from"./index-C4LiAiv3.js";import{C as $e}from"./clock-CHsUorid.js";import{T as Re}from"./trash-2-DxpHMsj-.js";import{T as _e}from"./trophy-uGPeuKAR.js";import"./index-JW2v18HP.js";function We(){const{user:r,isGuest:y,isAppAdmin:R,isRealAdmin:Ee,impersonating:Ue,realUser:Me}=fe(),[ee,h]=l.useState([]),[x,se]=l.useState({}),[te,v]=l.useState(!0),[_,E]=l.useState(!1),[ae,U]=l.useState(null),[re,M]=l.useState(!0),[S,ne]=l.useState(""),[u,k]=l.useState(null),[T,G]=l.useState([]),[p,P]=l.useState(""),[B,H]=l.useState(!1),[V,le]=l.useState(new Set),[oe,ie]=l.useState(new Set),[C,ce]=l.useState("all"),[I,de]=l.useState(new Set),xe=s=>{if(!r)return s.visibility==="public"||!s.visibility;if(s.userId===r.uid)return!0;switch(s.visibility||"public"){case"public":return!0;case"friends":return V.has(s.userId);case"group":return s.groupId&&oe.has(s.groupId);case"private":return!1;default:return!0}};l.useEffect(()=>{me()},[r==null?void 0:r.uid]);const me=async()=>{v(!0);try{const[s,t,a]=await Promise.all([ge(we(be,"users")),r&&!y?je.getFriendSet(r.uid):Promise.resolve(new Set),r&&!y?Ne.getByUser(r.uid):Promise.resolve([])]),o={};s.docs.forEach(i=>{o[i.id]={id:i.id,...i.data()}}),se(o),le(t),ie(new Set(a.map(i=>i.id)));const c=await w.getFeed(30);h(c.items),U(c.lastDoc),M(c.hasMore)}catch(s){console.error("Error loading feed:",s)}finally{v(!1)}},ue=async(s=!1)=>{s?E(!0):v(!0);try{const t=await w.getFeed(30,s?ae:null);h(s?a=>[...a,...t.items]:t.items),U(t.lastDoc),M(t.hasMore&&t.items.length>0)}catch(t){console.error("Error loading feed:",t)}finally{v(!1),E(!1)}},he=async s=>{k(s);const t=await w.getComments(s.id);G(t)},O=async()=>{if(!(!p.trim()||!u||y)){H(!0);try{const s=await w.addComment(u.id,r.uid,p.trim(),r.displayName||"");s&&(G(t=>[...t,{id:s.id,userId:r.uid,text:p.trim(),createdAt:{toDate:()=>new Date}}]),P(""),h(t=>t.map(a=>a.id===u.id?{...a,commentCount:(a.commentCount||0)+1}:a)))}catch(s){console.error("Error adding comment:",s)}finally{H(!1)}}},pe=async s=>{if(confirm("Delete this post from the feed?"))try{await w.deleteFeedItem(s,r.uid,R),h(t=>t.filter(a=>a.id!==s))}catch(t){console.error("Error deleting feed item:",t)}},Q=(s,t)=>{var a;if((a=t==null?void 0:t.data)!=null&&a.eventId)return e.jsx(Ie,{className:"w-5 h-5 text-pink-400 fill-pink-400"});switch(s){case"workout":return e.jsx(Y,{className:"w-5 h-5 text-green-400"});case"cardio":return e.jsx(b,{className:"w-5 h-5 text-orange-400"});case"group_workout":return e.jsx(L,{className:"w-5 h-5 text-cyan-400"});case"goal_completed":return e.jsx(_e,{className:"w-5 h-5 text-yellow-400"});case"goal_created":return e.jsx(De,{className:"w-5 h-5 text-purple-400"});case"personal_record":return e.jsx(Fe,{className:"w-5 h-5 text-flame-400"});default:return e.jsx(b,{className:"w-5 h-5 text-iron-400"})}},W=s=>{var a,o,c,i,m,n,d,f,g,j,N,K,X;const t=((a=x[s.userId])==null?void 0:a.displayName)||"Someone";switch(s.type){case"workout":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," completed ",e.jsx("span",{className:"text-flame-400",children:((o=s.data)==null?void 0:o.name)||"a workout"})]});case"cardio":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," logged ",e.jsxs("span",{className:"text-orange-400",children:[(c=s.data)==null?void 0:c.duration,"min of ",((i=s.data)==null?void 0:i.name)||"cardio"]})]});case"group_workout":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," completed their workout",(m=s.data)!=null&&m.groupName?e.jsxs(e.Fragment,{children:[" in ",e.jsx("span",{className:"text-cyan-400",children:s.data.groupName})]}):""]});case"goal_completed":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," achieved their goal: ",e.jsxs("span",{className:"text-yellow-400",children:[(n=s.data)==null?void 0:n.lift," - ",(d=s.data)==null?void 0:d.targetValue," ",(f=s.data)==null?void 0:f.unit]})]});case"goal_created":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," set a new goal: ",e.jsxs("span",{className:"text-purple-400",children:[(g=s.data)==null?void 0:g.lift," - ",(j=s.data)==null?void 0:j.targetValue," ",(N=s.data)==null?void 0:N.unit]})]});case"personal_record":return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," hit a new PR: ",e.jsxs("span",{className:"text-flame-400",children:[(K=s.data)==null?void 0:K.exercise," - ",(X=s.data)==null?void 0:X.weight,"lbs"]})]});default:return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t})," was active"]})}},F=ee.filter(xe),q=C==="all"?F:C==="friends"?F.filter(s=>V.has(s.userId)||s.userId===(r==null?void 0:r.uid)):F.filter(s=>s.userId===(r==null?void 0:r.uid)),z=S?q.filter(s=>{var c,i,m,n;const t=((i=(c=x[s.userId])==null?void 0:c.displayName)==null?void 0:i.toLowerCase())||"",a=((n=(m=s.data)==null?void 0:m.name)==null?void 0:n.toLowerCase())||"",o=S.toLowerCase();return t.includes(o)||a.includes(o)}):q;return y?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-12 text-center",children:[e.jsx(b,{className:"w-16 h-16 text-iron-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-display text-iron-200 mb-2",children:"Community Feed"}),e.jsx("p",{className:"text-iron-500 mb-6",children:"Sign in to see what others are up to and share your progress!"}),e.jsx(D,{to:"/login",className:"btn-primary",children:"Sign In"})]}):e.jsxs("div",{className:"max-w-2xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-3",children:[e.jsx(b,{className:"w-7 h-7 text-flame-500"}),"Community Feed"]}),e.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"See what the community is up to"})]}),Object.keys(x).length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-iron-800/50 rounded-full border border-iron-700/50",children:[e.jsx(L,{className:"w-4 h-4 text-flame-400"}),e.jsx("span",{className:"text-sm font-medium text-iron-300",children:Object.keys(x).length}),e.jsx("span",{className:"text-xs text-iron-500",children:"Active"})]})]}),e.jsx("div",{className:"card-steel p-4 mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500"}),e.jsx("input",{type:"text",placeholder:"Search by name or activity...",value:S,onChange:s=>ne(s.target.value),className:"input-field w-full pl-10"})]})}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:[{key:"all",label:"All",icon:Ae},{key:"friends",label:"Friends",icon:L},{key:"mine",label:"Mine",icon:A}].map(s=>e.jsxs("button",{onClick:()=>ce(s.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${C===s.key?"bg-flame-500/20 text-flame-400 border border-flame-500/30":"bg-iron-800/50 text-iron-400 border border-iron-700/50 hover:text-iron-200"}`,children:[e.jsx(s.icon,{className:"w-3.5 h-3.5"}),s.label]},s.key))}),te?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx($,{className:"w-8 h-8 text-flame-500 animate-spin mx-auto"}),e.jsx("p",{className:"text-iron-500 mt-4",children:"Loading feed..."})]}):z.length===0?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),e.jsx("p",{className:"text-iron-500",children:"No activity yet. Be the first to log a workout!"})]}):e.jsxs("div",{className:"space-y-4",children:[z.map(s=>{var o,c,i,m;const t=x[s.userId],a=`/profile/${(t==null?void 0:t.username)||s.userId}`;return e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{to:a,state:{from:"/feed",fromLabel:"Back to Feed"},className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center text-iron-400 hover:bg-iron-700 transition-colors",children:t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Q(s.type,s),e.jsx("p",{className:"text-sm text-iron-200",children:W(s)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-xs text-iron-600",children:((o=s.createdAt)==null?void 0:o.toDate)&&Z(s.createdAt.toDate(),{addSuffix:!0})}),s.visibility&&s.visibility!=="public"&&e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${s.visibility==="friends"?"bg-blue-500/10 text-blue-400":s.visibility==="group"?"bg-green-500/10 text-green-400":"bg-iron-700 text-iron-500"}`,children:s.visibility==="friends"?"Friends":s.visibility==="group"?"Group":"Private"})]})]})]}),(s.type==="workout"||s.type==="group_workout")&&(()=>{var d,f,g,j,N;const n=ye((d=s.data)==null?void 0:d.totalSets,(f=s.data)==null?void 0:f.duration);return n?e.jsxs("div",{className:"mt-2 ml-[52px] flex items-center gap-1.5 text-xs text-iron-500",children:[e.jsx($e,{className:"w-3 h-3"}),n,(g=s.data)!=null&&g.exerciseCount?` · ${s.data.exerciseCount} exercises`:"",(j=s.data)!=null&&j.totalSets?` · ${s.data.totalSets} sets`:""]}):(N=s.data)!=null&&N.exerciseCount?e.jsxs("div",{className:"mt-2 ml-[52px] flex items-center gap-1.5 text-xs text-iron-500",children:[e.jsx(Y,{className:"w-3 h-3"}),s.data.exerciseCount," exercises"]}):null})(),(s.type==="workout"||s.type==="group_workout")&&((i=(c=s.data)==null?void 0:c.exerciseSummary)==null?void 0:i.length)>0&&e.jsxs("div",{className:"mt-2 ml-[52px]",children:[e.jsxs("button",{onClick:()=>de(n=>{const d=new Set(n);return d.has(s.id)?d.delete(s.id):d.add(s.id),d}),className:"text-xs text-iron-500 hover:text-iron-300 transition-colors flex items-center gap-1",children:[I.has(s.id)?e.jsx(J,{className:"w-3 h-3"}):e.jsx(ve,{className:"w-3 h-3"}),I.has(s.id)?"Hide exercises":"Show exercises"]}),I.has(s.id)&&e.jsx("div",{className:"mt-2 space-y-1",children:s.data.exerciseSummary.map((n,d)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 px-3 bg-iron-800/40 rounded-lg",children:[e.jsx("span",{className:"text-xs text-iron-300",children:n.name}),e.jsxs("span",{className:"text-xs text-iron-500",children:[n.sets,"×",n.topWeight?`${n.topReps}@${n.topWeight}lbs`:n.topReps?`${n.topReps} reps`:""]})]},d))})]}),((m=s.data)==null?void 0:m.workoutId)&&s.userId===(r==null?void 0:r.uid)&&e.jsx(D,{to:s.type==="group_workout"?`/workouts/group/${s.data.workoutId}`:`/workouts/${s.data.workoutId}`,className:"mt-2 ml-[52px] block p-2.5 bg-iron-800/50 rounded-lg text-xs text-iron-400 hover:text-iron-200 hover:bg-iron-800 transition-colors",children:"View full workout details →"}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>he(s),className:"px-3 py-1.5 rounded-lg text-sm flex items-center gap-1.5 bg-iron-800 text-iron-400 hover:bg-iron-700 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4"}),s.commentCount>0?`${s.commentCount} comment${s.commentCount!==1?"s":""}`:"Comment"]}),R&&e.jsx("button",{onClick:()=>pe(s.id),className:"ml-auto p-1.5 rounded-lg text-iron-600 hover:text-red-400 hover:bg-red-500/10 transition-colors",title:"Delete post",children:e.jsx(Re,{className:"w-4 h-4"})})]})]},s.id)}),re&&e.jsx("button",{onClick:()=>ue(!0),disabled:_,className:"w-full py-3 text-center text-iron-400 hover:text-iron-200 transition-colors flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4"}),"Load more"]})})]}),u&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>k(null)}),e.jsxs("div",{className:"relative bg-iron-900 border border-iron-700 rounded-t-2xl sm:rounded-2xl w-full sm:max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[e.jsx("h3",{className:"font-display text-lg text-iron-100",children:"Comments"}),e.jsx("button",{onClick:()=>k(null),className:"text-iron-500 hover:text-iron-300",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 bg-iron-800/50 border-b border-iron-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-300",children:[Q(u.type,u),W(u)]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:T.length===0?e.jsx("p",{className:"text-center text-iron-500 py-8",children:"No comments yet. Be the first!"}):T.map(s=>{var t,a,o;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-800 flex items-center justify-center text-iron-400 flex-shrink-0 overflow-hidden",children:(t=x[s.userId])!=null&&t.photoURL?e.jsx("img",{src:x[s.userId].photoURL,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx(A,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-iron-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-iron-500 mb-1",children:((a=x[s.userId])==null?void 0:a.displayName)||"User"}),e.jsx("p",{className:"text-sm text-iron-200",children:s.text})]}),e.jsx("p",{className:"text-xs text-iron-600 mt-1",children:((o=s.createdAt)==null?void 0:o.toDate)&&Z(s.createdAt.toDate(),{addSuffix:!0})})]})]},s.id)})}),e.jsx("div",{className:"p-4 border-t border-iron-800",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:s=>P(s.target.value),onKeyDown:s=>s.key==="Enter"&&O(),placeholder:"Add a comment...",className:"input-field flex-1"}),e.jsx("button",{onClick:O,disabled:!p.trim()||B,className:"btn-primary px-4",children:B?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4"})})]})})]})]})]})}export{We as default};
