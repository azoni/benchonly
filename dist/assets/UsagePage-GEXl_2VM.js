import{G as R,d as U,r as o,j as e,n as y,Z as p,N as C,a4 as I,S as L,z as g,aJ as O}from"./index-zXXKWKZ_.js";import{M as k}from"./message-square-MlN3M5Jt.js";import{S as $}from"./search-Igh_rCc0.js";import{p as z}from"./index-BnERnSVH.js";import{s as B}from"./index-BKYiw15g.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=R("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),v={"generate-workout":{bg:"bg-purple-500/20",text:"text-purple-400",icon:P},"ask-assistant":{bg:"bg-blue-500/20",text:"text-blue-400",icon:k},autofill:{bg:"bg-green-500/20",text:"text-green-400",icon:L},analyze:{bg:"bg-orange-500/20",text:"text-orange-400",icon:$},"form-check":{bg:"bg-teal-500/20",text:"text-teal-400",icon:I}};function _(){const{user:Z}=U(),[w,D]=o.useState([]),[c,T]=o.useState(null),[M,S]=o.useState(!0),[m,A]=o.useState("7d"),[u,q]=o.useState("all"),[j,E]=o.useState([]);o.useEffect(()=>{async function t(){try{const a=await O(),s=B(new Date,m==="7d"?7:m==="30d"?30:90);let l=(a.records||[]).filter(n=>{var x;return((x=n.createdAt)!=null&&x.toDate?n.createdAt.toDate():new Date(n.createdAt))>=s});u!=="all"&&(l=l.filter(n=>n.userId===u));const i={totalTokens:l.reduce((n,h)=>n+(h.totalTokens||0),0),totalRequests:l.length,byFeature:{}};l.forEach(n=>{n.feature&&(i.byFeature[n.feature]||(i.byFeature[n.feature]={tokens:0,requests:0}),i.byFeature[n.feature].tokens+=n.totalTokens||0,i.byFeature[n.feature].requests+=1)}),D(l),T(i),E(a.users||[])}catch(a){console.error("Error fetching usage:",a)}finally{S(!1)}}t()},[m,u]);const d=t=>t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString(),F=t=>(t/1e3*.03).toFixed(2),f=(t=>{const a={};return t.forEach(r=>{var s;try{const l=(s=r.createdAt)!=null&&s.toDate?r.createdAt.toDate():new Date(r.createdAt);if(isNaN(l.getTime()))return;const i=g(l,"yyyy-MM-dd");a[i]||(a[i]={records:[],totalTokens:0}),a[i].records.push(r),a[i].totalTokens+=r.totalTokens||0}catch{}}),Object.entries(a).sort(([r],[s])=>new Date(s)-new Date(r))})(w);return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 pb-24",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display text-iron-100",children:"Usage"}),e.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"Track AI token consumption"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:m,onChange:t=>A(t.target.value),className:"input-field pr-10 appearance-none cursor-pointer",children:[e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"}),e.jsx("option",{value:"90d",children:"Last 90 days"})]}),e.jsx(y,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500 pointer-events-none"})]}),j.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u,onChange:t=>q(t.target.value),className:"input-field pr-10 appearance-none cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Users"}),j.map(t=>e.jsx("option",{value:t.id,children:t.displayName||t.email},t.id))]}),e.jsx(y,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-iron-500 pointer-events-none"})]})]}),c&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-iron-400 mb-2",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Total Tokens"})]}),e.jsx("p",{className:"text-2xl font-display text-iron-100",children:d(c.totalTokens)})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-iron-400 mb-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Requests"})]}),e.jsx("p",{className:"text-2xl font-display text-iron-100",children:c.totalRequests})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-iron-400 mb-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Avg/Request"})]}),e.jsx("p",{className:"text-2xl font-display text-iron-100",children:d(Math.round(c.totalTokens/c.totalRequests)||0)})]}),e.jsxs("div",{className:"card-steel p-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-iron-400 mb-2",children:e.jsx("span",{className:"text-sm",children:"Est. Cost"})}),e.jsxs("p",{className:"text-2xl font-display text-flame-400",children:["$",F(c.totalTokens)]})]})]}),(c==null?void 0:c.byFeature)&&Object.keys(c.byFeature).length>0&&e.jsxs("div",{className:"card-steel p-5 mb-8",children:[e.jsx("h3",{className:"text-sm font-medium text-iron-400 mb-4",children:"By Feature"}),e.jsx("div",{className:"space-y-3",children:Object.entries(c.byFeature).map(([t,a])=>{const r=v[t]||{bg:"bg-iron-700",text:"text-iron-400",icon:p},s=r.icon,l=Math.round(a.tokens/c.totalTokens*100);return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${r.bg} flex items-center justify-center flex-shrink-0`,children:e.jsx(s,{className:`w-5 h-5 ${r.text}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-iron-200 capitalize",children:t.replace(/-/g," ")}),e.jsxs("span",{className:"text-sm text-iron-400",children:[d(a.tokens)," tokens"]})]}),e.jsx("div",{className:"h-2 bg-iron-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${r.bg} rounded-full`,style:{width:`${l}%`}})})]}),e.jsxs("span",{className:"text-sm text-iron-500 w-12 text-right",children:[l,"%"]})]},t)})})]}),M?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})}):f.length>0?e.jsx("div",{className:"space-y-6",children:f.map(([t,{records:a,totalTokens:r}])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-iron-400",children:g(z(t),"EEEE, MMMM d")}),e.jsxs("span",{className:"text-sm text-iron-500",children:[d(r)," tokens"]})]}),e.jsx("div",{className:"space-y-2",children:a.map((s,l)=>{var x;const i=v[s.feature]||{bg:"bg-iron-700",text:"text-iron-400",icon:p},n=i.icon,h=s.requestCount>1;return e.jsxs("div",{className:"card-steel p-4 flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${i.bg} flex items-center justify-center flex-shrink-0`,children:e.jsx(n,{className:`w-5 h-5 ${i.text}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm text-iron-200 capitalize",children:[((x=s.feature)==null?void 0:x.replace(/-/g," "))||"AI Request",h&&e.jsxs("span",{className:"ml-2 text-xs text-iron-500",children:["(",s.requestCount," requests)"]})]}),e.jsxs("p",{className:"text-xs text-iron-500",children:[(()=>{var N;try{const b=(N=s.createdAt)!=null&&N.toDate?s.createdAt.toDate():new Date(s.createdAt);return isNaN(b.getTime())?"":g(b,"h:mm a")}catch{return""}})(),s.userName&&` Â· ${s.userName}`]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:d(s.totalTokens)}),e.jsx("p",{className:"text-xs text-iron-500",children:"tokens"})]})]},s.id||l)})})]},t))}):e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-iron-800 flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"w-8 h-8 text-iron-500"})}),e.jsx("h3",{className:"text-lg font-display text-iron-300 mb-2",children:"No usage data"}),e.jsx("p",{className:"text-iron-500 text-sm max-w-sm mx-auto",children:"AI usage will appear here once you start using features like workout generation and the assistant"})]})]})}export{_ as default};
