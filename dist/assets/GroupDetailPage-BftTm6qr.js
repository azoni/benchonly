import{r as i,d as Fs,z as Je,V as us,W as hs,Y as ps,$ as ls,a0 as gs,a2 as fs,j as e,o as Ds,m as Ee,S as We,X as Ae,B as is,i as He,C as ce,J as ze,I as Xe,Z as As,t as Is,N as Bs,M as Us,as as _e,at as qe,U as Ye,l as Hs,n as vs,w as zs,x as _s,aA as qs,aB as Vs,a as Js,b as Xs,c as Ys,u as Zs,aq as Ws,am as $s,al as Rs,L as Ve,A as Ks,aj as Qs,aC as et,P as os,F as Ts,D as st,ai as tt,aD as Ps,g as Me,f as De,aE as at,Q as rt,ag as nt,y as Os,aF as lt}from"./index-OFuFeI6c.js";import{T as it}from"./timer-xHOXjdBS.js";import{M as Gs}from"./message-square-BpmM0Gg8.js";import{e as ot}from"./index-B5kiQ_HH.js";import{M as ct}from"./more-vertical-Cldy9R1I.js";import{T as bs}from"./trash-2-B5s2_dp9.js";import{C as js}from"./copy-Br6F_JQL.js";import{P as dt}from"./pen-BK8yZLeF.js";import{C as xt}from"./crown-BJQjOqPF.js";import{F as mt}from"./file-text-CE0d_IyD.js";import{S as Ls}from"./search-BEmM8Tc3.js";const Ns=[{text:"Loading athlete profiles and training histories...",icon:"users"},{text:"Scanning recent workout data for volume and intensity trends...",icon:"brain"},{text:"Evaluating pain history and flagging injury risks...",icon:"alert"},{text:"Calculating estimated 1-rep maxes from recent sets...",icon:"calc"},{text:"Reviewing RPE averages to calibrate load recommendations...",icon:"brain"},{text:"Checking recovery status based on recent training frequency...",icon:"brain"},{text:"Selecting primary compound movements for the session...",icon:"dumbbell"},{text:"Adding accessory exercises to target weak points...",icon:"dumbbell"},{text:"Personalizing working weights per athlete based on e1RM...",icon:"users"},{text:"Applying progressive overload — adjusting from last session...",icon:"calc"},{text:"Building set/rep schemes for target intensity zone...",icon:"dumbbell"},{text:"Checking for exercise substitutions where pain was flagged...",icon:"alert"},{text:"Writing coaching notes and form cues for each exercise...",icon:"msg"},{text:"Generating individualized notes for each athlete...",icon:"users"},{text:"Validating workout structure and total volume...",icon:"calc"}];function ut({isOpen:$,onClose:de,group:Q,athletes:f,coachId:Ze,isAdmin:Y=!1,onSuccess:y}){var as,rs;const[Ne,H]=i.useState(""),{user:cs,userProfile:ee,updateProfile:xe,isAppAdmin:ws}=Fs(),[Ke,me]=i.useState(Je(new Date,"yyyy-MM-dd")),[M,$e]=i.useState([]),[q,Re]=i.useState({}),[ye,ve]=i.useState(!1),[_,Z]=i.useState(!1),[O,ue]=i.useState(null),[he,G]=i.useState(null),[se,Te]=i.useState("standard"),[z,we]=i.useState("strength"),[V,ke]=i.useState("auto"),[Pe,Le]=i.useState("moderate"),[ie,ds]=i.useState("auto"),[Ce,Qe]=i.useState("auto"),[Fe,Oe]=i.useState(""),[te,L]=i.useState(!1),[pe,ge]=i.useState(!1),[Ge,ae]=i.useState([]),[Ie,J]=i.useState(null),[T,m]=i.useState([]),re=i.useRef(null),ne=i.useRef(null),B=i.useRef(null);i.useEffect(()=>{$&&(f==null?void 0:f.length)>0&&($e(f.map(t=>t.uid)),Se(f))},[$,f]),i.useEffect(()=>{re.current&&(re.current.scrollTop=re.current.scrollHeight)},[T]),i.useEffect(()=>()=>{ne.current&&clearInterval(ne.current),B.current&&(B.current(),B.current=null)},[]);const K=(t,o,j=null)=>{ae(h=>{const v=h.findIndex(D=>D.label===t);if(v>=0){const D=[...h];return D[v]={label:t,status:o,detail:j},D}return[...h,{label:t,status:o,detail:j}]})},es=()=>{m([]);let t=0;m([{...Ns[0],id:0}]),t=1,ne.current=setInterval(()=>{t<Ns.length?(m(o=>[...o,{...Ns[t],id:t}]),t++):m(o=>[...o,{text:"Finalizing workout details...",icon:"brain",id:o.length}])},2200)},W=()=>{ne.current&&(clearInterval(ne.current),ne.current=null)},Se=async t=>{ve(!0),ae([]);const o={};for(const j of t){const h=j.displayName||"Unknown";K(`Analyzing ${h}`,"loading");try{const v=await Be(j.uid);o[j.uid]={...v,name:h};const D=Object.keys(v.maxLifts||{}).length,R=Object.keys(v.painHistory||{}).length;let k=`${D} lifts`;R>0&&(k+=`, ${R} pain flags`),K(`Analyzing ${h}`,R>0?"warning":"complete",k)}catch(v){console.error(`Error for ${j.uid}:`,v),o[j.uid]={id:j.uid,name:h,maxLifts:{},painHistory:{},rpeAverages:{},goals:[],recentWorkouts:[]},K(`Analyzing ${h}`,"complete","No data")}}Re(o),ve(!1)},Be=async t=>{let o=[];try{(await us(hs(ps(ls,"workouts"),gs("userId","==",t),fs(30)))).docs.forEach(E=>{var x,g,N,P;const w=E.data();w.status==="completed"&&o.push({...w,date:((P=(N=(g=(x=w.date)==null?void 0:x.toDate)==null?void 0:g.call(x))==null?void 0:N.toISOString)==null?void 0:P.call(N).split("T")[0])||w.date})})}catch(C){console.error(C)}try{(await us(hs(ps(ls,"groupWorkouts"),gs("assignedTo","==",t),fs(30)))).docs.forEach(E=>{var x,g,N,P;const w=E.data();w.status==="completed"&&o.push({...w,date:((P=(N=(g=(x=w.date)==null?void 0:x.toDate)==null?void 0:g.call(x))==null?void 0:N.toISOString)==null?void 0:P.call(N).split("T")[0])||w.date})})}catch(C){console.error(C)}o.sort((C,E)=>new Date(E.date||0)-new Date(C.date||0));const j={},h={},v={},D=new Date;o.forEach(C=>{const E=C.date?new Date(C.date):null,w=E&&!isNaN(E.getTime())?Math.floor((D-E)/(1e3*60*60*24)):null;(C.exercises||[]).forEach(x=>{x.name&&(x.sets||[]).forEach(g=>{if(!g.actualWeight&&!g.actualReps&&g.prescribedWeight)return;const N=parseFloat(g.actualWeight)||parseFloat(g.prescribedWeight)||0,P=parseInt(g.actualReps)||parseInt(g.prescribedReps)||0,I=parseInt(g.rpe)||0,U=parseInt(g.painLevel)||0;if(N>0&&P>0&&P<=12){const oe=Math.round(N*(1+P/30));(!j[x.name]||oe>j[x.name].e1rm)&&(j[x.name]={weight:N,reps:P,e1rm:oe})}U>0&&(h[x.name]||(h[x.name]={count:0,maxPain:0,lastDaysAgo:null,recentCount:0}),h[x.name].count++,h[x.name].maxPain=Math.max(h[x.name].maxPain,U),w!==null&&((h[x.name].lastDaysAgo===null||w<h[x.name].lastDaysAgo)&&(h[x.name].lastDaysAgo=w),w<=30&&h[x.name].recentCount++)),I>0&&(v[x.name]||(v[x.name]={total:0,count:0}),v[x.name].total+=I,v[x.name].count++)})})});const R={};Object.entries(v).forEach(([C,E])=>{R[C]=Math.round(E.total/E.count*10)/10});let k=[];try{k=(await us(hs(ps(ls,"goals"),gs("userId","==",t),fs(10)))).docs.map(E=>E.data()).filter(E=>E.status==="active")}catch(C){console.error(C)}const A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],F=o.slice(0,5).map(C=>{const E=new Date(C.date);return{...C,dayOfWeek:A[E.getDay()],exercises:(C.exercises||[]).map(w=>({name:w.name,type:w.type||"weight",notes:w.notes,sets:(w.sets||[]).map(x=>({prescribedWeight:x.prescribedWeight,prescribedReps:x.prescribedReps,actualWeight:x.actualWeight,actualReps:x.actualReps,rpe:x.rpe,painLevel:x.painLevel,completed:x.completed}))}))}});return{id:t,maxLifts:j,painHistory:h,rpeAverages:R,goals:k,recentWorkouts:F}},fe=async()=>{var h,v;if(M.length===0){G("Select at least one athlete");return}const o=se==="premium"?qe:_e["generate-group-workout"]*M.length,j=(ee==null?void 0:ee.credits)??0;if(!Y&&j<o){G(se==="premium"?`Not enough credits. Premium costs ${qe} credits, you have ${j}.`:`Not enough credits. Need ${o} (${_e["generate-group-workout"]} x ${M.length} athletes) but you have ${j}.`);return}Z(!0),G(null),K("Generating workouts","loading"),es(),B.current&&(B.current(),B.current=null);try{Y||xe({credits:j-o});const D=M.map(g=>{var N,P,I,U,oe,Ue;return{id:g,name:((N=q[g])==null?void 0:N.name)||"Unknown",maxLifts:((P=q[g])==null?void 0:P.maxLifts)||{},painHistory:((I=q[g])==null?void 0:I.painHistory)||{},rpeAverages:((U=q[g])==null?void 0:U.rpeAverages)||{},goals:((oe=q[g])==null?void 0:oe.goals)||[],recentWorkouts:((Ue=q[g])==null?void 0:Ue.recentWorkouts)||[]}}),R=`ggw_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,k=await zs(),A=await fetch(_s("generate-group-workout"),{method:"POST",headers:k,body:JSON.stringify({groupId:Q.id,athletes:D,prompt:Ne,workoutDate:Ke,model:se,workoutCategory:z,workoutFocus:V,intensity:Pe,duration:ie!=="auto"?parseInt(ie):null,exerciseCount:Ce!=="auto"?parseInt(Ce):null,maxExercise:V==="1rm-test"?Fe:null,includeWarmup:te,includeStretches:pe,jobId:R})});if(!A.ok){const g=await A.json().catch(()=>({}));throw new Error(g.error||"Failed to generate")}const F=await A.json();if(F.success&&!F.background){ue(F),W(),m(g=>{var N;return[...g,{text:`Done! Created ${(N=F.createdWorkouts)==null?void 0:N.length} personalized workouts.`,icon:"check",id:g.length}]}),K("Generating workouts","complete",`${(h=F.createdWorkouts)==null?void 0:h.length} workouts created in ${(v=F.usage)==null?void 0:v.responseMs}ms`),Z(!1);return}const C=F.jobId||R,E=qs(ls,"groupWorkoutJobs",C);let w=!1;const x=Vs(E,g=>{var P;if(w)return;const N=g.data();if(N){if(N.status==="complete"&&N.result)w=!0,x(),B.current=null,ue(N.result),W(),m(I=>{var U;return[...I,{text:`Done! Created ${(U=N.result.createdWorkouts)==null?void 0:U.length} personalized workouts.`,icon:"check",id:I.length}]}),K("Generating workouts","complete",`${(P=N.result.createdWorkouts)==null?void 0:P.length} workouts created`),Z(!1);else if(N.status==="error"){w=!0,x(),B.current=null;const I=N.error||"Generation failed";G(I),Y||xe({credits:j}),W(),m(U=>[...U,{text:`Error: ${I}`,icon:"error",id:U.length}]),K("Generating workouts","error",I),Z(!1)}}},g=>{w||(w=!0,console.error("Firestore listener error:",g),x(),B.current=null,G("Lost connection. Please try again."),Y||xe({credits:j}),W(),Z(!1))});B.current=x,setTimeout(()=>{w||(w=!0,x(),B.current=null,G("Generation is taking too long. Please try again with fewer athletes or simpler settings."),Y||xe({credits:j}),W(),Z(!1))},12e4)}catch(D){console.error("Error:",D),G(D.message),Y||xe({credits:j}),W(),m(R=>[...R,{text:`Error: ${D.message}`,icon:"error",id:R.length}]),K("Generating workouts","error",D.message),Z(!1)}},xs=()=>{y==null||y(),be()},ss=t=>{$e(o=>o.includes(t)?o.filter(j=>j!==t):[...o,t])},le=()=>{$e(M.length===(f==null?void 0:f.length)?[]:(f==null?void 0:f.map(t=>t.uid))||[])},be=()=>{H(""),Te("standard"),we("strength"),L(!0),ge(!1),ue(null),G(null),ae([]),m([]),W(),de()},ts=t=>{switch(t){case"brain":return e.jsx(is,{className:"w-3 h-3 text-flame-400"});case"alert":return e.jsx(ze,{className:"w-3 h-3 text-amber-400"});case"calc":return e.jsx(We,{className:"w-3 h-3 text-purple-400"});case"dumbbell":return e.jsx(Xe,{className:"w-3 h-3 text-cyan-400"});case"users":return e.jsx(Ye,{className:"w-3 h-3 text-green-400"});case"msg":return e.jsx(Gs,{className:"w-3 h-3 text-blue-400"});case"check":return e.jsx(ce,{className:"w-3 h-3 text-green-400"});case"error":return e.jsx(ze,{className:"w-3 h-3 text-red-400"});default:return e.jsx(He,{className:"w-3 h-3 text-flame-400 animate-spin"})}};return $?e.jsx(Ds,{children:e.jsx(Ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:be,children:e.jsxs(Ee.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-iron-900 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-flame-500/10 flex items-center justify-center",children:e.jsx(We,{className:"w-5 h-5 text-flame-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-iron-100",children:"AI Generate Workout"}),e.jsx("p",{className:"text-sm text-iron-500",children:Q==null?void 0:Q.name})]})]}),e.jsx("button",{onClick:be,className:"p-2 text-iron-400 hover:text-iron-200 rounded-xl",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-4 p-4",children:[e.jsx("div",{className:"lg:col-span-1 mb-4 lg:mb-0",children:e.jsxs("div",{className:"bg-iron-800/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(is,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-300",children:"Analysis"})]}),e.jsx("div",{className:"space-y-2",children:Ge.map((t,o)=>e.jsxs(Ee.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5",children:t.status==="loading"?e.jsx(He,{className:"w-3 h-3 text-flame-400 animate-spin"}):t.status==="complete"?e.jsx(ce,{className:"w-3 h-3 text-green-400"}):t.status==="warning"?e.jsx(ze,{className:"w-3 h-3 text-amber-400"}):e.jsx(ze,{className:"w-3 h-3 text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-iron-300",children:t.label}),t.detail&&e.jsx("p",{className:"text-xs text-iron-500 truncate",children:t.detail})]})]},t.label))}),(_||T.length>0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_&&e.jsx(He,{className:"w-3 h-3 text-flame-400 animate-spin"}),e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wider",children:_?"AI Thinking...":"AI Process"})]}),e.jsxs("div",{ref:re,className:"max-h-40 overflow-y-auto space-y-1.5 scrollbar-thin",children:[T.map(t=>e.jsxs(Ee.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:ts(t.icon)}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t.text})]},t.id)),_&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),!ye&&Object.keys(q).length>0&&!_&&T.length===0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-700",children:[e.jsx("p",{className:"text-xs text-iron-500 mb-2",children:"Group Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[e.jsxs("div",{className:"bg-iron-800/50 rounded-lg py-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:M.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Athletes"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg py-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.values(q).filter(t=>Object.keys(t.painHistory||{}).length>0).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"With Pain"})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-iron-800/30 rounded-xl border border-flame-500/20 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-iron-700/50 bg-flame-500/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-flame-500/20 flex items-center justify-center",children:e.jsx(is,{className:"w-4 h-4 text-flame-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI is generating workouts..."}),e.jsxs("p",{className:"text-xs text-iron-500",children:[M.length," athlete",M.length!==1?"s":""," · ",Ne||"Custom workout"]})]}),e.jsx(He,{className:"w-5 h-5 text-flame-400 animate-spin ml-auto"})]}),e.jsxs("div",{ref:re,className:"p-4 max-h-[300px] overflow-y-auto space-y-2.5 scrollbar-thin",children:[T.map(t=>e.jsxs(Ee.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},className:"flex items-start gap-3 py-1",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0 w-5 h-5 rounded bg-iron-800 flex items-center justify-center",children:ts(t.icon)}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:t.text})]},t.id)),e.jsxs("div",{className:"flex items-center gap-1.5 pt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),he&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:he})})]}):O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsxs("p",{className:"text-green-400 font-medium flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),(as=O.createdWorkouts)==null?void 0:as.length," workouts created"]}),O.usage&&e.jsxs("p",{className:"text-xs text-iron-500 mt-1",children:[O.usage.tokens," tokens · ",O.usage.responseMs,"ms · ",O.usage.cost]})]}),O.coachingNotes&&e.jsxs("div",{className:"bg-iron-800/50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-iron-700/50",children:[e.jsx(is,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI Coaching Notes"})]}),e.jsx("div",{className:"p-3 max-h-32 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:O.coachingNotes})})]}),e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-iron-100 mb-2",children:O.workoutName}),e.jsx("div",{className:"space-y-1",children:(rs=O.baseExercises)==null?void 0:rs.map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-400",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:t.name}),e.jsxs("span",{className:"text-iron-600",children:[t.defaultSets,"×",t.defaultReps]}),t.type&&t.type!=="weight"&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${t.type==="time"?"bg-blue-500/20 text-blue-400":t.type==="bodyweight"?"bg-emerald-500/20 text-emerald-400":""}`,children:t.type==="time"?"Time":"BW"})]},o))})]}),e.jsx("div",{className:"space-y-3 max-h-[250px] overflow-y-auto",children:Object.entries(O.athleteWorkouts||{}).map(([t,o])=>{var j;return e.jsxs("div",{className:"p-3 bg-iron-800/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-iron-200",children:o.athleteName}),o.personalNotes&&e.jsx("p",{className:"text-xs text-iron-500 mt-1 leading-relaxed",children:o.personalNotes}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(j=o.exercises)==null?void 0:j.slice(0,4).map((h,v)=>{var D,R,k,A,F,C,E;return e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${h.substitution?"bg-amber-500/20 text-amber-400":"bg-iron-700 text-iron-400"}`,children:[((D=h.substitution)==null?void 0:D.replacement)||h.name,": ",h.type==="time"?`${((k=(R=h.sets)==null?void 0:R[0])==null?void 0:k.prescribedTime)||"?"}s`:h.type==="bodyweight"?`${((F=(A=h.sets)==null?void 0:A[0])==null?void 0:F.prescribedReps)||"?"} reps`:`${((E=(C=h.sets)==null?void 0:C[0])==null?void 0:E.prescribedWeight)||"?"}lb`]},v)})})]},t)})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Workout description (optional)"}),e.jsx("textarea",{value:Ne,onChange:t=>H(t.target.value),placeholder:"e.g., 'Heavy bench day' or 'Focus on weak points'",className:"input-field w-full min-h-[60px] resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Workout Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5",children:[{value:"strength",label:"Strength",desc:"Weight training",icon:Xe,color:"flame"},{value:"hiit",label:"HIIT",desc:"Timed intervals",icon:it,color:"red"},{value:"wod",label:"WOD",desc:"AMRAP / EMOM",icon:As,color:"yellow"},{value:"mobility",label:"Mobility",desc:"Flexibility",icon:Is,color:"green"},{value:"calisthenics",label:"Calisthenics",desc:"Bodyweight",icon:Bs,color:"cyan"},{value:"dynamic",label:"Dynamic",desc:"Explosive",icon:Us,color:"purple"}].map(t=>{const o=t.icon,j=z===t.value,v={flame:{border:"border-flame-500",bg:"bg-flame-500/10",text:"text-flame-400"},red:{border:"border-red-500",bg:"bg-red-500/10",text:"text-red-400"},yellow:{border:"border-yellow-500",bg:"bg-yellow-500/10",text:"text-yellow-400"},green:{border:"border-green-500",bg:"bg-green-500/10",text:"text-green-400"},cyan:{border:"border-cyan-500",bg:"bg-cyan-500/10",text:"text-cyan-400"},purple:{border:"border-purple-500",bg:"bg-purple-500/10",text:"text-purple-400"}}[t.color];return e.jsxs("button",{onClick:()=>{we(t.value),t.value!=="strength"&&V==="1rm-test"&&(ke("auto"),Oe("")),t.value==="wod"&&(ke("auto"),L(!1),ge(!1)),t.value==="mobility"&&(Le("light"),L(!1),ge(!1))},className:`flex items-center gap-2 p-2 rounded-lg border transition-all text-left
                                ${j?`${v.border} ${v.bg} ${v.text}`:"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsx(o,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-medium",children:t.label}),e.jsx("div",{className:"text-[9px] text-iron-500 leading-tight",children:t.desc})]})]},t.value)})})]}),z!=="wod"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Style"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"push",label:"Push"},{value:"pull",label:"Pull"},{value:"legs",label:"Legs"},{value:"upper",label:"Upper"},{value:"full",label:"Full Body"},{value:"bench",label:"Bench Focus"},{value:"no-equipment",label:"Bodyweight"},...z==="strength"?[{value:"1rm-test",label:"Test 1RM"}]:[]].map(t=>e.jsxs("button",{onClick:()=>{ke(t.value),t.value!=="1rm-test"&&Oe("")},className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                              ${V===t.value?t.value==="1rm-test"?"border-yellow-500 bg-yellow-500/10 text-yellow-400":"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[t.label,t.value==="1rm-test"&&e.jsx("span",{className:"ml-1 text-[9px] px-1 py-0.5 rounded-full bg-green-500/20 text-green-400 font-medium leading-none",children:"New"})]},t.value))})]}),V==="1rm-test"&&e.jsxs("div",{className:"p-3 bg-yellow-500/5 border border-yellow-500/20 rounded-xl",children:[e.jsx("label",{className:"block text-sm text-yellow-400 mb-2",children:"Which lift?"}),e.jsx("input",{type:"text",value:Fe,onChange:t=>Oe(t.target.value),placeholder:"e.g. Bench Press, Squat, Deadlift...",className:"input-field w-full"}),e.jsx("p",{className:"text-xs text-iron-600 mt-1.5",children:"AI generates warm-up ramps and max attempt protocol per athlete."})]}),V!=="1rm-test"&&z!=="wod"&&z!=="mobility"&&z!=="hiit"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Intensity"}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:[{value:"light",label:"Light",desc:"RPE 5-6"},{value:"moderate",label:"Moderate",desc:"RPE 7-8"},{value:"heavy",label:"Heavy",desc:"RPE 8-9"},{value:"max",label:"Max",desc:"RPE 9-10"}].map(t=>e.jsxs("button",{onClick:()=>Le(t.value),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                                ${Pe===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsx("div",{className:"font-medium",children:t.label}),e.jsx("div",{className:"text-[10px] text-iron-500",children:t.desc})]},t.value))})]}),V!=="1rm-test"&&z!=="wod"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Duration"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:[{value:"auto",label:"Auto"},{value:"20",label:"20m"},{value:"30",label:"30m"},{value:"45",label:"45m"},{value:"60",label:"60m"},{value:"90",label:"90m"}].map(t=>e.jsx("button",{onClick:()=>ds(t.value),className:`px-2 py-0.5 text-[11px] rounded-md border transition-colors
                                  ${ie===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:[{value:"auto",label:"Auto"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"8",label:"8"}].map(t=>e.jsx("button",{onClick:()=>Qe(t.value),className:`px-2 py-0.5 text-[11px] rounded-md border transition-colors
                                  ${Ce===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:Ke,onChange:t=>me(t.target.value),className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs("button",{onClick:()=>Te("standard"),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                              ${se==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(As,{className:"w-3 h-3"}),"Standard"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[_e["generate-group-workout"],"/athlete"]})]}),e.jsxs("button",{onClick:()=>Te("premium"),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                              ${se==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(We,{className:"w-3 h-3"}),"Premium"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[qe," cr"]})]})]})]})]}),V!=="1rm-test"&&z!=="wod"&&z!=="mobility"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>L(!te),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${te?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Warm-up"}),e.jsx("button",{onClick:()=>ge(!pe),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${pe?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Stretches"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm text-iron-400 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Athletes (",M.length,"/",(f==null?void 0:f.length)||0,")"]}),e.jsx("button",{onClick:le,className:"text-xs text-flame-400 hover:text-flame-300",children:M.length===(f==null?void 0:f.length)?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:f==null?void 0:f.map(t=>{var D,R;const o=q[t.uid],j=Object.keys((o==null?void 0:o.painHistory)||{}).length>0,h=Object.keys((o==null?void 0:o.maxLifts)||{}).length,v=Ie===t.uid;return e.jsxs("div",{className:"border border-iron-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>ss(t.uid),className:`w-full flex items-center gap-3 p-3 transition-colors
                                  ${M.includes(t.uid)?"bg-flame-500/10":"bg-iron-800/50 hover:bg-iron-800"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center
                                  ${M.includes(t.uid)?"border-flame-500 bg-flame-500":"border-iron-600"}`,children:M.includes(t.uid)&&e.jsx(ce,{className:"w-3 h-3 text-white"})}),t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-iron-700 flex items-center justify-center text-xs text-iron-400",children:(D=t.displayName)==null?void 0:D[0]}),e.jsx("span",{className:"text-iron-200 flex-1 text-left",children:t.displayName}),e.jsxs("span",{className:"text-xs text-iron-500",children:[h," lifts"]}),j&&e.jsx(ze,{className:"w-4 h-4 text-amber-400"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),J(v?null:t.uid)},className:"p-1 hover:bg-iron-700 rounded",children:v?e.jsx(Hs,{className:"w-4 h-4 text-iron-400"}):e.jsx(vs,{className:"w-4 h-4 text-iron-400"})})]}),e.jsx(Ds,{children:v&&o&&e.jsx(Ee.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-iron-700 bg-iron-800/30",children:e.jsxs("div",{className:"p-3 text-xs space-y-2",children:[Object.keys(o.maxLifts||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-500 mb-1",children:"Top Lifts"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(o.maxLifts).sort((k,A)=>A[1].e1rm-k[1].e1rm).slice(0,4).map(([k,A])=>e.jsxs("span",{className:"bg-iron-700 px-2 py-0.5 rounded text-iron-300",children:[k,": ",A.e1rm,"lb"]},k))})]}),Object.keys(o.painHistory||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 mb-1",children:"Pain History"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(o.painHistory).map(([k,A])=>e.jsxs("span",{className:"bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded",children:[k,": ",A.maxPain,"/10"]},k))})]}),((R=o.goals)==null?void 0:R.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-500 mb-1",children:"Goals"}),o.goals.slice(0,2).map((k,A)=>e.jsxs("p",{className:"text-iron-400",children:[k.lift,": ",k.currentWeight||"?"," → ",k.targetWeight||k.targetValue]},A))]})]})})})]},t.uid)})})]}),he&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:he})})]})})]})}),e.jsx("div",{className:"p-4 border-t border-iron-800 flex gap-3",children:O?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{ue(null),m([])},className:"btn-secondary flex-1",children:"Generate Another"}),e.jsxs("button",{onClick:xs,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Done"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:be,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:fe,disabled:_||ye||M.length===0||!Y&&((ee==null?void 0:ee.credits)??0)<(se==="premium"?qe:_e["generate-group-workout"]*M.length),className:"btn-primary flex-1 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-5 h-5"}),"Generate for ",M.length," ",e.jsxs("span",{className:"text-xs opacity-70",children:["(",se==="premium"?qe:_e["generate-group-workout"]*M.length," cr)"]})]})})]})})]})})}):null}const ys=($,de="MMM d, yyyy")=>{if(!$)return"";try{const Q=Os($);return isNaN(Q.getTime())?"":Je(Q,de)}catch{return""}},ht=["Bench Press","Incline Bench Press","Close Grip Bench","Dumbbell Press","Overhead Press","Squat","Deadlift","Barbell Row","Pull-ups","Tricep Extension","Bicep Curl","Lateral Raise"],pt=["Dead Hang","Plank","Wall Sit","L-Sit","Farmers Carry","Static Hold"],gt=["Pull-ups","Push-ups","Dips","Chin-ups","Muscle-ups","Bodyweight Squats"];function Mt(){var I,U,oe,Ue,ks,Cs;const{id:$}=Js(),de=Xs(),Q=Ys();Zs("Group");const{user:f,userProfile:Ze,isAppAdmin:Y}=Fs(),[y,Ne]=i.useState(null),[H,cs]=i.useState([]),[ee,xe]=i.useState({}),[ws,Ke]=i.useState({}),[me,M]=i.useState([]),[$e,q]=i.useState(!0),Re=(Ze==null?void 0:Ze.customExercises)||{},ye=[...ht,...Re.weight||[]],ve=[...gt,...Re.bodyweight||[]],_=[...pt,...Re.time||[]],[Z,O]=i.useState(!1),[ue,he]=i.useState(!1),[G,se]=i.useState(((I=Q.state)==null?void 0:I.activeTab)||"members"),[Te,z]=i.useState(!1),[we,V]=i.useState("code"),[ke,Pe]=i.useState(""),[Le,ie]=i.useState([]),[ds,Ce]=i.useState(!1),[Qe,Fe]=i.useState(null),[Oe,te]=i.useState(!1),[L,pe]=i.useState([]),[ge,Ge]=i.useState(Ws()),[ae,Ie]=i.useState(""),[J,T]=i.useState({}),[m,re]=i.useState(null),[ne,B]=i.useState(!1),[K,es]=i.useState(null),[W,Se]=i.useState(null),[Be,fe]=i.useState(""),[xs,ss]=i.useState(!1),le=(U=y==null?void 0:y.admins)==null?void 0:U.includes(f==null?void 0:f.uid);i.useEffect(()=>{async function s(){if(!(!$||!f))try{const n=await De.getById($);if(Ne(n),n!=null&&n.members){const a=await De.getMemberDetails(n.members),r=Rs(new Date,{weekStartsOn:1}),l=$s(new Date,{weekStartsOn:1}),u={},p={};for(const c of n.members){try{const d=await at.getByDateRange(c,r,l);u[c]=d}catch{u[c]=[]}try{if(c===f.uid||Y){const d=await rt.getByUser(c);p[c]=d.filter(b=>b.status==="active")}else p[c]=[]}catch{p[c]=[]}}cs(a),Ke(u),xe(p);try{const c=await Me.getByGroup($,f.uid);M(c)}catch(c){console.error("Error loading group workouts:",c),M([])}}}catch(n){console.error("Error fetching group:",n)}finally{q(!1)}}s()},[$,f]);const be=async()=>{y!=null&&y.inviteCode&&(await navigator.clipboard.writeText(y.inviteCode),he(!0),setTimeout(()=>he(!1),2e3))},ts=async s=>{if(Pe(s),s.length<2){ie([]);return}Ce(!0);try{const a=(await nt.search(s)).filter(r=>{var l;return!((l=y==null?void 0:y.members)!=null&&l.includes(r.uid))});ie(a)}catch(n){console.error("Error searching users:",n)}finally{Ce(!1)}},as=async s=>{Fe(s);try{await De.addMember($,s);const n=await De.getMemberDetails([...y.members,s]);cs(n),Ne(a=>({...a,members:[...a.members,s]})),ie(a=>a.filter(r=>r.uid!==s))}catch(n){console.error("Error inviting user:",n),alert("Failed to invite user")}finally{Fe(null)}},rs=async()=>{if(confirm("Are you sure you want to leave this group?"))try{await De.removeMember($,f.uid),de("/groups")}catch(s){console.error("Error leaving group:",s)}},t=async()=>{if(confirm("Are you sure you want to delete this group? This cannot be undone."))try{await De.delete($),de("/groups")}catch(s){console.error("Error deleting group:",s)}},o=()=>{const s=(y==null?void 0:y.members)||[];pe(s),Ge(Ws()),Ie(""),fe("");const n={};s.forEach(a=>{n[a]={personalNotes:"",exercises:[{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}),T(n),re(s[0]||null),Se(null),te(!0)},j=s=>{const n=s.assignments.map(b=>b.memberId);pe(n);const a=Os(s.date),r=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");Ge(`${r}-${l}-${u}`),Ie(s.name);const p={},c={},d=me.find(b=>{var S;return b.id===((S=s.assignments[0])==null?void 0:S.id)});fe((d==null?void 0:d.coachingNotes)||""),s.assignments.forEach(b=>{var X;const S=me.find(je=>je.id===b.id);c[b.memberId]=b.id,(X=S==null?void 0:S.exercises)!=null&&X.length?p[b.memberId]={personalNotes:S.personalNotes||"",exercises:S.exercises.map(je=>{var Ss,Es,Ms;const ms=je.type||((Es=(Ss=je.sets)==null?void 0:Ss[0])!=null&&Es.prescribedTime?"time":"weight");return{id:Date.now()+Math.random(),name:je.name,type:ms,notes:je.notes||"",sets:((Ms=je.sets)==null?void 0:Ms.map(ns=>ms==="time"?{time:ns.prescribedTime||""}:ms==="bodyweight"?{reps:ns.prescribedReps||""}:{weight:ns.prescribedWeight||"",reps:ns.prescribedReps||""}))||[{weight:"",reps:""}]}})}:p[b.memberId]={personalNotes:(S==null?void 0:S.personalNotes)||"",exercises:[{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}),T(p),re(n[0]||null),Se(c),te(!0)},h=async s=>{const n=s.length;if(confirm(`Delete this workout for ${n} member${n>1?"s":""}? This cannot be undone.`))try{await Promise.all(s.map(a=>Me.delete(a.id))),M(a=>a.filter(r=>!s.some(l=>l.id===r.id))),es(null)}catch(a){console.error("Error deleting workouts:",a),alert("Failed to delete workouts")}},v=s=>{T(n=>{var a;return{...n,[s]:{...n[s],exercises:[...((a=n[s])==null?void 0:a.exercises)||[],{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}})},D=(s,n)=>{T(a=>({...a,[s]:{...a[s],exercises:a[s].exercises.filter(r=>r.id!==n)}}))},R=(s,n,a,r)=>{T(l=>{const u={...l},p=u[s].exercises.map(c=>{if(c.id!==n)return c;const d={...c,[a]:r};if(a==="name"){const b=_.includes(r),S=ve.includes(r)&&!ye.includes(r);b&&c.type!=="time"?(d.type="time",d.sets=c.sets.map(X=>({time:X.time||""}))):S&&c.type!=="bodyweight"?(d.type="bodyweight",d.sets=c.sets.map(X=>({reps:X.reps||""}))):!b&&!S&&c.type!=="weight"&&(d.type="weight",d.sets=c.sets.map(X=>({weight:X.weight||"",reps:X.reps||""})))}return d});return u[s]={...u[s],exercises:p},u})},k=(s,n)=>{T(a=>({...a,[s]:{...a[s],exercises:a[s].exercises.map(r=>{if(r.id!==n)return r;const l=r.sets[r.sets.length-1];let u;return r.type==="time"?u={time:(l==null?void 0:l.time)||""}:r.type==="bodyweight"?u={reps:(l==null?void 0:l.reps)||""}:u={weight:(l==null?void 0:l.weight)||"",reps:(l==null?void 0:l.reps)||""},{...r,sets:[...r.sets,u]}})}}))},A=(s,n,a,r,l)=>{T(u=>({...u,[s]:{...u[s],exercises:u[s].exercises.map(p=>p.id===n?{...p,sets:p.sets.map((c,d)=>d===a?{...c,[r]:l}:c)}:p)}}))},F=(s,n,a)=>{T(r=>({...r,[s]:{...r[s],exercises:r[s].exercises.map(l=>l.id===n?{...l,sets:l.sets.filter((u,p)=>p!==a)}:l)}}))},C=s=>{T(n=>({...n,[s]:{...n[s],exercises:n[s].exercises.map(a=>{const r=a.sets[a.sets.length-1];let l;return a.type==="time"?l={time:(r==null?void 0:r.time)||""}:a.type==="bodyweight"?l={reps:(r==null?void 0:r.reps)||""}:l={weight:(r==null?void 0:r.weight)||"",reps:(r==null?void 0:r.reps)||""},{...a,sets:[...a.sets,l]}})}}))},E=s=>{const a=(J[s]||{}).exercises||[],r=JSON.parse(JSON.stringify(a));T(l=>{const u={...l};return L.forEach(p=>{p!==s&&(u[p]={...u[p],exercises:r.map(c=>({...c,id:Date.now()+Math.random(),sets:c.sets.map(d=>({...d}))}))})}),u})},w=s=>{pe(n=>{const a=n.includes(s)?n.filter(r=>r!==s):[...n,s];return n.includes(s)||T(r=>({...r,[s]:{personalNotes:"",exercises:[{id:Date.now(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}})),a})},x=async()=>{if(!ae.trim()||L.length===0){alert("Please enter a workout name and select at least one member");return}B(!0);try{const[s,n,a]=ge.split("-").map(Number),r=new Date(s,n-1,a,12,0,0),l=p=>((p==null?void 0:p.exercises)||[]).filter(c=>c.name.trim()).map(c=>({name:c.name,type:c.type||"weight",notes:c.notes||"",sets:c.sets.map((d,b)=>{const S={id:Date.now()+b,rpe:"",painLevel:0};return c.type==="time"?{...S,prescribedTime:d.time||"",actualTime:""}:c.type==="bodyweight"?{...S,prescribedReps:d.reps||"",actualReps:""}:{...S,prescribedWeight:d.weight||"",prescribedReps:d.reps||"",actualWeight:"",actualReps:""}})}));if(W)for(const p of L){const c=W[p];if(!c)continue;const d=J[p],b=l(d);await Me.update(c,{name:ae,date:r,exercises:b,coachingNotes:Be||"",personalNotes:(d==null?void 0:d.personalNotes)||""})}else{const p=L.map(c=>{const d=J[c],b=l(d);return{assignedTo:c,name:ae,exercises:b}});await Me.createBatch($,y.admins,r,p,y.members)}const u=await Me.getByGroup($,f.uid);M(u),te(!1),Se(null),fe(""),alert(W?"Workout updated!":`Workout assigned to ${L.length} member${L.length!==1?"s":""}!`)}catch(s){console.error("Error saving group workout:",s),alert("Failed to save workout")}finally{B(!1)}},g=ot({start:Rs(new Date,{weekStartsOn:1}),end:$s(new Date,{weekStartsOn:1})}),N=s=>{const n=ws[s]||[];return g.map(a=>{const r=n.find(l=>{var u;try{const p=(u=l.date)!=null&&u.toDate?l.date.toDate():new Date(l.date);return lt(p,a)}catch{return!1}});return(r==null?void 0:r.status)||null})},P=s=>{switch(s){case"present":return"bg-green-500";case"missed":return"bg-red-500";case"vacation":return"bg-blue-500";default:return"bg-iron-700"}};return $e?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})}):y?e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>de("/groups"),className:"flex items-center gap-2 text-iron-400 hover:text-iron-200 transition-colors",children:[e.jsx(Ks,{className:"w-5 h-5"}),e.jsx("span",{children:"Groups"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>O(!Z),className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-lg transition-colors",children:e.jsx(ct,{className:"w-5 h-5"})}),Z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>O(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-iron-800 border border-iron-700 rounded-lg shadow-xl z-20 overflow-hidden",children:[le&&e.jsxs(Ve,{to:`/groups/${$}/settings`,className:"flex items-center gap-3 px-4 py-3 text-iron-300 hover:bg-iron-700 transition-colors",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Group Settings"]}),e.jsxs("button",{onClick:rs,className:"w-full flex items-center gap-3 px-4 py-3 text-iron-300 hover:bg-iron-700 transition-colors",children:[e.jsx(et,{className:"w-4 h-4"}),"Leave Group"]}),le&&e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 text-red-400 hover:bg-red-500/10 transition-colors",children:[e.jsx(bs,{className:"w-4 h-4"}),"Delete Group"]})]})]})]})]}),e.jsxs("div",{className:"card-steel p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-flame-500/20 to-flame-600/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ye,{className:"w-8 h-8 text-flame-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-display text-iron-100 mb-1",children:y.name}),e.jsxs("p",{className:"text-iron-500 text-sm",children:[H.length," member",H.length!==1?"s":""," · Created ",ys(y.createdAt)]})]})]}),le&&y.inviteCode&&e.jsx("div",{className:"mt-6 p-4 bg-iron-800/50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-400 mb-1",children:"Invite Code"}),e.jsx("p",{className:"text-xl font-mono font-bold text-iron-200 tracking-wider",children:y.inviteCode})]}),e.jsx("button",{onClick:be,className:"btn-secondary flex items-center gap-2",children:ue?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 text-green-400"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-4 h-4"}),"Copy"]})})]})})]}),e.jsx("div",{className:"flex gap-2 mb-6 border-b border-iron-800 overflow-x-auto",children:["members","workouts","goals","attendance"].map(s=>e.jsxs("button",{onClick:()=>se(s),className:`px-4 py-3 text-sm font-medium whitespace-nowrap transition-colors relative ${G===s?"text-flame-400":"text-iron-500 hover:text-iron-300"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),G===s&&e.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-flame-500"})]},s))}),G==="workouts"&&e.jsxs("div",{className:"space-y-4",children:[le&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>ss(!0),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"AI Generate"]}),e.jsxs("button",{onClick:o,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"}),"Manual"]})]}),me.length===0?e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(Xe,{className:"w-12 h-12 text-iron-600 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-400",children:"No group workouts yet"}),le&&e.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"Create a workout to assign it to group members"})]}):e.jsx("div",{className:"space-y-3",children:(()=>{const s={};return me.forEach(n=>{const a=ys(n.date,"yyyy-MM-dd"),r=`${n.name}-${a}`;s[r]||(s[r]={name:n.name,date:n.date,exercises:n.exercises,assignments:[]}),s[r].assignments.push({id:n.id,memberId:n.assignedTo,status:n.status})}),Object.entries(s).map(([n,a])=>{var p,c;const r=K===n,l=a.assignments.filter(d=>d.status==="completed").length,u=a.assignments.length;return e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsxs("button",{onClick:()=>es(r?null:n),className:"w-full p-4 flex items-center gap-4 text-left hover:bg-iron-800/30 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-flame-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Xe,{className:"w-5 h-5 text-flame-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-iron-100",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500",children:[e.jsx("span",{children:ys(a.date,"EEE, MMM d")}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[((p=a.exercises)==null?void 0:p.length)||0," exercises"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{className:l===u?"text-green-400":"",children:[l,"/",u," done"]})]})]}),r?e.jsx(vs,{className:"w-5 h-5 text-iron-500"}):e.jsx(Ts,{className:"w-5 h-5 text-iron-500"})]}),r&&e.jsxs("div",{className:"border-t border-iron-800",children:[(()=>{const d=me.find(b=>{var S;return b.id===((S=a.assignments[0])==null?void 0:S.id)});return d!=null&&d.coachingNotes?e.jsxs("div",{className:"p-4 bg-flame-500/5 border-b border-iron-800",children:[e.jsxs("p",{className:"text-xs text-flame-400 flex items-center gap-1.5 mb-1.5",children:[e.jsx(We,{className:"w-3 h-3"}),"AI Coaching Notes"]}),e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:d.coachingNotes})]}):null})(),e.jsxs("div",{className:"p-4 bg-iron-800/20 border-b border-iron-800",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-2",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(c=a.exercises)==null?void 0:c.map((d,b)=>{var S;return e.jsxs("span",{className:"px-2 py-1 bg-iron-800 rounded text-sm text-iron-300",children:[d.name," (",((S=d.sets)==null?void 0:S.length)||0,"×)"]},b)})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-3",children:"Assigned Members"}),e.jsx("div",{className:"space-y-2",children:a.assignments.map(d=>{var S;const b=H.find(X=>X.uid===d.memberId);return e.jsxs(Ve,{to:`/workouts/group/${d.id}`,state:{from:`/groups/${$}`,fromLabel:"Back to Group"},className:"flex items-center gap-3 p-3 rounded-lg bg-iron-800/30 hover:bg-iron-800/50 transition-colors",children:[b!=null&&b.photoURL?e.jsx("img",{src:b.photoURL,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-iron-400",children:((S=b==null?void 0:b.displayName)==null?void 0:S[0])||"?"})}),e.jsx("span",{className:"flex-1 text-iron-200",children:(b==null?void 0:b.displayName)||"Unknown"}),d.status==="completed"?e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs font-medium",children:"Done"}):e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded text-xs font-medium",children:"Pending"}),e.jsx(Ts,{className:"w-4 h-4 text-iron-600"})]},d.id)})})]}),a.assignments.length>1&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(Ve,{to:`/groups/${$}/batch/${encodeURIComponent(n)}`,className:"btn-secondary w-full flex items-center justify-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"View All Members"]})}),le&&e.jsxs("div",{className:"p-4 border-t border-iron-800 flex gap-2",children:[e.jsxs("button",{onClick:()=>j(a),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4"}),"Edit Workout"]}),e.jsxs("button",{onClick:d=>{d.stopPropagation(),h(a.assignments)},className:"px-4 py-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4"}),"Delete"]})]})]})]},n)})})()})]}),G==="members"&&e.jsxs("div",{className:"space-y-3",children:[H.map(s=>{var n,a;return e.jsxs(Ve,{to:`/profile/${s.username||s.uid}`,state:{from:`/groups/${$}`,fromLabel:"Back to Group"},className:"card-steel p-4 flex items-center gap-4 hover:border-iron-600 transition-colors",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:s.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:((n=s.displayName)==null?void 0:n[0])||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-iron-100 truncate",children:s.displayName||"Unknown"}),((a=y.admins)==null?void 0:a.includes(s.uid))&&e.jsx(xt,{className:"w-4 h-4 text-yellow-500 flex-shrink-0"}),s.uid===f.uid&&e.jsx("span",{className:"text-xs text-iron-500",children:"(you)"})]}),s.username&&e.jsxs("p",{className:"text-xs text-iron-500",children:["@",s.username]})]}),e.jsx("div",{className:"hidden sm:flex gap-1",children:N(s.uid).map((r,l)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${P(r)}`,title:Je(g[l],"EEE")},l))})]},s.uid)}),le&&e.jsxs("button",{onClick:()=>z(!0),className:"w-full card-steel p-4 flex items-center justify-center gap-2 text-iron-400 hover:text-iron-200 hover:border-iron-600 transition-colors",children:[e.jsx(st,{className:"w-5 h-5"}),"Invite Members"]})]}),G==="attendance"&&e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-iron-700",children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-iron-400",children:"Member"}),g.map(s=>e.jsxs("th",{className:`px-3 py-3 text-center text-sm font-medium ${tt(s)?"text-flame-400":"text-iron-400"}`,children:[Je(s,"EEE"),e.jsx("div",{className:"text-xs text-iron-600 font-normal",children:Je(s,"d")})]},s.toISOString()))]})}),e.jsx("tbody",{children:H.map(s=>{var n,a;return e.jsxs("tr",{className:"border-b border-iron-800 last:border-0",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-iron-400",children:(n=s.displayName)==null?void 0:n[0]})}),e.jsx("span",{className:"text-sm text-iron-200 truncate max-w-[100px]",children:(a=s.displayName)==null?void 0:a.split(" ")[0]})]})}),N(s.uid).map((r,l)=>e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("div",{className:`w-6 h-6 rounded-full mx-auto ${P(r)}`,title:r||"No data"})},l))]},s.uid)})})]})}),e.jsxs("div",{className:"px-4 py-3 bg-iron-800/50 flex gap-4 text-xs text-iron-500",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"})," Present"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"})," Missed"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"})," Vacation"]})]})]}),G==="goals"&&e.jsx("div",{className:"space-y-4",children:H.map(s=>{var n,a;return e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800 flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-iron-400",children:(n=s.displayName)==null?void 0:n[0]})}),e.jsx("div",{children:e.jsxs("h3",{className:"font-medium text-iron-100",children:[s.displayName,s.uid===f.uid&&e.jsx("span",{className:"text-xs text-iron-500 ml-2",children:"(you)"})]})})]}),e.jsx("div",{className:"p-4",children:((a=ee[s.uid])==null?void 0:a.length)>0?e.jsx("div",{className:"space-y-3",children:ee[s.uid].map(r=>{const l=r.currentValue??r.currentWeight??0,u=r.targetValue??r.targetWeight??0,p=u>0?Math.min(100,l/u*100):0,c=r.metricType==="time"?"sec":r.metricType==="reps"?"reps":"lbs";return e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-iron-200",children:r.lift}),e.jsxs("span",{className:"text-sm text-iron-400",children:[l," / ",u," ",c]})]}),e.jsx("div",{className:"h-2 bg-iron-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-flame-500 rounded-full transition-all",style:{width:`${p}%`}})})]},r.id)})}):e.jsx("p",{className:"text-iron-500 text-sm text-center py-2",children:"No active goals"})})]},s.uid)})}),Oe&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-iron-900 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-iron-900 border-b border-iron-800 p-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-display text-iron-100",children:W?"Edit Group Workout":"Assign Group Workout"}),e.jsx("button",{onClick:()=>{te(!1),Se(null),fe("")},className:"p-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-2",children:"Workout Name *"}),e.jsx("input",{type:"text",value:ae,onChange:s=>Ie(s.target.value),placeholder:"e.g., Push Day, Bench Focus",className:"input-field w-full text-base py-3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:ge,onChange:s=>Ge(s.target.value),className:"input-field w-full text-base py-3"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-3",children:W?"Assigned Members":"Assign to Members"}),W&&Be&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>{const s=document.getElementById("coaching-notes-section");s&&s.classList.toggle("hidden")},className:"flex items-center gap-2 text-sm text-flame-400 hover:text-flame-300 mb-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"AI Coaching Notes",e.jsx(vs,{className:"w-3 h-3"})]}),e.jsx("div",{id:"coaching-notes-section",children:e.jsx("textarea",{value:Be,onChange:s=>fe(s.target.value),rows:3,className:"input-field w-full text-sm resize-none",placeholder:"Coaching notes..."})})]}),W&&e.jsx("p",{className:"text-xs text-iron-500 mb-2",children:"Members cannot be changed when editing. Create a new workout to assign to different members."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(s=>{var r,l;const n=L.includes(s.uid),a=W&&!n;return e.jsxs("button",{onClick:()=>!W&&w(s.uid),disabled:W,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${n?"bg-flame-500/20 border border-flame-500/50 text-flame-200":a?"bg-iron-800/30 border border-iron-800 text-iron-600 cursor-not-allowed":"bg-iron-800/50 border border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-5 h-5 rounded-full"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-iron-700 flex items-center justify-center text-xs",children:(r=s.displayName)==null?void 0:r[0]}),e.jsx("span",{className:"text-sm",children:(l=s.displayName)==null?void 0:l.split(" ")[0]}),n&&e.jsx(ce,{className:"w-4 h-4"})]},s.uid)})})]}),L.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300",children:"Prescriptions by Member"}),m&&L.length>1&&e.jsxs("button",{onClick:()=>E(m),className:"text-xs text-flame-400 hover:text-flame-300 flex items-center gap-1",children:[e.jsx(js,{className:"w-3 h-3"}),"Copy to all members"]})]}),e.jsx("div",{className:"flex gap-1 mb-4 overflow-x-auto pb-2",children:L.map(s=>{var a,r;const n=H.find(l=>l.uid===s);return e.jsxs("button",{onClick:()=>re(s),className:`flex items-center gap-2 px-3 py-2 rounded-lg whitespace-nowrap transition-colors ${m===s?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:[n!=null&&n.photoURL?e.jsx("img",{src:n.photoURL,alt:"",className:"w-5 h-5 rounded-full"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-iron-600 flex items-center justify-center text-xs",children:(a=n==null?void 0:n.displayName)==null?void 0:a[0]}),e.jsx("span",{className:"text-sm",children:(r=n==null?void 0:n.displayName)==null?void 0:r.split(" ")[0]})]},s)})}),m&&J[m]&&e.jsxs("div",{className:"space-y-4",children:[(W||((oe=J[m])==null?void 0:oe.personalNotes))&&e.jsxs("div",{className:"bg-iron-800/30 rounded-lg p-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-iron-500 mb-2",children:[e.jsx(Gs,{className:"w-3 h-3"}),"Personal Notes for ",((ks=(Ue=H.find(s=>s.uid===m))==null?void 0:Ue.displayName)==null?void 0:ks.split(" ")[0])||"Member"]}),e.jsx("textarea",{value:((Cs=J[m])==null?void 0:Cs.personalNotes)||"",onChange:s=>T(n=>({...n,[m]:{...n[m],personalNotes:s.target.value}})),rows:2,className:"input-field w-full text-sm resize-none",placeholder:"Notes specific to this athlete..."})]}),J[m].exercises.length>1&&e.jsxs("button",{onClick:()=>C(m),className:"w-full py-2 text-xs text-flame-400 hover:text-flame-300 bg-flame-500/5 hover:bg-flame-500/10 border border-flame-500/20 rounded-lg flex items-center justify-center gap-1.5 transition-colors",children:[e.jsx(os,{className:"w-3 h-3"}),"Add 1 Set to Each Exercise"]}),J[m].exercises.map((s,n)=>e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-7 h-7 rounded-lg bg-flame-500/20 text-flame-400 flex items-center justify-center text-sm font-medium",children:n+1}),e.jsxs("select",{value:s.name,onChange:a=>R(m,s.id,"name",a.target.value),className:"input-field flex-1 text-base py-2",children:[e.jsx("option",{value:"",children:"Select exercise"}),s.name&&![...ye,...ve,..._].includes(s.name)&&e.jsxs("option",{value:s.name,children:[s.name," (custom)"]}),e.jsx("optgroup",{label:"Weight Exercises",children:ye.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("optgroup",{label:"Bodyweight",children:ve.map(a=>e.jsx("option",{value:a,children:a},`bw-${a}`))}),e.jsx("optgroup",{label:"Time-Based",children:_.map(a=>e.jsx("option",{value:a,children:a},`t-${a}`))})]}),J[m].exercises.length>1&&e.jsx("button",{onClick:()=>D(m,s.id),className:"p-2 text-iron-500 hover:text-red-400 transition-colors",children:e.jsx(bs,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center gap-1.5 mb-3 ml-9",children:["weight","bodyweight","time"].map(a=>e.jsx("button",{onClick:()=>{const r=s.sets.map(l=>a==="time"?{time:l.time||""}:a==="bodyweight"?{reps:l.reps||""}:{weight:l.weight||"",reps:l.reps||""});T(l=>({...l,[m]:{...l[m],exercises:l[m].exercises.map(u=>u.id===s.id?{...u,type:a,sets:r}:u)}}))},className:`text-xs px-2 py-0.5 rounded transition-colors ${s.type===a?a==="time"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":a==="bodyweight"?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-iron-600/30 text-iron-300 border border-iron-500/30":"text-iron-600 hover:text-iron-400"}`,children:a==="weight"?"Weight":a==="bodyweight"?"BW":"Time"},a))}),e.jsxs("div",{className:"space-y-2",children:[s.type==="time"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-8",children:"Time (seconds)"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((a,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:r+1})}),e.jsx("div",{className:"col-span-8",children:e.jsx("input",{type:"number",inputMode:"numeric",value:a.time||"",onChange:l=>A(m,s.id,r,"time",l.target.value),placeholder:"60",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>F(m,s.id,r),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ae,{className:"w-4 h-4"})})})]},r))]}):s.type==="bodyweight"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-8",children:"Reps"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((a,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:r+1})}),e.jsx("div",{className:"col-span-8",children:e.jsx("input",{type:"text",inputMode:"numeric",value:a.reps||"",onChange:l=>A(m,s.id,r,"reps",l.target.value),onBlur:l=>A(m,s.id,r,"reps",Ps(l.target.value)),placeholder:"e.g. 10 or 8-12",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>F(m,s.id,r),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ae,{className:"w-4 h-4"})})})]},r))]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-4",children:"Weight"}),e.jsx("div",{className:"col-span-4",children:"Reps"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((a,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:r+1})}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",value:a.weight||"",onChange:l=>A(m,s.id,r,"weight",l.target.value),placeholder:"lbs",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",inputMode:"numeric",value:a.reps||"",onChange:l=>A(m,s.id,r,"reps",l.target.value),onBlur:l=>A(m,s.id,r,"reps",Ps(l.target.value)),placeholder:"e.g. 8 or 6-8",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>F(m,s.id,r),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ae,{className:"w-4 h-4"})})})]},r))]}),e.jsxs("button",{onClick:()=>k(m,s.id),className:"w-full py-2 text-xs text-iron-500 hover:text-iron-300 flex items-center justify-center gap-1",children:[e.jsx(os,{className:"w-3 h-3"}),"Add Set"]})]}),(s.notes||W)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-iron-700/50",children:e.jsx("input",{type:"text",value:s.notes||"",onChange:a=>R(m,s.id,"notes",a.target.value),placeholder:"Form cues, modifications, warnings...",className:"input-field w-full text-xs py-1.5 px-2 bg-iron-800/30 placeholder:text-iron-600"})})]},s.id)),e.jsxs("button",{onClick:()=>v(m),className:"w-full py-3 border border-dashed border-iron-700 rounded-lg text-iron-400 hover:text-iron-200 hover:border-iron-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx(os,{className:"w-4 h-4"}),"Add Exercise"]})]})]})]}),e.jsxs("div",{className:"bg-iron-900 border-t border-iron-800 p-4 flex gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>te(!1),className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:x,disabled:ne||!ae.trim()||L.length===0,className:"btn-primary flex-1 disabled:opacity-50",children:ne?W?"Saving...":"Creating...":W?"Save Changes":`Assign to ${L.length} Member${L.length!==1?"s":""}`})]})]})}),Te&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-iron-900 rounded-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-display text-iron-100",children:"Invite Members"}),e.jsx("button",{onClick:()=>{z(!1),Pe(""),ie([])},className:"p-2 text-iron-400 hover:text-iron-200",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-iron-800",children:[e.jsx("button",{onClick:()=>V("code"),className:`flex-1 py-3 text-sm font-medium transition-colors ${we==="code"?"text-flame-400 border-b-2 border-flame-400":"text-iron-400 hover:text-iron-200"}`,children:"Share Code"}),e.jsx("button",{onClick:()=>V("search"),className:`flex-1 py-3 text-sm font-medium transition-colors ${we==="search"?"text-flame-400 border-b-2 border-flame-400":"text-iron-400 hover:text-iron-200"}`,children:"Search Users"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:we==="code"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-iron-400 text-sm",children:"Share this code with people you want to invite to the group."}),e.jsxs("div",{className:"bg-iron-800/50 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-3xl font-mono font-bold text-iron-100 tracking-widest mb-4",children:(y==null?void 0:y.inviteCode)||"No code"}),e.jsx("button",{onClick:be,className:"btn-secondary flex items-center gap-2 mx-auto",children:ue?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-4 h-4"}),"Copy Code"]})})]}),e.jsx("p",{className:"text-iron-500 text-xs text-center",children:"Members can join using this code in Groups → Join Group"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-iron-500"}),e.jsx("input",{type:"text",value:ke,onChange:s=>ts(s.target.value),placeholder:"Search by name or email...",className:"input-field w-full pl-10 py-3",autoFocus:!0})]}),ds?e.jsx("div",{className:"py-8 text-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-flame-500 border-t-transparent rounded-full animate-spin mx-auto"})}):Le.length>0?e.jsx("div",{className:"space-y-2",children:Le.map(s=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-iron-400 font-medium",children:((n=s.displayName)==null?void 0:n[0])||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-100 font-medium",children:s.displayName}),e.jsx("p",{className:"text-iron-500 text-sm",children:s.email})]})]}),e.jsx("button",{onClick:()=>as(s.uid),disabled:Qe===s.uid,className:"btn-primary text-sm py-2 px-4 disabled:opacity-50",children:Qe===s.uid?"Adding...":"Add"})]},s.uid)})}):ke.length>=2?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(Ye,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-iron-500",children:"No users found"})]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(Ls,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-iron-500",children:"Type to search for users"})]})]})})]})}),e.jsx(ut,{isOpen:xs,onClose:()=>ss(!1),group:y,athletes:H,coachId:f.uid,isAdmin:Y,onSuccess:()=>{Me.getByGroup($,f.uid).then(M).catch(s=>console.error("[GroupDetail] Refresh failed:",s))}})]}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8 text-center",children:[e.jsx("h2",{className:"text-xl font-display text-iron-200 mb-4",children:"Group Not Found"}),e.jsx(Ve,{to:"/groups",className:"btn-primary",children:"Back to Groups"})]})}export{Mt as default};
