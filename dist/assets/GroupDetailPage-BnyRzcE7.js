import{r as i,d as Ps,z as Ve,V as xs,W as ms,Y as us,$ as as,a0 as hs,a2 as ps,j as e,o as Ms,m as ke,S as De,X as Ee,B as rs,i as Ue,C as ie,J as Be,Z as Os,ar as He,as as ze,U as qe,l as Gs,n as Ns,I as ls,w as Is,x as Us,aE as Bs,aF as Hs,a as zs,b as _s,c as Vs,u as qs,am as As,al as Ws,L as _e,A as Js,aj as Xs,aG as Ys,P as ns,F as $s,D as Zs,ai as Ks,aD as Rs,g as Ce,f as Se,aH as Qs,Q as et,ag as st,y as Ls,aI as tt}from"./index-BpGUo1il.js";import{M as Fs}from"./message-square-D4FEmnq0.js";import{e as at}from"./index-4jo7v_Zl.js";import{M as rt}from"./more-vertical-B4s-QNMZ.js";import{T as gs}from"./trash-2-m-vdhbNC.js";import{C as fs}from"./copy-BVmi4XB4.js";import{P as nt}from"./pen-BKC7ELFM.js";import{C as lt}from"./crown-B-DmWV7K.js";import{F as it}from"./file-text-C5yx5EKC.js";import{S as Ts}from"./search-C0Dy9C3z.js";const js=[{text:"Loading athlete profiles and training histories...",icon:"users"},{text:"Scanning recent workout data for volume and intensity trends...",icon:"brain"},{text:"Evaluating pain history and flagging injury risks...",icon:"alert"},{text:"Calculating estimated 1-rep maxes from recent sets...",icon:"calc"},{text:"Reviewing RPE averages to calibrate load recommendations...",icon:"brain"},{text:"Checking recovery status based on recent training frequency...",icon:"brain"},{text:"Selecting primary compound movements for the session...",icon:"dumbbell"},{text:"Adding accessory exercises to target weak points...",icon:"dumbbell"},{text:"Personalizing working weights per athlete based on e1RM...",icon:"users"},{text:"Applying progressive overload — adjusting from last session...",icon:"calc"},{text:"Building set/rep schemes for target intensity zone...",icon:"dumbbell"},{text:"Checking for exercise substitutions where pain was flagged...",icon:"alert"},{text:"Writing coaching notes and form cues for each exercise...",icon:"msg"},{text:"Generating individualized notes for each athlete...",icon:"users"},{text:"Validating workout structure and total volume...",icon:"calc"}];function ot({isOpen:A,onClose:oe,group:Q,athletes:g,coachId:Je,isAdmin:X=!1,onSuccess:y}){var Ge,ss;const[fe,z]=i.useState(""),{user:is,userProfile:ee,updateProfile:ce,isAppAdmin:ys}=Ps(),[Xe,de]=i.useState(Ve(new Date,"yyyy-MM-dd")),[D,Me]=i.useState([]),[V,Ae]=i.useState({}),[je,be]=i.useState(!1),[_,Y]=i.useState(!1),[O,xe]=i.useState(null),[me,G]=i.useState(null),[se,We]=i.useState("standard"),[Z,$e]=i.useState("auto"),[Re,Ye]=i.useState("moderate"),[Ne,Ze]=i.useState("auto"),[ne,os]=i.useState("auto"),[Te,Pe]=i.useState(""),[ye,Ke]=i.useState(!1),[te,L]=i.useState(!1),[Le,ve]=i.useState([]),[Fe,ue]=i.useState(null),[ae,W]=i.useState([]),T=i.useRef(null),u=i.useRef(null),I=i.useRef(null);i.useEffect(()=>{A&&(g==null?void 0:g.length)>0&&(Me(g.map(r=>r.uid)),es(g))},[A,g]),i.useEffect(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[ae]),i.useEffect(()=>()=>{u.current&&clearInterval(u.current),I.current&&(I.current(),I.current=null)},[]);const q=(r,d,b=null)=>{ve(p=>{const E=p.findIndex(M=>M.label===r);if(E>=0){const M=[...p];return M[E]={label:r,status:d,detail:b},M}return[...p,{label:r,status:d,detail:b}]})},Qe=()=>{W([]);let r=0;W([{...js[0],id:0}]),r=1,u.current=setInterval(()=>{r<js.length?(W(d=>[...d,{...js[r],id:r}]),r++):W(d=>[...d,{text:"Finalizing workout details...",icon:"brain",id:d.length}])},2200)},re=()=>{u.current&&(clearInterval(u.current),u.current=null)},es=async r=>{be(!0),ve([]);const d={};for(const b of r){const p=b.displayName||"Unknown";q(`Analyzing ${p}`,"loading");try{const E=await F(b.uid);d[b.uid]={...E,name:p};const M=Object.keys(E.maxLifts||{}).length,$=Object.keys(E.painHistory||{}).length;let k=`${M} lifts`;$>0&&(k+=`, ${$} pain flags`),q(`Analyzing ${p}`,$>0?"warning":"complete",k)}catch(E){console.error(`Error for ${b.uid}:`,E),d[b.uid]={id:b.uid,name:p,maxLifts:{},painHistory:{},rpeAverages:{},goals:[],recentWorkouts:[]},q(`Analyzing ${p}`,"complete","No data")}}Ae(d),be(!1)},F=async r=>{let d=[];try{(await xs(ms(us(as,"workouts"),hs("userId","==",r),ps(30)))).docs.forEach(C=>{var x,j,v,R;const w=C.data();w.status==="completed"&&d.push({...w,date:((R=(v=(j=(x=w.date)==null?void 0:x.toDate)==null?void 0:j.call(x))==null?void 0:v.toISOString)==null?void 0:R.call(v).split("T")[0])||w.date})})}catch(N){console.error(N)}try{(await xs(ms(us(as,"groupWorkouts"),hs("assignedTo","==",r),ps(30)))).docs.forEach(C=>{var x,j,v,R;const w=C.data();w.status==="completed"&&d.push({...w,date:((R=(v=(j=(x=w.date)==null?void 0:x.toDate)==null?void 0:j.call(x))==null?void 0:v.toISOString)==null?void 0:R.call(v).split("T")[0])||w.date})})}catch(N){console.error(N)}d.sort((N,C)=>new Date(C.date||0)-new Date(N.date||0));const b={},p={},E={},M=new Date;d.forEach(N=>{const C=N.date?new Date(N.date):null,w=C&&!isNaN(C.getTime())?Math.floor((M-C)/(1e3*60*60*24)):null;(N.exercises||[]).forEach(x=>{x.name&&(x.sets||[]).forEach(j=>{if(!j.actualWeight&&!j.actualReps&&j.prescribedWeight)return;const v=parseFloat(j.actualWeight)||parseFloat(j.prescribedWeight)||0,R=parseInt(j.actualReps)||parseInt(j.prescribedReps)||0,U=parseInt(j.rpe)||0,H=parseInt(j.painLevel)||0;if(v>0&&R>0&&R<=12){const le=Math.round(v*(1+R/30));(!b[x.name]||le>b[x.name].e1rm)&&(b[x.name]={weight:v,reps:R,e1rm:le})}H>0&&(p[x.name]||(p[x.name]={count:0,maxPain:0,lastDaysAgo:null,recentCount:0}),p[x.name].count++,p[x.name].maxPain=Math.max(p[x.name].maxPain,H),w!==null&&((p[x.name].lastDaysAgo===null||w<p[x.name].lastDaysAgo)&&(p[x.name].lastDaysAgo=w),w<=30&&p[x.name].recentCount++)),U>0&&(E[x.name]||(E[x.name]={total:0,count:0}),E[x.name].total+=U,E[x.name].count++)})})});const $={};Object.entries(E).forEach(([N,C])=>{$[N]=Math.round(C.total/C.count*10)/10});let k=[];try{k=(await xs(ms(us(as,"goals"),hs("userId","==",r),ps(10)))).docs.map(C=>C.data()).filter(C=>C.status==="active")}catch(N){console.error(N)}const P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=d.slice(0,5).map(N=>{const C=new Date(N.date);return{...N,dayOfWeek:P[C.getDay()],exercises:(N.exercises||[]).map(w=>({name:w.name,type:w.type||"weight",notes:w.notes,sets:(w.sets||[]).map(x=>({prescribedWeight:x.prescribedWeight,prescribedReps:x.prescribedReps,actualWeight:x.actualWeight,actualReps:x.actualReps,rpe:x.rpe,painLevel:x.painLevel,completed:x.completed}))}))}});return{id:r,maxLifts:b,painHistory:p,rpeAverages:$,goals:k,recentWorkouts:B}},we=async()=>{var p,E;if(D.length===0){G("Select at least one athlete");return}const d=se==="premium"?ze:He["generate-group-workout"]*D.length,b=(ee==null?void 0:ee.credits)??0;if(!X&&b<d){G(se==="premium"?`Not enough credits. Premium costs ${ze} credits, you have ${b}.`:`Not enough credits. Need ${d} (${He["generate-group-workout"]} x ${D.length} athletes) but you have ${b}.`);return}Y(!0),G(null),q("Generating workouts","loading"),Qe(),I.current&&(I.current(),I.current=null);try{X||ce({credits:b-d});const M=D.map(j=>{var v,R,U,H,le,Ie;return{id:j,name:((v=V[j])==null?void 0:v.name)||"Unknown",maxLifts:((R=V[j])==null?void 0:R.maxLifts)||{},painHistory:((U=V[j])==null?void 0:U.painHistory)||{},rpeAverages:((H=V[j])==null?void 0:H.rpeAverages)||{},goals:((le=V[j])==null?void 0:le.goals)||[],recentWorkouts:((Ie=V[j])==null?void 0:Ie.recentWorkouts)||[]}}),$=`ggw_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,k=await Is(),P=await fetch(Us("generate-group-workout"),{method:"POST",headers:k,body:JSON.stringify({groupId:Q.id,athletes:M,prompt:fe,workoutDate:Xe,model:se,workoutFocus:Z,intensity:Re,duration:Ne!=="auto"?parseInt(Ne):null,exerciseCount:ne!=="auto"?parseInt(ne):null,maxExercise:Z==="1rm-test"?Te:null,includeWarmup:ye,includeStretches:te,jobId:$})});if(!P.ok){const j=await P.json().catch(()=>({}));throw new Error(j.error||"Failed to generate")}const B=await P.json();if(B.success&&!B.background){xe(B),re(),W(j=>{var v;return[...j,{text:`Done! Created ${(v=B.createdWorkouts)==null?void 0:v.length} personalized workouts.`,icon:"check",id:j.length}]}),q("Generating workouts","complete",`${(p=B.createdWorkouts)==null?void 0:p.length} workouts created in ${(E=B.usage)==null?void 0:E.responseMs}ms`),Y(!1);return}const N=B.jobId||$,C=Bs(as,"groupWorkoutJobs",N);let w=!1;const x=Hs(C,j=>{var R;if(w)return;const v=j.data();if(v){if(v.status==="complete"&&v.result)w=!0,x(),I.current=null,xe(v.result),re(),W(U=>{var H;return[...U,{text:`Done! Created ${(H=v.result.createdWorkouts)==null?void 0:H.length} personalized workouts.`,icon:"check",id:U.length}]}),q("Generating workouts","complete",`${(R=v.result.createdWorkouts)==null?void 0:R.length} workouts created`),Y(!1);else if(v.status==="error"){w=!0,x(),I.current=null;const U=v.error||"Generation failed";G(U),X||ce({credits:b}),re(),W(H=>[...H,{text:`Error: ${U}`,icon:"error",id:H.length}]),q("Generating workouts","error",U),Y(!1)}}},j=>{w||(w=!0,console.error("Firestore listener error:",j),x(),I.current=null,G("Lost connection. Please try again."),X||ce({credits:b}),re(),Y(!1))});I.current=x,setTimeout(()=>{w||(w=!0,x(),I.current=null,G("Generation is taking too long. Please try again with fewer athletes or simpler settings."),X||ce({credits:b}),re(),Y(!1))},12e4)}catch(M){console.error("Error:",M),G(M.message),X||ce({credits:b}),re(),W($=>[...$,{text:`Error: ${M.message}`,icon:"error",id:$.length}]),q("Generating workouts","error",M.message),Y(!1)}},Oe=()=>{y==null||y(),pe()},he=r=>{Me(d=>d.includes(r)?d.filter(b=>b!==r):[...d,r])},cs=()=>{Me(D.length===(g==null?void 0:g.length)?[]:(g==null?void 0:g.map(r=>r.uid))||[])},pe=()=>{z(""),We("standard"),Ke(!0),L(!1),xe(null),G(null),ve([]),W([]),re(),oe()},K=r=>{switch(r){case"brain":return e.jsx(rs,{className:"w-3 h-3 text-flame-400"});case"alert":return e.jsx(Be,{className:"w-3 h-3 text-amber-400"});case"calc":return e.jsx(De,{className:"w-3 h-3 text-purple-400"});case"dumbbell":return e.jsx(ls,{className:"w-3 h-3 text-cyan-400"});case"users":return e.jsx(qe,{className:"w-3 h-3 text-green-400"});case"msg":return e.jsx(Fs,{className:"w-3 h-3 text-blue-400"});case"check":return e.jsx(ie,{className:"w-3 h-3 text-green-400"});case"error":return e.jsx(Be,{className:"w-3 h-3 text-red-400"});default:return e.jsx(Ue,{className:"w-3 h-3 text-flame-400 animate-spin"})}};return A?e.jsx(Ms,{children:e.jsx(ke.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:pe,children:e.jsxs(ke.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:r=>r.stopPropagation(),className:"bg-iron-900 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-flame-500/10 flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-flame-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-iron-100",children:"AI Generate Workout"}),e.jsx("p",{className:"text-sm text-iron-500",children:Q==null?void 0:Q.name})]})]}),e.jsx("button",{onClick:pe,className:"p-2 text-iron-400 hover:text-iron-200 rounded-xl",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-4 p-4",children:[e.jsx("div",{className:"lg:col-span-1 mb-4 lg:mb-0",children:e.jsxs("div",{className:"bg-iron-800/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(rs,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-300",children:"Analysis"})]}),e.jsx("div",{className:"space-y-2",children:Le.map((r,d)=>e.jsxs(ke.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5",children:r.status==="loading"?e.jsx(Ue,{className:"w-3 h-3 text-flame-400 animate-spin"}):r.status==="complete"?e.jsx(ie,{className:"w-3 h-3 text-green-400"}):r.status==="warning"?e.jsx(Be,{className:"w-3 h-3 text-amber-400"}):e.jsx(Be,{className:"w-3 h-3 text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-iron-300",children:r.label}),r.detail&&e.jsx("p",{className:"text-xs text-iron-500 truncate",children:r.detail})]})]},r.label))}),(_||ae.length>0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_&&e.jsx(Ue,{className:"w-3 h-3 text-flame-400 animate-spin"}),e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wider",children:_?"AI Thinking...":"AI Process"})]}),e.jsxs("div",{ref:T,className:"max-h-40 overflow-y-auto space-y-1.5 scrollbar-thin",children:[ae.map(r=>e.jsxs(ke.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:K(r.icon)}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:r.text})]},r.id)),_&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),!je&&Object.keys(V).length>0&&!_&&ae.length===0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-700",children:[e.jsx("p",{className:"text-xs text-iron-500 mb-2",children:"Group Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[e.jsxs("div",{className:"bg-iron-800/50 rounded-lg py-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:D.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Athletes"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg py-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.values(V).filter(r=>Object.keys(r.painHistory||{}).length>0).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"With Pain"})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-iron-800/30 rounded-xl border border-flame-500/20 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-iron-700/50 bg-flame-500/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-flame-500/20 flex items-center justify-center",children:e.jsx(rs,{className:"w-4 h-4 text-flame-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI is generating workouts..."}),e.jsxs("p",{className:"text-xs text-iron-500",children:[D.length," athlete",D.length!==1?"s":""," · ",fe||"Custom workout"]})]}),e.jsx(Ue,{className:"w-5 h-5 text-flame-400 animate-spin ml-auto"})]}),e.jsxs("div",{ref:T,className:"p-4 max-h-[300px] overflow-y-auto space-y-2.5 scrollbar-thin",children:[ae.map(r=>e.jsxs(ke.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},className:"flex items-start gap-3 py-1",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0 w-5 h-5 rounded bg-iron-800 flex items-center justify-center",children:K(r.icon)}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:r.text})]},r.id)),e.jsxs("div",{className:"flex items-center gap-1.5 pt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),me&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:me})})]}):O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsxs("p",{className:"text-green-400 font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),(Ge=O.createdWorkouts)==null?void 0:Ge.length," workouts created"]}),O.usage&&e.jsxs("p",{className:"text-xs text-iron-500 mt-1",children:[O.usage.tokens," tokens · ",O.usage.responseMs,"ms · ",O.usage.cost]})]}),O.coachingNotes&&e.jsxs("div",{className:"bg-iron-800/50 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-iron-700/50",children:[e.jsx(rs,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI Coaching Notes"})]}),e.jsx("div",{className:"p-3 max-h-32 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:O.coachingNotes})})]}),e.jsxs("div",{className:"p-4 bg-iron-800/50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-iron-100 mb-2",children:O.workoutName}),e.jsx("div",{className:"space-y-1",children:(ss=O.baseExercises)==null?void 0:ss.map((r,d)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-400",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{children:r.name}),e.jsxs("span",{className:"text-iron-600",children:[r.defaultSets,"×",r.defaultReps]}),r.type&&r.type!=="weight"&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${r.type==="time"?"bg-blue-500/20 text-blue-400":r.type==="bodyweight"?"bg-emerald-500/20 text-emerald-400":""}`,children:r.type==="time"?"Time":"BW"})]},d))})]}),e.jsx("div",{className:"space-y-3 max-h-[250px] overflow-y-auto",children:Object.entries(O.athleteWorkouts||{}).map(([r,d])=>{var b;return e.jsxs("div",{className:"p-3 bg-iron-800/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-iron-200",children:d.athleteName}),d.personalNotes&&e.jsx("p",{className:"text-xs text-iron-500 mt-1 leading-relaxed",children:d.personalNotes}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:(b=d.exercises)==null?void 0:b.slice(0,4).map((p,E)=>{var M,$,k,P,B,N,C;return e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${p.substitution?"bg-amber-500/20 text-amber-400":"bg-iron-700 text-iron-400"}`,children:[((M=p.substitution)==null?void 0:M.replacement)||p.name,": ",p.type==="time"?`${((k=($=p.sets)==null?void 0:$[0])==null?void 0:k.prescribedTime)||"?"}s`:p.type==="bodyweight"?`${((B=(P=p.sets)==null?void 0:P[0])==null?void 0:B.prescribedReps)||"?"} reps`:`${((C=(N=p.sets)==null?void 0:N[0])==null?void 0:C.prescribedWeight)||"?"}lb`]},E)})})]},r)})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Workout description (optional)"}),e.jsx("textarea",{value:fe,onChange:r=>z(r.target.value),placeholder:"e.g., 'Heavy bench day' or 'Focus on weak points'",className:"input-field w-full min-h-[60px] resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Style"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"push",label:"Push"},{value:"pull",label:"Pull"},{value:"legs",label:"Legs"},{value:"upper",label:"Upper"},{value:"full",label:"Full Body"},{value:"bench",label:"Bench Focus"},{value:"no-equipment",label:"Bodyweight"},{value:"1rm-test",label:"Test 1RM"}].map(r=>e.jsxs("button",{onClick:()=>{$e(r.value),r.value!=="1rm-test"&&Pe("")},className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                              ${Z===r.value?r.value==="1rm-test"?"border-yellow-500 bg-yellow-500/10 text-yellow-400":"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[r.label,r.value==="1rm-test"&&e.jsx("span",{className:"ml-1 text-[9px] px-1 py-0.5 rounded-full bg-green-500/20 text-green-400 font-medium leading-none",children:"New"})]},r.value))})]}),Z==="1rm-test"&&e.jsxs("div",{className:"p-3 bg-yellow-500/5 border border-yellow-500/20 rounded-xl",children:[e.jsx("label",{className:"block text-sm text-yellow-400 mb-2",children:"Which lift?"}),e.jsx("input",{type:"text",value:Te,onChange:r=>Pe(r.target.value),placeholder:"e.g. Bench Press, Squat, Deadlift...",className:"input-field w-full"}),e.jsx("p",{className:"text-xs text-iron-600 mt-1.5",children:"AI generates warm-up ramps and max attempt protocol per athlete."})]}),Z!=="1rm-test"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Intensity"}),e.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:[{value:"light",label:"Light",desc:"RPE 5-6"},{value:"moderate",label:"Moderate",desc:"RPE 7-8"},{value:"heavy",label:"Heavy",desc:"RPE 8-9"},{value:"max",label:"Max",desc:"RPE 9-10"}].map(r=>e.jsxs("button",{onClick:()=>Ye(r.value),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                                ${Re===r.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-[10px] text-iron-500",children:r.desc})]},r.value))})]}),Z!=="1rm-test"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Duration"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:[{value:"auto",label:"Auto"},{value:"20",label:"20m"},{value:"30",label:"30m"},{value:"45",label:"45m"},{value:"60",label:"60m"},{value:"90",label:"90m"}].map(r=>e.jsx("button",{onClick:()=>Ze(r.value),className:`px-2 py-0.5 text-[11px] rounded-md border transition-colors
                                  ${Ne===r.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:r.label},r.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:[{value:"auto",label:"Auto"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"8",label:"8"}].map(r=>e.jsx("button",{onClick:()=>os(r.value),className:`px-2 py-0.5 text-[11px] rounded-md border transition-colors
                                  ${ne===r.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:Xe,onChange:r=>de(r.target.value),className:"input-field w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsxs("button",{onClick:()=>We("standard"),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                              ${se==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(Os,{className:"w-3 h-3"}),"Standard"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[He["generate-group-workout"],"/athlete"]})]}),e.jsxs("button",{onClick:()=>We("premium"),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                              ${se==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),"Premium"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[ze," cr"]})]})]})]})]}),Z!=="1rm-test"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Ke(!ye),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${ye?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Warm-up"}),e.jsx("button",{onClick:()=>L(!te),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${te?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Stretches"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm text-iron-400 flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),"Athletes (",D.length,"/",(g==null?void 0:g.length)||0,")"]}),e.jsx("button",{onClick:cs,className:"text-xs text-flame-400 hover:text-flame-300",children:D.length===(g==null?void 0:g.length)?"Deselect All":"Select All"})]}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:g==null?void 0:g.map(r=>{var M,$;const d=V[r.uid],b=Object.keys((d==null?void 0:d.painHistory)||{}).length>0,p=Object.keys((d==null?void 0:d.maxLifts)||{}).length,E=Fe===r.uid;return e.jsxs("div",{className:"border border-iron-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>he(r.uid),className:`w-full flex items-center gap-3 p-3 transition-colors
                                  ${D.includes(r.uid)?"bg-flame-500/10":"bg-iron-800/50 hover:bg-iron-800"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center
                                  ${D.includes(r.uid)?"border-flame-500 bg-flame-500":"border-iron-600"}`,children:D.includes(r.uid)&&e.jsx(ie,{className:"w-3 h-3 text-white"})}),r.photoURL?e.jsx("img",{src:r.photoURL,alt:"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-iron-700 flex items-center justify-center text-xs text-iron-400",children:(M=r.displayName)==null?void 0:M[0]}),e.jsx("span",{className:"text-iron-200 flex-1 text-left",children:r.displayName}),e.jsxs("span",{className:"text-xs text-iron-500",children:[p," lifts"]}),b&&e.jsx(Be,{className:"w-4 h-4 text-amber-400"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),ue(E?null:r.uid)},className:"p-1 hover:bg-iron-700 rounded",children:E?e.jsx(Gs,{className:"w-4 h-4 text-iron-400"}):e.jsx(Ns,{className:"w-4 h-4 text-iron-400"})})]}),e.jsx(Ms,{children:E&&d&&e.jsx(ke.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-iron-700 bg-iron-800/30",children:e.jsxs("div",{className:"p-3 text-xs space-y-2",children:[Object.keys(d.maxLifts||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-500 mb-1",children:"Top Lifts"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(d.maxLifts).sort((k,P)=>P[1].e1rm-k[1].e1rm).slice(0,4).map(([k,P])=>e.jsxs("span",{className:"bg-iron-700 px-2 py-0.5 rounded text-iron-300",children:[k,": ",P.e1rm,"lb"]},k))})]}),Object.keys(d.painHistory||{}).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 mb-1",children:"Pain History"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(d.painHistory).map(([k,P])=>e.jsxs("span",{className:"bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded",children:[k,": ",P.maxPain,"/10"]},k))})]}),(($=d.goals)==null?void 0:$.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-500 mb-1",children:"Goals"}),d.goals.slice(0,2).map((k,P)=>e.jsxs("p",{className:"text-iron-400",children:[k.lift,": ",k.currentWeight||"?"," → ",k.targetWeight||k.targetValue]},P))]})]})})})]},r.uid)})})]}),me&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:me})})]})})]})}),e.jsx("div",{className:"p-4 border-t border-iron-800 flex gap-3",children:O?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{xe(null),W([])},className:"btn-secondary flex-1",children:"Generate Another"}),e.jsxs("button",{onClick:Oe,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Done"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:pe,className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:we,disabled:_||je||D.length===0||!X&&((ee==null?void 0:ee.credits)??0)<(se==="premium"?ze:He["generate-group-workout"]*D.length),className:"btn-primary flex-1 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-5 h-5"}),"Generate for ",D.length," ",e.jsxs("span",{className:"text-xs opacity-70",children:["(",se==="premium"?ze:He["generate-group-workout"]*D.length," cr)"]})]})})]})})]})})}):null}const bs=(A,oe="MMM d, yyyy")=>{if(!A)return"";try{const Q=Ls(A);return isNaN(Q.getTime())?"":Ve(Q,oe)}catch{return""}},ct=["Bench Press","Incline Bench Press","Close Grip Bench","Dumbbell Press","Overhead Press","Squat","Deadlift","Barbell Row","Pull-ups","Tricep Extension","Bicep Curl","Lateral Raise"],dt=["Dead Hang","Plank","Wall Sit","L-Sit","Farmers Carry","Static Hold"],xt=["Pull-ups","Push-ups","Dips","Chin-ups","Muscle-ups","Bodyweight Squats"];function vt(){var le,Ie,vs,ws,ks,Cs;const{id:A}=zs(),oe=_s(),Q=Vs();qs("Group");const{user:g,userProfile:Je,isAppAdmin:X}=Ps(),[y,fe]=i.useState(null),[z,is]=i.useState([]),[ee,ce]=i.useState({}),[ys,Xe]=i.useState({}),[de,D]=i.useState([]),[Me,V]=i.useState(!0),Ae=(Je==null?void 0:Je.customExercises)||{},je=[...ct,...Ae.weight||[]],be=[...xt,...Ae.bodyweight||[]],_=[...dt,...Ae.time||[]],[Y,O]=i.useState(!1),[xe,me]=i.useState(!1),[G,se]=i.useState(((le=Q.state)==null?void 0:le.activeTab)||"members"),[We,Z]=i.useState(!1),[$e,Re]=i.useState("code"),[Ye,Ne]=i.useState(""),[Ze,ne]=i.useState([]),[os,Te]=i.useState(!1),[Pe,ye]=i.useState(null),[Ke,te]=i.useState(!1),[L,Le]=i.useState([]),[ve,Fe]=i.useState(new Date().toISOString().split("T")[0]),[ue,ae]=i.useState(""),[W,T]=i.useState({}),[u,I]=i.useState(null),[q,Qe]=i.useState(!1),[re,es]=i.useState(null),[F,we]=i.useState(null),[Oe,he]=i.useState(""),[cs,pe]=i.useState(!1),K=(Ie=y==null?void 0:y.admins)==null?void 0:Ie.includes(g==null?void 0:g.uid);i.useEffect(()=>{async function s(){if(!(!A||!g))try{const n=await Se.getById(A);if(fe(n),n!=null&&n.members){const t=await Se.getMemberDetails(n.members),a=Ws(new Date,{weekStartsOn:1}),l=As(new Date,{weekStartsOn:1}),m={},h={};for(const o of n.members){try{const c=await Qs.getByDateRange(o,a,l);m[o]=c}catch{m[o]=[]}try{if(o===g.uid||X){const c=await et.getByUser(o);h[o]=c.filter(f=>f.status==="active")}else h[o]=[]}catch{h[o]=[]}}is(t),Xe(m),ce(h);try{const o=await Ce.getByGroup(A,g.uid);D(o)}catch(o){console.error("Error loading group workouts:",o),D([])}}}catch(n){console.error("Error fetching group:",n)}finally{V(!1)}}s()},[A,g]);const Ge=async()=>{y!=null&&y.inviteCode&&(await navigator.clipboard.writeText(y.inviteCode),me(!0),setTimeout(()=>me(!1),2e3))},ss=async s=>{if(Ne(s),s.length<2){ne([]);return}Te(!0);try{const t=(await st.search(s)).filter(a=>{var l;return!((l=y==null?void 0:y.members)!=null&&l.includes(a.uid))});ne(t)}catch(n){console.error("Error searching users:",n)}finally{Te(!1)}},r=async s=>{ye(s);try{await Se.addMember(A,s);const n=await Se.getMemberDetails([...y.members,s]);is(n),fe(t=>({...t,members:[...t.members,s]})),ne(t=>t.filter(a=>a.uid!==s))}catch(n){console.error("Error inviting user:",n),alert("Failed to invite user")}finally{ye(null)}},d=async()=>{if(confirm("Are you sure you want to leave this group?"))try{await Se.removeMember(A,g.uid),oe("/groups")}catch(s){console.error("Error leaving group:",s)}},b=async()=>{if(confirm("Are you sure you want to delete this group? This cannot be undone."))try{await Se.delete(A),oe("/groups")}catch(s){console.error("Error deleting group:",s)}},p=()=>{const s=(y==null?void 0:y.members)||[];Le(s),Fe(new Date().toISOString().split("T")[0]),ae(""),he("");const n={};s.forEach(t=>{n[t]={personalNotes:"",exercises:[{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}),T(n),I(s[0]||null),we(null),te(!0)},E=s=>{const n=s.assignments.map(f=>f.memberId);Le(n);const t=Ls(s.date),a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");Fe(`${a}-${l}-${m}`),ae(s.name);const h={},o={},c=de.find(f=>{var S;return f.id===((S=s.assignments[0])==null?void 0:S.id)});he((c==null?void 0:c.coachingNotes)||""),s.assignments.forEach(f=>{var J;const S=de.find(ge=>ge.id===f.id);o[f.memberId]=f.id,(J=S==null?void 0:S.exercises)!=null&&J.length?h[f.memberId]={personalNotes:S.personalNotes||"",exercises:S.exercises.map(ge=>{var Ss,Es,Ds;const ds=ge.type||((Es=(Ss=ge.sets)==null?void 0:Ss[0])!=null&&Es.prescribedTime?"time":"weight");return{id:Date.now()+Math.random(),name:ge.name,type:ds,notes:ge.notes||"",sets:((Ds=ge.sets)==null?void 0:Ds.map(ts=>ds==="time"?{time:ts.prescribedTime||""}:ds==="bodyweight"?{reps:ts.prescribedReps||""}:{weight:ts.prescribedWeight||"",reps:ts.prescribedReps||""}))||[{weight:"",reps:""}]}})}:h[f.memberId]={personalNotes:(S==null?void 0:S.personalNotes)||"",exercises:[{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}),T(h),I(n[0]||null),we(o),te(!0)},M=async s=>{const n=s.length;if(confirm(`Delete this workout for ${n} member${n>1?"s":""}? This cannot be undone.`))try{await Promise.all(s.map(t=>Ce.delete(t.id))),D(t=>t.filter(a=>!s.some(l=>l.id===a.id))),es(null)}catch(t){console.error("Error deleting workouts:",t),alert("Failed to delete workouts")}},$=s=>{T(n=>{var t;return{...n,[s]:{...n[s],exercises:[...((t=n[s])==null?void 0:t.exercises)||[],{id:Date.now()+Math.random(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}}})},k=(s,n)=>{T(t=>({...t,[s]:{...t[s],exercises:t[s].exercises.filter(a=>a.id!==n)}}))},P=(s,n,t,a)=>{T(l=>{const m={...l},h=m[s].exercises.map(o=>{if(o.id!==n)return o;const c={...o,[t]:a};if(t==="name"){const f=_.includes(a),S=be.includes(a)&&!je.includes(a);f&&o.type!=="time"?(c.type="time",c.sets=o.sets.map(J=>({time:J.time||""}))):S&&o.type!=="bodyweight"?(c.type="bodyweight",c.sets=o.sets.map(J=>({reps:J.reps||""}))):!f&&!S&&o.type!=="weight"&&(c.type="weight",c.sets=o.sets.map(J=>({weight:J.weight||"",reps:J.reps||""})))}return c});return m[s]={...m[s],exercises:h},m})},B=(s,n)=>{T(t=>({...t,[s]:{...t[s],exercises:t[s].exercises.map(a=>{if(a.id!==n)return a;const l=a.sets[a.sets.length-1];let m;return a.type==="time"?m={time:(l==null?void 0:l.time)||""}:a.type==="bodyweight"?m={reps:(l==null?void 0:l.reps)||""}:m={weight:(l==null?void 0:l.weight)||"",reps:(l==null?void 0:l.reps)||""},{...a,sets:[...a.sets,m]}})}}))},N=(s,n,t,a,l)=>{T(m=>({...m,[s]:{...m[s],exercises:m[s].exercises.map(h=>h.id===n?{...h,sets:h.sets.map((o,c)=>c===t?{...o,[a]:l}:o)}:h)}}))},C=(s,n,t)=>{T(a=>({...a,[s]:{...a[s],exercises:a[s].exercises.map(l=>l.id===n?{...l,sets:l.sets.filter((m,h)=>h!==t)}:l)}}))},w=s=>{T(n=>({...n,[s]:{...n[s],exercises:n[s].exercises.map(t=>{const a=t.sets[t.sets.length-1];let l;return t.type==="time"?l={time:(a==null?void 0:a.time)||""}:t.type==="bodyweight"?l={reps:(a==null?void 0:a.reps)||""}:l={weight:(a==null?void 0:a.weight)||"",reps:(a==null?void 0:a.reps)||""},{...t,sets:[...t.sets,l]}})}}))},x=s=>{const t=(W[s]||{}).exercises||[],a=JSON.parse(JSON.stringify(t));T(l=>{const m={...l};return L.forEach(h=>{h!==s&&(m[h]={...m[h],exercises:a.map(o=>({...o,id:Date.now()+Math.random(),sets:o.sets.map(c=>({...c}))}))})}),m})},j=s=>{Le(n=>{const t=n.includes(s)?n.filter(a=>a!==s):[...n,s];return n.includes(s)||T(a=>({...a,[s]:{personalNotes:"",exercises:[{id:Date.now(),name:"",type:"weight",notes:"",sets:[{weight:"",reps:""}]}]}})),t})},v=async()=>{if(!ue.trim()||L.length===0){alert("Please enter a workout name and select at least one member");return}Qe(!0);try{const[s,n,t]=ve.split("-").map(Number),a=new Date(s,n-1,t,12,0,0),l=h=>((h==null?void 0:h.exercises)||[]).filter(o=>o.name.trim()).map(o=>({name:o.name,type:o.type||"weight",notes:o.notes||"",sets:o.sets.map((c,f)=>{const S={id:Date.now()+f,rpe:"",painLevel:0};return o.type==="time"?{...S,prescribedTime:c.time||"",actualTime:""}:o.type==="bodyweight"?{...S,prescribedReps:c.reps||"",actualReps:""}:{...S,prescribedWeight:c.weight||"",prescribedReps:c.reps||"",actualWeight:"",actualReps:""}})}));if(F)for(const h of L){const o=F[h];if(!o)continue;const c=W[h],f=l(c);await Ce.update(o,{name:ue,date:a,exercises:f,coachingNotes:Oe||"",personalNotes:(c==null?void 0:c.personalNotes)||""})}else{const h=L.map(o=>{const c=W[o],f=l(c);return{assignedTo:o,name:ue,exercises:f}});await Ce.createBatch(A,y.admins,a,h,y.members)}const m=await Ce.getByGroup(A,g.uid);D(m),te(!1),we(null),he(""),alert(F?"Workout updated!":`Workout assigned to ${L.length} member${L.length!==1?"s":""}!`)}catch(s){console.error("Error saving group workout:",s),alert("Failed to save workout")}finally{Qe(!1)}},R=at({start:Ws(new Date,{weekStartsOn:1}),end:As(new Date,{weekStartsOn:1})}),U=s=>{const n=ys[s]||[];return R.map(t=>{const a=n.find(l=>{var m;try{const h=(m=l.date)!=null&&m.toDate?l.date.toDate():new Date(l.date);return tt(h,t)}catch{return!1}});return(a==null?void 0:a.status)||null})},H=s=>{switch(s){case"present":return"bg-green-500";case"missed":return"bg-red-500";case"vacation":return"bg-blue-500";default:return"bg-iron-700"}};return Me?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})}):y?e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 pb-24",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>oe("/groups"),className:"flex items-center gap-2 text-iron-400 hover:text-iron-200 transition-colors",children:[e.jsx(Js,{className:"w-5 h-5"}),e.jsx("span",{children:"Groups"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>O(!Y),className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-lg transition-colors",children:e.jsx(rt,{className:"w-5 h-5"})}),Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>O(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-iron-800 border border-iron-700 rounded-lg shadow-xl z-20 overflow-hidden",children:[K&&e.jsxs(_e,{to:`/groups/${A}/settings`,className:"flex items-center gap-3 px-4 py-3 text-iron-300 hover:bg-iron-700 transition-colors",children:[e.jsx(Xs,{className:"w-4 h-4"}),"Group Settings"]}),e.jsxs("button",{onClick:d,className:"w-full flex items-center gap-3 px-4 py-3 text-iron-300 hover:bg-iron-700 transition-colors",children:[e.jsx(Ys,{className:"w-4 h-4"}),"Leave Group"]}),K&&e.jsxs("button",{onClick:b,className:"w-full flex items-center gap-3 px-4 py-3 text-red-400 hover:bg-red-500/10 transition-colors",children:[e.jsx(gs,{className:"w-4 h-4"}),"Delete Group"]})]})]})]})]}),e.jsxs("div",{className:"card-steel p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-flame-500/20 to-flame-600/10 flex items-center justify-center flex-shrink-0",children:e.jsx(qe,{className:"w-8 h-8 text-flame-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-display text-iron-100 mb-1",children:y.name}),e.jsxs("p",{className:"text-iron-500 text-sm",children:[z.length," member",z.length!==1?"s":""," · Created ",bs(y.createdAt)]})]})]}),K&&y.inviteCode&&e.jsx("div",{className:"mt-6 p-4 bg-iron-800/50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-iron-400 mb-1",children:"Invite Code"}),e.jsx("p",{className:"text-xl font-mono font-bold text-iron-200 tracking-wider",children:y.inviteCode})]}),e.jsx("button",{onClick:Ge,className:"btn-secondary flex items-center gap-2",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 text-green-400"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"w-4 h-4"}),"Copy"]})})]})})]}),e.jsx("div",{className:"flex gap-2 mb-6 border-b border-iron-800 overflow-x-auto",children:["members","workouts","goals","attendance"].map(s=>e.jsxs("button",{onClick:()=>se(s),className:`px-4 py-3 text-sm font-medium whitespace-nowrap transition-colors relative ${G===s?"text-flame-400":"text-iron-500 hover:text-iron-300"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),G===s&&e.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-flame-500"})]},s))}),G==="workouts"&&e.jsxs("div",{className:"space-y-4",children:[K&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>pe(!0),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),"AI Generate"]}),e.jsxs("button",{onClick:p,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"w-5 h-5"}),"Manual"]})]}),de.length===0?e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(ls,{className:"w-12 h-12 text-iron-600 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-400",children:"No group workouts yet"}),K&&e.jsx("p",{className:"text-iron-500 text-sm mt-1",children:"Create a workout to assign it to group members"})]}):e.jsx("div",{className:"space-y-3",children:(()=>{const s={};return de.forEach(n=>{const t=bs(n.date,"yyyy-MM-dd"),a=`${n.name}-${t}`;s[a]||(s[a]={name:n.name,date:n.date,exercises:n.exercises,assignments:[]}),s[a].assignments.push({id:n.id,memberId:n.assignedTo,status:n.status})}),Object.entries(s).map(([n,t])=>{var h,o;const a=re===n,l=t.assignments.filter(c=>c.status==="completed").length,m=t.assignments.length;return e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsxs("button",{onClick:()=>es(a?null:n),className:"w-full p-4 flex items-center gap-4 text-left hover:bg-iron-800/30 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-flame-500/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ls,{className:"w-5 h-5 text-flame-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-iron-100",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500",children:[e.jsx("span",{children:bs(t.date,"EEE, MMM d")}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[((h=t.exercises)==null?void 0:h.length)||0," exercises"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{className:l===m?"text-green-400":"",children:[l,"/",m," done"]})]})]}),a?e.jsx(Ns,{className:"w-5 h-5 text-iron-500"}):e.jsx($s,{className:"w-5 h-5 text-iron-500"})]}),a&&e.jsxs("div",{className:"border-t border-iron-800",children:[(()=>{const c=de.find(f=>{var S;return f.id===((S=t.assignments[0])==null?void 0:S.id)});return c!=null&&c.coachingNotes?e.jsxs("div",{className:"p-4 bg-flame-500/5 border-b border-iron-800",children:[e.jsxs("p",{className:"text-xs text-flame-400 flex items-center gap-1.5 mb-1.5",children:[e.jsx(De,{className:"w-3 h-3"}),"AI Coaching Notes"]}),e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:c.coachingNotes})]}):null})(),e.jsxs("div",{className:"p-4 bg-iron-800/20 border-b border-iron-800",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-2",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(o=t.exercises)==null?void 0:o.map((c,f)=>{var S;return e.jsxs("span",{className:"px-2 py-1 bg-iron-800 rounded text-sm text-iron-300",children:[c.name," (",((S=c.sets)==null?void 0:S.length)||0,"×)"]},f)})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-3",children:"Assigned Members"}),e.jsx("div",{className:"space-y-2",children:t.assignments.map(c=>{var S;const f=z.find(J=>J.uid===c.memberId);return e.jsxs(_e,{to:`/workouts/group/${c.id}`,state:{from:`/groups/${A}`,fromLabel:"Back to Group"},className:"flex items-center gap-3 p-3 rounded-lg bg-iron-800/30 hover:bg-iron-800/50 transition-colors",children:[f!=null&&f.photoURL?e.jsx("img",{src:f.photoURL,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-iron-400",children:((S=f==null?void 0:f.displayName)==null?void 0:S[0])||"?"})}),e.jsx("span",{className:"flex-1 text-iron-200",children:(f==null?void 0:f.displayName)||"Unknown"}),c.status==="completed"?e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 rounded text-xs font-medium",children:"Done"}):e.jsx("span",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 rounded text-xs font-medium",children:"Pending"}),e.jsx($s,{className:"w-4 h-4 text-iron-600"})]},c.id)})})]}),t.assignments.length>1&&e.jsx("div",{className:"px-4 pb-3",children:e.jsxs(_e,{to:`/groups/${A}/batch/${encodeURIComponent(n)}`,className:"btn-secondary w-full flex items-center justify-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"View All Members"]})}),K&&e.jsxs("div",{className:"p-4 border-t border-iron-800 flex gap-2",children:[e.jsxs("button",{onClick:()=>E(t),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Edit Workout"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),M(t.assignments)},className:"px-4 py-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(gs,{className:"w-4 h-4"}),"Delete"]})]})]})]},n)})})()})]}),G==="members"&&e.jsxs("div",{className:"space-y-3",children:[z.map(s=>{var n,t;return e.jsxs(_e,{to:`/profile/${s.username||s.uid}`,state:{from:`/groups/${A}`,fromLabel:"Back to Group"},className:"card-steel p-4 flex items-center gap-4 hover:border-iron-600 transition-colors",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:s.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:((n=s.displayName)==null?void 0:n[0])||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-iron-100 truncate",children:s.displayName||"Unknown"}),((t=y.admins)==null?void 0:t.includes(s.uid))&&e.jsx(lt,{className:"w-4 h-4 text-yellow-500 flex-shrink-0"}),s.uid===g.uid&&e.jsx("span",{className:"text-xs text-iron-500",children:"(you)"})]}),s.username&&e.jsxs("p",{className:"text-xs text-iron-500",children:["@",s.username]})]}),e.jsx("div",{className:"hidden sm:flex gap-1",children:U(s.uid).map((a,l)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${H(a)}`,title:Ve(R[l],"EEE")},l))})]},s.uid)}),K&&e.jsxs("button",{onClick:()=>Z(!0),className:"w-full card-steel p-4 flex items-center justify-center gap-2 text-iron-400 hover:text-iron-200 hover:border-iron-600 transition-colors",children:[e.jsx(Zs,{className:"w-5 h-5"}),"Invite Members"]})]}),G==="attendance"&&e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-iron-700",children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-iron-400",children:"Member"}),R.map(s=>e.jsxs("th",{className:`px-3 py-3 text-center text-sm font-medium ${Ks(s)?"text-flame-400":"text-iron-400"}`,children:[Ve(s,"EEE"),e.jsx("div",{className:"text-xs text-iron-600 font-normal",children:Ve(s,"d")})]},s.toISOString()))]})}),e.jsx("tbody",{children:z.map(s=>{var n,t;return e.jsxs("tr",{className:"border-b border-iron-800 last:border-0",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-iron-400",children:(n=s.displayName)==null?void 0:n[0]})}),e.jsx("span",{className:"text-sm text-iron-200 truncate max-w-[100px]",children:(t=s.displayName)==null?void 0:t.split(" ")[0]})]})}),U(s.uid).map((a,l)=>e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("div",{className:`w-6 h-6 rounded-full mx-auto ${H(a)}`,title:a||"No data"})},l))]},s.uid)})})]})}),e.jsxs("div",{className:"px-4 py-3 bg-iron-800/50 flex gap-4 text-xs text-iron-500",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"})," Present"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"})," Missed"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"})," Vacation"]})]})]}),G==="goals"&&e.jsx("div",{className:"space-y-4",children:z.map(s=>{var n,t;return e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800 flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"font-bold text-iron-400",children:(n=s.displayName)==null?void 0:n[0]})}),e.jsx("div",{children:e.jsxs("h3",{className:"font-medium text-iron-100",children:[s.displayName,s.uid===g.uid&&e.jsx("span",{className:"text-xs text-iron-500 ml-2",children:"(you)"})]})})]}),e.jsx("div",{className:"p-4",children:((t=ee[s.uid])==null?void 0:t.length)>0?e.jsx("div",{className:"space-y-3",children:ee[s.uid].map(a=>{const l=a.currentValue??a.currentWeight??0,m=a.targetValue??a.targetWeight??0,h=m>0?Math.min(100,l/m*100):0,o=a.metricType==="time"?"sec":a.metricType==="reps"?"reps":"lbs";return e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-iron-200",children:a.lift}),e.jsxs("span",{className:"text-sm text-iron-400",children:[l," / ",m," ",o]})]}),e.jsx("div",{className:"h-2 bg-iron-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-flame-500 rounded-full transition-all",style:{width:`${h}%`}})})]},a.id)})}):e.jsx("p",{className:"text-iron-500 text-sm text-center py-2",children:"No active goals"})})]},s.uid)})}),Ke&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-iron-900 rounded-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-iron-900 border-b border-iron-800 p-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-display text-iron-100",children:F?"Edit Group Workout":"Assign Group Workout"}),e.jsx("button",{onClick:()=>{te(!1),we(null),he("")},className:"p-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-2",children:"Workout Name *"}),e.jsx("input",{type:"text",value:ue,onChange:s=>ae(s.target.value),placeholder:"e.g., Push Day, Bench Focus",className:"input-field w-full text-base py-3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-2",children:"Date *"}),e.jsx("input",{type:"date",value:ve,onChange:s=>Fe(s.target.value),className:"input-field w-full text-base py-3"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300 mb-3",children:F?"Assigned Members":"Assign to Members"}),F&&Oe&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>{const s=document.getElementById("coaching-notes-section");s&&s.classList.toggle("hidden")},className:"flex items-center gap-2 text-sm text-flame-400 hover:text-flame-300 mb-2",children:[e.jsx(it,{className:"w-4 h-4"}),"AI Coaching Notes",e.jsx(Ns,{className:"w-3 h-3"})]}),e.jsx("div",{id:"coaching-notes-section",children:e.jsx("textarea",{value:Oe,onChange:s=>he(s.target.value),rows:3,className:"input-field w-full text-sm resize-none",placeholder:"Coaching notes..."})})]}),F&&e.jsx("p",{className:"text-xs text-iron-500 mb-2",children:"Members cannot be changed when editing. Create a new workout to assign to different members."}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(s=>{var a,l;const n=L.includes(s.uid),t=F&&!n;return e.jsxs("button",{onClick:()=>!F&&j(s.uid),disabled:F,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${n?"bg-flame-500/20 border border-flame-500/50 text-flame-200":t?"bg-iron-800/30 border border-iron-800 text-iron-600 cursor-not-allowed":"bg-iron-800/50 border border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-5 h-5 rounded-full"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-iron-700 flex items-center justify-center text-xs",children:(a=s.displayName)==null?void 0:a[0]}),e.jsx("span",{className:"text-sm",children:(l=s.displayName)==null?void 0:l.split(" ")[0]}),n&&e.jsx(ie,{className:"w-4 h-4"})]},s.uid)})})]}),L.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-iron-300",children:"Prescriptions by Member"}),u&&L.length>1&&e.jsxs("button",{onClick:()=>x(u),className:"text-xs text-flame-400 hover:text-flame-300 flex items-center gap-1",children:[e.jsx(fs,{className:"w-3 h-3"}),"Copy to all members"]})]}),e.jsx("div",{className:"flex gap-1 mb-4 overflow-x-auto pb-2",children:L.map(s=>{var t,a;const n=z.find(l=>l.uid===s);return e.jsxs("button",{onClick:()=>I(s),className:`flex items-center gap-2 px-3 py-2 rounded-lg whitespace-nowrap transition-colors ${u===s?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:bg-iron-700"}`,children:[n!=null&&n.photoURL?e.jsx("img",{src:n.photoURL,alt:"",className:"w-5 h-5 rounded-full"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-iron-600 flex items-center justify-center text-xs",children:(t=n==null?void 0:n.displayName)==null?void 0:t[0]}),e.jsx("span",{className:"text-sm",children:(a=n==null?void 0:n.displayName)==null?void 0:a.split(" ")[0]})]},s)})}),u&&W[u]&&e.jsxs("div",{className:"space-y-4",children:[(F||((vs=W[u])==null?void 0:vs.personalNotes))&&e.jsxs("div",{className:"bg-iron-800/30 rounded-lg p-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-iron-500 mb-2",children:[e.jsx(Fs,{className:"w-3 h-3"}),"Personal Notes for ",((ks=(ws=z.find(s=>s.uid===u))==null?void 0:ws.displayName)==null?void 0:ks.split(" ")[0])||"Member"]}),e.jsx("textarea",{value:((Cs=W[u])==null?void 0:Cs.personalNotes)||"",onChange:s=>T(n=>({...n,[u]:{...n[u],personalNotes:s.target.value}})),rows:2,className:"input-field w-full text-sm resize-none",placeholder:"Notes specific to this athlete..."})]}),W[u].exercises.length>1&&e.jsxs("button",{onClick:()=>w(u),className:"w-full py-2 text-xs text-flame-400 hover:text-flame-300 bg-flame-500/5 hover:bg-flame-500/10 border border-flame-500/20 rounded-lg flex items-center justify-center gap-1.5 transition-colors",children:[e.jsx(ns,{className:"w-3 h-3"}),"Add 1 Set to Each Exercise"]}),W[u].exercises.map((s,n)=>e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-7 h-7 rounded-lg bg-flame-500/20 text-flame-400 flex items-center justify-center text-sm font-medium",children:n+1}),e.jsxs("select",{value:s.name,onChange:t=>P(u,s.id,"name",t.target.value),className:"input-field flex-1 text-base py-2",children:[e.jsx("option",{value:"",children:"Select exercise"}),s.name&&![...je,...be,..._].includes(s.name)&&e.jsxs("option",{value:s.name,children:[s.name," (custom)"]}),e.jsx("optgroup",{label:"Weight Exercises",children:je.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("optgroup",{label:"Bodyweight",children:be.map(t=>e.jsx("option",{value:t,children:t},`bw-${t}`))}),e.jsx("optgroup",{label:"Time-Based",children:_.map(t=>e.jsx("option",{value:t,children:t},`t-${t}`))})]}),W[u].exercises.length>1&&e.jsx("button",{onClick:()=>k(u,s.id),className:"p-2 text-iron-500 hover:text-red-400 transition-colors",children:e.jsx(gs,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center gap-1.5 mb-3 ml-9",children:["weight","bodyweight","time"].map(t=>e.jsx("button",{onClick:()=>{const a=s.sets.map(l=>t==="time"?{time:l.time||""}:t==="bodyweight"?{reps:l.reps||""}:{weight:l.weight||"",reps:l.reps||""});T(l=>({...l,[u]:{...l[u],exercises:l[u].exercises.map(m=>m.id===s.id?{...m,type:t,sets:a}:m)}}))},className:`text-xs px-2 py-0.5 rounded transition-colors ${s.type===t?t==="time"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":t==="bodyweight"?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-iron-600/30 text-iron-300 border border-iron-500/30":"text-iron-600 hover:text-iron-400"}`,children:t==="weight"?"Weight":t==="bodyweight"?"BW":"Time"},t))}),e.jsxs("div",{className:"space-y-2",children:[s.type==="time"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-8",children:"Time (seconds)"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:a+1})}),e.jsx("div",{className:"col-span-8",children:e.jsx("input",{type:"number",inputMode:"numeric",value:t.time||"",onChange:l=>N(u,s.id,a,"time",l.target.value),placeholder:"60",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>C(u,s.id,a),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})})]},a))]}):s.type==="bodyweight"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-8",children:"Reps"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:a+1})}),e.jsx("div",{className:"col-span-8",children:e.jsx("input",{type:"text",inputMode:"numeric",value:t.reps||"",onChange:l=>N(u,s.id,a,"reps",l.target.value),onBlur:l=>N(u,s.id,a,"reps",Rs(l.target.value)),placeholder:"e.g. 10 or 8-12",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>C(u,s.id,a),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})})]},a))]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs text-iron-500 px-1",children:[e.jsx("div",{className:"col-span-2",children:"Set"}),e.jsx("div",{className:"col-span-4",children:"Weight"}),e.jsx("div",{className:"col-span-4",children:"Reps"}),e.jsx("div",{className:"col-span-2"})]}),s.sets.map((t,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"text-iron-400 text-sm font-medium pl-1",children:a+1})}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",value:t.weight||"",onChange:l=>N(u,s.id,a,"weight",l.target.value),placeholder:"lbs",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",inputMode:"numeric",value:t.reps||"",onChange:l=>N(u,s.id,a,"reps",l.target.value),onBlur:l=>N(u,s.id,a,"reps",Rs(l.target.value)),placeholder:"e.g. 8 or 6-8",className:"input-field w-full text-base py-2 px-3"})}),e.jsx("div",{className:"col-span-2 flex justify-end",children:s.sets.length>1&&e.jsx("button",{onClick:()=>C(u,s.id,a),className:"p-1 text-iron-600 hover:text-red-400 transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})})]},a))]}),e.jsxs("button",{onClick:()=>B(u,s.id),className:"w-full py-2 text-xs text-iron-500 hover:text-iron-300 flex items-center justify-center gap-1",children:[e.jsx(ns,{className:"w-3 h-3"}),"Add Set"]})]}),(s.notes||F)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-iron-700/50",children:e.jsx("input",{type:"text",value:s.notes||"",onChange:t=>P(u,s.id,"notes",t.target.value),placeholder:"Form cues, modifications, warnings...",className:"input-field w-full text-xs py-1.5 px-2 bg-iron-800/30 placeholder:text-iron-600"})})]},s.id)),e.jsxs("button",{onClick:()=>$(u),className:"w-full py-3 border border-dashed border-iron-700 rounded-lg text-iron-400 hover:text-iron-200 hover:border-iron-600 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Add Exercise"]})]})]})]}),e.jsxs("div",{className:"bg-iron-900 border-t border-iron-800 p-4 flex gap-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>te(!1),className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:q||!ue.trim()||L.length===0,className:"btn-primary flex-1 disabled:opacity-50",children:q?F?"Saving...":"Creating...":F?"Save Changes":`Assign to ${L.length} Member${L.length!==1?"s":""}`})]})]})}),We&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-iron-900 rounded-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-display text-iron-100",children:"Invite Members"}),e.jsx("button",{onClick:()=>{Z(!1),Ne(""),ne([])},className:"p-2 text-iron-400 hover:text-iron-200",children:e.jsx(Ee,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-iron-800",children:[e.jsx("button",{onClick:()=>Re("code"),className:`flex-1 py-3 text-sm font-medium transition-colors ${$e==="code"?"text-flame-400 border-b-2 border-flame-400":"text-iron-400 hover:text-iron-200"}`,children:"Share Code"}),e.jsx("button",{onClick:()=>Re("search"),className:`flex-1 py-3 text-sm font-medium transition-colors ${$e==="search"?"text-flame-400 border-b-2 border-flame-400":"text-iron-400 hover:text-iron-200"}`,children:"Search Users"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:$e==="code"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-iron-400 text-sm",children:"Share this code with people you want to invite to the group."}),e.jsxs("div",{className:"bg-iron-800/50 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-3xl font-mono font-bold text-iron-100 tracking-widest mb-4",children:(y==null?void 0:y.inviteCode)||"No code"}),e.jsx("button",{onClick:Ge,className:"btn-secondary flex items-center gap-2 mx-auto",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"w-4 h-4"}),"Copy Code"]})})]}),e.jsx("p",{className:"text-iron-500 text-xs text-center",children:"Members can join using this code in Groups → Join Group"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-iron-500"}),e.jsx("input",{type:"text",value:Ye,onChange:s=>ss(s.target.value),placeholder:"Search by name or email...",className:"input-field w-full pl-10 py-3",autoFocus:!0})]}),os?e.jsx("div",{className:"py-8 text-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-flame-500 border-t-transparent rounded-full animate-spin mx-auto"})}):Ze.length>0?e.jsx("div",{className:"space-y-2",children:Ze.map(s=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-iron-400 font-medium",children:((n=s.displayName)==null?void 0:n[0])||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-iron-100 font-medium",children:s.displayName}),e.jsx("p",{className:"text-iron-500 text-sm",children:s.email})]})]}),e.jsx("button",{onClick:()=>r(s.uid),disabled:Pe===s.uid,className:"btn-primary text-sm py-2 px-4 disabled:opacity-50",children:Pe===s.uid?"Adding...":"Add"})]},s.uid)})}):Ye.length>=2?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(qe,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-iron-500",children:"No users found"})]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(Ts,{className:"w-10 h-10 text-iron-700 mx-auto mb-2"}),e.jsx("p",{className:"text-iron-500",children:"Type to search for users"})]})]})})]})}),e.jsx(ot,{isOpen:cs,onClose:()=>pe(!1),group:y,athletes:z,coachId:g.uid,isAdmin:X,onSuccess:()=>{Ce.getByGroup(A,g.uid).then(D).catch(s=>console.error("[GroupDetail] Refresh failed:",s))}})]}):e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8 text-center",children:[e.jsx("h2",{className:"text-xl font-display text-iron-200 mb-4",children:"Group Not Found"}),e.jsx(_e,{to:"/groups",className:"btn-primary",children:"Back to Groups"})]})}export{vt as default};
