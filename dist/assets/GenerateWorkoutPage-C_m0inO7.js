import{b as At,u as It,ap as Wt,d as Ot,r as c,V as ae,W as re,Y as ne,$ as le,a0 as J,a2 as ie,aq as Pt,j as e,K as Lt,A as Mt,B as oe,n as Xe,m as T,i as $,C as Qe,J as K,Z as Ft,ar as ce,S as ve,as as de,R as et,l as Ht,o as tt,H as Gt,X as zt,P as st,I as Bt,w as we,x as ke,a3 as Ut,at}from"./index-Lqbj01pB.js";import{E as _t}from"./ExerciseInfoModal-BAvKyQHm.js";import{P as qt}from"./pencil-DZ0f5gr2.js";import{F as Jt}from"./file-text-cKg-YLjr.js";import{T as Kt}from"./trash-2-CVhQkg2S.js";import{M as Yt}from"./message-square-KdZSQXaJ.js";import"./external-link-DUHLYFGi.js";const Se=[{text:"Reviewing your recent training sessions...",icon:"brain"},{text:"Analyzing strength progression trends...",icon:"calc"},{text:"Checking for pain history and injury risks...",icon:"alert"},{text:"Calculating working weights from your e1RM data...",icon:"calc"},{text:"Evaluating RPE patterns and recovery state...",icon:"brain"},{text:"Selecting exercises based on your focus area...",icon:"dumbbell"},{text:"Applying progressive overload to target weights...",icon:"calc"},{text:"Balancing volume with recovery capacity...",icon:"brain"},{text:"Building optimal set and rep schemes...",icon:"dumbbell"},{text:"Writing personalized coaching notes...",icon:"msg"}];function rs(){var _e;const me=At();It("Generate Workout");const[Ce]=Wt(),{user:S,userProfile:k,updateProfile:Ee,isAppAdmin:rt}=Ot(),[a]=c.useState(()=>{try{const t=Ce.get("programContext");return t?JSON.parse(t):null}catch{return null}}),[C,$e]=c.useState(!1),[Y,De]=c.useState(!0),[y,w]=c.useState(null),[Z,nt]=c.useState(null),[Re,V]=c.useState(null),[Te,Ae]=c.useState(!1),[N,Ie]=c.useState(!1),[We,X]=c.useState(null),[xe,O]=c.useState(null),[ue,P]=c.useState(""),[pe,lt]=c.useState(!1),[Oe,he]=c.useState(null),[Pe,ge]=c.useState(null),[fe,it]=c.useState(!1),[L,be]=c.useState([]),[Zt,Le]=c.useState(null),[M,D]=c.useState([]),F=c.useRef(null),A=c.useRef(null),[f,ot]=c.useState({recentWorkouts:[],goals:[],maxLifts:{},painHistory:{},rpeAverages:{},cardioHistory:[],ouraData:null}),[H,ct]=c.useState(()=>{var s;if(!a)return"";const t=[`Program: ${a.programName} — Week ${a.weekNumber} (${a.phase})`];return t.push(`Day: ${a.dayLabel} (${a.dayType})`),t.push(`Primary: ${a.primaryLift} ${a.primaryScheme} @ ${a.intensity}`),((s=a.accessories)==null?void 0:s.length)>0&&t.push(`Accessories: ${a.accessories.join(", ")}`),a.notes&&t.push(`Notes: ${a.notes}`),t.push(`
Generate this workout following the program prescription above. Use my actual performance data to calculate working weights.`),t.join(`
`)}),[v,dt]=c.useState(a?"bench":"auto"),[ye,mt]=c.useState((a==null?void 0:a.dayType)==="deload"?"recovery":(a==null?void 0:a.dayType)==="test"?"max":(a==null?void 0:a.dayType)==="speed"?"light":"moderate"),[I,Me]=c.useState("standard"),[G,xt]=c.useState("auto"),[z,ut]=c.useState("auto"),[je,pt]=c.useState(!1),[Ne,ht]=c.useState(!1),[E,Fe]=c.useState(""),[He,gt]=c.useState(()=>{const t=Ce.get("date");return t&&/^\d{4}-\d{2}-\d{2}$/.test(t)?t:new Date().toISOString().split("T")[0]}),Q=rt;c.useEffect(()=>{S&&bt()},[S]),c.useEffect(()=>{F.current&&(F.current.scrollTop=F.current.scrollHeight)},[M]),c.useEffect(()=>()=>{A.current&&clearInterval(A.current)},[]);const j=(t,s,n=null)=>{be(l=>{const x=l.findIndex(r=>r.label===t);if(x>=0){const r=[...l];return r[x]={label:t,status:s,detail:n},r}return[...l,{label:t,status:s,detail:n}]}),Le(t)},ft=()=>{D([]);let t=0;D([{...Se[0],id:0}]),t=1,A.current=setInterval(()=>{t<Se.length?(D(s=>[...s,{...Se[t],id:t}]),t++):D(s=>[...s,{text:"Finalizing your workout...",icon:"brain",id:s.length}])},2e3)},Ge=()=>{A.current&&(clearInterval(A.current),A.current=null)},ze=t=>{switch(t){case"brain":return e.jsx(oe,{className:"w-3 h-3 text-flame-400"});case"alert":return e.jsx(K,{className:"w-3 h-3 text-amber-400"});case"calc":return e.jsx(ve,{className:"w-3 h-3 text-purple-400"});case"dumbbell":return e.jsx(Bt,{className:"w-3 h-3 text-cyan-400"});case"msg":return e.jsx(Yt,{className:"w-3 h-3 text-blue-400"});case"check":return e.jsx(Qe,{className:"w-3 h-3 text-green-400"});case"error":return e.jsx(K,{className:"w-3 h-3 text-red-400"});default:return e.jsx($,{className:"w-3 h-3 text-flame-400 animate-spin"})}},bt=async()=>{var t,s,n,l;try{De(!0),be([]);const x=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let r=[];j("Loading workout history","loading");try{(await ae(re(ne(le,"workouts"),J("userId","==",S.uid),ie(50)))).docs.forEach(m=>{var h,u;const p=m.data();if(p.status==="completed"){const g=((u=(h=p.date)==null?void 0:h.toDate)==null?void 0:u.call(h))||new Date(p.date);r.push({...p,date:g.toISOString().split("T")[0],dayOfWeek:x[g.getDay()]})}})}catch(d){console.error(d)}try{(await ae(re(ne(le,"groupWorkouts"),J("assignedTo","==",S.uid),ie(50)))).docs.forEach(m=>{var h,u;const p=m.data();if(p.status==="completed"){const g=((u=(h=p.date)==null?void 0:h.toDate)==null?void 0:u.call(h))||new Date(p.date);r.push({...p,date:g.toISOString().split("T")[0],dayOfWeek:x[g.getDay()]})}})}catch(d){console.error(d)}r.sort((d,m)=>new Date(m.date||0)-new Date(d.date||0)),r=r.slice(0,20),j("Loading workout history","complete",`${r.length} workouts found`),j("Analyzing max lifts","loading");const i={},o={},b={},B=new Date;r.forEach(d=>{var h;const m=(h=d.date)!=null&&h.toDate?d.date.toDate():d.date?new Date(d.date):null,p=m&&!isNaN(m.getTime())?Math.floor((B-m)/(1e3*60*60*24)):null;(d.exercises||[]).forEach(u=>{u.name&&(u.sets||[]).forEach(g=>{const W=parseFloat(g.actualWeight)||parseFloat(g.prescribedWeight)||0,se=parseInt(g.actualReps)||parseInt(g.prescribedReps)||0,Ye=parseInt(g.rpe)||0,Ze=parseInt(g.painLevel)||0;if(!(!g.actualWeight&&!g.actualReps&&g.prescribedWeight)){if(W>0&&se>0&&se<=12){const Ve=Math.round(W*(1+se/30));(!i[u.name]||Ve>i[u.name].e1rm)&&(i[u.name]={weight:W,reps:se,e1rm:Ve})}Ze>0&&(o[u.name]||(o[u.name]={count:0,maxPain:0,lastDaysAgo:null,recentCount:0}),o[u.name].count++,o[u.name].maxPain=Math.max(o[u.name].maxPain,Ze),p!==null&&((o[u.name].lastDaysAgo===null||p<o[u.name].lastDaysAgo)&&(o[u.name].lastDaysAgo=p),p<=30&&o[u.name].recentCount++)),Ye>0&&(b[u.name]||(b[u.name]={total:0,count:0}),b[u.name].total+=Ye,b[u.name].count++)}})})});const qe=Object.keys(i).length,Rt=Object.entries(i).sort((d,m)=>m[1].e1rm-d[1].e1rm).slice(0,3).map(([d,m])=>`${d}: ${m.e1rm}lb`);j("Analyzing max lifts","complete",qe>0?`${qe} lifts tracked. Top: ${Rt.join(", ")}`:"No lift data found");const U=k==null?void 0:k.aiContextOverrides;U&&(U.maxLifts&&Object.entries(U.maxLifts).forEach(([d,m])=>{i[d]={...i[d]||{},...m}}),U.excludeExercises&&U.excludeExercises.forEach(d=>{const m=d.toLowerCase();Object.keys(i).forEach(p=>{const h=p.toLowerCase();(m===h||h.includes(m)||m.includes(h))&&delete i[p]})})),j("Checking pain history","loading");const Je=Object.keys(o).length,Tt=Object.keys(o).slice(0,3).join(", ");j("Checking pain history",Je>0?"warning":"complete",Je>0?`Pain flagged on: ${Tt}`:"No pain history"),j("Analyzing RPE patterns","loading");const _={};Object.entries(b).forEach(([d,m])=>{_[d]=Math.round(m.total/m.count*10)/10});const Ke=Object.values(_).length>0?(Object.values(_).reduce((d,m)=>d+m,0)/Object.values(_).length).toFixed(1):null;j("Analyzing RPE patterns","complete",Ke?`Average RPE: ${Ke}`:"No RPE data"),j("Loading goals","loading");let te=[];try{te=(await ae(re(ne(le,"goals"),J("userId","==",S.uid),ie(10)))).docs.map(m=>m.data()).filter(m=>m.status==="active")}catch(d){console.error(d)}j("Loading goals","complete",te.length>0?`${te.length} active goals`:"No active goals"),j("Loading cardio history","loading");let R=[];try{R=(await ae(re(ne(le,"workouts"),J("userId","==",S.uid),J("workoutType","==","cardio"),ie(20)))).docs.map(m=>{var h,u,g,W;const p=m.data();return{...p,date:((W=(g=(u=(h=p.date)==null?void 0:h.toDate)==null?void 0:u.call(h))==null?void 0:g.toISOString)==null?void 0:W.call(g).split("T")[0])||p.date}}),R.sort((m,p)=>new Date(p.date||0)-new Date(m.date||0)),R=R.slice(0,10)}catch(d){console.error(d)}j("Loading cardio history","complete",R.length>0?`${R.length} recent cardio sessions`:"No cardio data");let q=null;try{q=await Pt.getLatestScores(S.uid),q&&j("Loading Oura data","complete",`Readiness: ${((s=(t=q.latest)==null?void 0:t.readiness)==null?void 0:s.score)||"—"}, Sleep: ${((l=(n=q.latest)==null?void 0:n.sleep)==null?void 0:l.score)||"—"}`)}catch{}ot({recentWorkouts:r,goals:te,maxLifts:i,painHistory:o,rpeAverages:_,cardioHistory:R,ouraData:q}),Le(null)}catch(x){console.error("Error loading context:",x)}finally{De(!1)}},yt=async()=>{var n;const t=(k==null?void 0:k.credits)??0,s=I==="premium"?de:ce["generate-workout"];if(!Q&&t<s){V(`Not enough credits. You need ${s} credits but have ${t}. Check Settings for your usage.`);return}$e(!0),V(null),j("Generating workout","loading"),ft();try{Q||Ee({credits:t-s});const l=await we(),x=await fetch(ke("generate-workout"),{method:"POST",headers:l,body:JSON.stringify({prompt:H,workoutFocus:v,intensity:ye,model:I,includeWarmup:je,includeStretches:Ne,duration:G!=="auto"?parseInt(G):null,exerciseCount:z!=="auto"?parseInt(z):null,maxExercise:v==="1rm-test"?E:null,draftMode:!0,context:{recentWorkouts:f.recentWorkouts.slice(0,5),goals:f.goals,maxLifts:f.maxLifts,painHistory:f.painHistory,rpeAverages:f.rpeAverages,cardioHistory:f.cardioHistory,ouraData:f.ouraData}})});if(!x.ok){const i=await x.json().catch(()=>({}));throw new Error(i.error||"Failed to generate workout")}const r=await x.json();w(r.workout),nt(r.usage),Ge(),D(i=>[...i,{text:"Workout ready!",icon:"check",id:i.length}]),j("Generating workout","complete",`Created in ${(n=r.usage)==null?void 0:n.responseMs}ms`)}catch(l){console.error("Generation error:",l),V(l.message),Q||Ee({credits:t}),Ge(),D(x=>[...x,{text:`Error: ${l.message}`,icon:"error",id:x.length}]),j("Generating workout","error",l.message)}finally{$e(!1)}},jt=async()=>{if(y){Ae(!0);try{const t={...y,date:new Date(He+"T12:00:00"),status:"scheduled"};a&&(t.programId=a.programId,t.programWeek=a.weekNumber,t.programDayLabel=a.dayLabel);const s=await Ut.create(S.uid,t);if(a!=null&&a.programId&&(a!=null&&a.dayKey))try{const n=await at.get(a.programId);if(n){const l=[...n.completedDays||[],a.dayKey];await at.update(a.programId,{completedDays:l})}}catch(n){console.error("Failed to mark program day complete:",n)}me(`/workouts/${s.id}`)}catch(t){console.error("Save error:",t),V("Failed to save workout")}finally{Ae(!1)}}},Nt=(t,s)=>{w(n=>({...n,exercises:n.exercises.map((l,x)=>x===t?{...l,name:s}:l)}))},ee=(t,s,n,l)=>{w(x=>({...x,exercises:x.exercises.map((r,i)=>i===t?{...r,sets:r.sets.map((o,b)=>b===s?{...o,[n]:l}:o)}:r)}))},vt=t=>{w(s=>({...s,exercises:s.exercises.filter((n,l)=>l!==t)}))},wt=t=>{w(s=>({...s,exercises:s.exercises.map((n,l)=>{if(l!==t)return n;const x=n.sets[n.sets.length-1]||{};return{...n,sets:[...n.sets,{...x,id:Date.now(),completed:!1}]}})}))},kt=(t,s)=>{w(n=>({...n,exercises:n.exercises.map((l,x)=>x===t?{...l,sets:l.sets.filter((r,i)=>i!==s)}:l)}))},Be=async(t,s)=>{const n=y.exercises[t];if(n){X(t);try{const l=y.exercises.filter((o,b)=>b!==t).map(o=>o.name),x=await we(),r=await fetch(ke("swap-exercise"),{method:"POST",headers:x,body:JSON.stringify({exerciseName:n.name,exerciseType:n.type||"weight",sets:n.sets,workoutContext:{otherExercises:l},...s?{reason:s}:{}})});if(!r.ok)throw new Error("Swap failed");const i=await r.json();i.exercise&&w(o=>({...o,exercises:o.exercises.map((b,B)=>B===t?{...i.exercise,type:i.exercise.type||b.type||"weight"}:b)}))}catch(l){console.error("Swap error:",l)}finally{X(null)}}},St=async(t,s)=>{const n=y.exercises[t];if(n){X(t),he(null),ge(null);try{const l=y.exercises.filter((o,b)=>b!==t).map(o=>o.name),x=await we(),r=await fetch(ke("swap-exercise"),{method:"POST",headers:x,body:JSON.stringify({exerciseName:n.name,exerciseType:n.type||"weight",sets:n.sets,workoutContext:{otherExercises:l},preferredReplacement:s})});if(!r.ok)throw new Error("Swap failed");const i=await r.json();i.exercise&&w(o=>({...o,exercises:o.exercises.map((b,B)=>B===t?{...i.exercise,type:i.exercise.type||b.type||"weight"}:b)}))}catch(l){console.error("Substitution swap error:",l)}finally{X(null)}}},Ue=()=>{w(null),Ie(!1),D([]),be(t=>t.filter(s=>s.label!=="Generating workout"))},Ct=t=>{const s=t.type||"weight";return s==="time"?{label:"Time",color:"bg-blue-500/20 text-blue-400"}:s==="bodyweight"?{label:"BW",color:"bg-emerald-500/20 text-emerald-400"}:null},Et=(t,s)=>s==="time"?`${t.prescribedTime||"?"}s`:s==="bodyweight"?`${t.prescribedReps||"?"} reps`:`${t.prescribedWeight?`${t.prescribedWeight} lbs × `:""}${t.prescribedReps||"?"} reps`,$t=[{value:"auto",label:"Auto"},{value:"push",label:"Push"},{value:"pull",label:"Pull"},{value:"legs",label:"Legs"},{value:"upper",label:"Upper"},{value:"full",label:"Full Body"},{value:"bench",label:"Bench Focus"},{value:"core",label:"Core"},{value:"no-equipment",label:"Bodyweight"},{value:"vacation",label:"Hotel / Travel"},{value:"1rm-test",label:"Test 1RM"}],Dt=[{value:"light",label:"Light",desc:"RPE 5-6"},{value:"moderate",label:"Moderate",desc:"RPE 7-8"},{value:"heavy",label:"Heavy",desc:"RPE 8-9"},{value:"max",label:"Max",desc:"RPE 9-10"}];return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[a&&e.jsxs("div",{className:"mb-4 p-3 bg-flame-500/10 border border-flame-500/20 rounded-xl flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-flame-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Lt,{className:"w-4 h-4 text-flame-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-flame-300",children:a.programName}),e.jsxs("p",{className:"text-xs text-iron-400",children:["Week ",a.weekNumber," · ",a.phase," · ",a.dayLabel]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-medium border ${{primary:"bg-flame-500/20 text-flame-400 border-flame-500/30",volume:"bg-blue-500/20 text-blue-400 border-blue-500/30",speed:"bg-cyan-500/20 text-cyan-400 border-cyan-500/30",deload:"bg-green-500/20 text-green-400 border-green-500/30",test:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"}[a.dayType]||"bg-iron-800 text-iron-400 border-iron-700"}`,children:a.dayType})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>me(a?`/programs/${a.programId}`:"/workouts"),className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-xl transition-colors",children:e.jsx(Mt,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-display text-2xl text-iron-50",children:a?"Generate Program Workout":"AI Generate Workout"}),e.jsx("p",{className:"text-iron-400 mt-1",children:a?`${a.primaryLift} ${a.primaryScheme} @ ${a.intensity}`:"Personalized based on your training history"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 order-2 lg:order-1",children:e.jsxs("div",{className:"card-steel rounded-xl p-4",children:[e.jsxs("button",{onClick:()=>lt(!pe),className:"flex items-center gap-2 w-full lg:cursor-default",children:[e.jsx(oe,{className:"w-5 h-5 text-flame-400"}),e.jsx("h3",{className:"font-medium text-iron-200 flex-1 text-left",children:"Analysis"}),!Y&&L.length>0&&e.jsxs("span",{className:"text-xs text-iron-500 lg:hidden",children:[L.filter(t=>t.status==="complete").length,"/",L.length]}),e.jsx(Xe,{className:`w-4 h-4 text-iron-500 lg:hidden transition-transform ${pe?"rotate-180":""}`})]}),e.jsxs("div",{className:`${pe?"":"hidden"} lg:block mt-4`,children:[e.jsxs("div",{className:"space-y-3",children:[L.map((t,s)=>e.jsxs(T.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:t.status==="loading"?e.jsx($,{className:"w-4 h-4 text-flame-400 animate-spin"}):t.status==="complete"?e.jsx(Qe,{className:"w-4 h-4 text-green-400"}):t.status==="warning"?e.jsx(K,{className:"w-4 h-4 text-amber-400"}):e.jsx(K,{className:"w-4 h-4 text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-iron-200",children:t.label}),t.detail&&e.jsx("p",{className:"text-xs text-iron-500 mt-0.5 truncate",children:t.detail})]})]},t.label)),L.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-iron-500",children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Starting analysis..."})]})]}),(C||M.length>0)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C&&e.jsx($,{className:"w-3 h-3 text-flame-400 animate-spin"}),e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wider",children:C?"AI Thinking...":"AI Process"})]}),e.jsxs("div",{ref:F,className:"max-h-44 overflow-y-auto space-y-1.5",children:[M.map(t=>e.jsxs(T.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:ze(t.icon)}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t.text})]},t.id)),C&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1 h-1 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]}),!Y&&!C&&M.length===0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-iron-800",children:[e.jsx("p",{className:"text-xs text-iron-500 uppercase tracking-wide mb-3",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:f.recentWorkouts.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Workouts"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.keys(f.maxLifts).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Lifts Tracked"})]}),e.jsxs("div",{className:"bg-iron-800/50 rounded-lg p-2",children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:f.goals.length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Goals"})]}),e.jsxs("div",{className:`bg-iron-800/50 rounded-lg p-2 ${Object.keys(f.painHistory).length>0?"border border-amber-500/30":""}`,children:[e.jsx("p",{className:"text-lg font-semibold text-iron-100",children:Object.keys(f.painHistory).length}),e.jsx("p",{className:"text-xs text-iron-500",children:"Pain Flags"})]})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2 order-1 lg:order-2",children:C?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-iron-800/30 rounded-xl border border-flame-500/20 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-iron-700/50 bg-flame-500/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-flame-500/20 flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-flame-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"AI is generating your workout..."}),e.jsxs("p",{className:"text-xs text-iron-500",children:[v!=="auto"?v:"Auto"," · ",ye," intensity",G!=="auto"?` · ${G}min`:"",z!=="auto"?` · ${z} exercises`:"",H?` · "${H.slice(0,40)}${H.length>40?"...":""}"`:""]})]}),e.jsx($,{className:"w-5 h-5 text-flame-400 animate-spin ml-auto"})]}),e.jsxs("div",{ref:F,className:"p-4 max-h-[400px] overflow-y-auto space-y-2.5 scrollbar-thin",children:[M.map(t=>e.jsxs(T.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},className:"flex items-start gap-3 py-1",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0 w-5 h-5 rounded bg-iron-800 flex items-center justify-center",children:ze(t.icon)}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:t.text})]},t.id)),e.jsxs("div",{className:"flex items-center gap-1.5 pt-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"w-1.5 h-1.5 bg-flame-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]})]})}):y?e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-400 font-medium",children:"Draft"})}),N?e.jsx("input",{type:"text",value:y.name,onChange:t=>w(s=>({...s,name:t.target.value})),className:"input-field w-full text-xl font-semibold"}):e.jsx("h2",{className:"text-xl font-semibold text-iron-100",children:y.name}),y.description&&!N&&e.jsx("p",{className:"text-iron-400 mt-1",children:y.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ie(!N),className:`p-2 rounded-xl transition-colors ${N?"text-flame-400 bg-flame-500/10":"text-iron-400 hover:text-iron-200 hover:bg-iron-800"}`,title:N?"Done editing":"Edit workout",children:e.jsx(qt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Ue,className:"p-2 text-iron-400 hover:text-iron-200 hover:bg-iron-800 rounded-xl",title:"Start over",children:e.jsx(et,{className:"w-5 h-5"})})]})]}),Z&&e.jsxs("p",{className:"text-xs text-iron-600 mt-2",children:[Z.tokens," tokens · ",Z.responseMs,"ms · ",Z.cost]})]}),y.notes&&!N&&e.jsxs("div",{className:"border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2 px-6 pt-3",children:[e.jsx(oe,{className:"w-4 h-4 text-flame-400"}),e.jsx("span",{className:"text-xs text-iron-500 uppercase tracking-wider",children:"Coaching Notes"})]}),e.jsx("div",{className:"px-6 py-3 max-h-32 overflow-y-auto",children:e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:y.notes})})]}),y.generationPrompt&&!N&&e.jsxs("div",{className:"border-b border-iron-800",children:[e.jsxs("button",{onClick:()=>it(!fe),className:"w-full flex items-center justify-between px-6 py-3 hover:bg-iron-800/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-iron-500"}),e.jsx("span",{className:"text-sm font-medium text-iron-200",children:"Generation Prompt"})]}),fe?e.jsx(Ht,{className:"w-4 h-4 text-iron-500"}):e.jsx(Xe,{className:"w-4 h-4 text-iron-500"})]}),e.jsx(tt,{children:fe&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"px-6 pb-3",children:e.jsx("pre",{className:"text-xs text-iron-400 leading-relaxed whitespace-pre-wrap font-mono max-h-96 overflow-y-auto",children:y.generationPrompt})})})})]}),e.jsx("div",{className:"divide-y divide-iron-800",children:(_e=y.exercises)==null?void 0:_e.map((t,s)=>{var x;const n=Ct(t),l=t.type||"weight";return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-iron-800 flex items-center justify-center text-iron-400 text-sm font-medium",children:s+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[N?e.jsx("input",{type:"text",value:t.name,onChange:r=>Nt(s,r.target.value),className:"input-field w-full text-sm font-medium"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{he(t),ge(s)},className:"font-medium text-iron-100 hover:text-flame-400 transition-colors text-left flex items-center gap-1.5",children:[t.name,e.jsx(Gt,{className:"w-3.5 h-3.5 text-iron-600 flex-shrink-0"})]}),n&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${n.color}`,children:n.label})]}),t.notes&&!N&&e.jsx("p",{className:"text-xs text-iron-500 mt-0.5",children:t.notes})]}),!N&&e.jsx("button",{onClick:()=>O(s),disabled:We!==null,title:"Swap for similar exercise",className:"p-1.5 text-iron-500 hover:text-flame-400 hover:bg-flame-500/10 rounded-lg transition-colors disabled:opacity-30",children:We===s?e.jsx($,{className:"w-4 h-4 animate-spin text-flame-400"}):e.jsx(et,{className:"w-4 h-4"})}),N&&e.jsx("button",{onClick:()=>vt(s),className:"p-1.5 text-red-400 hover:bg-red-500/10 rounded-lg",children:e.jsx(Kt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"ml-11 space-y-1",children:[(x=t.sets)==null?void 0:x.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-iron-500 w-12",children:["Set ",i+1]}),N?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[l==="time"?e.jsx("input",{type:"text",value:r.prescribedTime||"",onChange:o=>ee(s,i,"prescribedTime",o.target.value),className:"input-field w-20 text-sm py-1",placeholder:"sec"}):l==="bodyweight"?e.jsx("input",{type:"text",value:r.prescribedReps||"",onChange:o=>ee(s,i,"prescribedReps",o.target.value),className:"input-field w-20 text-sm py-1",placeholder:"reps"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:r.prescribedWeight||"",onChange:o=>ee(s,i,"prescribedWeight",o.target.value),className:"input-field w-20 text-sm py-1",placeholder:"lbs"}),e.jsx("span",{className:"text-iron-500",children:"×"}),e.jsx("input",{type:"text",value:r.prescribedReps||"",onChange:o=>ee(s,i,"prescribedReps",o.target.value),className:"input-field w-20 text-sm py-1",placeholder:"reps"})]}),e.jsx("button",{onClick:()=>kt(s,i),className:"p-1 text-iron-600 hover:text-red-400",children:e.jsx(zt,{className:"w-3 h-3"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-iron-300",children:Et(r,l)}),r.targetRpe&&e.jsxs("span",{className:"text-iron-500 cursor-help",title:`RPE ${r.targetRpe}/10 effort — ${r.targetRpe>=10?"all-out, nothing left":r.targetRpe>=9?"could maybe do 1 more rep":r.targetRpe>=8?"could do ~2 more reps":r.targetRpe>=7?"could do ~3 more reps":"comfortable, 4+ reps in reserve"}`,children:["@ RPE ",r.targetRpe]})]})]},i)),N&&e.jsxs("button",{onClick:()=>wt(s),className:"text-xs text-flame-400 hover:text-flame-300 mt-1 flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"})," Add set"]})]})]},s)})}),e.jsxs("div",{className:"p-4 border-t border-iron-800 flex gap-3",children:[e.jsx("button",{onClick:Ue,className:"btn-secondary flex-1",children:"Regenerate"}),e.jsx("button",{onClick:jt,disabled:Te,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:Te?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-5 h-5"}),"Add to Workouts"]})})]})]}):e.jsxs("div",{className:"card-steel rounded-xl p-4",children:[e.jsx("h3",{className:"font-medium text-iron-200 mb-3",children:"Workout Options"}),!Y&&Object.keys(f.maxLifts).length===0&&e.jsxs("div",{className:"mb-3 p-2.5 bg-amber-500/10 border border-amber-500/20 rounded-lg flex items-start gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-300",children:"No training data yet"}),e.jsx("p",{className:"text-xs text-iron-500",children:"Weights will be set conservatively. Log a workout first for personalized loads."})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Describe your workout (optional)"}),e.jsx("textarea",{value:H,onChange:t=>ct(t.target.value),placeholder:"e.g., 'Heavy bench day with tricep accessories'",className:"input-field w-full min-h-[60px] resize-none text-sm"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Style"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$t.map(t=>e.jsxs("button",{onClick:()=>{dt(t.value),t.value!=="1rm-test"&&Fe("")},className:`px-3 py-1.5 text-sm rounded-lg border transition-colors
                        ${v===t.value?t.value==="1rm-test"?"border-yellow-500 bg-yellow-500/10 text-yellow-400":"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[t.label,t.value==="1rm-test"&&e.jsx("span",{className:"ml-1 text-[9px] px-1 py-0.5 rounded-full bg-green-500/20 text-green-400 font-medium leading-none",children:"New"})]},t.value))}),v==="auto"&&e.jsx("p",{className:"text-[11px] text-iron-600 mt-2",children:"Auto selects exercises from your logged workouts and adjusts weights based on recent performance. The more you log, the more variety you'll get."})]}),v==="1rm-test"&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-500/5 border border-yellow-500/20 rounded-xl",children:[e.jsx("label",{className:"block text-sm text-yellow-400 mb-2",children:"Which lift are you testing?"}),e.jsx("input",{type:"text",value:E,onChange:t=>Fe(t.target.value),placeholder:"e.g. Bench Press, Squat, Deadlift...",className:"input-field w-full",list:"known-exercises"}),e.jsx("datalist",{id:"known-exercises",children:Object.keys(f.maxLifts).map(t=>e.jsx("option",{value:t},t))}),E&&f.maxLifts[E]&&e.jsxs("p",{className:"text-xs text-iron-500 mt-2",children:["Current e1RM: ",e.jsxs("span",{className:"text-iron-300",children:[f.maxLifts[E].e1rm," lbs"]}),e.jsxs("span",{className:"text-iron-600",children:[" (best: ",f.maxLifts[E].weight,"×",f.maxLifts[E].reps,")"]})]}),e.jsx("p",{className:"text-xs text-iron-600 mt-1.5",children:"AI will generate warm-up ramps, attempt protocols, and accessory cooldown."})]}),v!=="1rm-test"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"text-sm text-iron-400 mb-1.5 block",children:"Intensity"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-1.5",children:Dt.map(t=>e.jsxs("button",{onClick:()=>mt(t.value),className:`px-2 py-1.5 text-xs rounded-lg border transition-colors text-center
                        ${ye===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsx("div",{className:"font-medium",children:t.label}),e.jsx("div",{className:"text-[10px] text-iron-500",children:t.desc})]},t.value))})]}),v!=="1rm-test"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Duration"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"20",label:"20m"},{value:"30",label:"30m"},{value:"45",label:"45m"},{value:"60",label:"60m"},{value:"90",label:"90m"}].map(t=>e.jsx("button",{onClick:()=>xt(t.value),className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                          ${G===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Exercises"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{value:"auto",label:"Auto"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"},{value:"6",label:"6"},{value:"8",label:"8"}].map(t=>e.jsx("button",{onClick:()=>ut(t.value),className:`px-2.5 py-1 text-xs rounded-lg border transition-colors
                          ${z===t.value?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:t.label},t.value))})]})]}),v!=="1rm-test"&&e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>pt(!je),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${je?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Warm-up"}),e.jsx("button",{onClick:()=>ht(!Ne),className:`flex-1 px-3 py-2 text-xs rounded-lg border transition-colors text-center ${Ne?"border-flame-500/50 bg-flame-500/10 text-flame-400 font-semibold":"border-iron-700 text-iron-500 hover:border-iron-600"}`,children:"Stretches"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"Workout Date"}),e.jsx("input",{type:"date",value:He,onChange:t=>gt(t.target.value),className:"input-field text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-1.5",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>Me("standard"),className:`px-3 py-2 text-xs rounded-lg border transition-colors text-center
                        ${I==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(Ft,{className:"w-3 h-3"}),"Standard"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[ce["generate-workout"]," cr"]})]}),e.jsxs("button",{onClick:()=>Me("premium"),className:`px-3 py-2 text-xs rounded-lg border transition-colors text-center
                        ${I==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"}),"Premium"]}),e.jsxs("div",{className:"text-[10px] text-iron-500",children:[de," cr"]})]})]})]})]}),e.jsx("button",{onClick:yt,disabled:C||Y||v==="1rm-test"&&!E.trim()||!Q&&((k==null?void 0:k.credits)??0)<(I==="premium"?de:ce["generate-workout"]),className:"btn-primary w-full flex items-center justify-center gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-5 h-5"}),"Generate Workout",e.jsxs("span",{className:"text-xs opacity-70 ml-1",children:["(",I==="premium"?de:ce["generate-workout"]," credits)"]})]})}),Re&&e.jsx("p",{className:"text-red-400 text-sm mt-3 text-center",children:Re})]})})]}),e.jsx(_t,{exercise:Oe,isOpen:!!Oe,onClose:()=>{he(null),ge(null)},onSubstitute:Pe!==null?t=>St(Pe,t):void 0}),e.jsx(tt,{children:xe!==null&&e.jsxs(e.Fragment,{children:[e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{O(null),P("")},className:"fixed inset-0 bg-black/60 z-50"}),e.jsxs(T.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-x-4 top-[30%] mx-auto max-w-sm bg-iron-900 border border-iron-700 rounded-2xl z-50 p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-iron-200",children:"Swap Exercise"}),e.jsx("p",{className:"text-xs text-iron-500",children:`Optionally note why you're swapping (e.g. "shoulder pain", "no cable machine")`}),e.jsx("input",{type:"text",value:ue,onChange:t=>P(t.target.value),placeholder:"Reason (optional)",className:"input-field w-full text-sm",autoFocus:!0,onKeyDown:t=>{t.key==="Enter"&&(Be(xe,ue),O(null),P(""))}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{O(null),P("")},className:"flex-1 py-2.5 text-sm text-iron-400 hover:text-iron-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{Be(xe,ue),O(null),P("")},className:"flex-1 py-2.5 text-sm bg-flame-500/15 text-flame-400 border border-flame-500/30 rounded-xl hover:bg-flame-500/25 transition-colors",children:"Swap"})]})]})]})})]})}export{rs as default};
