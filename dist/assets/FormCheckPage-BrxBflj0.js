import{G as ft,_ as Rt,u as Ct,d as _t,r as l,W as et,a2 as tt,a1 as Pt,a0 as Fe,Y as st,V as at,aE as It,ax as Ht,$ as Ie,aS as At,x as Mt,ay as Dt,j as e,A as Ot,a4 as $t,o as ye,m as L,J as Ut,q as Gt,Z as nt,S as Wt,n as rt,a5 as He,i as Kt,aT as qt,E as it,F as lt,X as Bt,K as zt,l as Vt,aU as Xt}from"./index-DngWaF3c.js";import{P as Jt}from"./pause-jSnuuXYY.js";import{I as ot}from"./info-A1JU0cij.js";import{C as $e}from"./camera-7VptqMmQ.js";import{C as Qt}from"./clock-DjapWf3y.js";import{C as Yt}from"./check-circle-O2U5nVFK.js";import{X as Zt}from"./x-circle-DoqQqZJx.js";import{E as ct}from"./eye-off-DLex2NQd.js";import{C as dt}from"./chevron-left-CvOHcSLt.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ft("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=ft("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ss="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.32/wasm",as="https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_full/float16/1/pose_landmarker_full.task",d={NOSE:0,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28};let fe=null,ge=null,Ae=0;function ns(s){const r=Math.round(s*1e3);return Ae=Math.max(Ae+1,r),Ae}async function rs(){return fe||ge||(ge=(async()=>{try{const{PoseLandmarker:s,FilesetResolver:r}=await Rt(async()=>{const{PoseLandmarker:b,FilesetResolver:I}=await import("./vision_bundle-BNilC3Ix.js");return{PoseLandmarker:b,FilesetResolver:I}},[]),i=await r.forVisionTasks(ss),u={modelAssetPath:as};try{fe=await s.createFromOptions(i,{baseOptions:{...u,delegate:"GPU"},runningMode:"VIDEO",numPoses:1,minPoseDetectionConfidence:.65,minPosePresenceConfidence:.65})}catch{console.warn("[pose] GPU delegate failed, retrying with CPU"),fe=await s.createFromOptions(i,{baseOptions:{...u,delegate:"CPU"},runningMode:"VIDEO",numPoses:1,minPoseDetectionConfidence:.65,minPosePresenceConfidence:.65})}return fe}catch(s){throw ge=null,s}})(),ge)}const Me=.45;function oe(s,r,i){if((s.visibility??1)<Me||(r.visibility??1)<Me||(i.visibility??1)<Me)return null;const u={x:s.x-r.x,y:s.y-r.y,z:(s.z??0)-(r.z??0)},b={x:i.x-r.x,y:i.y-r.y,z:(i.z??0)-(r.z??0)},I=u.x*b.x+u.y*b.y+u.z*b.z,w=Math.sqrt(u.x**2+u.y**2+u.z**2),y=Math.sqrt(b.x**2+b.y**2+b.z**2);return!w||!y?null:Math.round(Math.acos(Math.max(-1,Math.min(1,I/(w*y))))*(180/Math.PI))}function is(s,r){const i=oe(s[d.LEFT_SHOULDER],s[d.LEFT_ELBOW],s[d.LEFT_WRIST]),u=oe(s[d.RIGHT_SHOULDER],s[d.RIGHT_ELBOW],s[d.RIGHT_WRIST]),b=oe(s[d.LEFT_HIP],s[d.LEFT_SHOULDER],s[d.LEFT_ELBOW]),I=oe(s[d.RIGHT_HIP],s[d.RIGHT_SHOULDER],s[d.RIGHT_ELBOW]),w=oe(s[d.LEFT_SHOULDER],s[d.LEFT_HIP],s[d.LEFT_KNEE]),y=oe(s[d.RIGHT_SHOULDER],s[d.RIGHT_HIP],s[d.RIGHT_KNEE]),k=oe(s[d.LEFT_HIP],s[d.LEFT_KNEE],s[d.LEFT_ANKLE]),f=oe(s[d.RIGHT_HIP],s[d.RIGHT_KNEE],s[d.RIGHT_ANKLE]),C=s[d.LEFT_WRIST],$=s[d.RIGHT_WRIST],S=[d.LEFT_SHOULDER,d.RIGHT_SHOULDER,d.LEFT_ELBOW,d.RIGHT_ELBOW].map(g=>{var H;return((H=s[g])==null?void 0:H.visibility)??0}),p=Math.round(S.reduce((g,H)=>g+H,0)/S.length*100),n=g=>s[g]?{x:s[g].x,y:s[g].y,v:s[g].visibility??1}:null,h={nose:n(d.NOSE),leftShoulder:n(d.LEFT_SHOULDER),rightShoulder:n(d.RIGHT_SHOULDER),leftElbow:n(d.LEFT_ELBOW),rightElbow:n(d.RIGHT_ELBOW),leftWrist:n(d.LEFT_WRIST),rightWrist:n(d.RIGHT_WRIST),leftHip:n(d.LEFT_HIP),rightHip:n(d.RIGHT_HIP),leftKnee:n(d.LEFT_KNEE),rightKnee:n(d.RIGHT_KNEE),leftAnkle:n(d.LEFT_ANKLE),rightAnkle:n(d.RIGHT_ANKLE)};return{timestamp:r,poseDetected:!0,confidence:p,elbowFlexion:{left:i,right:u},elbowFlare:{left:b,right:I},hipAngle:{left:w,right:y},kneeAngle:{left:k,right:f},wristPos:{left:{x:(C==null?void 0:C.x)??null,y:(C==null?void 0:C.y)??null},right:{x:($==null?void 0:$.x)??null,y:($==null?void 0:$.y)??null}},joints:h}}const be={quick:{frames:5,label:"Quick",desc:"5 frames",credits:10},standard:{frames:10,label:"Standard",desc:"10 frames",credits:15},detailed:{frames:20,label:"Detailed",desc:"20 frames",credits:25}},ls=640,os=.82,xt=50,De=["Tip: Trim your video to start right before the first rep","Tip: Film from a 45Â° angle for the most useful analysis","Tip: Side angle works best for bench press form","Tip: Keep your phone at hip height for squats and deadlifts","Tip: Wear form-fitting clothes so joint positions are visible","Tip: Good lighting makes a huge difference in analysis quality","Tip: Shorter clips (5-15s) give the best frame coverage"];function cs(s,r,i){const u=(i||"").toLowerCase(),b=u.includes("squat")||u.includes("rdl")||u.includes("deadlift")||u.includes("lunge")||u.includes("hip thrust"),I=(p,n)=>{if(p.length<=n)return p;const h=(p.length-1)/(n-1);return Array.from({length:n},(g,H)=>p[Math.round(H*h)])},w=s.filter(p=>{var n;return(n=p.pose)==null?void 0:n.poseDetected});if(w.length===0)return I(s,r);if(w.length<=r)return w;const y=w.map((p,n)=>{var ce,z,ne,U,ee,X,ae,o,J,re,F,c,E,ie;const h=(ce=w[n-1])==null?void 0:ce.pose,g=(z=w[n+1])==null?void 0:z.pose;let H=(p.pose.confidence||0)*.5;const K=(V,le,te)=>V==null||le==null||te==null?0:V<=le&&V<=te||V>=le&&V>=te?80:0;return H+=K((ne=p.pose.elbowFlexion)==null?void 0:ne.left,(U=h==null?void 0:h.elbowFlexion)==null?void 0:U.left,(ee=g==null?void 0:g.elbowFlexion)==null?void 0:ee.left),H+=K((X=p.pose.elbowFlexion)==null?void 0:X.right,(ae=h==null?void 0:h.elbowFlexion)==null?void 0:ae.right,(o=g==null?void 0:g.elbowFlexion)==null?void 0:o.right),b&&(H+=K((J=p.pose.kneeAngle)==null?void 0:J.left,(re=h==null?void 0:h.kneeAngle)==null?void 0:re.left,(F=g==null?void 0:g.kneeAngle)==null?void 0:F.left)*1.5,H+=K((c=p.pose.hipAngle)==null?void 0:c.left,(E=h==null?void 0:h.hipAngle)==null?void 0:E.left,(ie=g==null?void 0:g.hipAngle)==null?void 0:ie.left)),{frame:p,score:H}}),k=[w[0]],f=new Set([w[0].timestamp]);w.length>1&&(k.push(w[w.length-1]),f.add(w[w.length-1].timestamp));const $=(s[s.length-1].timestamp-s[0].timestamp)/(r*2),S=[...y].sort((p,n)=>n.score-p.score);for(const{frame:p}of S){if(k.length>=r)break;f.has(p.timestamp)||k.some(n=>Math.abs(n.timestamp-p.timestamp)<$)||(k.push(p),f.add(p.timestamp))}return k.sort((p,n)=>p.timestamp-n.timestamp)}function ve(s){return s>=8?"text-green-400":s>=6?"text-yellow-400":s>=4?"text-orange-400":"text-red-400"}function Oe(s){return s>=8?"bg-green-500/20":s>=6?"bg-yellow-500/20":s>=4?"bg-orange-500/20":"bg-red-500/20"}function ht(s){return s>=8?"bg-green-500":s>=6?"bg-yellow-500":s>=4?"bg-orange-500":"bg-red-500"}function mt(s){return s>=8?"bg-green-500/30":s>=6?"bg-yellow-500/30":s>=4?"bg-orange-500/30":"bg-red-500/30"}function ds(s){return s>=9?"Excellent":s>=8?"Great":s>=7?"Good":s>=6?"Decent":s>=5?"Needs Work":s>=4?"Poor":s>=2?"Dangerous":"N/A"}function xs(s){return s==="high"?"text-red-400 bg-red-500/15 border-red-500/30":s==="medium"?"text-orange-400 bg-orange-500/15 border-orange-500/30":"text-yellow-400 bg-yellow-500/15 border-yellow-500/30"}function hs(s){return s==="high"?"ðŸ”´":s==="medium"?"ðŸŸ¡":"ðŸŸ¢"}const ms={"bench press":{angle:"Side view",height:"Chest height",mode:"Landscape",tip:"Place phone on the floor beside the bench pointing toward you â€” level with your chest"},"front squat":{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Set phone on a rack safety bar or box to your right or left at hip height"},squat:{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Set phone on a rack safety bar or box to your right or left at hip height"},"romanian deadlift":{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Same as deadlift â€” side profile at hip height shows the hip hinge and back angle best"},rdl:{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Same as deadlift â€” side profile at hip height shows the hip hinge and back angle best"},deadlift:{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Set phone on a box or plate stack to your side â€” hip height gives the clearest bar path"},"overhead press":{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Side view shows bar path and lockout position clearly"},"barbell row":{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Side view shows your hinge angle and elbow drive path"},"pull-up":{angle:"Front view",height:"Chest height",mode:"Portrait",tip:"Face the camera â€” place phone 2â€“3m in front on a surface at chest height"},"chin-up":{angle:"Front view",height:"Chest height",mode:"Portrait",tip:"Face the camera â€” place phone 2â€“3m in front on a surface at chest height"},"hip thrust":{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Side view shows lockout and bar position over hips most clearly"},lunge:{angle:"Side view",height:"Hip height",mode:"Landscape",tip:"Side view shows step length, knee tracking, and torso angle"}};function us({exercise:s}){var u;const r=(s||"").toLowerCase(),i=((u=Object.entries(ms).find(([b])=>r.includes(b)))==null?void 0:u[1])||{angle:"45Â° or side view",height:"Hip height",mode:"Landscape",tip:"Side view gives the most accurate joint angle measurements â€” set your phone at hip height"};return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-blue-500/5 border border-blue-500/20",children:[e.jsx($e,{className:"w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-blue-300 mb-1",children:"Camera Placement"}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed mb-2",children:i.tip}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[i.angle,i.height,i.mode].map(b=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-blue-500/10 border border-blue-500/20 rounded-full text-blue-300",children:b},b))})]})]})}const ps=[["leftShoulder","rightShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["leftShoulder","leftHip"],["rightShoulder","rightHip"],["leftHip","rightHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]];function ut({dataUrl:s,joints:r,metrics:i,exercise:u,show:b}){const I=l.useRef(null),w=l.useRef(null),y=l.useRef(null),k=l.useCallback(()=>{var E,ie,V,le,te,he;const f=w.current,C=y.current,$=I.current;if(!f||!$)return;const S=$.offsetWidth,p=$.offsetHeight;if(!S||!p)return;const n=window.devicePixelRatio||1;f.width=S*n,f.height=p*n;const h=f.getContext("2d");if(h.scale(n,n),h.clearRect(0,0,S,p),!b||!r||!(C!=null&&C.naturalWidth))return;const g=C.naturalWidth,H=C.naturalHeight,K=Math.min(S/g,p/H),ce=g*K,z=H*K,ne=(S-ce)/2,U=(p-z)/2,ee=v=>v?{x:v.x*ce+ne,y:v.y*z+U,v:v.v??1}:null,X=Math.max(1.5,S/220);h.lineWidth=X,ps.forEach(([v,W])=>{const Q=ee(r[v]),O=ee(r[W]);if(!Q||!O||Q.v<.25||O.v<.25)return;const de=Math.min(.8,(Q.v+O.v)/2);h.strokeStyle=`rgba(255,255,255,${de})`,h.beginPath(),h.moveTo(Q.x,Q.y),h.lineTo(O.x,O.y),h.stroke()});const ae=Math.max(3,S/130);if(Object.values(r).forEach(v=>{if(!v||v.v<.3)return;const W=ee(v);W&&(h.fillStyle=`rgba(251,146,60,${Math.min(.95,v.v)})`,h.beginPath(),h.arc(W.x,W.y,ae,0,Math.PI*2),h.fill())}),!i)return;const o=(u||"").toLowerCase(),J=Math.max(10,Math.round(S/42));h.font=`bold ${J}px monospace`,h.textBaseline="top";const re=o.includes("bench")?v=>v>=80&&v<=105?"#4ade80":v>=65&&v<=120?"#facc15":"#f87171":()=>"#94a3b8",F=o.includes("squat")||o.includes("deadlift")||o.includes("rdl")?v=>v<=90?"#4ade80":v<=115?"#facc15":"#f87171":()=>"#94a3b8",c=(v,W,Q)=>{var ue;if(!W||!r[v]||(((ue=r[v])==null?void 0:ue.v)??0)<.4)return;const O=ee(r[v]);if(!O)return;const de=`${W}Â°`,xe=Q(W),je=h.measureText(de).width,Y=3,me=O.x+ae+4,Ne=O.y-J/2-Y;h.fillStyle="rgba(0,0,0,0.72)",h.fillRect(me-Y,Ne,je+Y*2,J+Y*2),h.fillStyle=xe,h.fillText(de,me,Ne+Y)};c("leftElbow",(E=i==null?void 0:i.elbowFlexion)==null?void 0:E.left,re),c("rightElbow",(ie=i==null?void 0:i.elbowFlexion)==null?void 0:ie.right,re),c("leftKnee",(V=i==null?void 0:i.kneeAngle)==null?void 0:V.left,F),c("rightKnee",(le=i==null?void 0:i.kneeAngle)==null?void 0:le.right,F),c("leftHip",(te=i==null?void 0:i.hipAngle)==null?void 0:te.left,()=>"#94a3b8"),c("rightHip",(he=i==null?void 0:i.hipAngle)==null?void 0:he.right,()=>"#94a3b8")},[r,i,u,b]);return l.useEffect(()=>{const f=y.current;f!=null&&f.complete&&f.naturalWidth&&k()},[k]),e.jsxs("div",{ref:I,className:"relative w-full aspect-video bg-black",children:[e.jsx("img",{ref:y,src:s,alt:"Frame",className:"w-full h-full object-contain",onLoad:k}),e.jsx("canvas",{ref:w,className:"absolute inset-0 pointer-events-none",style:{width:"100%",height:"100%"}})]})}function fs({score:s,size:r=100}){const i=(r-12)/2,u=2*Math.PI*i,b=u*(1-Math.min(s/10,1)),I=s>=8?"#4ade80":s>=6?"#facc15":s>=4?"#fb923c":"#f87171";return e.jsxs("div",{className:"relative flex-shrink-0",style:{width:r,height:r},children:[e.jsxs("svg",{width:r,height:r,className:"-rotate-90",children:[e.jsx("circle",{cx:r/2,cy:r/2,r:i,fill:"none",stroke:"rgba(255,255,255,0.06)",strokeWidth:"8"}),e.jsx(L.circle,{cx:r/2,cy:r/2,r:i,fill:"none",stroke:I,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:u,initial:{strokeDashoffset:u},animate:{strokeDashoffset:b},transition:{duration:1.2,ease:"easeOut",delay:.3}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(L.span,{className:`text-3xl font-bold font-display ${ve(s)}`,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.6,duration:.4},children:s}),e.jsx("span",{className:"text-[10px] text-iron-500 uppercase tracking-wider",children:ds(s)})]})]})}function Re({label:s,score:r,note:i}){const[u,b]=l.useState(!1),I=r>=8?"bg-green-500":r>=6?"bg-yellow-500":r>=4?"bg-orange-500":"bg-red-500";return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>i&&b(!u),className:"w-full flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-iron-400 w-16 text-right flex-shrink-0",children:s}),e.jsx("div",{className:"flex-1 h-2 bg-iron-800 rounded-full overflow-hidden",children:e.jsx(L.div,{className:`h-full rounded-full ${I}`,initial:{width:0},animate:{width:`${r/10*100}%`},transition:{duration:.8,ease:"easeOut",delay:.5}})}),e.jsx("span",{className:`text-xs font-semibold w-6 text-right ${ve(r)}`,children:r})]}),e.jsx(ye,{children:u&&i&&e.jsx(L.p,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"text-[11px] text-iron-500 ml-[76px] mt-1 overflow-hidden",children:i})})]})}function pt({phase:s}){const r={setup:"bg-blue-500/20 text-blue-400",descent:"bg-purple-500/20 text-purple-400",bottom:"bg-red-500/20 text-red-400",ascent:"bg-amber-500/20 text-amber-400",lockout:"bg-green-500/20 text-green-400",transition:"bg-iron-700/50 text-iron-400",rest:"bg-iron-700/50 text-iron-500"};return e.jsx("span",{className:`text-[10px] font-semibold px-2 py-0.5 rounded-full uppercase tracking-wide ${r[s]||r.transition}`,children:s})}function Ls(){var We,Ke,qe,Be,ze,Ve,Xe,Je,Qe;Ct("Form Check");const{user:s,isAppAdmin:r}=_t(),i=r,u=l.useRef(null),b=l.useRef(null),I=l.useRef(null),w=l.useRef(null),y=l.useRef(null),[k,f]=l.useState("upload"),[C,$]=l.useState(null),[S,p]=l.useState(null),[n,h]=l.useState([]),[g,H]=l.useState(""),[K,ce]=l.useState(""),[z,ne]=l.useState("standard"),[U,ee]=l.useState("standard"),[X,ae]=l.useState(0),[o,J]=l.useState(null),[re,F]=l.useState(null),[c,E]=l.useState(0),[ie,V]=l.useState(!1),[le,te]=l.useState(!1),[he,v]=l.useState(0),[W,Q]=l.useState(!1),[O,de]=l.useState([]),[xe,je]=l.useState([]),[Y,me]=l.useState(!0),[Ne,ue]=l.useState(!1),[gt,we]=l.useState(""),[ke,Ue]=l.useState([]),[gs,Ge]=l.useState(!1),[Ce,bt]=l.useState(!1);l.useEffect(()=>()=>{S&&URL.revokeObjectURL(S)},[S]),l.useEffect(()=>()=>{y.current&&y.current()},[]);const Se=l.useCallback(()=>{if(!s||s.uid==="guest")return;Ge(!0);const t=et(st(Ie,"formCheckJobs"),Fe("userId","==",s.uid),Fe("status","==","complete"),Pt("createdAt","desc"),tt(20));at(t).then(a=>{const x=[];a.forEach(j=>{var _,P;const N=j.data();N.analysis&&N.analysis.overallScore>0&&x.push({id:j.id,exercise:N.analysis.exercise||"Unknown",score:N.analysis.overallScore||0,quality:N.quality||"standard",frameCount:N.frameCount||0,createdAt:((P=(_=N.createdAt)==null?void 0:_.toDate)==null?void 0:P.call(_))||new Date,analysis:N.analysis})}),Ue(x)}).catch(a=>{console.warn("Form check history needs composite index, trying fallback:",a.message);const x=et(st(Ie,"formCheckJobs"),Fe("userId","==",s.uid),Fe("status","==","complete"),tt(20));at(x).then(j=>{const N=[];j.forEach(_=>{var m,A;const P=_.data();P.analysis&&P.analysis.overallScore>0&&N.push({id:_.id,exercise:P.analysis.exercise||"Unknown",score:P.analysis.overallScore||0,quality:P.quality||"standard",frameCount:P.frameCount||0,createdAt:((A=(m=P.createdAt)==null?void 0:m.toDate)==null?void 0:A.call(m))||new Date,analysis:P.analysis})}),N.sort((_,P)=>P.createdAt-_.createdAt),Ue(N)}).catch(j=>{console.error("Failed to load form check history:",j)})}).finally(()=>Ge(!1))},[s]);l.useEffect(()=>{Se()},[Se]),l.useEffect(()=>{if(k!=="results")return;const t=a=>{a.key==="ArrowLeft"&&c>0&&E(x=>x-1),a.key==="ArrowRight"&&c<n.length-1&&E(x=>x+1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[k,c,n.length]),l.useEffect(()=>{if(k!=="analyzing")return;const t=setInterval(()=>v(a=>(a+1)%De.length),4e3);return()=>clearInterval(t)},[k]);const Ee=l.useCallback(t=>{if(t){if(!t.type.startsWith("video/")){F("Please select a video file.");return}if(t.size>100*1024*1024){F("Video must be under 100MB.");return}F(null),$(t),p(a=>(a&&URL.revokeObjectURL(a),URL.createObjectURL(t)))}},[]),yt=l.useCallback(t=>{var a;return Ee((a=t.target.files)==null?void 0:a[0])},[Ee]),vt=l.useCallback(t=>{var a;t.preventDefault(),V(!1),Ee((a=t.dataTransfer.files)==null?void 0:a[0])},[Ee]),jt=l.useCallback(()=>{const t=w.current;t&&(t.paused?(t.play(),te(!0)):(t.pause(),te(!1)))},[]),Nt=l.useCallback(async()=>{var P;if(!S)return;const t=be[U].frames;f("extracting"),ae(0),F(null);const a=u.current,x=b.current;if(!a||!x){F("Could not initialize video processor."),f("upload");return}const j=x.getContext("2d",{willReadFrequently:!0}),N=m=>new Promise((A,T)=>{const M=setTimeout(()=>T(new Error("Frame seek timed out")),1e4),se=()=>{clearTimeout(M),a.removeEventListener("seeked",se),a.removeEventListener("error",Z),requestAnimationFrame(()=>setTimeout(A,150))},Z=()=>{clearTimeout(M),a.removeEventListener("seeked",se),a.removeEventListener("error",Z),T(new Error("Video error during seek"))};a.addEventListener("seeked",se),a.addEventListener("error",Z),a.currentTime=m}),_=()=>{const m=j.getImageData(0,0,x.width,x.height).data,A=Math.max(4,Math.floor(m.length/500))*4;let T=0,M=0;for(let R=0;R<m.length;R+=A)T+=m[R]+m[R+1]+m[R+2],M++;const se=T/(M*3);let Z=0;for(let R=0;R<m.length;R+=A){const Te=(m[R]+m[R+1]+m[R+2])/3-se;Z+=Te*Te}Z/=M;const Pe=new Set;for(let R=0;R<m.length;R+=A)Pe.add((m[R]>>4)*256+(m[R+1]>>4)*16+(m[R+2]>>4));return Z>200||Pe.size>20};try{a.src=S,await new Promise((D,G)=>{a.readyState>=1?D():(a.onloadedmetadata=D,a.onerror=()=>G(new Error("Could not load video")))});const m=a.duration;if(!m||m<=0||!isFinite(m)){F("Could not read video duration. Try a different file."),f("upload");return}we("Loading pose model...");let A=null;try{A=await rs()}catch(D){console.warn("[extract] MediaPipe unavailable, will skip pose scan:",D.message)}const T=Math.min(1,ls/a.videoWidth);x.width=Math.round(a.videoWidth*T),x.height=Math.round(a.videoHeight*T);const M=Math.min(60,Math.max(t*4,Math.ceil(m*5))),se=m/M,Z=[];for(let D=0;D<M;D++){const G=D*se;if(we(`Scanning movement... (${D+1}/${M})`),ae(Math.round((D+1)/M*90)),await N(G),j.drawImage(a,0,0,x.width,x.height),!_())continue;const pe=x.toDataURL("image/jpeg",os),Tt=pe.split(",")[1];let Ye={poseDetected:!1,timestamp:G};if(A)try{const Le=new Image;await new Promise((Lt,Ft)=>{Le.onload=Lt,Le.onerror=Ft,Le.src=pe});const Ze=(P=A.detectForVideo(Le,ns(G)).landmarks)==null?void 0:P[0];Ze&&(Ye=is(Ze,G))}catch{}Z.push({dataUrl:pe,base64:Tt,timestamp:G,pose:Ye})}if(Z.length===0){F("Could not read frames from this video. Try a different file."),f("upload");return}we("Selecting key frames...");const R=cs(Z,t,K).map((D,G)=>({...D,index:G+1})),Te=R.map(D=>{const{joints:G,...pe}=D.pose||{};return pe}),St=R.map(D=>{var G;return((G=D.pose)==null?void 0:G.joints)||null}),Et=R.map(({pose:D,...G})=>G);h(Et),de(Te),je(St),ae(100),f("preview")}catch(m){console.error("Frame extraction error:",m),F(m.message||"Could not extract frames. Try a different file."),f("upload")}},[S,U,K]),wt=l.useCallback(async()=>{if(!s||n.length===0)return;f("analyzing"),F(null),v(Math.floor(Math.random()*De.length));const t=z==="premium",a=t?xt:be[U].credits;try{if(!i&&await It.getBalance(s.uid)<a){F(`Not enough credits. You need ${a} credits.`),f("preview");return}const x=`fc_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,j=await s.getIdToken();y.current&&(y.current(),y.current=null);const N=Ht(Ie,"formCheckJobs",x);await At(N,{userId:s.uid,status:"pending",createdAt:new Date});let _=!1;const P=await fetch(Mt("analyze-form"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({jobId:x,frames:n.map(T=>T.base64),timestamps:n.map(T=>Math.round(T.timestamp*10)/10),note:g.trim()||void 0,exercise:K||void 0,model:t?"premium":"standard",quality:U,poseData:O.length>0?O:void 0})});if(!P.ok){const T=await P.json().catch(()=>({}));throw new Error(T.error||"Failed to start analysis. Please try again.")}const m=await P.json();if(m.analysis&&!m.background){_=!0,y.current&&(y.current(),y.current=null),J(m.analysis),E(0),f("results"),m.analysis.overallScore>0&&Se();return}const A=Dt(N,T=>{var se;if(_)return;const M=T.data();M&&(M.status==="complete"?(_=!0,A(),y.current=null,J(M.analysis),E(0),f("results"),((se=M.analysis)==null?void 0:se.overallScore)>0&&Se()):M.status==="error"&&(_=!0,A(),y.current=null,F(M.error||"Analysis failed. Please try again."),f("preview")))},T=>{_||(_=!0,console.error("Firestore listener error:",T),A(),y.current=null,F("Lost connection to analysis. Please try again."),f("preview"))});y.current=A,setTimeout(()=>{_||(_=!0,A(),y.current=null,f(T=>T==="analyzing"?(F("Analysis is taking longer than expected. Please try again or use fewer frames."),"preview"):T))},18e4)}catch(x){console.error("Form analysis error:",x),F(x.message||"Something went wrong. Please try again."),f("preview")}},[s,n,g,z,U,i]),_e=()=>{y.current&&(y.current(),y.current=null),f("upload"),$(null),p(t=>(t&&URL.revokeObjectURL(t),null)),h([]),H(""),ne("standard"),ee("standard"),J(null),F(null),E(0),Q(!1),de([]),je([]),we("")},q=(We=o==null?void 0:o.frames)==null?void 0:We[c],B=o==null?void 0:o.movementQuality,kt=l.useCallback(t=>{h([]),J(t.analysis),E(0),Q(!1),f("results")},[]);return e.jsxs("div",{className:"max-w-2xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[k==="results"&&e.jsx("button",{onClick:_e,className:"p-2 -ml-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(Ot,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display text-iron-100 flex items-center gap-2",children:[e.jsx($t,{className:"w-6 h-6 text-flame-400"}),"Form Check",e.jsx("span",{className:"text-[10px] font-semibold px-1.5 py-0.5 rounded-full bg-purple-500/20 text-purple-400 uppercase",children:"Beta"})]}),k!=="results"&&e.jsx("p",{className:"text-sm text-iron-500 mt-1",children:"Upload a video for AI-powered frame-by-frame form analysis"})]})]}),e.jsx("video",{ref:u,className:"hidden",muted:!0,playsInline:!0,preload:"metadata"}),e.jsx("canvas",{ref:b,className:"hidden"}),e.jsx(ye,{children:re&&e.jsxs(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-2",children:[e.jsx(Ut,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-300",children:re})]})}),k==="upload"&&e.jsxs(L.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsx("div",{onClick:()=>{var t;return!C&&((t=I.current)==null?void 0:t.click())},onDragOver:t=>{t.preventDefault(),V(!0)},onDragLeave:()=>V(!1),onDrop:vt,className:`relative rounded-2xl overflow-hidden transition-all duration-200 ${ie?"ring-2 ring-flame-500 bg-flame-500/5":C?"bg-black":"card-steel border-2 border-dashed border-iron-700 hover:border-flame-500/40 cursor-pointer"}`,children:C&&S?e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:w,src:S,className:"w-full aspect-video object-contain bg-black",playsInline:!0,loop:!0,muted:!0,onEnded:()=>te(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("button",{onClick:t=>{t.stopPropagation(),jt()},className:"w-14 h-14 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center hover:bg-black/80 transition-colors",children:le?e.jsx(Jt,{className:"w-6 h-6 text-white"}):e.jsx(Gt,{className:"w-6 h-6 text-white ml-0.5"})})}),e.jsx("div",{className:"absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/80 to-transparent p-4 pt-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white font-medium truncate max-w-[200px]",children:C.name}),e.jsxs("p",{className:"text-xs text-iron-400",children:[(C.size/(1024*1024)).toFixed(1),"MB"]})]}),e.jsx("button",{onClick:t=>{var a;t.stopPropagation(),(a=I.current)==null||a.click()},className:"text-xs text-flame-400 hover:text-flame-300 font-medium",children:"Change"})]})})]}):e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-iron-800/80 flex items-center justify-center mx-auto mb-4",children:e.jsx(ts,{className:`w-7 h-7 transition-colors ${ie?"text-flame-400":"text-iron-500"}`})}),e.jsx("p",{className:"text-iron-200 font-medium mb-1",children:"Drop a video here or tap to upload"}),e.jsx("p",{className:"text-xs text-iron-500",children:"MP4, MOV, WEBM up to 100MB"})]})}),e.jsx("input",{ref:I,type:"file",accept:"video/*",onChange:yt,className:"hidden","aria-label":"Upload video"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-iron-400 mb-1.5 block",children:"Exercise (optional)"}),e.jsxs("select",{value:K,onChange:t=>ce(t.target.value),className:"input-field w-full","aria-label":"Exercise selection",children:[e.jsx("option",{value:"",children:"Auto-detect"}),e.jsx("option",{value:"Bench Press",children:"Bench Press"}),e.jsx("option",{value:"Squat",children:"Squat"}),e.jsx("option",{value:"Deadlift",children:"Deadlift"}),e.jsx("option",{value:"Overhead Press",children:"Overhead Press"}),e.jsx("option",{value:"Barbell Row",children:"Barbell Row"}),e.jsx("option",{value:"Pull-up",children:"Pull-up"}),e.jsx("option",{value:"Romanian Deadlift",children:"Romanian Deadlift"}),e.jsx("option",{value:"Front Squat",children:"Front Squat"}),e.jsx("option",{value:"Hip Thrust",children:"Hip Thrust"}),e.jsx("option",{value:"Lunges",children:"Lunges"})]})]}),e.jsx(us,{exercise:K}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-iron-400 mb-1.5 block",children:"Note (optional)"}),e.jsx("input",{type:"text",value:g,onChange:t=>H(t.target.value),maxLength:200,placeholder:"e.g., checking squat depth, elbow pain on bench...",className:"input-field w-full","aria-label":"Analysis note"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"Analysis Depth"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(be).map(([t,a])=>e.jsxs("button",{onClick:()=>ee(t),className:`relative px-3 py-3 rounded-xl border transition-all text-center ${U===t?"border-flame-500 bg-flame-500/10 shadow-glow":"border-iron-700 hover:border-iron-600 bg-iron-900/50"}`,children:[t==="standard"&&e.jsx("span",{className:"absolute -top-2 left-1/2 -translate-x-1/2 text-[9px] font-bold px-1.5 py-0.5 rounded-full bg-flame-500 text-white uppercase",children:"Popular"}),e.jsx("div",{className:`text-sm font-semibold ${U===t?"text-flame-400":"text-iron-300"}`,children:a.label}),e.jsx("div",{className:"text-[11px] text-iron-500 mt-0.5",children:a.desc}),e.jsxs("div",{className:`text-xs font-semibold mt-1 ${U===t?"text-flame-400":"text-iron-400"}`,children:[a.credits," credits"]})]},t))})]}),i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-iron-400 mb-2",children:"AI Model"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>ne("standard"),className:`px-3 py-2 text-xs rounded-xl border transition-colors text-center ${z==="standard"?"border-flame-500 bg-flame-500/10 text-flame-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(nt,{className:"w-3 h-3"}),"Standard"]})}),e.jsx("button",{onClick:()=>ne("premium"),className:`px-3 py-2 text-xs rounded-xl border transition-colors text-center ${z==="premium"?"border-purple-500 bg-purple-500/10 text-purple-400":"border-iron-700 text-iron-400 hover:border-iron-600"}`,children:e.jsxs("div",{className:"font-medium flex items-center justify-center gap-1",children:[e.jsx(Wt,{className:"w-3 h-3"}),"Premium"]})})]})]}),e.jsxs("div",{className:"flex items-start gap-2.5 p-3 bg-iron-800/40 rounded-xl",children:[e.jsx(ot,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-iron-500 leading-relaxed",children:"Video is processed on your device â€” only extracted frames are sent for AI analysis. Trim your clip to start right before your first rep for the best frame selection."})]}),e.jsxs("button",{onClick:Nt,disabled:!C,className:"btn-primary w-full py-3.5 disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-base",children:[e.jsx($e,{className:"w-5 h-5"})," Extract Frames"]})]}),k==="upload"&&ke.length>0&&e.jsxs(L.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.15},className:"mt-4",children:[e.jsxs("button",{onClick:()=>bt(!Ce),className:"card-steel p-3 w-full flex items-center gap-3 hover:border-iron-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Qt,{className:"w-4 h-4 text-purple-400"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-iron-200",children:"Past Form Checks"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[ke.length," analysis",ke.length!==1?"es":""]})]}),e.jsx(rt,{className:`w-4 h-4 text-iron-500 transition-transform ${Ce?"rotate-180":""}`})]}),e.jsx(ye,{children:Ce&&e.jsx(L.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx("div",{className:"card-steel mt-1 divide-y divide-iron-800/50 max-h-72 overflow-y-auto",children:ke.map(t=>e.jsxs("button",{onClick:()=>kt(t),className:"w-full p-3 flex items-center gap-3 hover:bg-iron-800/30 transition-colors text-left",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${Oe(t.score)}`,children:e.jsx("span",{className:`text-sm font-bold ${ve(t.score)}`,children:t.score})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-iron-200 truncate",children:t.exercise}),e.jsxs("p",{className:"text-[11px] text-iron-500",children:[t.createdAt.toLocaleDateString(void 0,{month:"short",day:"numeric"})," Â· ",t.frameCount," frames Â· ",t.quality]})]}),e.jsx(He,{className:"w-4 h-4 text-iron-600 flex-shrink-0"})]},t.id))})})})]}),k==="extracting"&&e.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},className:"card-steel p-8 text-center",children:[e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-5",children:[e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-flame-500/20 animate-ping"}),e.jsx("div",{className:"relative w-16 h-16 rounded-2xl bg-flame-500/10 flex items-center justify-center",children:e.jsx($e,{className:"w-7 h-7 text-flame-400"})})]}),e.jsx("p",{className:"text-iron-200 font-semibold mb-1",children:X<=20?"Scanning for the actual lift...":X<=60?"Extracting key frames...":"Mapping movement..."}),e.jsx("p",{className:"text-xs text-iron-500 mb-4",children:X<=20?"Detecting when the lift starts":X<=60?`Capturing ${be[U].frames} frames`:gt||"Running pose estimation on each frame"}),e.jsx("div",{className:"w-56 h-2.5 bg-iron-800 rounded-full mx-auto overflow-hidden",children:e.jsx(L.div,{className:"h-full bg-gradient-to-r from-flame-500 to-flame-400 rounded-full",animate:{width:`${X}%`},transition:{duration:.3}})}),e.jsxs("p",{className:"text-xs text-iron-600 mt-2",children:[X,"%"]})]}),k==="preview"&&e.jsxs(L.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-iron-200",children:[n.length," frames captured"]}),O.length>0&&(O.filter(a=>a.poseDetected).length>0?e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-medium text-green-400 bg-green-500/10 px-1.5 py-0.5 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 inline-block"}),"Movement mapped"]}):null)]}),e.jsx("span",{className:"text-[11px] text-iron-500",children:n.length>0&&`${n[0].timestamp.toFixed(1)}s â€“ ${n[n.length-1].timestamp.toFixed(1)}s`})]}),e.jsx("div",{className:"flex gap-1.5 overflow-x-auto pb-2 -mx-1 px-1 scrollbar-hide",children:n.map((t,a)=>e.jsxs("div",{className:"relative flex-shrink-0 w-20 aspect-video rounded-lg overflow-hidden bg-iron-800 ring-1 ring-iron-700/50",children:[e.jsx("img",{src:t.dataUrl,alt:`Frame ${a+1}`,className:"w-full h-full object-cover"}),e.jsxs("span",{className:"absolute bottom-0.5 right-1 text-[9px] text-white/80 bg-black/60 px-1 rounded",children:[t.timestamp.toFixed(1),"s"]}),e.jsx("span",{className:"absolute top-0.5 left-1 text-[9px] text-white/60 font-semibold",children:a+1})]},a))})]}),g&&e.jsxs("div",{className:"card-steel p-3 flex items-start gap-2",children:[e.jsx(ot,{className:"w-3.5 h-3.5 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-iron-500 uppercase tracking-wider mb-0.5",children:"Note"}),e.jsx("p",{className:"text-sm text-iron-300",children:g})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_e,className:"btn-secondary flex-1 py-3",children:"Start Over"}),e.jsxs("button",{onClick:wt,className:"btn-primary flex-1 py-3 flex items-center justify-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4"}),"Analyze (",z==="premium"?xt:be[U].credits," credits)"]})]})]}),k==="analyzing"&&e.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx("div",{className:"card-steel p-6",children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-[100px] h-[100px] rounded-full bg-iron-800 animate-pulse flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-5 w-40 bg-iron-800 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-full bg-iron-800/60 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-3/4 bg-iron-800/60 rounded animate-pulse"})]})]})}),e.jsxs("div",{className:"card-steel p-5 text-center",children:[e.jsx(Kt,{className:"w-8 h-8 text-flame-400 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-iron-200 font-semibold mb-1",children:"Analyzing your form..."}),e.jsxs("p",{className:"text-xs text-iron-500 mb-4",children:[z==="premium"?"GPT-4o":"GPT-4o mini"," is reviewing each frame"]}),e.jsx(ye,{mode:"wait",children:e.jsx(L.p,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"text-xs text-iron-600 italic",children:De[he]},he)})]})]}),k==="results"&&o&&e.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(L.div,{className:"card-steel p-5",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(fs,{score:o.overallScore}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h2",{className:"text-lg font-display text-iron-100",children:o.exercise||"Exercise"}),o.variation&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-iron-800 text-iron-400 border border-iron-700",children:o.variation})]}),o.repsDetected>0&&e.jsxs("p",{className:"text-xs text-iron-500 mt-0.5",children:[o.repsDetected," rep",o.repsDetected!==1?"s":""," detected"]}),e.jsx("p",{className:"text-sm text-iron-400 mt-2 leading-relaxed",children:o.overallSummary})]})]})}),B&&e.jsxs(L.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3",children:"Movement Quality"}),e.jsxs("div",{className:"space-y-2.5",children:[B.stability&&e.jsx(Re,{label:"Stability",score:B.stability.score,note:B.stability.note}),B.rangeOfMotion&&e.jsx(Re,{label:"ROM",score:B.rangeOfMotion.score,note:B.rangeOfMotion.note}),B.control&&e.jsx(Re,{label:"Control",score:B.control.score,note:B.control.note}),B.alignment&&e.jsx(Re,{label:"Alignment",score:B.alignment.score,note:B.alignment.note})]})]}),e.jsxs(L.div,{className:"grid grid-cols-2 gap-3",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.3},children:[((Ke=o.keyStrengths)==null?void 0:Ke.length)>0&&e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-green-400 uppercase tracking-wider mb-2.5 flex items-center gap-1.5",children:[e.jsx(Yt,{className:"w-3.5 h-3.5"})," Strengths"]}),e.jsx("div",{className:"space-y-2",children:o.keyStrengths.map((t,a)=>e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t},a))})]}),((qe=o.keyIssues)==null?void 0:qe.length)>0&&e.jsxs("div",{className:"card-steel p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-red-400 uppercase tracking-wider mb-2.5 flex items-center gap-1.5",children:[e.jsx(Zt,{className:"w-3.5 h-3.5"})," Issues"]}),e.jsx("div",{className:"space-y-2",children:o.keyIssues.map((t,a)=>e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t},a))})]})]}),((Be=o.injuryRisks)==null?void 0:Be.length)>0&&e.jsxs(L.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.35},children:[e.jsxs("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[e.jsx(qt,{className:"w-3.5 h-3.5"})," Injury Risk Areas"]}),e.jsx("div",{className:"space-y-2.5",children:o.injuryRisks.map((t,a)=>e.jsxs("div",{className:`p-3 rounded-xl border ${xs(t.severity)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm",children:hs(t.severity)}),e.jsx("span",{className:"text-xs font-semibold",children:t.area}),e.jsx("span",{className:"text-[9px] uppercase tracking-wider opacity-70 ml-auto",children:t.severity})]}),e.jsx("p",{className:"text-[11px] opacity-80 leading-relaxed",children:t.description}),t.fix&&e.jsxs("p",{className:"text-[11px] mt-1.5 opacity-90",children:[e.jsx("span",{className:"font-semibold",children:"Fix:"})," ",t.fix]})]},a))})]}),n.length>0&&((ze=o.frames)==null?void 0:ze.length)>0&&e.jsxs(L.div,{className:"card-steel overflow-hidden",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider px-4 pt-4 pb-2",children:"Frame-by-Frame"}),e.jsxs("div",{className:"relative",onTouchStart:t=>{t.currentTarget.dataset.touchX=t.touches[0].clientX},onTouchEnd:t=>{const a=t.changedTouches[0].clientX-Number(t.currentTarget.dataset.touchX||0);a>50&&c>0&&E(c-1),a<-50&&c<n.length-1&&E(c+1)},children:[e.jsx(ut,{dataUrl:(Ve=n[c])==null?void 0:Ve.dataUrl,joints:xe[c]||null,metrics:O[c]||null,exercise:o.exercise,show:Y}),e.jsxs("div",{className:"absolute top-3 left-3 flex items-center gap-2",children:[q&&(Number(q.formScore)>0?e.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded-lg backdrop-blur-sm ${Oe(Number(q.formScore))} ${ve(Number(q.formScore))}`,children:[q.formScore,"/10"]}):e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-lg backdrop-blur-sm bg-iron-700/80 text-iron-400",children:"Not scored"})),(q==null?void 0:q.phase)&&e.jsx(pt,{phase:q.phase})]}),xe.some(t=>t!==null)&&e.jsx("button",{onClick:()=>me(t=>!t),className:"absolute top-3 right-12 p-1.5 rounded-lg bg-black/60 backdrop-blur-sm hover:bg-black/80 transition-colors",title:Y?"Hide skeleton overlay":"Show skeleton overlay",children:Y?e.jsx(it,{className:"w-4 h-4 text-white/80"}):e.jsx(ct,{className:"w-4 h-4 text-white/40"})}),e.jsx("button",{onClick:()=>ue(!0),className:"absolute top-3 right-3 p-1.5 rounded-lg bg-black/60 backdrop-blur-sm hover:bg-black/80 transition-colors",title:"Fullscreen",children:e.jsx(es,{className:"w-4 h-4 text-white/80"})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5 bg-iron-900/80 border-t border-iron-800/50",children:[e.jsx("button",{onClick:()=>E(Math.max(0,c-1)),disabled:c===0,"aria-label":"Previous frame",className:"w-10 h-10 rounded-xl bg-iron-800 border border-iron-700 flex items-center justify-center transition-colors hover:bg-iron-700 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(dt,{className:"w-5 h-5 text-iron-200"})}),e.jsx("div",{className:"flex-1 flex items-center gap-1 overflow-x-auto px-1",children:n.map((t,a)=>{var N;const x=(N=o.frames)==null?void 0:N[a],j=Number(x==null?void 0:x.formScore)||0;return e.jsx("button",{onClick:()=>E(a),"aria-label":`Frame ${a+1}`,className:`flex-1 min-w-[12px] rounded-full transition-all ${a===c?`h-3 ${j>0?ht(j):"bg-iron-400"} shadow-sm ring-1 ring-white/20`:`h-2 ${j>0?mt(j):"bg-iron-700/50"} hover:h-2.5`}`,title:`Frame ${a+1}: ${(x==null?void 0:x.phase)||""} ${j>0?`(${j}/10)`:"(not scored)"}`},a)})}),e.jsx("button",{onClick:()=>E(Math.min(n.length-1,c+1)),disabled:c===n.length-1,"aria-label":"Next frame",className:"w-10 h-10 rounded-xl bg-iron-800 border border-iron-700 flex items-center justify-center transition-colors hover:bg-iron-700 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(lt,{className:"w-5 h-5 text-iron-200"})}),e.jsxs("span",{className:"text-xs text-iron-500 font-mono w-10 text-center flex-shrink-0",children:[c+1,"/",n.length]})]}),q&&e.jsxs("div",{className:"p-4 border-t border-iron-800/50",children:[e.jsx("p",{className:"text-sm text-iron-200 leading-relaxed",children:q.assessment}),((Xe=q.cues)==null?void 0:Xe.length)>0&&e.jsx("div",{className:"mt-2.5 space-y-1.5",children:q.cues.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(He,{className:"w-3 h-3 text-flame-400 mt-1 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:t})]},a))})]})]}),e.jsx(ye,{children:Ne&&n.length>0&&e.jsxs(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black flex flex-col",onTouchStart:t=>{t.currentTarget.dataset.touchX=t.touches[0].clientX},onTouchEnd:t=>{const a=t.changedTouches[0].clientX-Number(t.currentTarget.dataset.touchX||0);a>50&&c>0&&E(c-1),a<-50&&c<n.length-1&&E(c+1)},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{var x;const t=(x=o.frames)==null?void 0:x[c],a=Number(t==null?void 0:t.formScore)||0;return a>0?e.jsxs("span",{className:`text-sm font-bold px-2.5 py-1 rounded-lg ${Oe(a)} ${ve(a)}`,children:[a,"/10"]}):e.jsx("span",{className:"text-sm font-medium px-2.5 py-1 rounded-lg bg-iron-800 text-iron-400",children:"Not scored"})})(),(()=>{var a;const t=(a=o.frames)==null?void 0:a[c];return(t==null?void 0:t.phase)&&e.jsx(pt,{phase:t.phase})})(),e.jsxs("span",{className:"text-xs text-iron-500 font-mono ml-1",children:[c+1,"/",n.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[xe.some(t=>t!==null)&&e.jsx("button",{onClick:()=>me(t=>!t),className:"p-2 rounded-lg bg-iron-800 hover:bg-iron-700 transition-colors",children:Y?e.jsx(it,{className:"w-4 h-4 text-white/80"}):e.jsx(ct,{className:"w-4 h-4 text-white/40"})}),e.jsx("button",{onClick:()=>ue(!1),className:"p-2 rounded-lg bg-iron-800 hover:bg-iron-700 transition-colors",children:e.jsx(Bt,{className:"w-4 h-4 text-white/80"})})]})]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(ut,{dataUrl:(Je=n[c])==null?void 0:Je.dataUrl,joints:xe[c]||null,metrics:O[c]||null,exercise:o.exercise,show:Y})}),(()=>{var a,x;const t=(a=o.frames)==null?void 0:a[c];return t?e.jsxs("div",{className:"flex-shrink-0 px-4 pt-3 pb-4 max-h-40 overflow-y-auto",children:[e.jsx("p",{className:"text-sm text-iron-200 leading-relaxed",children:t.assessment}),((x=t.cues)==null?void 0:x.length)>0&&e.jsx("div",{className:"mt-2 space-y-1",children:t.cues.map((j,N)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(He,{className:"w-3 h-3 text-flame-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed",children:j})]},N))})]}):null})(),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 px-4 pb-6",children:[e.jsx("button",{onClick:()=>E(Math.max(0,c-1)),disabled:c===0,className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center disabled:opacity-30",children:e.jsx(dt,{className:"w-5 h-5 text-iron-200"})}),e.jsx("div",{className:"flex-1 flex items-center gap-1",children:n.map((t,a)=>{var N;const x=(N=o.frames)==null?void 0:N[a],j=Number(x==null?void 0:x.formScore)||0;return e.jsx("button",{onClick:()=>E(a),className:`flex-1 min-w-[12px] rounded-full transition-all ${a===c?`h-3 ${j>0?ht(j):"bg-iron-400"} ring-1 ring-white/20`:`h-2 ${j>0?mt(j):"bg-iron-700/50"}`}`},a)})}),e.jsx("button",{onClick:()=>E(Math.min(n.length-1,c+1)),disabled:c===n.length-1,className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center disabled:opacity-30",children:e.jsx(lt,{className:"w-5 h-5 text-iron-200"})})]})]})}),o.focusDrill&&e.jsxs(L.div,{className:"relative overflow-hidden rounded-2xl border border-flame-500/20",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-flame-500/10 via-transparent to-transparent"}),e.jsxs("div",{className:"relative p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(zt,{className:"w-4 h-4 text-flame-400"}),e.jsx("h3",{className:"text-sm font-semibold text-flame-400",children:"Focus Next Session"})]}),e.jsx("p",{className:"text-sm font-semibold text-iron-100 mb-1",children:o.focusDrill.title}),e.jsx("p",{className:"text-xs text-iron-400 leading-relaxed mb-3",children:o.focusDrill.description}),o.focusDrill.cue&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-flame-500/15 rounded-lg border border-flame-500/20",children:[e.jsx("span",{className:"text-xs text-iron-500",children:"Cue:"}),e.jsxs("span",{className:"text-sm font-semibold text-flame-300",children:['"',o.focusDrill.cue,'"']})]})]})]}),((Qe=o.recommendations)==null?void 0:Qe.length)>0&&e.jsxs(L.div,{className:"card-steel p-4",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.55},children:[e.jsx("h3",{className:"text-xs font-semibold text-iron-400 uppercase tracking-wider mb-3",children:"Recommendations"}),e.jsx("div",{className:"space-y-2.5",children:(W?o.recommendations:o.recommendations.slice(0,3)).map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 text-[10px] font-bold ${a===0?"bg-flame-500/20 text-flame-400":"bg-iron-800 text-iron-500"}`,children:a+1}),e.jsx("p",{className:"text-sm text-iron-300 leading-relaxed",children:t})]},a))}),o.recommendations.length>3&&e.jsxs("button",{onClick:()=>Q(!W),className:"mt-3 text-xs text-iron-500 hover:text-iron-300 flex items-center gap-1 transition-colors",children:[W?e.jsx(Vt,{className:"w-3.5 h-3.5"}):e.jsx(rt,{className:"w-3.5 h-3.5"}),W?"Show less":`Show ${o.recommendations.length-3} more`]})]}),e.jsxs("button",{onClick:_e,className:"btn-secondary w-full py-3 flex items-center justify-center gap-2",children:[e.jsx(Xt,{className:"w-4 h-4"})," Analyze Another Video"]})]})]})}export{Ls as default};
