import{b as ie,d as le,r as l,av as oe,aw as h,ag as ce,j as e,ax as H,A as de,i as y,ac as me,z as xe,l as pe,n as ue,o as he,m as ge,ae as fe,I as Y,J as je,K as be,q as Ne,ar as G,ay as we}from"./index-Bu1DCD4H.js";import{C as ye,X}from"./x-circle-D_SPWch0.js";import{C as ve}from"./clock-ySZ75key.js";import{P as z}from"./pen-Cs0n1Yg6.js";import{F as J}from"./file-text-CAgGEGff.js";import{T as ke}from"./trash-2-b18YEtdV.js";const Ce={pending:"bg-yellow-500/10 text-yellow-400 border-yellow-500/20",in_progress:"bg-blue-500/10 text-blue-400 border-blue-500/20",completed:"bg-green-500/10 text-green-400 border-green-500/20",denied:"bg-red-500/10 text-red-400 border-red-500/20",cancelled:"bg-iron-800 text-iron-500 border-iron-700"},Se={pending:"Pending",in_progress:"In Progress",completed:"Completed",denied:"Denied",cancelled:"Cancelled"},Ae={custom_workout:"Custom Workout",review:"Workout Review"};function Pe(){const c=ie(),{user:d,userProfile:K}=le(),[v,k]=l.useState([]),[Q,C]=l.useState(!0),[S,A]=l.useState(null),[D,V]=l.useState({}),[Z,L]=l.useState({}),[q,ee]=l.useState({}),[m,T]=l.useState("active"),[E,R]=l.useState(null),[g,f]=l.useState(null),j=oe.isTrainer(K,d==null?void 0:d.email);l.useEffect(()=>{j&&b()},[j]);const b=async()=>{C(!0);try{const s=await h.getAll();k(s);const t=[...new Set(s.map(a=>a.userId))],r={};await Promise.all(t.map(async a=>{try{const o=await ce.get(a);o&&(r[a]=o)}catch{}})),ee(r)}catch(s){console.error("Error loading requests:",s)}finally{C(!1)}},se=async s=>{if(!D[s]){L(t=>({...t,[s]:!0}));try{const t=await h.getUserSummary(s);V(r=>({...r,[s]:t}))}catch(t){console.error("Error loading user summary:",t)}finally{L(t=>({...t,[s]:!1}))}}},te=async s=>{R(s);try{await h.claim(s,d.uid),await b()}catch(t){console.error("Error claiming request:",t)}finally{R(null)}},I=async s=>{try{await h.deny(s.id,"");const t=s.type==="custom_workout"?G["trainer-custom-workout"]:G["trainer-review"];await we.add(s.userId,t),await b()}catch(t){console.error("Error denying request:",t)}},ae=async s=>{if(g!==s){f(s);return}try{await h.delete(s),k(t=>t.filter(r=>r.id!==s)),f(null)}catch(t){console.error("Error deleting request:",t),f(null)}},ne=(s,t)=>{S===s?A(null):(A(s),se(t))};if(!j)return e.jsxs("div",{className:"max-w-3xl mx-auto py-12 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-iron-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-display text-iron-200 mb-2",children:"Trainer Access Required"}),e.jsx("p",{className:"text-iron-500 mb-6",children:"You need to be an approved trainer to access this page. Apply in Settings."}),e.jsx("button",{onClick:()=>c("/settings"),className:"btn-primary px-6 py-2",children:"Go to Settings"})]});const N=v.filter(s=>["pending","in_progress"].includes(s.status)),w=v.filter(s=>["completed","denied","cancelled"].includes(s.status)),P=m==="active"?N:w;return e.jsxs("div",{className:"max-w-4xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>c(-1),className:"p-2 text-iron-400 hover:text-iron-100 hover:bg-iron-800 rounded-plate transition-colors",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"font-display text-display-md text-iron-50",children:"Trainer Dashboard"}),e.jsx("p",{className:"text-iron-400",children:"Manage workout requests from users"})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>T("active"),className:`px-4 py-2 text-sm rounded-lg transition-colors flex items-center gap-2 ${m==="active"?"bg-flame-500 text-white":"bg-iron-800 text-iron-400 hover:text-iron-200"}`,children:["Active",N.length>0&&e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${m==="active"?"bg-white/20":"bg-flame-500/20 text-flame-400"}`,children:N.length})]}),e.jsxs("button",{onClick:()=>T("completed"),className:`px-4 py-2 text-sm rounded-lg transition-colors flex items-center gap-2 ${m==="completed"?"bg-green-500 text-white":"bg-iron-800 text-iron-400 hover:text-iron-200"}`,children:["Completed",w.length>0&&e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${m==="completed"?"bg-white/20":"bg-iron-700"}`,children:w.length})]})]}),Q?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-flame-400"})}):P.length===0?e.jsxs("div",{className:"card-steel p-12 text-center",children:[e.jsx(ye,{className:"w-10 h-10 text-green-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-iron-200 mb-1",children:m==="active"?"All caught up":"No completed requests yet"}),e.jsx("p",{className:"text-iron-500",children:m==="active"?"No pending requests right now.":"Completed and denied requests will appear here."})]}):e.jsx("div",{className:"space-y-3",children:P.sort((s,t)=>{var o,x,p,u;const r=((x=(o=s.createdAt)==null?void 0:o.toDate)==null?void 0:x.call(o))||new Date(0);return(((u=(p=t.createdAt)==null?void 0:p.toDate)==null?void 0:u.call(p))||new Date(0))-r}).map(s=>{var p,u,W,_,$,U,F,M,O;const t=q[s.userId],r=S===s.id,a=D[s.userId],o=Z[s.userId],x=!!s.workoutId;return e.jsxs("div",{className:"card-steel rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>ne(s.id,s.userId),className:"w-full p-4 flex items-center gap-3 hover:bg-iron-800/30 transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-iron-800 flex items-center justify-center flex-shrink-0 overflow-hidden",children:t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx(me,{className:"w-5 h-5 text-iron-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-sm font-medium text-iron-100 truncate",children:(t==null?void 0:t.displayName)||"User"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full border ${Ce[s.status]}`,children:Se[s.status]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-iron-500",children:[e.jsx("span",{className:s.type==="custom_workout"?"text-flame-400":"text-purple-400",children:Ae[s.type]}),((p=s.createdAt)==null?void 0:p.toDate)&&e.jsx("span",{children:xe((W=(u=s.createdAt)==null?void 0:u.toDate)==null?void 0:W.call(u),"MMM d, h:mm a")}),s.targetDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"})," Due ",s.targetDate]})]})]}),r?e.jsx(pe,{className:"w-5 h-5 text-iron-500"}):e.jsx(ue,{className:"w-5 h-5 text-iron-500"})]}),e.jsx(he,{children:r&&e.jsx(ge.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-iron-800",children:[s.notes&&e.jsxs("div",{className:"mt-4 p-3 bg-iron-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(fe,{className:"w-3.5 h-3.5 text-iron-400"}),e.jsx("span",{className:"text-xs font-medium text-iron-400",children:"User Notes"})]}),e.jsx("p",{className:"text-sm text-iron-200",children:s.notes})]}),x&&e.jsxs("button",{onClick:()=>c(`/workouts/${s.workoutId}/edit`),className:`mt-4 w-full p-3 bg-flame-500/10 border border-flame-500/20 rounded-lg
                                text-sm text-flame-300 hover:bg-flame-500/20 transition-colors flex items-center gap-2`,children:[e.jsx(z,{className:"w-4 h-4"}),"Edit Linked Workout"]}),s.type==="review"&&s.workoutId&&!x&&e.jsxs("button",{onClick:()=>c(`/workouts/${s.workoutId}/edit`),className:`mt-4 w-full p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg
                                text-sm text-purple-300 hover:bg-purple-500/20 transition-colors flex items-center gap-2`,children:[e.jsx(J,{className:"w-4 h-4"}),"Open Workout to Review"]}),["pending","in_progress"].includes(s.status)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-xs font-medium text-iron-400 uppercase tracking-wider mb-3",children:"Athlete Summary"}),o?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-iron-500 py-4",children:[e.jsx(y,{className:"w-3 h-3 animate-spin"})," Loading athlete data..."]}):a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-iron-400",children:[((_=a.profile)==null?void 0:_.weight)&&e.jsxs("span",{children:["Weight: ",a.profile.weight,"lbs"]}),(($=a.profile)==null?void 0:$.height)&&e.jsxs("span",{children:["Height: ",a.profile.height]}),((U=a.profile)==null?void 0:U.age)&&e.jsxs("span",{children:["Age: ",a.profile.age]}),((F=a.profile)==null?void 0:F.activityLevel)&&e.jsx("span",{children:a.profile.activityLevel})]}),Object.keys(a.maxLifts||{}).length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(Y,{className:"w-3.5 h-3.5 text-flame-400"}),e.jsx("span",{className:"text-xs font-medium text-iron-300",children:"Top Lifts"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Object.entries(a.maxLifts).sort((n,i)=>i[1].e1rm-n[1].e1rm).slice(0,6).map(([n,i])=>e.jsxs("div",{className:"text-xs px-2 py-1.5 bg-iron-800/50 rounded",children:[e.jsx("span",{className:"text-iron-300",children:n}),e.jsxs("span",{className:"text-iron-500 ml-1",children:[i.e1rm,"lb e1RM"]})]},n))})]}),Object.keys(a.painHistory||{}).length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(je,{className:"w-3.5 h-3.5 text-red-400"}),e.jsx("span",{className:"text-xs font-medium text-iron-300",children:"Pain Areas"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Object.entries(a.painHistory).map(([n,i])=>e.jsxs("span",{className:"text-xs px-2 py-1 bg-red-500/10 text-red-300 rounded",children:[n,": ",i.maxPain,"/10 (",i.count,"x)"]},n))})]}),((M=a.goals)==null?void 0:M.length)>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(be,{className:"w-3.5 h-3.5 text-green-400"}),e.jsx("span",{className:"text-xs font-medium text-iron-300",children:"Active Goals"})]}),e.jsx("div",{className:"space-y-1",children:a.goals.map((n,i)=>e.jsxs("div",{className:"text-xs text-iron-400",children:[n.lift||n.metricType,": ",n.currentWeight||"?"," â†’ ",n.targetWeight||"?"]},i))})]}),((O=a.recentWorkouts)==null?void 0:O.length)>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-iron-300",children:"Recent Sessions"})]}),e.jsx("div",{className:"space-y-1.5",children:a.recentWorkouts.slice(0,3).map((n,i)=>{var B;return e.jsxs("div",{className:"text-xs p-2 bg-iron-800/50 rounded",children:[e.jsxs("div",{className:"flex justify-between mb-0.5",children:[e.jsx("span",{className:"text-iron-200 font-medium",children:n.name}),e.jsx("span",{className:"text-iron-500",children:n.date})]}),e.jsx("div",{className:"text-iron-500",children:(B=n.exercises)==null?void 0:B.map(re=>re.name).join(", ")})]},i)})})]})]}):e.jsx("p",{className:"text-xs text-iron-600",children:"No data available"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>te(s.id),disabled:E===s.id,className:`flex-1 py-2.5 bg-flame-500 hover:bg-flame-400 text-white rounded-lg
                                    text-sm font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50`,children:[E===s.id?e.jsx(y,{className:"w-4 h-4 animate-spin"}):e.jsx(Ne,{className:"w-4 h-4"}),"Claim"]}),e.jsxs("button",{onClick:()=>I(s),className:`py-2.5 px-4 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg
                                    text-sm font-medium flex items-center justify-center gap-2 transition-colors`,children:[e.jsx(X,{className:"w-4 h-4"})," Deny"]})]}),s.status==="in_progress"&&s.trainerId===(d==null?void 0:d.uid)&&e.jsxs(e.Fragment,{children:[s.type==="custom_workout"&&e.jsx("button",{onClick:()=>{if(x)c(`/workouts/${s.workoutId}/edit`);else{const n=new URLSearchParams({userId:s.userId,requestId:s.id});s.targetDate&&n.set("date",s.targetDate),c(`/workouts/new?${n.toString()}`)}},className:`flex-1 py-2.5 bg-flame-500 hover:bg-flame-400 text-white rounded-lg
                                      text-sm font-medium flex items-center justify-center gap-2 transition-colors`,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4"})," Edit Workout"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4"})," Create Workout"]})}),s.type==="review"&&s.workoutId&&e.jsxs("button",{onClick:()=>c(`/workouts/${s.workoutId}/edit`),className:`flex-1 py-2.5 bg-purple-500 hover:bg-purple-400 text-white rounded-lg
                                      text-sm font-medium flex items-center justify-center gap-2 transition-colors`,children:[e.jsx(J,{className:"w-4 h-4"})," Review Workout"]}),e.jsxs("button",{onClick:()=>I(s),className:`py-2.5 px-4 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg
                                    text-sm font-medium flex items-center justify-center gap-2 transition-colors`,children:[e.jsx(X,{className:"w-4 h-4"})," Deny"]})]}),["completed","denied","cancelled"].includes(s.status)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ae(s.id),className:`py-2.5 px-4 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors ${g===s.id?"bg-red-500 hover:bg-red-600 text-white flex-1":"bg-red-500/10 hover:bg-red-500/20 text-red-400"}`,children:[e.jsx(ke,{className:"w-4 h-4"}),g===s.id?"Tap to confirm":"Delete"]}),g===s.id&&e.jsx("button",{onClick:()=>f(null),className:"py-2.5 px-4 bg-iron-800 hover:bg-iron-700 text-iron-400 rounded-lg text-sm font-medium transition-colors",children:"Cancel"})]})]})]})})})]},s.id)})})]})}export{Pe as default};
