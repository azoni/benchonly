import{a as ee,b as se,d as te,u as ae,r as j,j as e,A as K,I as V,L as re,p as le,Z as ne,H as ie,f as Z,g as ce,y as oe,z as xe}from"./index-1OrUyFOO.js";import{W as de}from"./WorkoutSummaryCard-CME_7x-z.js";import{E as me}from"./ExerciseInfoModal-BLbRJy1u.js";import{M as k}from"./message-square-DWFO1tdv.js";import"./external-link-CVgE83-U.js";const pe=a=>{if(a.type)return a.type;const n=a.sets||[];return n.some(x=>x.prescribedTime||x.actualTime)?"time":!n.some(x=>x.prescribedWeight||x.actualWeight)&&n.some(x=>x.prescribedReps||x.actualReps)?"bodyweight":"weight"},he=a=>{switch(a){case"time":return{label:"Time",color:"bg-blue-500/20 text-blue-400"};case"bodyweight":return{label:"BW",color:"bg-emerald-500/20 text-emerald-400"};default:return null}},ue=(a,n)=>!a||!n||n<1?null:n===1?a:n>30?null:Math.round(a*(1+n/30)),W=(a,n="MMM d, yyyy")=>{if(!a)return"";try{const N=oe(a);return isNaN(N.getTime())?"":xe(N,n)}catch{return""}},fe=a=>a>=9?"text-red-400":a>=7?"text-yellow-400":"text-green-400",ge=a=>a>=7?"bg-red-500/20 text-red-400":a>=4?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400";function Re(){var S,A,P,I;const{groupId:a,batchKey:n}=ee(),N=se(),{user:x}=te();ae("Group Workout Batch");const[be,q]=j.useState(null),[E,z]=j.useState([]),[p,O]=j.useState([]),[M,J]=j.useState(0),[Q,X]=j.useState(!0),[L,$]=j.useState(null),B=decodeURIComponent(n);if(j.useEffect(()=>{async function i(){if(!(!a||!x))try{const[d,t]=await Promise.all([Z.getById(a),ce.getByGroup(a,x.uid)]);if(q(d),d!=null&&d.members){const o=await Z.getMemberDetails(d.members);z(o)}const f=t.filter(o=>{const u=W(o.date,"yyyy-MM-dd");return`${o.name}-${u}`===B});O(f)}catch(d){console.error("Error loading batch view:",d)}finally{X(!1)}}i()},[a,n,x,B]),Q)return e.jsx("div",{className:"min-h-[50vh] flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-4 border-flame-500 border-t-transparent rounded-full animate-spin"})});if(p.length===0)return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>N(`/groups/${a}`),className:"flex items-center gap-2 text-iron-400 hover:text-iron-200 mb-6",children:[e.jsx(K,{className:"w-5 h-5"}),"Back to Group"]}),e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-iron-700 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-500",children:"No workouts found for this batch"})]})]});const Y=((S=p[0])==null?void 0:S.name)||"Workout",_=W((A=p[0])==null?void 0:A.date,"EEE, MMM d"),C=p.filter(i=>i.status==="completed").length,r=p[M]||p[0],m=E.find(i=>i.uid===(r==null?void 0:r.assignedTo)),h=(r==null?void 0:r.status)==="completed";return e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6 pb-32",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:()=>N(`/groups/${a}`,{state:{activeTab:"workouts"}}),className:"p-2 -ml-2 text-iron-400 hover:text-iron-200 transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl font-bold text-iron-50 truncate",children:Y}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-iron-500",children:[e.jsx("span",{children:_}),e.jsx("span",{children:"·"}),e.jsxs("span",{className:C===p.length?"text-green-400":"",children:[C,"/",p.length," done"]})]})]})]}),e.jsx("div",{className:"mb-6 -mx-4 px-4",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:p.map((i,d)=>{var u,v;const t=E.find(R=>R.uid===i.assignedTo),f=d===M,o=i.status==="completed";return e.jsxs("button",{onClick:()=>J(d),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl whitespace-nowrap transition-all flex-shrink-0 ${f?"bg-flame-500 text-white shadow-lg shadow-flame-500/20":"bg-iron-800/50 text-iron-400 hover:bg-iron-800 hover:text-iron-200"}`,children:[t!=null&&t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${f?"bg-white/20":"bg-iron-700"}`,children:((u=t==null?void 0:t.displayName)==null?void 0:u[0])||"?"}),e.jsx("span",{className:"text-sm font-medium",children:((v=t==null?void 0:t.displayName)==null?void 0:v.split(" ")[0])||"Unknown"}),o&&e.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${f?"bg-green-300":"bg-green-500"}`})]},i.id)})})}),r&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m!=null&&m.photoURL?e.jsx("img",{src:m.photoURL,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-iron-700 flex items-center justify-center",children:e.jsx("span",{className:"text-sm text-iron-400",children:((P=m==null?void 0:m.displayName)==null?void 0:P[0])||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-iron-100",children:(m==null?void 0:m.displayName)||"Unknown"}),e.jsxs("p",{className:"text-xs text-iron-500",children:[h?"Completed":"Pending",r.completedAt&&` · ${W(r.completedAt,"MMM d, h:mm a")}`]})]})]}),e.jsx(re,{to:`/workouts/group/${r.id}`,state:{from:`/groups/${a}/batch/${n}`,fromLabel:"Back to Batch"},className:"text-sm text-flame-400 hover:text-flame-300 font-medium",children:"View Full →"})]}),r.coachingNotes&&e.jsxs("div",{className:"card-steel p-4 mb-4 bg-flame-500/5 border-flame-500/10",children:[e.jsx("p",{className:"text-xs text-flame-400 mb-1.5",children:"AI Coaching Notes"}),e.jsx("p",{className:"text-sm text-iron-400 leading-relaxed",children:r.coachingNotes})]}),r.notes&&e.jsx("div",{className:"card-steel p-4 mb-4",children:e.jsx("p",{className:"text-iron-300 text-sm",children:r.notes})}),((I=r.exercises)==null?void 0:I.length)>0&&e.jsx(de,{exercises:r.exercises,isCompleted:h}),e.jsx("div",{className:"space-y-4",children:le(r.exercises||[]).map((i,d)=>{var v,R,D,F,U,G,H;if(i.type==="superset"){const{exerciseA:s,exerciseB:c}=i,g=(b,l)=>{const y=b.type==="time",w=b.type==="bodyweight",T=y?!!l.actualTime:w?!!l.actualReps:!!(l.actualWeight||l.actualReps);return y?h&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualTime,"s ",e.jsxs("span",{className:"text-xs text-iron-500 font-normal",children:["target ",l.prescribedTime||"—","s"]})]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedTime||"—","s"]}):w?h&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualReps||"—"," reps"]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedReps||"—"," reps"]}):h&&T?e.jsxs("span",{className:"text-base font-bold text-flame-400",children:[l.actualWeight||"—"," × ",l.actualReps||"—"," ",e.jsxs("span",{className:"text-xs text-iron-500 font-normal",children:["target ",l.prescribedWeight||"—"," × ",l.prescribedReps||"—"]})]}):e.jsxs("span",{className:"text-base font-bold text-iron-100",children:[l.prescribedWeight||"—"," lbs × ",l.prescribedReps||"—"]})};return e.jsxs("div",{className:"card-steel overflow-hidden border border-purple-500/20",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-purple-500/10 text-purple-400 text-xs font-semibold",children:[e.jsx(ne,{className:"w-3 h-3"})," Superset"]}),e.jsxs("h3",{className:"text-lg font-semibold text-iron-50 flex-1",children:[s.name," ",e.jsx("span",{className:"text-iron-600",children:"/"})," ",c.name]})]}),e.jsxs("p",{className:"text-sm text-iron-500 mt-1",children:[((v=s.sets)==null?void 0:v.length)||0," sets"]})]}),e.jsx("div",{className:"divide-y divide-iron-800/50",children:(R=s.sets)==null?void 0:R.map((b,l)=>{var w;const y=(w=c.sets)==null?void 0:w[l];return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:l+1})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-purple-400 font-medium mb-0.5",children:["A — ",s.name]}),g(s,b)]}),y&&e.jsxs("div",{className:"pt-1.5 border-t border-iron-700/30",children:[e.jsxs("p",{className:"text-xs text-purple-400 font-medium mb-0.5",children:["B — ",c.name]}),g(c,y)]})]})]})},l)})}),(s.notes||c.notes)&&e.jsxs("div",{className:"px-4 pb-2 space-y-1",children:[s.notes&&e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-iron-400",children:[e.jsx("span",{className:"text-purple-400",children:"A:"})," ",s.notes]})]}),c.notes&&e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-iron-400",children:[e.jsx("span",{className:"text-purple-400",children:"B:"})," ",c.notes]})]})]})]},`ss-${i.supersetGroup}`)}const t=i.exercise,f=i.index,o=pe(t),u=he(o);return e.jsxs("div",{className:"card-steel overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-iron-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>$(t),className:"text-lg font-semibold text-iron-50 hover:text-flame-400 transition-colors text-left flex items-center gap-1.5",children:[t.name,e.jsx(ie,{className:"w-3.5 h-3.5 text-iron-600 flex-shrink-0"})]}),u&&e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${u.color}`,children:u.label})]}),e.jsxs("p",{className:"text-sm text-iron-500 mt-1",children:[((D=t.sets)==null?void 0:D.length)||0," sets"]})]}),e.jsx("div",{className:"divide-y divide-iron-800/50",children:(F=t.sets)==null?void 0:F.map((s,c)=>{const g=o==="time"?s.actualTime:o==="bodyweight"?s.actualReps:s.actualWeight||s.actualReps,b=o==="weight"&&g&&s.actualWeight&&s.actualReps&&parseInt(s.actualReps)>1?ue(parseFloat(s.actualWeight),parseInt(s.actualReps)):null;return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-iron-800 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-bold text-iron-400",children:c+1})}),e.jsx("div",{className:"flex-1",children:o==="time"?h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedTime||"—","s"]}),g?e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualTime||"—"," seconds"]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("div",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedTime||"—"," seconds"]}):o==="bodyweight"?h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedReps||"—"," reps"]}),g?e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualReps||"—"," reps"]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("div",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedReps||"—"," reps"]}):h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-iron-500 mb-1",children:["Target: ",s.prescribedWeight||"—"," lbs × ",s.prescribedReps||"—"," reps"]}),g?e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("span",{className:"text-2xl font-bold text-flame-400",children:[s.actualWeight||"—"," lbs × ",s.actualReps||"—"]}),b&&e.jsxs("span",{className:"text-sm text-iron-500 bg-iron-800 px-2 py-1 rounded-lg",children:["e1RM: ",b," lbs"]})]}):e.jsx("span",{className:"text-lg text-iron-600",children:"Not logged"})]}):e.jsxs("span",{className:"text-2xl font-bold text-iron-100",children:[s.prescribedWeight||"—"," lbs × ",s.prescribedReps||"—",s.targetRpe&&e.jsxs("span",{className:"text-sm text-iron-500 font-normal ml-2",children:["@ RPE ",s.targetRpe]})]})})]})},c)})}),h&&(t.rpe||t.painLevel>0||((U=t.sets)==null?void 0:U.some(s=>s.rpe||s.painLevel>0)))&&e.jsxs("div",{className:"px-4 pb-2 flex items-center gap-3",children:[(t.rpe||((G=t.sets)==null?void 0:G.some(s=>s.rpe)))&&(()=>{const s=t.rpe||Math.max(0,...(t.sets||[]).map(c=>parseFloat(c.rpe)||0));return e.jsxs("span",{className:`text-sm font-semibold ${fe(s)}`,children:["RPE ",s]})})(),(t.painLevel>0||((H=t.sets)==null?void 0:H.some(s=>s.painLevel>0)))&&(()=>{const s=t.painLevel||Math.max(0,...(t.sets||[]).map(c=>c.painLevel||0));return e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${ge(s)}`,children:["Pain ",s]})})()]}),t.notes&&e.jsx("div",{className:"px-4 pb-2",children:e.jsxs("div",{className:"flex items-start gap-2 bg-iron-800/30 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-iron-500 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-iron-400",children:t.notes})]})}),t.userNotes&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex items-start gap-2 bg-flame-500/5 border border-flame-500/10 rounded-lg p-3",children:[e.jsx(k,{className:"w-4 h-4 text-flame-400/60 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-iron-500 mb-0.5",children:"Their Notes"}),e.jsx("p",{className:"text-sm text-iron-400",children:t.userNotes})]})]})})]},f)})}),(!r.exercises||r.exercises.length===0)&&e.jsxs("div",{className:"card-steel p-8 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-iron-700 mx-auto mb-3"}),e.jsx("p",{className:"text-iron-500",children:"No exercises in this workout"})]})]}),L&&e.jsx(me,{exercise:L,onClose:()=>$(null)})]})}export{Re as default};
